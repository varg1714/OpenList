import{cr as Ft,cs as Pt}from"./index.9265efac.js";function Rt(xt){throw new Error('Could not dynamically require "'+xt+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ut={exports:{}};/*!
 * artplayer.js v4.6.2
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2023 Harvey Zack
 * Released under the MIT License.
 */(function(xt,kt){(function(R,M,i,a,e){var c=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Pt<"u"?Pt:{},O=typeof c[a]=="function"&&c[a],S=O.cache||{},L=typeof Rt=="function"&&Rt.bind(xt);function u(h,m){if(!S[h]){if(!R[h]){var v=typeof c[a]=="function"&&c[a];if(!m&&v)return v(h,!0);if(O)return O(h,!0);if(L&&typeof h=="string")return L(h);var T=new Error("Cannot find module '"+h+"'");throw T.code="MODULE_NOT_FOUND",T}t.resolve=function(s){var g=R[h][1][s];return g!=null?g:s},t.cache={};var o=S[h]=new u.Module(h);R[h][0].call(o.exports,t,o,o.exports,this)}return S[h].exports;function t(s){var g=t.resolve(s);return g===!1?{}:u(g)}}u.isParcelRequire=!0,u.Module=function(h){this.id=h,this.bundle=u,this.exports={}},u.modules=R,u.cache=S,u.parent=O,u.register=function(h,m){R[h]=[function(v,T){T.exports=m},{}]},Object.defineProperty(u,"root",{get:function(){return c[a]}}),c[a]=u;for(var n=0;n<M.length;n++)u(M[n]);if(i){var f=u(i);xt.exports=f}})({"5lTcX":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("bundle-text:./style/index.less"),c=a.interopDefault(e),O=R("option-validator"),S=a.interopDefault(O),L=R("./utils/emitter"),u=a.interopDefault(L),n=R("./utils"),f=R("./scheme"),h=a.interopDefault(f),m=R("./config"),v=a.interopDefault(m),T=R("./whitelist"),o=a.interopDefault(T),t=R("./template"),s=a.interopDefault(t),g=R("./i18n"),E=a.interopDefault(g),d=R("./player"),r=a.interopDefault(d),l=R("./control"),A=a.interopDefault(l),x=R("./contextmenu"),b=a.interopDefault(x),D=R("./info"),p=a.interopDefault(D),y=R("./subtitle"),I=a.interopDefault(y),C=R("./events"),P=a.interopDefault(C),w=R("./hotkey"),k=a.interopDefault(w),F=R("./layer"),_=a.interopDefault(F),B=R("./loading"),N=a.interopDefault(B),U=R("./notice"),j=a.interopDefault(U),K=R("./mask"),H=a.interopDefault(K),G=R("./icons"),W=a.interopDefault(G),X=R("./setting"),z=a.interopDefault(X),Q=R("./storage"),$=a.interopDefault(Q),Y=R("./plugins"),J=a.interopDefault(Y),q=R("./mobile"),tt=a.interopDefault(q);let et=0;const rt=[];class V extends u.default{constructor(at,ot){super(),this.id=++et;const ut=n.mergeDeep(V.option,at);if(this.option=(0,S.default)(ut,h.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isRotate=!1,this.isDestroy=!1,this.whitelist=new o.default(this),this.template=new s.default(this),this.events=new P.default(this),this.whitelist.state?(this.storage=new $.default(this),this.icons=new W.default(this),this.i18n=new E.default(this),this.notice=new j.default(this),this.player=new r.default(this),this.layers=new _.default(this),this.controls=new A.default(this),this.contextmenu=new b.default(this),this.subtitle=new I.default(this),this.info=new p.default(this),this.loading=new N.default(this),this.hotkey=new k.default(this),this.mask=new H.default(this),this.setting=new z.default(this),this.plugins=new J.default(this)):this.mobile=new tt.default(this),typeof ot=="function"&&this.on("ready",()=>ot.call(this,this)),V.DEBUG){const nt=ft=>console.log(`[ART.${this.id}] -> ${ft}`);nt("Version@"+V.version),nt("Env@"+V.env),nt("Build@"+V.build);for(let ft=0;ft<v.default.events.length;ft++)this.on("video:"+v.default.events[ft],st=>nt("Event@"+st.type))}rt.push(this)}static get instances(){return rt}static get version(){return"4.6.2"}static get env(){return"production"}static get build(){return"2023-01-26 15:26:58"}static get config(){return v.default}static get utils(){return n}static get scheme(){return h.default}static get Emitter(){return u.default}static get validator(){return S.default}static get kindOf(){return S.default.kindOf}static get html(){return s.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},escape:!0,encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:n.isSafari?"auto":"metadata"},i18n:{},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}get video(){return this.template.$video}destroy(at=!0){this.events.destroy(),this.template.destroy(at),rt.splice(rt.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(i.default=V,V.DEBUG=!1,V.CONTEXTMENU=!0,V.NOTICE_TIME=2e3,V.SETTING_WIDTH=250,V.SETTING_ITEM_WIDTH=200,V.SETTING_ITEM_HEIGHT=35,V.INDICATOR_SIZE=14,V.INDICATOR_SIZE_ICON=16,V.INDICATOR_SIZE_MOBILE=18,V.INDICATOR_SIZE_MOBILE_ICON=20,V.VOLUME_PANEL_WIDTH=60,V.VOLUME_HANDLE_WIDTH=12,V.RESIZE_TIME=500,V.SCROLL_TIME=200,V.SCROLL_GAP=50,V.AUTO_PLAYBACK_MAX=10,V.AUTO_PLAYBACK_MIN=5,V.AUTO_PLAYBACK_TIMEOUT=3e3,V.RECONNECT_TIME_MAX=5,V.RECONNECT_SLEEP_TIME=1e3,V.CONTROL_HIDE_TIME=3e3,V.DB_CLICE_TIME=300,V.MOBILE_AUTO_PLAYBACKRATE=3,V.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,V.MOBILE_AUTO_ORIENTATION_TIME=200,V.INFO_LOOP_TIME=1e3,V.FAST_FORWARD_VALUE=3,V.FAST_FORWARD_TIME=1e3,V.TOUCH_MOVE_RATIO=.5,V.VOLUME_STEP=.1,V.SEEK_STEP=5,V.PROGRESS_HEIGHT=6,V.PLAYBACK_RATE=[.5,.75,1,1.25,1.5,2],V.ASPECT_RATIO=["default","4:3","16:9"],V.FLIP=["normal","horizontal","vertical"],V.FULLSCREEN_WEB_IN_BODY=!1,typeof document<"u"&&!document.getElementById("artplayer-style")){const it=n.createElement("style");it.id="artplayer-style",it.textContent=c.default,document.head.appendChild(it)}typeof window<"u"&&(window.Artplayer=V),console.log(`%c ArtPlayer %c ${V.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"0016T","option-validator":"bAWi2","./utils/emitter":"66mFZ","./utils":"71aH7","./scheme":"AKEiO","./config":"lyjeQ","./whitelist":"9L0ao","./template":"X13Zf","./i18n":"3jKkj","./player":"a90nx","./control":"8Z0Uf","./contextmenu":"2KYsr","./info":"02ajl","./subtitle":"eSWto","./events":"jo4S1","./hotkey":"6NoFy","./layer":"6G6hZ","./loading":"3dsEe","./notice":"dWGTw","./mask":"5POkG","./icons":"6OeNg","./setting":"3eYNH","./storage":"2aaJe","./plugins":"8MTUM","./mobile":"7mil2","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"0016T":[function(R,M,i){M.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;transition:bottom .2s;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:auto;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;transition:all .2s;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#ffffff80;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator:hover{transform:scale(1.2)!important}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;border-radius:3px;display:none;position:absolute;bottom:10px;left:0;box-shadow:0 1px 3px #0003,0 1px 2px -1px #0003}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.75;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;transition:opacity .1s ease-in-out;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;transition:transform .2s ease-in-out;display:flex;transform:scale(1)}.art-video-player .art-bottom .art-controls .art-control .art-icon:active{transform:scale(.85)}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{height:105px;padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:var(--theme)}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:60px;left:0;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:var(--theme)}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;user-select:all;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:var(--theme)}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:var(--theme);cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:var(--theme)}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],bAWi2:[function(R,M,i){M.exports=function(){function a(n){return(a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f})(n)}var e=Object.prototype.toString,c=function(n){if(n===void 0)return"undefined";if(n===null)return"null";var f=a(n);if(f==="boolean")return"boolean";if(f==="string")return"string";if(f==="number")return"number";if(f==="symbol")return"symbol";if(f==="function")return function(h){return O(h)==="GeneratorFunction"}(n)?"generatorfunction":"function";if(function(h){return Array.isArray?Array.isArray(h):h instanceof Array}(n))return"array";if(function(h){return!(!h.constructor||typeof h.constructor.isBuffer!="function")&&h.constructor.isBuffer(h)}(n))return"buffer";if(function(h){try{if(typeof h.length=="number"&&typeof h.callee=="function")return!0}catch(m){if(m.message.indexOf("callee")!==-1)return!0}return!1}(n))return"arguments";if(function(h){return h instanceof Date||typeof h.toDateString=="function"&&typeof h.getDate=="function"&&typeof h.setDate=="function"}(n))return"date";if(function(h){return h instanceof Error||typeof h.message=="string"&&h.constructor&&typeof h.constructor.stackTraceLimit=="number"}(n))return"error";if(function(h){return h instanceof RegExp||typeof h.flags=="string"&&typeof h.ignoreCase=="boolean"&&typeof h.multiline=="boolean"&&typeof h.global=="boolean"}(n))return"regexp";switch(O(n)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(h){return typeof h.throw=="function"&&typeof h.return=="function"&&typeof h.next=="function"}(n))return"generator";switch(f=e.call(n)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return f.slice(8,-1).toLowerCase().replace(/\s/g,"")};function O(n){return n.constructor?n.constructor.name:null}function S(n,f){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return L(n,f,h),u(n,f,h),function(m,v,T){var o=c(v),t=c(m);if(o==="object"){if(t!=="object")throw new Error("[Type Error]: '".concat(T.join("."),"' require 'object' type, but got '").concat(t,"'"));Object.keys(v).forEach(function(s){var g=m[s],E=v[s],d=T.slice();d.push(s),L(g,E,d),u(g,E,d),S(g,E,d)})}if(o==="array"){if(t!=="array")throw new Error("[Type Error]: '".concat(T.join("."),"' require 'array' type, but got '").concat(t,"'"));m.forEach(function(s,g){var E=m[g],d=v[g]||v[0],r=T.slice();r.push(g),L(E,d,r),u(E,d,r),S(E,d,r)})}}(n,f,h),n}function L(n,f,h){if(c(f)==="string"){var m=c(n);if(f[0]==="?"&&(f=f.slice(1)+"|undefined"),!(-1<f.indexOf("|")?f.split("|").map(function(v){return v.toLowerCase().trim()}).filter(Boolean).some(function(v){return m===v}):f.toLowerCase().trim()===m))throw new Error("[Type Error]: '".concat(h.join("."),"' require '").concat(f,"' type, but got '").concat(m,"'"))}}function u(n,f,h){if(c(f)==="function"){var m=f(n,c(n),h);if(m!==!0){var v=c(m);throw v==="string"?new Error(m):v==="error"?m:new Error("[Validator Error]: The scheme for '".concat(h.join("."),"' validator require return true, but got '").concat(m,"'"))}}}return S.kindOf=c,S}()},{}],"66mFZ":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=class{on(a,e,c){const O=this.e||(this.e={});return(O[a]||(O[a]=[])).push({fn:e,ctx:c}),this}once(a,e,c){const O=this;function S(...L){O.off(a,S),e.apply(c,L)}return S._=e,this.on(a,S,c)}emit(a,...e){const c=((this.e||(this.e={}))[a]||[]).slice();for(let O=0;O<c.length;O+=1)c[O].fn.apply(c[O].ctx,e);return this}off(a,e){const c=this.e||(this.e={}),O=c[a],S=[];if(O&&e)for(let L=0,u=O.length;L<u;L+=1)O[L].fn!==e&&O[L].fn._!==e&&S.push(O[L]);return S.length?c[a]=S:delete c[a],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(R,M,i){i.interopDefault=function(a){return a&&a.__esModule?a:{default:a}},i.defineInteropFlag=function(a){Object.defineProperty(a,"__esModule",{value:!0})},i.exportAll=function(a,e){return Object.keys(a).forEach(function(c){c==="default"||c==="__esModule"||e.hasOwnProperty(c)||Object.defineProperty(e,c,{enumerable:!0,get:function(){return a[c]}})}),e},i.export=function(a,e,c){Object.defineProperty(a,e,{enumerable:!0,get:c})}},{}],"71aH7":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./dom");a.exportAll(e,i);var c=R("./error");a.exportAll(c,i);var O=R("./subtitle");a.exportAll(O,i);var S=R("./file");a.exportAll(S,i);var L=R("./property");a.exportAll(L,i);var u=R("./time");a.exportAll(u,i);var n=R("./format");a.exportAll(n,i);var f=R("./compatibility");a.exportAll(f,i)},{"./dom":"bSNiV","./error":"hwmZz","./subtitle":"inzwq","./file":"6b7Ip","./property":"5NSdr","./time":"epmNy","./format":"gapRl","./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bSNiV:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i),a.export(i,"query",()=>c),a.export(i,"queryAll",()=>O),a.export(i,"addClass",()=>S),a.export(i,"removeClass",()=>L),a.export(i,"hasClass",()=>u),a.export(i,"append",()=>n),a.export(i,"remove",()=>f),a.export(i,"setStyle",()=>h),a.export(i,"setStyles",()=>m),a.export(i,"getStyle",()=>v),a.export(i,"sublings",()=>T),a.export(i,"inverseClass",()=>o),a.export(i,"tooltip",()=>t),a.export(i,"isInViewport",()=>s),a.export(i,"includeFromEvent",()=>g),a.export(i,"replaceElement",()=>E),a.export(i,"createElement",()=>d);var e=R("./compatibility");function c(r,l=document){return l.querySelector(r)}function O(r,l=document){return Array.from(l.querySelectorAll(r))}function S(r,l){return r.classList.add(l)}function L(r,l){return r.classList.remove(l)}function u(r,l){return r.classList.contains(l)}function n(r,l){return l instanceof Element?r.appendChild(l):r.insertAdjacentHTML("beforeend",String(l)),r.lastElementChild||r.lastChild}function f(r){return r.parentNode.removeChild(r)}function h(r,l,A){return r.style[l]=A,r}function m(r,l){return Object.keys(l).forEach(A=>{h(r,A,l[A])}),r}function v(r,l,A=!0){const x=window.getComputedStyle(r,null).getPropertyValue(l);return A?parseFloat(x):x}function T(r){return Array.from(r.parentElement.children).filter(l=>l!==r)}function o(r,l){T(r).forEach(A=>L(A,l)),S(r,l)}function t(r,l,A="top"){e.isMobile||(r.setAttribute("aria-label",l),S(r,"hint--rounded"),S(r,`hint--${A}`))}function s(r,l=0){const A=r.getBoundingClientRect(),x=window.innerHeight||document.documentElement.clientHeight,b=window.innerWidth||document.documentElement.clientWidth,D=A.top-l<=x&&A.top+A.height+l>=0,p=A.left-l<=b+l&&A.left+A.width+l>=0;return D&&p}function g(r,l){return r.composedPath&&r.composedPath().indexOf(l)>-1}function E(r,l){return l.parentNode.replaceChild(r,l),r}function d(r){return document.createElement(r)}},{"./compatibility":"6ZTr6","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6ZTr6":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i),a.export(i,"userAgent",()=>e),a.export(i,"isMobile",()=>c),a.export(i,"isSafari",()=>O),a.export(i,"isWechat",()=>S),a.export(i,"isIE",()=>L),a.export(i,"isAndroid",()=>u),a.export(i,"isIOS",()=>n);const e=typeof window<"u"?window.navigator.userAgent:"",c=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),O=/^((?!chrome|android).)*safari/i.test(e),S=/MicroMessenger/i.test(e),L=/MSIE|Trident/i.test(e),u=/android/i.test(e),n=/iPad|iPhone|iPod/i.test(e)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hwmZz:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i),a.export(i,"ArtPlayerError",()=>e),a.export(i,"errorHandle",()=>c);class e extends Error{constructor(S,L){super(S),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,L||this.constructor),this.name="ArtPlayerError"}}function c(O,S){if(!O)throw new e(S);return O}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],inzwq:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(S){return`WEBVTT \r
\r
`.concat((L=S,L.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(u,n,f)=>{let h=f.slice(0,3);return f.length===1&&(h=f+"00"),f.length===2&&(h=f+"0"),`${n},${h}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var L}function c(S){return URL.createObjectURL(new Blob([S],{type:"text/vtt"}))}function O(S){const L=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function u(n=""){return n.split(/[:.]/).map((f,h,m)=>{if(h===m.length-1){if(f.length===1)return`.${f}00`;if(f.length===2)return`.${f}0`}else if(f.length===1)return(h===0?"0":":0")+f;return h===0?f:h===m.length-1?`.${f}`:`:${f}`}).join("")}return`WEBVTT

${S.split(/\r?\n/).map(n=>{const f=n.match(L);return f?{start:u(f[1].trim()),end:u(f[2].trim()),text:f[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(h=>h.trim()).join(`
`)}:null}).filter(n=>n).map((n,f)=>n?`${f+1}
${n.start} --> ${n.end}
${n.text}`:"").filter(n=>n.trim()).join(`

`)}`}a.defineInteropFlag(i),a.export(i,"srtToVtt",()=>e),a.export(i,"vttToBlob",()=>c),a.export(i,"assToVtt",()=>O)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6b7Ip":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(O){return O.includes("?")?e(O.split("?")[0]):O.includes("#")?e(O.split("#")[0]):O.trim().toLowerCase().split(".").pop()}function c(O,S){const L=document.createElement("a");L.style.display="none",L.href=O,L.download=S,document.body.appendChild(L),L.click(),document.body.removeChild(L)}a.defineInteropFlag(i),a.export(i,"getExt",()=>e),a.export(i,"download",()=>c)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5NSdr":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i),a.export(i,"def",()=>e),a.export(i,"has",()=>O),a.export(i,"get",()=>S),a.export(i,"mergeDeep",()=>L);const e=Object.defineProperty,{hasOwnProperty:c}=Object.prototype;function O(u,n){return c.call(u,n)}function S(u,n){return Object.getOwnPropertyDescriptor(u,n)}function L(...u){const n=f=>f&&typeof f=="object"&&!Array.isArray(f);return u.reduce((f,h)=>(Object.keys(h).forEach(m=>{const v=f[m],T=h[m];Array.isArray(v)&&Array.isArray(T)?f[m]=v.concat(...T):!n(v)||!n(T)||T instanceof Element?f[m]=T:f[m]=L(v,T)}),f),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],epmNy:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(S=0){return new Promise(L=>setTimeout(L,S))}function c(S,L,u){let n;function f(...h){clearTimeout(n),n=setTimeout(function(){n=null,S.apply(u,h)},L)}return f.clearTimeout=function(){clearTimeout(n)},f}function O(S,L){let u,n,f=!1;return function h(...m){if(f)return u=m,void(n=this);f=!0,S.apply(this,m),setTimeout(()=>{f=!1,u&&(h.apply(n,u),u=null,n=null)},L)}}a.defineInteropFlag(i),a.export(i,"sleep",()=>e),a.export(i,"debounce",()=>c),a.export(i,"throttle",()=>O)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gapRl:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(u,n,f){return Math.max(Math.min(u,Math.max(n,f)),Math.min(n,f))}function c(u){return u.charAt(0).toUpperCase()+u.slice(1)}function O(u){return["string","number"].includes(typeof u)}function S(u){const n=Math.floor(u/3600),f=Math.floor((u-3600*n)/60),h=Math.floor(u-3600*n-60*f);return(n>0?[n,f,h]:[f,h]).map(m=>m<10?`0${m}`:String(m)).join(":")}function L(u){return u.replace(/[&<>'"]/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[n]||n)}a.defineInteropFlag(i),a.export(i,"clamp",()=>e),a.export(i,"capitalize",()=>c),a.export(i,"isStringOrNumber",()=>O),a.export(i,"secondToTime",()=>S),a.export(i,"escape",()=>L)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],AKEiO:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i),a.export(i,"ComponentOption",()=>h);var e=R("../utils");const c="array",O="boolean",S="string",L="number",u="object",n="function";function f(m,v,T){return(0,e.errorHandle)(v===S||v===L||m instanceof Element,`${T.join(".")} require '${S}' or 'Element' type`)}const h={html:f,disable:`?${O}`,name:`?${S}`,index:`?${L}`,style:`?${u}`,click:`?${n}`,mounted:`?${n}`,tooltip:`?${S}|${L}`,width:`?${L}`,selector:`?${c}`,onSelect:`?${n}`,switch:`?${O}`,onSwitch:`?${n}`,range:`?${c}`,onRange:`?${n}`,onChange:`?${n}`};i.default={id:S,container:f,url:S,poster:S,title:S,type:S,theme:S,lang:S,volume:L,isLive:O,muted:O,autoplay:O,autoSize:O,autoMini:O,loop:O,flip:O,playbackRate:O,aspectRatio:O,screenshot:O,setting:O,hotkey:O,pip:O,mutex:O,backdrop:O,fullscreen:O,fullscreenWeb:O,subtitleOffset:O,miniProgressBar:O,useSSR:O,playsInline:O,lock:O,fastForward:O,autoPlayback:O,autoOrientation:O,airplay:O,plugins:[n],whitelist:[`${S}|${n}|regexp`],layers:[h],contextmenu:[h],settings:[h],controls:[{...h,position:(m,v,T)=>{const o=["top","left","right"];return(0,e.errorHandle)(o.includes(m),`${T.join(".")} only accept ${o.toString()} as parameters`)}}],quality:[{default:`?${O}`,html:S,url:S}],highlight:[{time:L,text:S}],thumbnails:{url:S,number:L,column:L,width:L,height:L},subtitle:{url:S,type:S,style:u,escape:O,encoding:S},moreVideoAttr:u,i18n:u,icons:u,customType:u}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lyjeQ:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9L0ao":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("./utils");i.default=class{constructor(e){this.art=e}get state(){const{option:e,constructor:{kindOf:c}}=this.art;return!a.isMobile||!e.whitelist.length||e.whitelist.some(O=>{switch(c(O)){case"string":return O==="*"||a.userAgent.indexOf(O)>-1;case"function":return O(a.userAgent);case"regexp":return O.test(a.userAgent);default:return!1}})}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],X13Zf:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("./utils");class e{constructor(O){this.art=O;const{option:S,constructor:L,whitelist:u}=O;S.container instanceof Element?this.$container=S.container:(this.$container=(0,a.query)(S.container),(0,a.errorHandle)(this.$container,`No container element found by ${S.container}`));const n=this.$container.tagName.toLowerCase();(0,a.errorHandle)(n==="div",`Unsupported container element type, only support 'div' but got '${n}'`),(0,a.errorHandle)(L.instances.every(f=>f.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=O.id,this.$original=this.$container.cloneNode(!0),u.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"><track default kind="metadata" src=""></track></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.6.2</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(O){return(0,a.query)(O,this.$container)}desktop(){const{option:O}=this.art;O.useSSR||(this.$container.innerHTML=e.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$track=this.query("track"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),O.backdrop&&((0,a.addClass)(this.$setting,"art-backdrop-filter"),(0,a.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,a.addClass)(this.$info,"art-backdrop-filter")),a.isMobile&&(0,a.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(O){O?(0,a.replaceElement)(this.$original,this.$container):(0,a.addClass)(this.$player,"art-destroy")}}i.default=e},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3jKkj":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../utils"),c=R("./zh-cn.json"),O=a.interopDefault(c),S=R("./zh-tw.json"),L=a.interopDefault(S),u=R("./pl.json"),n=a.interopDefault(u),f=R("./cs.json"),h=a.interopDefault(f),m=R("./es.json"),v=a.interopDefault(m),T=R("./fa.json"),o=a.interopDefault(T);i.default=class{constructor(t){this.art=t,this.languages={"zh-cn":O.default,"zh-tw":L.default,pl:n.default,cs:h.default,es:v.default,fa:o.default},this.update(t.option.i18n)}init(){const t=this.art.option.lang.toLowerCase();this.language=this.languages[t]||{}}get(t){return this.language[t]||t}update(t){this.languages=(0,e.mergeDeep)(this.languages,t),this.init()}}},{"../utils":"71aH7","./zh-cn.json":"lNQi5","./zh-tw.json":"eRpom","./pl.json":"iEpPa","./cs.json":"dBgp3","./es.json":"dNIrL","./fa.json":"7Plhe","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lNQi5:[function(R,M,i){M.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],eRpom:[function(R,M,i){M.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],iEpPa:[function(R,M,i){M.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],dBgp3:[function(R,M,i){M.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],dNIrL:[function(R,M,i){M.exports=JSON.parse('{"Video Info":"Informaci\xF3n del video","Close":"Cerrar","Video Load Failed":"Fall\xF3 carga de video","Volume":"Volumen","Play":"Reproduciendo","Pause":"Pausa","Rate":"Velocidad","Mute":"Silencio","Video Flip":"Rotar video","Horizontal":"Horizontal","Vertical":"Vertical","Reconnect":"Reconectando","Show Setting":"Mostrar ajustes","Hide Setting":"Ocultar ajustes","Screenshot":"Captura de Pantalla","Play Speed":"Velocidad de reproducci\xF3n","Aspect Ratio":"Relaci\xF3n de aspecto","Default":"Por defecto","Normal":"Normal","Open":"Abrir","Switch Video":"Cambiar video","Switch Subtitle":"Cambiar subt\xEDtulo","Fullscreen":"Pantalla completa","Exit Fullscreen":"Salir de Pantalla completa","Web Fullscreen":"Pantalla completa Web","Exit Web Fullscreen":"Salir de Pantalla completa","Mini Player":"Mini reproductor","PIP Mode":"Modo PiP","Exit PIP Mode":"Cerrar modo PiP","PIP Not Supported":"Modo PiP no compatible","Fullscreen Not Supported":"Pantalla completa no soportada","Subtitle Offset":"Ajuste subt\xEDtulo","Last Seen":"Visto \xFAltima vez","Jump Play":"Saltar","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay no disponible"}')},{}],"7Plhe":[function(R,M,i){M.exports=JSON.parse('{"Video Info":"\u0627\u0637\u0644\u0627\u0639\u0627\u062A \u0648\u06CC\u062F\u06CC\u0648","Close":"\u0628\u0633\u062A\u0646","Video Load Failed":"\u0628\u0627\u0631\u06AF\u0630\u0627\u0631\u06CC \u0646\u0627\u0645\u0648\u0641\u0642","Play":"\u067E\u062E\u0634","Volume":"\u0645\u06CC\u0632\u0627\u0646 \u0635\u062F\u0627","Pause":"\u062A\u0648\u0642\u0641","Rate":"\u0646\u0631\u062E","Mute":"\u0633\u06A9\u0648\u062A","Video Flip":"\u0686\u0631\u062E\u0634 \u062A\u0635\u0648\u06CC\u0631","Horizontal":"\u0627\u0641\u0642\u06CC","Vertical":"\u0639\u0645\u0648\u062F\u06CC","Reconnect":"\u0627\u062A\u0635\u0627\u0644 \u0645\u062C\u062F\u062F","Show Setting":"\u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Hide Setting":"\u0628\u0633\u062A\u0646 \u062A\u0646\u0638\u06CC\u0645\u0627\u062A","Screenshot":"\u0639\u06A9\u0633 \u0627\u0632 \u0635\u0641\u062D\u0647","Play Speed":"\u0633\u0631\u0639\u062A \u067E\u062E\u0634","Aspect Ratio":"\u0646\u0633\u0628\u062A \u062A\u0635\u0648\u06CC\u0631","Default":"\u062D\u0627\u0644\u062A \u067E\u06CC\u0634\u0641\u0631\u0636","Normal":" \u062D\u0627\u0644\u062A \u0639\u0627\u062F\u06CC","Open":"\u0628\u0627\u0632\u06A9\u0631\u062F\u0646","Switch Video":"\u062A\u063A\u06CC\u06CC\u0631 \u0648\u06CC\u062F\u06CC\u0648","Switch Subtitle":"\u0646\u063A\u06CC\u06CC\u0631 \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Fullscreen":"\u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Exit Fullscreen":"\u06A9\u0648\u0686\u06A9 \u06A9\u0631\u062F\u0646","Web Fullscreen":"\u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Exit Web Fullscreen":"\u062E\u0631\u0648\u062C \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0626\u0627\u062A\u0631","Mini Player":"\u062D\u0627\u0644\u062A \u067E\u062E\u0634 \u06A9\u0648\u0686\u06A9","PIP Mode":" \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Exit PIP Mode":"\u062E\u0631\u0648\u062C \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","PIP Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0645\u06CC\u0646\u06CC \u067E\u0644\u06CC\u0631","Fullscreen Not Supported":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u062D\u0627\u0644\u062A \u062A\u0645\u0627\u0645 \u0635\u0641\u062D\u0647","Subtitle Offset":"\u0627\u0641\u0633\u062A \u0632\u06CC\u0631\u0646\u0648\u06CC\u0633","Last Seen":"\u0622\u062E\u0631\u06CC\u0646 \u0628\u0627\u0632\u062F\u06CC\u062F","Jump Play":"\u062C\u0627\u0645\u067E \u067E\u0644\u06CC","AirPlay":"\u0627\u06CC\u0631 \u067E\u0644\u06CC","AirPlay Not Available":"\u0639\u062F\u0645 \u067E\u0634\u062A\u06CC\u0628\u0627\u0646\u06CC \u0627\u0632 \u0627\u06CC\u0631\u067E\u0644\u06CC"}')},{}],a90nx:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./urlMix"),c=a.interopDefault(e),O=R("./attrMix"),S=a.interopDefault(O),L=R("./playMix"),u=a.interopDefault(L),n=R("./pauseMix"),f=a.interopDefault(n),h=R("./toggleMix"),m=a.interopDefault(h),v=R("./seekMix"),T=a.interopDefault(v),o=R("./volumeMix"),t=a.interopDefault(o),s=R("./currentTimeMix"),g=a.interopDefault(s),E=R("./durationMix"),d=a.interopDefault(E),r=R("./switchMix"),l=a.interopDefault(r),A=R("./playbackRateMix"),x=a.interopDefault(A),b=R("./aspectRatioMix"),D=a.interopDefault(b),p=R("./screenshotMix"),y=a.interopDefault(p),I=R("./fullscreenMix"),C=a.interopDefault(I),P=R("./fullscreenWebMix"),w=a.interopDefault(P),k=R("./pipMix"),F=a.interopDefault(k),_=R("./loadedMix"),B=a.interopDefault(_),N=R("./playedMix"),U=a.interopDefault(N),j=R("./playingMix"),K=a.interopDefault(j),H=R("./autoSizeMix"),G=a.interopDefault(H),W=R("./rectMix"),X=a.interopDefault(W),z=R("./flipMix"),Q=a.interopDefault(z),$=R("./miniMix"),Y=a.interopDefault($),J=R("./loopMix"),q=a.interopDefault(J),tt=R("./posterMix"),et=a.interopDefault(tt),rt=R("./autoHeightMix"),V=a.interopDefault(rt),it=R("./themeMix"),at=a.interopDefault(it),ot=R("./titleMix"),ut=a.interopDefault(ot),nt=R("./typeMix"),ft=a.interopDefault(nt),st=R("./normalSizeMix"),dt=a.interopDefault(st),pt=R("./subtitleOffsetMix"),yt=a.interopDefault(pt),gt=R("./airplayMix"),lt=a.interopDefault(gt),ct=R("./optionInit"),ht=a.interopDefault(ct),vt=R("./eventInit"),Et=a.interopDefault(vt);i.default=class{constructor(Z){(0,c.default)(Z),(0,S.default)(Z),(0,u.default)(Z),(0,f.default)(Z),(0,m.default)(Z),(0,T.default)(Z),(0,t.default)(Z),(0,g.default)(Z),(0,d.default)(Z),(0,l.default)(Z),(0,x.default)(Z),(0,D.default)(Z),(0,y.default)(Z),(0,C.default)(Z),(0,w.default)(Z),(0,F.default)(Z),(0,B.default)(Z),(0,U.default)(Z),(0,K.default)(Z),(0,G.default)(Z),(0,X.default)(Z),(0,Q.default)(Z),(0,Y.default)(Z),(0,q.default)(Z),(0,et.default)(Z),(0,V.default)(Z),(0,at.default)(Z),(0,ut.default)(Z),(0,ft.default)(Z),(0,dt.default)(Z),(0,yt.default)(Z),(0,lt.default)(Z),(0,Et.default)(Z),(0,ht.default)(Z)}}},{"./urlMix":"kQoac","./attrMix":"deCma","./playMix":"fOJuP","./pauseMix":"fzHAy","./toggleMix":"cBHxQ","./seekMix":"koAPr","./volumeMix":"6eyuR","./currentTimeMix":"faaWv","./durationMix":"5y91K","./switchMix":"iceD8","./playbackRateMix":"keKwh","./aspectRatioMix":"jihET","./screenshotMix":"36kPY","./fullscreenMix":"2GYOJ","./fullscreenWebMix":"5aYAP","./pipMix":"7EnIB","./loadedMix":"3N9mP","./playedMix":"et96R","./playingMix":"9DzzM","./autoSizeMix":"i1LDY","./rectMix":"IqARI","./flipMix":"7E7Vs","./miniMix":"gpugx","./loopMix":"f1hVG","./posterMix":"1SuFS","./autoHeightMix":"8x4te","./themeMix":"2FqhO","./titleMix":"7Am53","./typeMix":"1fQQs","./normalSizeMix":"ePkBr","./subtitleOffsetMix":"6vlBV","./airplayMix":"eftqT","./optionInit":"fCWZK","./eventInit":"f8Lv3","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kQoac:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,template:{$video:O}}=e;(0,a.def)(e,"url",{get:()=>O.currentSrc,async set(S){if(S){const L=c.type||(0,a.getExt)(S),u=c.customType[L];L&&u?(await(0,a.sleep)(),e.loading.show=!0,u.call(e,O,S,e)):(e.url&&e.url!==S&&e.once("video:canplay",()=>{e.isReady&&e.emit("restart")}),O.src=S,e.option.url=S,e.emit("url",S))}else await(0,a.sleep)(),e.loading.show=!0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],deCma:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{template:{$video:c}}=e;(0,a.def)(e,"attr",{value(O,S){if(S===void 0)return c[O];c[O]=S}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fOJuP:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,notice:O,option:S,constructor:{instances:L},template:{$video:u}}=e;(0,a.def)(e,"play",{value:async function(){const n=await u.play();if(O.show=c.get("Play"),e.emit("play"),S.mutex)for(let f=0;f<L.length;f++){const h=L[f];h!==e&&h.pause()}return n}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fzHAy:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{template:{$video:c},i18n:O,notice:S}=e;(0,a.def)(e,"pause",{value(){const L=c.pause();return S.show=O.get("Pause"),e.emit("pause"),L}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cBHxQ:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){(0,a.def)(e,"toggle",{value:()=>e.playing?e.pause():e.play()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],koAPr:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{notice:c}=e;(0,a.def)(e,"seek",{set(O){e.currentTime=O,e.emit("seek",e.currentTime),e.duration&&(c.show=`${(0,a.secondToTime)(e.currentTime)} / ${(0,a.secondToTime)(e.duration)}`)}}),(0,a.def)(e,"forward",{set(O){e.seek=e.currentTime+O}}),(0,a.def)(e,"backward",{set(O){e.seek=e.currentTime-O}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6eyuR":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{template:{$video:c},i18n:O,notice:S,storage:L}=e;(0,a.def)(e,"volume",{get:()=>c.volume||0,set:u=>{c.volume=(0,a.clamp)(u,0,1),S.show=`${O.get("Volume")}: ${parseInt(100*c.volume,10)}`,c.volume!==0&&L.set("volume",c.volume)}}),(0,a.def)(e,"muted",{get:()=>c.muted,set:u=>{c.muted=u}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],faaWv:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{$video:c}=e.template;(0,a.def)(e,"currentTime",{get:()=>c.currentTime||0,set:O=>{O=parseFloat(O),Number.isNaN(O)||(c.currentTime=(0,a.clamp)(O,0,e.duration))}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5y91K":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){(0,a.def)(e,"duration",{get:()=>{const{duration:c}=e.template.$video;return c===1/0?0:c||0}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],iceD8:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,option:O,notice:S}=e;function L(u,n,f){return new Promise(h=>{if(u===e.url)return h(u);const{playing:m}=e;e.pause(),URL.revokeObjectURL(e.url),e.url=u,e.once("video:canplay",()=>{e.playbackRate=!1,e.aspectRatio=!1,e.flip="normal",e.autoSize=O.autoSize,e.currentTime=f,e.notice.show="",m&&e.play(),n&&(S.show=`${c.get("Switch Video")}: ${n}`),h(u)})})}(0,a.def)(e,"switchQuality",{value:(u,n)=>L(u,n,e.currentTime)}),(0,a.def)(e,"switchUrl",{value:(u,n)=>L(u,n,0)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],keKwh:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{template:{$video:c},i18n:O,notice:S}=e;(0,a.def)(e,"playbackRate",{get:()=>c.playbackRate,set(L){if(L){if(L===c.playbackRate)return;c.playbackRate=L,S.show=`${O.get("Rate")}: ${L===1?O.get("Normal"):`${L}x`}`}else e.playbackRate=1}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jihET:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{template:{$video:c,$player:O},i18n:S,notice:L}=e;(0,a.def)(e,"aspectRatio",{get:()=>O.dataset.aspectRatio||"default",set(u){if(u||(u="default"),u==="default")(0,a.setStyle)(c,"width",null),(0,a.setStyle)(c,"height",null),(0,a.setStyle)(c,"padding",null),delete O.dataset.aspectRatio;else{const n=u.split(":").map(Number),{videoWidth:f,videoHeight:h}=c,{clientWidth:m,clientHeight:v}=O,T=f/h,o=n[0]/n[1];if(T>o){const t=o*h/f;(0,a.setStyle)(c,"width",100*t+"%"),(0,a.setStyle)(c,"height","100%"),(0,a.setStyle)(c,"padding",`0 ${(m-m*t)/2}px`)}else{const t=f/o/h;(0,a.setStyle)(c,"width","100%"),(0,a.setStyle)(c,"height",100*t+"%"),(0,a.setStyle)(c,"padding",(v-v*t)/2+"px 0")}O.dataset.aspectRatio=u}L.show=`${S.get("Aspect Ratio")}: ${u==="default"?S.get("Default"):u}`,e.emit("aspectRatio",u)}}),(0,a.def)(e,"aspectRatioReset",{set(u){if(u){const{aspectRatio:n}=e;e.aspectRatio=n}}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"36kPY":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,notice:O,template:{$video:S}}=e,L=(0,a.createElement)("canvas");(0,a.def)(e,"getDataURL",{value:()=>new Promise((u,n)=>{try{L.width=S.videoWidth,L.height=S.videoHeight,L.getContext("2d").drawImage(S,0,0),u(L.toDataURL("image/png"))}catch(f){O.show=f,n(f)}})}),(0,a.def)(e,"getBlobUrl",{value:()=>new Promise((u,n)=>{try{L.width=S.videoWidth,L.height=S.videoHeight,L.getContext("2d").drawImage(S,0,0),L.toBlob(f=>{u(URL.createObjectURL(f))})}catch(f){O.show=f,n(f)}})}),(0,a.def)(e,"screenshot",{value:async()=>{const u=await e.getDataURL();return(0,a.download)(u,`${c.title||"artplayer"}_${(0,a.secondToTime)(S.currentTime)}.png`),e.emit("screenshot",u),u}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2GYOJ":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../libs/screenfull"),c=a.interopDefault(e),O=R("../utils");i.default=function(S){const{i18n:L,notice:u,template:{$video:n,$player:f}}=S;S.once("video:loadedmetadata",()=>{c.default.isEnabled?(h=>{c.default.on("change",()=>{h.emit("fullscreen",c.default.isFullscreen)}),(0,O.def)(h,"fullscreen",{get:()=>c.default.isFullscreen,async set(m){m?(h.normalSize="fullscreen",h.aspectRatioReset=!0,h.autoSize=!1,await c.default.request(f),(0,O.addClass)(f,"art-fullscreen"),h.emit("resize"),u.show=""):(h.aspectRatioReset=!0,h.autoSize=h.option.autoSize,await c.default.exit(),(0,O.removeClass)(f,"art-fullscreen"),h.emit("resize"),u.show="")}})})(S):document.fullscreenEnabled||n.webkitSupportsFullscreen?(h=>{(0,O.def)(h,"fullscreen",{get:()=>n.webkitDisplayingFullscreen,set(m){m?(h.normalSize="fullscreen",n.webkitEnterFullscreen(),h.emit("fullscreen",!0),u.show=""):(n.webkitExitFullscreen(),h.emit("fullscreen",!1),u.show="")}})})(S):(0,O.def)(S,"fullscreen",{get:()=>!1,set(){u.show=L.get("Fullscreen Not Supported")}}),(0,O.def)(S,"fullscreen",(0,O.get)(S,"fullscreen"))})}},{"../libs/screenfull":"8v40z","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8v40z":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);const a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],e=(()=>{if(typeof document>"u")return!1;const S=a[0],L={};for(const u of a)if(u[1]in document){for(const[n,f]of u.entries())L[S[n]]=f;return L}return!1})(),c={change:e.fullscreenchange,error:e.fullscreenerror};let O={request:(S=document.documentElement,L)=>new Promise((u,n)=>{const f=()=>{O.off("change",f),u()};O.on("change",f);const h=S[e.requestFullscreen](L);h instanceof Promise&&h.then(f).catch(n)}),exit:()=>new Promise((S,L)=>{if(!O.isFullscreen)return void S();const u=()=>{O.off("change",u),S()};O.on("change",u);const n=document[e.exitFullscreen]();n instanceof Promise&&n.then(u).catch(L)}),toggle:(S,L)=>O.isFullscreen?O.exit():O.request(S,L),onchange(S){O.on("change",S)},onerror(S){O.on("error",S)},on(S,L){const u=c[S];u&&document.addEventListener(u,L,!1)},off(S,L){const u=c[S];u&&document.removeEventListener(u,L,!1)},raw:e};Object.defineProperties(O,{isFullscreen:{get:()=>Boolean(document[e.fullscreenElement])},element:{enumerable:!0,get:()=>document[e.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[e.fullscreenEnabled])}}),e||(O={isEnabled:!1}),i.default=O},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5aYAP":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{notice:c,constructor:O,template:{$container:S,$player:L}}=e;(0,a.def)(e,"fullscreenWeb",{get:()=>(0,a.hasClass)(L,"art-fullscreen-web"),set(u){u?(O.FULLSCREEN_WEB_IN_BODY&&(0,a.append)(document.body,L),e.normalSize="fullscreenWeb",(0,a.addClass)(L,"art-fullscreen-web"),e.aspectRatioReset=!0,e.autoSize=!1,e.emit("resize"),e.emit("fullscreenWeb",!0),c.show=""):(O.FULLSCREEN_WEB_IN_BODY&&(0,a.append)(S,L),(0,a.removeClass)(L,"art-fullscreen-web"),e.aspectRatioReset=!0,e.autoSize=e.option.autoSize,e.emit("resize"),e.emit("fullscreenWeb",!1),c.show="")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7EnIB":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,notice:O,template:{$video:S}}=e;document.pictureInPictureEnabled?function(L){const{template:{$video:u},proxy:n,notice:f}=L;u.disablePictureInPicture=!1,(0,a.def)(L,"pip",{get:()=>document.pictureInPictureElement,set(h){h?(L.normalSize="pip",u.requestPictureInPicture().catch(m=>{throw f.show=m,m})):document.exitPictureInPicture().catch(m=>{throw f.show=m,m})}}),n(u,"enterpictureinpicture",()=>{L.emit("pip",!0)}),n(u,"leavepictureinpicture",()=>{L.emit("pip",!1)})}(e):S.webkitSupportsPresentationMode?function(L){const{$video:u}=L.template;u.webkitSetPresentationMode("inline"),(0,a.def)(L,"pip",{get:()=>u.webkitPresentationMode==="picture-in-picture",set(n){n?(L.normalSize="pip",u.webkitSetPresentationMode("picture-in-picture"),L.emit("pip",!0)):(u.webkitSetPresentationMode("inline"),L.emit("pip",!1))}})}(e):(0,a.def)(e,"pip",{get:()=>!1,set(){O.show=c.get("PIP Not Supported")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3N9mP":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{$video:c}=e.template;(0,a.def)(e,"loaded",{get:()=>e.loadedTime/c.duration}),(0,a.def)(e,"loadedTime",{get:()=>c.buffered.length?c.buffered.end(c.buffered.length-1):0})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],et96R:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){(0,a.def)(e,"played",{get:()=>e.currentTime/e.duration})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9DzzM":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{$video:c}=e.template;(0,a.def)(e,"playing",{get:()=>c.currentTime>0&&!c.paused&&!c.ended&&c.readyState>2})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],i1LDY:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{$container:c,$player:O,$video:S}=e.template;(0,a.def)(e,"autoSize",{get:()=>(0,a.hasClass)(c,"art-auto-size"),set(L){if(L){const{videoWidth:u,videoHeight:n}=S,{width:f,height:h}=c.getBoundingClientRect(),m=u/n,v=f/h;if((0,a.addClass)(c,"art-auto-size"),v>m){const T=h*m/f*100;(0,a.setStyle)(O,"width",`${T}%`),(0,a.setStyle)(O,"height","100%")}else{const T=f/m/h*100;(0,a.setStyle)(O,"width","100%"),(0,a.setStyle)(O,"height",`${T}%`)}e.emit("autoSize",{width:e.width,height:e.height})}else(0,a.removeClass)(c,"art-auto-size"),(0,a.setStyle)(O,"width",null),(0,a.setStyle)(O,"height",null),e.emit("autoSize")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],IqARI:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){(0,a.def)(e,"rect",{get:()=>e.template.$player.getBoundingClientRect()});const c=["bottom","height","left","right","top","width"];for(let O=0;O<c.length;O++){const S=c[O];(0,a.def)(e,S,{get:()=>e.rect[S]})}(0,a.def)(e,"x",{get:()=>e.left+window.pageXOffset}),(0,a.def)(e,"y",{get:()=>e.top+window.pageYOffset})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7E7Vs":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{template:{$player:c},i18n:O,notice:S}=e;(0,a.def)(e,"flip",{get:()=>c.dataset.flip||"normal",set(L){L||(L="normal"),L==="normal"?delete c.dataset.flip:c.dataset.flip=L,S.show=`${O.get("Video Flip")}: ${O.get((0,a.capitalize)(L))}`,e.emit("flip",L)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gpugx:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,option:O,storage:S,proxy:L,template:{$player:u,$miniClose:n,$miniTitle:f,$miniHeader:h}}=e;let m=!1,v=0,T=0,o=0,t=0;L(h,"mousedown",s=>{m=!0,v=s.pageX,T=s.pageY,o=e.left,t=e.top}),L(document,"mousemove",s=>{if(m){(0,a.addClass)(u,"art-is-dragging");const g=t+s.pageY-T,E=o+s.pageX-v;(0,a.setStyle)(u,"top",`${g}px`),(0,a.setStyle)(u,"left",`${E}px`),S.set("top",g),S.set("left",E)}}),L(document,"mouseup",()=>{m=!1,(0,a.removeClass)(u,"art-is-dragging")}),L(n,"click",()=>{e.mini=!1,m=!1,(0,a.removeClass)(u,"art-is-dragging")}),(0,a.append)(f,O.title||c.get("Mini Player")),(0,a.def)(e,"mini",{get:()=>(0,a.hasClass)(u,"art-mini"),set(s){if(s){e.normalSize="mini",e.autoSize=!1,(0,a.addClass)(u,"art-mini");const g=S.get("top"),E=S.get("left");if(g&&E)(0,a.setStyle)(u,"top",`${g}px`),(0,a.setStyle)(u,"left",`${E}px`),(0,a.isInViewport)(h)||(S.del("top"),S.del("left"),e.mini=!0);else{const d=window.innerHeight-e.height-50,r=window.innerWidth-e.width-50;S.set("top",d),S.set("left",r),(0,a.setStyle)(u,"top",`${d}px`),(0,a.setStyle)(u,"left",`${r}px`)}e.aspectRatio=!1,e.playbackRate=!1,e.notice.show="",e.emit("mini",!0)}else(0,a.removeClass)(u,"art-mini"),(0,a.setStyle)(u,"top",null),(0,a.setStyle)(u,"left",null),e.aspectRatio=!1,e.playbackRate=!1,e.autoSize=O.autoSize,e.notice.show="",e.emit("mini",!1)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f1hVG:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){let c=[];(0,a.def)(e,"loop",{get:()=>c,set:O=>{if(Array.isArray(O)&&typeof O[0]=="number"&&typeof O[1]=="number"){const S=(0,a.clamp)(O[0],0,Math.min(O[1],e.duration)),L=(0,a.clamp)(O[1],S,e.duration);c=L-S>=1?[S,L]:[]}else c=[]}}),e.on("video:timeupdate",()=>{c.length&&(e.currentTime<c[0]||e.currentTime>c[1])&&(e.seek=c[0])})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1SuFS":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,template:{$poster:O}}=e;(0,a.def)(e,"poster",{get:()=>c.poster,set(S){c.poster=S,(0,a.setStyle)(O,"backgroundImage",`url(${S})`)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8x4te":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,template:{$container:O,$video:S}}=e,L=O.style.height;(0,a.def)(e,"autoHeight",{get:()=>(0,a.hasClass)(O,"art-auto-height"),set(u){if(u){const{clientWidth:n}=O,{videoHeight:f,videoWidth:h}=S,m=f*(n/h);(0,a.setStyle)(O,"height",m+"px"),(0,a.addClass)(O,"art-auto-height"),e.autoSize=c.autoSize,e.emit("autoHeight",m)}else(0,a.setStyle)(O,"height",L),(0,a.removeClass)(O,"art-auto-height"),e.autoSize=c.autoSize,e.emit("autoHeight")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2FqhO":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,template:{$player:O}}=e;(0,a.def)(e,"theme",{get:()=>getComputedStyle(O).getPropertyValue("--theme"),set(S){c.theme=S,O.style.setProperty("--theme",S)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7Am53":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){(0,a.def)(e,"title",{get:()=>e.option.title,set(c){e.option.title=c}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1fQQs":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){(0,a.def)(e,"type",{get:()=>e.option.type,set(c){e.option.type=c}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePkBr:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const c=["mini","pip","fullscreen","fullscreenWeb"];(0,a.def)(e,"normalSize",{get:()=>c.every(O=>!e[O]),set(O){c.filter(S=>S!==O).forEach(S=>{e[S]&&(e[S]=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6vlBV":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{clamp:c}=e.constructor.utils,{notice:O,template:S,i18n:L}=e;let u=0,n=[];e.on("subtitle:switch",()=>{n=[]}),(0,a.def)(e,"subtitleOffset",{get:()=>u,set(f){if(S.$track&&S.$track.track){const h=Array.from(S.$track.track.cues);u=c(f,-5,5);for(let m=0;m<h.length;m++){const v=h[m];n[m]||(n[m]={startTime:v.startTime,endTime:v.endTime}),v.startTime=c(n[m].startTime+u,0,e.duration),v.endTime=c(n[m].endTime+u,0,e.duration)}e.subtitle.update(),O.show=`${L.get("Subtitle Offset")}: ${f}s`,e.emit("subtitleOffset",f)}else e.emit("subtitleOffset",0)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eftqT:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,notice:O,proxy:S,template:{$video:L}}=e;let u=!0;window.WebKitPlaybackTargetAvailabilityEvent&&L.webkitShowPlaybackTargetPicker?S(L,"webkitplaybacktargetavailabilitychanged",n=>{switch(n.availability){case"available":u=!0;break;case"not-available":u=!1}}):u=!1,(0,a.def)(e,"airplay",{value(){u?(L.webkitShowPlaybackTargetPicker(),e.emit("airplay")):O.show=c.get("AirPlay Not Available")}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fCWZK:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,storage:O,template:{$video:S,$poster:L}}=e;Object.keys(c.moreVideoAttr).forEach(n=>{e.attr(n,c.moreVideoAttr[n])}),c.muted&&(e.muted=c.muted),c.volume&&(S.volume=(0,a.clamp)(c.volume,0,1));const u=O.get("volume");typeof u=="number"&&(S.volume=(0,a.clamp)(u,0,1)),c.poster&&(0,a.setStyle)(L,"backgroundImage",`url(${c.poster})`),c.autoplay&&(S.autoplay=c.autoplay),c.playsInline&&(S.playsInline=!0,S["webkit-playsinline"]=!0),c.theme&&(e.theme=c.theme),e.url=c.url}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],f8Lv3:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../config"),c=a.interopDefault(e),O=R("../utils");i.default=function(S){const{i18n:L,notice:u,option:n,constructor:f,proxy:h,template:{$player:m,$video:v,$poster:T}}=S;let o=0;for(let t=0;t<c.default.events.length;t++)h(v,c.default.events[t],s=>{S.emit(`video:${s.type}`,s)});S.on("video:canplay",()=>{o=0,S.loading.show=!1}),S.once("video:canplay",()=>{S.loading.show=!1,S.controls.show=!0,S.mask.show=!0,S.isReady=!0,S.emit("ready")}),S.on("video:ended",()=>{n.loop?(S.seek=0,S.play(),S.controls.show=!1,S.mask.show=!1):(S.controls.show=!0,S.mask.show=!0)}),S.on("video:error",async t=>{o<f.RECONNECT_TIME_MAX?(await(0,O.sleep)(f.RECONNECT_SLEEP_TIME),o+=1,S.url=n.url,u.show=`${L.get("Reconnect")}: ${o}`,S.emit("error",t,o)):(S.mask.show=!0,S.loading.show=!1,S.controls.show=!0,(0,O.addClass)(m,"art-error"),await(0,O.sleep)(f.RECONNECT_SLEEP_TIME),u.show=L.get("Video Load Failed"),S.destroy(!1))}),S.on("video:loadedmetadata",()=>{S.autoSize=n.autoSize,O.isMobile&&(S.loading.show=!1,S.controls.show=!0,S.mask.show=!0)}),S.on("video:loadstart",()=>{S.loading.show=!0,S.mask.show=!1,S.controls.show=!0}),S.on("video:pause",()=>{S.controls.show=!0,S.mask.show=!0}),S.on("video:play",()=>{S.mask.show=!1,(0,O.setStyle)(T,"display","none")}),S.on("video:playing",()=>{S.mask.show=!1}),S.on("video:seeked",()=>{S.loading.show=!1}),S.on("video:seeking",()=>{S.loading.show=!0,S.mask.show=!1}),S.on("video:timeupdate",()=>{S.mask.show=!1}),S.on("video:waiting",()=>{S.loading.show=!0,S.mask.show=!1})}},{"../config":"lyjeQ","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8Z0Uf":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../utils"),c=R("../utils/component"),O=a.interopDefault(c),S=R("./fullscreen"),L=a.interopDefault(S),u=R("./fullscreenWeb"),n=a.interopDefault(u),f=R("./pip"),h=a.interopDefault(f),m=R("./playAndPause"),v=a.interopDefault(m),T=R("./progress"),o=a.interopDefault(T),t=R("./time"),s=a.interopDefault(t),g=R("./volume"),E=a.interopDefault(g),d=R("./setting"),r=a.interopDefault(d),l=R("./thumbnails"),A=a.interopDefault(l),x=R("./screenshot"),b=a.interopDefault(x),D=R("./quality"),p=a.interopDefault(D),y=R("./loop"),I=a.interopDefault(y),C=R("./airplay"),P=a.interopDefault(C);class w extends O.default{constructor(F){super(F),this.name="control";const{proxy:_,constructor:B,template:{$player:N}}=F;let U=Date.now();_(N,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,e.removeClass)(N,"art-hide-cursor"),(0,e.addClass)(N,"art-hover"),U=Date.now()}),F.on("video:timeupdate",()=>{!F.isInput&&F.playing&&this.show&&Date.now()-U>=B.CONTROL_HIDE_TIME&&(this.show=!1,(0,e.addClass)(N,"art-hide-cursor"),(0,e.removeClass)(N,"art-hover"))}),this.init()}init(){const{option:F}=this.art;F.isLive||this.add((0,o.default)({name:"progress",position:"top",index:10})),!F.thumbnails.url||F.isLive||e.isMobile||this.add((0,A.default)({name:"thumbnails",position:"top",index:20})),this.add((0,I.default)({name:"loop",position:"top",index:30})),this.add((0,v.default)({name:"playAndPause",position:"left",index:10})),this.add((0,E.default)({name:"volume",position:"left",index:20})),F.isLive||this.add((0,s.default)({name:"time",position:"left",index:30})),F.quality.length&&this.add((0,p.default)({name:"quality",position:"right",index:10})),F.screenshot&&!e.isMobile&&this.add((0,b.default)({name:"screenshot",position:"right",index:20})),F.setting&&this.add((0,r.default)({name:"setting",position:"right",index:30})),F.pip&&this.add((0,h.default)({name:"pip",position:"right",index:40})),F.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,P.default)({name:"airplay",position:"right",index:50})),F.fullscreenWeb&&this.add((0,n.default)({name:"fullscreenWeb",position:"right",index:60})),F.fullscreen&&this.add((0,L.default)({name:"fullscreen",position:"right",index:70}));for(let _=0;_<F.controls.length;_++)this.add(F.controls[_])}add(F){const _=typeof F=="function"?F(this.art):F,{$progress:B,$controlsLeft:N,$controlsRight:U}=this.art.template;switch(_.position){case"top":this.$parent=B;break;case"left":this.$parent=N;break;case"right":this.$parent=U;break;default:(0,e.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(_)}}i.default=w},{"../utils":"71aH7","../utils/component":"18nVI","./fullscreen":"c61Lj","./fullscreenWeb":"03jeB","./pip":"u8l8e","./playAndPause":"ebXtb","./progress":"bgoVP","./time":"ikc2j","./volume":"b8NFx","./setting":"03o9l","./thumbnails":"eCVx2","./screenshot":"4KCF5","./quality":"efgTY","./loop":"2hIff","./airplay":"4IS2d","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"18nVI":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./dom"),c=R("option-validator"),O=a.interopDefault(c),S=R("../scheme"),L=R("./property"),u=R("./error");i.default=class{constructor(n){this.id=0,this.art=n,this.add=this.add.bind(this)}get show(){return(0,e.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(n){const{$player:f}=this.art.template,h=`art-${this.name}-show`;n?(0,e.addClass)(f,h):(0,e.removeClass)(f,h),this.art.emit(this.name,n)}set toggle(n){n&&(this.show=!this.show)}add(n){const f=typeof n=="function"?n(this.art):n;if(f.html=f.html||"",(0,O.default)(f,S.ComponentOption),!this.$parent||!this.name||f.disable)return;const h=f.name||`${this.name}${this.id}`;(0,u.errorHandle)(!(0,L.has)(this,h),`Cannot add an existing name [${h}] to the [${this.name}]`),this.id+=1;const m=(0,e.createElement)("div");(0,e.addClass)(m,`art-${this.name}`),(0,e.addClass)(m,`art-${this.name}-${h}`);const v=Array.from(this.$parent.children);m.dataset.index=f.index||this.id;const T=v.find(o=>Number(o.dataset.index)>=Number(m.dataset.index));return T?T.insertAdjacentElement("beforebegin",m):(0,e.append)(this.$parent,m),f.html&&(0,e.append)(m,f.html),f.style&&(0,e.setStyles)(m,f.style),f.tooltip&&(0,e.tooltip)(m,f.tooltip),f.click&&this.art.events.proxy(m,"click",o=>{o.preventDefault(),f.click.call(this.art,this,o)}),f.selector&&["left","right"].includes(f.position)&&this.selector(f,m),f.mounted&&f.mounted.call(this.art,m),(0,L.def)(this,h,{value:m}),m}selector(n,f){const{hover:h,proxy:m}=this.art.events;(0,e.addClass)(f,"art-control-selector");const v=(0,e.createElement)("div");(0,e.addClass)(v,"art-selector-value"),(0,e.append)(v,n.html),f.innerText="",(0,e.append)(f,v);const T=n.selector.map((s,g)=>`<div class="art-selector-item ${s.default?"art-current":""}" data-index="${g}">${s.html}</div>`).join(""),o=(0,e.createElement)("div");(0,e.addClass)(o,"art-selector-list"),(0,e.append)(o,T),(0,e.append)(f,o),this.art.option.backdrop&&(0,e.addClass)(o,"art-backdrop-filter");const t=()=>{const s=(0,e.getStyle)(f,"width")/2-(0,e.getStyle)(o,"width")/2;o.style.left=`${s}px`};h(f,t),m(o,"click",async s=>{const g=(s.composedPath()||[]).find(r=>(0,e.hasClass)(r,"art-selector-item"));if(!g)return;(0,e.inverseClass)(g,"art-current");const E=Number(g.dataset.index),d=n.selector[E]||{};if(v.innerText=g.innerText,n.onSelect){const r=await n.onSelect.call(this.art,d,g,s);typeof r!="string"&&typeof r!="number"||(v.innerHTML=r)}t()})}}},{"./dom":"bSNiV","option-validator":"bAWi2","../scheme":"AKEiO","./property":"5NSdr","./error":"hwmZz","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],c61Lj:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,tooltip:c.i18n.get("Fullscreen"),mounted:O=>{const{proxy:S,icons:L,i18n:u}=c,n=(0,a.append)(O,L.fullscreenOn),f=(0,a.append)(O,L.fullscreenOff);(0,a.setStyle)(f,"display","none"),S(O,"click",()=>{c.fullscreen=!c.fullscreen}),c.on("fullscreen",h=>{h?((0,a.tooltip)(O,u.get("Exit Fullscreen")),(0,a.setStyle)(n,"display","none"),(0,a.setStyle)(f,"display","inline-flex")):((0,a.tooltip)(O,u.get("Fullscreen")),(0,a.setStyle)(n,"display","inline-flex"),(0,a.setStyle)(f,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03jeB":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,tooltip:c.i18n.get("Web Fullscreen"),mounted:O=>{const{proxy:S,icons:L,i18n:u}=c,n=(0,a.append)(O,L.fullscreenWebOn),f=(0,a.append)(O,L.fullscreenWebOff);(0,a.setStyle)(f,"display","none"),S(O,"click",()=>{c.fullscreenWeb=!c.fullscreenWeb}),c.on("fullscreenWeb",h=>{h?((0,a.tooltip)(O,u.get("Exit Web Fullscreen")),(0,a.setStyle)(n,"display","none"),(0,a.setStyle)(f,"display","inline-flex")):((0,a.tooltip)(O,u.get("Web Fullscreen")),(0,a.setStyle)(n,"display","inline-flex"),(0,a.setStyle)(f,"display","none"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],u8l8e:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,tooltip:c.i18n.get("PIP Mode"),mounted:O=>{const{proxy:S,icons:L,i18n:u}=c;(0,a.append)(O,L.pip),S(O,"click",()=>{c.pip=!c.pip}),c.on("pip",n=>{(0,a.tooltip)(O,u.get(n?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ebXtb:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,mounted:O=>{const{proxy:S,icons:L,i18n:u}=c,n=(0,a.append)(O,L.play),f=(0,a.append)(O,L.pause);function h(){(0,a.setStyle)(n,"display","flex"),(0,a.setStyle)(f,"display","none")}function m(){(0,a.setStyle)(n,"display","none"),(0,a.setStyle)(f,"display","flex")}(0,a.tooltip)(n,u.get("Play")),(0,a.tooltip)(f,u.get("Pause")),S(n,"click",()=>{c.play()}),S(f,"click",()=>{c.pause()}),c.playing?m():h(),c.on("video:playing",()=>{m()}),c.on("video:pause",()=>{h()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bgoVP:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i),a.export(i,"getPosFromEvent",()=>c),a.export(i,"setCurrentTime",()=>O);var e=R("../utils");function c(S,L){const{$progress:u}=S.template,{left:n}=u.getBoundingClientRect(),f=e.isMobile?L.touches[0].clientX:L.pageX,h=(0,e.clamp)(f-n,0,u.clientWidth),m=h/u.clientWidth*S.duration;return{second:m,time:(0,e.secondToTime)(m),width:h,percentage:(0,e.clamp)(h/u.clientWidth,0,1)}}function O(S,L){if(S.isRotate){const u=L.touches[0].clientY/S.height,n=u*S.duration;S.emit("setBar","played",u),S.seek=n}else{const{second:u,percentage:n}=c(S,L);S.emit("setBar","played",n),S.seek=u}}i.default=function(S){return L=>{const{icons:u,option:n,proxy:f}=L;return{...S,html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:h=>{let m=!1;const v=(0,e.query)(".art-progress-loaded",h),T=(0,e.query)(".art-progress-played",h),o=(0,e.query)(".art-progress-highlight",h),t=(0,e.query)(".art-progress-indicator",h),s=(0,e.query)(".art-progress-tip",h),{PROGRESS_HEIGHT:g,INDICATOR_SIZE:E,INDICATOR_SIZE_ICON:d,INDICATOR_SIZE_MOBILE:r,INDICATOR_SIZE_MOBILE_ICON:l}=L.constructor;(0,e.setStyle)(h,"height",`${g}px`),(0,e.setStyle)(T,"backgroundColor","var(--theme)");let A=E;function x(b,D){b==="loaded"&&(0,e.setStyle)(v,"width",100*D+"%"),b==="played"&&((0,e.setStyle)(T,"width",100*D+"%"),(0,e.setStyle)(t,"left",`calc(${100*D}% - ${A/2}px)`))}u.indicator?(A=d,(0,e.append)(t,u.indicator)):(0,e.setStyles)(t,{backgroundColor:"var(--theme)"}),e.isMobile&&(A=r,u.indicator&&(A=l)),(0,e.setStyles)(t,{left:`-${A/2}px`,width:`${A}px`,height:`${A}px`}),L.on("video:loadedmetadata",()=>{for(let b=0;b<n.highlight.length;b++){const D=n.highlight[b],p=(0,e.clamp)(D.time,0,L.duration)/L.duration*100;(0,e.append)(o,`<span data-text="${D.text}" data-time="${D.time}" style="left: ${p}%"></span>`)}}),x("loaded",L.loaded),L.on("setBar",(b,D)=>{x(b,D)}),L.on("video:progress",()=>{x("loaded",L.loaded)}),L.on("video:timeupdate",()=>{x("played",L.played)}),L.on("video:ended",()=>{x("played",1)}),e.isMobile||(f(h,"click",b=>{b.target!==t&&O(L,b)}),f(h,"mousemove",b=>{(0,e.setStyle)(s,"display","block"),(0,e.includeFromEvent)(b,o)?function(D){const{width:p}=c(L,D),{text:y}=D.target.dataset;s.innerHTML=y;const I=s.clientWidth;p<=I/2?(0,e.setStyle)(s,"left",0):p>h.clientWidth-I/2?(0,e.setStyle)(s,"left",h.clientWidth-I+"px"):(0,e.setStyle)(s,"left",p-I/2+"px")}(b):function(D){const{width:p,time:y}=c(L,D);s.innerHTML=y;const I=s.clientWidth;p<=I/2?(0,e.setStyle)(s,"left",0):p>h.clientWidth-I/2?(0,e.setStyle)(s,"left",h.clientWidth-I+"px"):(0,e.setStyle)(s,"left",p-I/2+"px")}(b)}),f(h,"mouseleave",()=>{(0,e.setStyle)(s,"display","none")}),f(h,"mousedown",()=>{m=!0}),f(document,"mousemove",b=>{if(m){const{second:D,percentage:p}=c(L,b);x("played",p),L.seek=D}}),f(document,"mouseup",()=>{m&&(m=!1)}))}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ikc2j:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,style:{cursor:"auto",marginLeft:"10px"},mounted:O=>{function S(){const u=`${(0,a.secondToTime)(c.currentTime)} / ${(0,a.secondToTime)(c.duration)}`;u!==O.innerText&&(O.innerText=u)}S();const L=["video:loadedmetadata","video:timeupdate","video:progress"];for(let u=0;u<L.length;u++)c.on(L[u],S)}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],b8NFx:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,mounted:O=>{const{proxy:S,icons:L,i18n:u}=c;let n=!1;const f=c.constructor.VOLUME_PANEL_WIDTH,h=c.constructor.VOLUME_HANDLE_WIDTH,m=(0,a.append)(O,L.volume),v=(0,a.append)(O,L.volumeClose),T=(0,a.append)(O,'<div class="art-volume-panel"></div>'),o=(0,a.append)(T,'<div class="art-volume-slider-handle"></div>');function t(g){const{left:E}=T.getBoundingClientRect();return(0,a.clamp)(g.pageX-E-h/2,0,f-h/2)/(f-h)}function s(g=.7){if(c.muted||g===0)(0,a.setStyle)(m,"display","none"),(0,a.setStyle)(v,"display","flex"),(0,a.setStyle)(o,"left","0");else{const E=(f-h)*g;(0,a.setStyle)(m,"display","flex"),(0,a.setStyle)(v,"display","none"),(0,a.setStyle)(o,"left",`${E}px`)}}(0,a.tooltip)(m,u.get("Mute")),(0,a.setStyle)(v,"display","none"),a.isMobile&&(0,a.setStyle)(T,"display","none"),s(c.volume),c.on("video:volumechange",()=>{s(c.volume)}),S(m,"click",()=>{c.muted=!0}),S(v,"click",()=>{c.muted=!1}),S(T,"click",g=>{c.muted=!1,c.volume=t(g)}),S(o,"mousedown",()=>{n=!0}),S(O,"mousemove",g=>{n&&(c.muted=!1,c.volume=t(g))}),S(document,"mouseup",()=>{n&&(n=!1)})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"03o9l":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,tooltip:c.i18n.get("Show Setting"),mounted:O=>{const{proxy:S,icons:L,i18n:u}=c;(0,a.append)(O,L.setting),S(O,"click",()=>{c.setting.toggle=!0,c.setting.updateStyle()}),c.on("setting",n=>{(0,a.tooltip)(O,u.get(n?"Hide Setting":"Show Setting"))})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eCVx2:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils"),e=R("./progress");i.default=function(c){return O=>({...c,mounted:S=>{const{option:L,template:{$progress:u,$video:n},events:{proxy:f,loadImg:h}}=O;let m=null,v=!1,T=!1;f(u,"mousemove",async o=>{v||(v=!0,m=await h(L.thumbnails.url),T=!0),T&&((0,a.setStyle)(S,"display","block"),function(t){const{width:s}=(0,e.getPosFromEvent)(O,t),{url:g,number:E,column:d,width:r,height:l}=L.thumbnails,A=r||m.naturalWidth/d,x=l||A/(n.videoWidth/n.videoHeight),b=u.clientWidth/E,D=Math.floor(s/b),p=Math.ceil(D/d)-1,y=D%d||d-1;(0,a.setStyle)(S,"backgroundImage",`url(${g})`),(0,a.setStyle)(S,"height",`${x}px`),(0,a.setStyle)(S,"width",`${A}px`),(0,a.setStyle)(S,"backgroundPosition",`-${y*A}px -${p*x}px`),s<=A/2?(0,a.setStyle)(S,"left",0):s>u.clientWidth-A/2?(0,a.setStyle)(S,"left",u.clientWidth-A+"px"):(0,a.setStyle)(S,"left",s-A/2+"px")}(o))}),f(u,"mouseleave",()=>{(0,a.setStyle)(S,"display","none")}),O.on("hover",o=>{o||(0,a.setStyle)(S,"display","none")})}})}},{"../utils":"71aH7","./progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4KCF5":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,tooltip:c.i18n.get("Screenshot"),mounted:O=>{const{proxy:S,icons:L}=c;(0,a.append)(O,L.screenshot),S(O,"click",()=>{c.screenshot()})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],efgTY:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a){return e=>{const c=e.option.quality,O=c.find(S=>S.default)||c[0];return{...a,style:{marginRight:"10px"},html:O?O.html:"",selector:c,onSelect(S){e.switchQuality(S.url,S.html)}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2hIff":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,mounted:O=>{const S=(0,a.append)(O,'<span class="art-loop-point"></span>'),L=(0,a.append)(O,'<span class="art-loop-point"></span>');c.on("loop",u=>{u&&u.length?((0,a.setStyle)(O,"display","block"),(0,a.setStyle)(S,"left",`calc(${u[0]/c.duration*100}% - ${S.clientWidth}px)`),(0,a.setStyle)(L,"left",u[1]/c.duration*100+"%")):(0,a.setStyle)(O,"display","none")})}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4IS2d":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>({...e,tooltip:c.i18n.get("AirPlay"),mounted:O=>{const{proxy:S,icons:L}=c;(0,a.append)(O,L.airplay),S(O,"click",()=>c.airplay())}})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2KYsr":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../utils"),c=R("../utils/component"),O=a.interopDefault(c),S=R("./playbackRate"),L=a.interopDefault(S),u=R("./aspectRatio"),n=a.interopDefault(u),f=R("./flip"),h=a.interopDefault(f),m=R("./info"),v=a.interopDefault(m),T=R("./version"),o=a.interopDefault(T),t=R("./close"),s=a.interopDefault(t);class g extends O.default{constructor(d){super(d),this.name="contextmenu",this.$parent=d.template.$contextmenu,e.isMobile||this.init()}init(){const{option:d,proxy:r,template:{$player:l,$contextmenu:A}}=this.art;d.playbackRate&&this.add((0,L.default)({name:"playbackRate",index:10})),d.aspectRatio&&this.add((0,n.default)({name:"aspectRatio",index:20})),d.flip&&this.add((0,h.default)({name:"flip",index:30})),this.add((0,v.default)({name:"info",index:40})),this.add((0,o.default)({name:"version",index:50})),this.add((0,s.default)({name:"close",index:60}));for(let x=0;x<d.contextmenu.length;x++)this.add(d.contextmenu[x]);r(l,"contextmenu",x=>{if(x.preventDefault(),!this.art.constructor.CONTEXTMENU)return;this.show=!0;const b=x.clientX,D=x.clientY,{height:p,width:y,left:I,top:C}=l.getBoundingClientRect(),{height:P,width:w}=A.getBoundingClientRect();let k=b-I,F=D-C;b+w>I+y&&(k=y-w),D+P>C+p&&(F=p-P),(0,e.setStyles)(A,{top:`${F}px`,left:`${k}px`})}),r(l,"click",x=>{(0,e.includeFromEvent)(x,A)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}i.default=g},{"../utils":"71aH7","../utils/component":"18nVI","./playbackRate":"69eLi","./aspectRatio":"lUefg","./flip":"kysiM","./info":"gqIgJ","./version":"kRU7C","./close":"jQ8Pm","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"69eLi":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>{const{i18n:O,constructor:{PLAYBACK_RATE:S}}=c;return{...e,html:`${O.get("Play Speed")}:
                ${S.map(L=>`<span data-value="${L}">${L===1?O.get("Normal"):L}</span>`).join("")}
            `,click:(L,u)=>{const{value:n}=u.target.dataset;n&&(c.playbackRate=Number(n),L.show=!1)},mounted:L=>{const u=(0,a.query)('[data-value="1"]',L);u&&(0,a.inverseClass)(u,"art-current"),c.on("video:ratechange",()=>{const n=(0,a.queryAll)("span",L).find(f=>Number(f.dataset.value)===c.playbackRate);n&&(0,a.inverseClass)(n,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],lUefg:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>{const{i18n:O,constructor:{ASPECT_RATIO:S}}=c;return{...e,html:`${O.get("Aspect Ratio")}:
                ${S.map(L=>`<span data-value="${L}">${L==="default"?O.get("Default"):L}</span>`).join("")}
            `,click:(L,u)=>{const{value:n}=u.target.dataset;n&&(c.aspectRatio=n,L.show=!1)},mounted:L=>{const u=(0,a.query)('[data-value="default"]',L);u&&(0,a.inverseClass)(u,"art-current"),c.on("aspectRatio",n=>{const f=(0,a.queryAll)("span",L).find(h=>h.dataset.value===n);f&&(0,a.inverseClass)(f,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kysiM:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){return c=>{const{i18n:O,constructor:{FLIP:S}}=c;return{...e,html:`${O.get("Video Flip")}:
                ${S.map(L=>`<span data-value="${L}">${O.get((0,a.capitalize)(L))}</span>`).join("")}
            `,click:(L,u)=>{const{value:n}=u.target.dataset;n&&(c.flip=n.toLowerCase(),L.show=!1)},mounted:L=>{const u=(0,a.query)('[data-value="normal"]',L);u&&(0,a.inverseClass)(u,"art-current"),c.on("flip",n=>{const f=(0,a.queryAll)("span",L).find(h=>h.dataset.value===n);f&&(0,a.inverseClass)(f,"art-current")})}}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],gqIgJ:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a){return e=>({...a,html:e.i18n.get("Video Info"),click:c=>{e.info.show=!0,c.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kRU7C:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a){return{...a,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.6.2</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jQ8Pm:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a){return e=>({...a,html:e.i18n.get("Close"),click:c=>{c.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"02ajl":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./utils"),c=R("./utils/component"),O=a.interopDefault(c);class S extends O.default{constructor(u){super(u),this.name="info",e.isMobile||this.init()}init(){const{proxy:u,constructor:n,template:{$infoPanel:f,$infoClose:h,$video:m}}=this.art;u(h,"click",()=>{this.show=!1});let v=null;const T=(0,e.queryAll)("[data-video]",f)||[];this.art.on("destroy",()=>{clearTimeout(v)}),function o(){for(let t=0;t<T.length;t++){const s=T[t],g=m[s.dataset.video],E=typeof g=="number"?g.toFixed(2):g;s.innerText!==E&&(s.innerText=E)}v=setTimeout(o,n.INFO_LOOP_TIME)}()}}i.default=S},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eSWto:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./utils"),c=R("./utils/component"),O=a.interopDefault(c),S=R("option-validator"),L=a.interopDefault(S),u=R("./scheme"),n=a.interopDefault(u);class f extends O.default{constructor(m){super(m),this.name="subtitle",this.eventDestroy=()=>null,this.init(m.option.subtitle);let v=!1;m.on("video:timeupdate",()=>{if(!this.url)return;const T=this.art.template.$video.webkitDisplayingFullscreen;typeof T=="boolean"&&T!==v&&(v=T,this.createTrack(T?"subtitles":"metadata",this.url))})}get url(){return this.art.template.$track.src}set url(m){this.switch(m)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(m,v){const{$subtitle:T}=this.art.template;return typeof m=="object"?(0,e.setStyles)(T,m):(0,e.setStyle)(T,m,v)}update(){const{$subtitle:m}=this.art.template;m.innerHTML="",this.activeCue&&(this.art.option.subtitle.escape?m.innerHTML=this.activeCue.text.split(/\r?\n/).map(v=>`<p>${(0,e.escape)(v)}</p>`).join(""):m.innerHTML=this.activeCue.text,this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(m,v={}){const{i18n:T,notice:o,option:t}=this.art,s={...t.subtitle,...v,url:m},g=await this.init(s);return v.name&&(o.show=`${T.get("Switch Subtitle")}: ${v.name}`),g}createTrack(m,v){const{template:T,proxy:o}=this.art,{$video:t,$track:s}=T,g=(0,e.createElement)("track");g.default=!0,g.kind=m,g.src=v,g.track.mode="hidden",this.eventDestroy(),(0,e.remove)(s),(0,e.append)(t,g),T.$track=g,this.eventDestroy=o(this.textTrack,"cuechange",()=>this.update())}async init(m){const{notice:v,template:{$subtitle:T}}=this.art;if((0,L.default)(m,n.default.subtitle),m.url)return this.style(m.style),fetch(m.url).then(o=>o.arrayBuffer()).then(o=>{const t=new TextDecoder(m.encoding).decode(o);switch(this.art.emit("subtitleLoad",m.url),m.type||(0,e.getExt)(m.url)){case"srt":return(0,e.vttToBlob)((0,e.srtToVtt)(t));case"ass":return(0,e.vttToBlob)((0,e.assToVtt)(t));case"vtt":return(0,e.vttToBlob)(t);default:return m.url}}).then(o=>(T.innerHTML="",this.url===o||(URL.revokeObjectURL(this.url),this.createTrack("metadata",o),this.art.emit("subtitleSwitch",o)),o)).catch(o=>{throw v.show=o,o})}}i.default=f},{"./utils":"71aH7","./utils/component":"18nVI","option-validator":"bAWi2","./scheme":"AKEiO","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],jo4S1:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../utils/error"),c=R("./clickInit"),O=a.interopDefault(c),S=R("./hoverInit"),L=a.interopDefault(S),u=R("./mousemoveInit"),n=a.interopDefault(u),f=R("./resizeInit"),h=a.interopDefault(f),m=R("./gestureInit"),v=a.interopDefault(m),T=R("./viewInit"),o=a.interopDefault(T);i.default=class{constructor(t){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),t.whitelist.state&&((0,O.default)(t,this),(0,L.default)(t,this),(0,n.default)(t,this),(0,h.default)(t,this),(0,v.default)(t,this),(0,o.default)(t,this))}proxy(t,s,g,E={}){if(Array.isArray(s))return s.map(r=>this.proxy(t,r,g,E));t.addEventListener(s,g,E);const d=()=>t.removeEventListener(s,g,E);return this.destroyEvents.push(d),d}hover(t,s,g){s&&this.proxy(t,"mouseenter",s),g&&this.proxy(t,"mouseleave",g)}loadImg(t){return new Promise((s,g)=>{let E;if(t instanceof HTMLImageElement)E=t;else{if(typeof t!="string")return g(new e.ArtPlayerError("Unable to get Image"));E=new Image,E.src=t}if(E.complete)return s(E);this.proxy(E,"load",()=>s(E)),this.proxy(E,"error",()=>g(new e.ArtPlayerError(`Failed to load Image: ${E.src}`)))})}destroy(){for(let t=0;t<this.destroyEvents.length;t++)this.destroyEvents[t]()}}},{"../utils/error":"hwmZz","./clickInit":"6UrCm","./hoverInit":"4jWHi","./mousemoveInit":"bMF9b","./resizeInit":"eDXPO","./gestureInit":"95GtS","./viewInit":"InUBx","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6UrCm":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e,c){const{constructor:O,template:{$player:S,$video:L}}=e;c.proxy(document,["click","contextmenu"],n=>{(0,a.includeFromEvent)(n,S)?(e.isInput=n.target.tagName==="INPUT",e.isFocus=!0,e.emit("focus")):(e.isInput=!1,e.isFocus=!1,e.emit("blur"))});let u=0;c.proxy(L,"click",()=>{const n=Date.now();n-u<=O.DB_CLICE_TIME?(e.emit("dblclick"),a.isMobile?e.isLock||e.toggle():e.fullscreen=!e.fullscreen):(e.emit("click"),a.isMobile||e.toggle()),u=n})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"4jWHi":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e,c){const{$player:O}=e.template;c.hover(O,S=>{(0,a.addClass)(O,"art-hover"),e.emit("hover",!0,S)},S=>{(0,a.removeClass)(O,"art-hover"),e.emit("hover",!1,S)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],bMF9b:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a,e){const{$player:c}=a.template;e.proxy(c,"mousemove",O=>{a.emit("mousemove",O)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],eDXPO:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e,c){const{option:O}=e,S=(0,a.throttle)(()=>{e.normalSize&&(e.autoSize=O.autoSize),e.aspectRatioReset=!0,e.notice.show="",e.emit("resize")},e.constructor.RESIZE_TIME);c.proxy(window,["orientationchange","resize"],()=>{S()}),screen&&screen.orientation&&screen.orientation.onchange&&c.proxy(screen.orientation,"change",()=>{S()})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"95GtS":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils"),e=R("../control/progress");i.default=function(c,O){if(a.isMobile&&!c.option.isLive){const{$video:S,$progress:L}=c.template;let u=null,n=!1,f=0,h=0,m=0;const v=t=>{if(t.touches.length===1&&!c.isLock){u===L&&(0,e.setCurrentTime)(c,t),n=!0;const{clientX:s,clientY:g}=t.touches[0];f=s,h=g,m=c.currentTime}},T=t=>{if(t.touches.length===1&&n&&c.duration){const{clientX:s,clientY:g}=t.touches[0],E=(0,a.clamp)((s-f)/c.width,-1,1),d=(0,a.clamp)((g-h)/c.height,-1,1),r=c.isRotate?d:E,l=u===S?c.constructor.TOUCH_MOVE_RATIO:1,A=(0,a.clamp)(m+c.duration*r*l,0,c.duration);c.seek=A,c.emit("setBar","played",(0,a.clamp)(A/c.duration,0,1)),c.notice.show=`${(0,a.secondToTime)(A)} / ${(0,a.secondToTime)(c.duration)}`}},o=()=>{n&&(f=0,h=0,m=0,n=!1,u=null)};O.proxy(L,"touchstart",t=>{u=L,v(t)}),O.proxy(S,"touchstart",t=>{u=S,v(t)}),O.proxy(S,"touchmove",T),O.proxy(L,"touchmove",T),O.proxy(document,"touchend",o)}}},{"../utils":"71aH7","../control/progress":"bgoVP","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],InUBx:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e,c){const{option:O,constructor:S,template:{$container:L}}=e,u=(0,a.throttle)(()=>{e.emit("view",(0,a.isInViewport)(L,S.SCROLL_GAP))},S.SCROLL_TIME);c.proxy(window,"scroll",()=>{u()}),e.on("view",n=>{O.autoMini&&(e.mini=!n)})}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6NoFy":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("./utils");i.default=class{constructor(e){this.art=e,this.keys={},e.option.hotkey&&!a.isMobile&&this.init()}init(){const{proxy:e,constructor:c}=this.art;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=c.SEEK_STEP}),this.add(38,()=>{this.art.volume+=c.VOLUME_STEP}),this.add(39,()=>{this.art.forward=c.SEEK_STEP}),this.add(40,()=>{this.art.volume-=c.VOLUME_STEP}),e(window,"keydown",O=>{if(this.art.isFocus){const S=document.activeElement.tagName.toUpperCase(),L=document.activeElement.getAttribute("contenteditable");if(S!=="INPUT"&&S!=="TEXTAREA"&&L!==""&&L!=="true"){const u=this.keys[O.keyCode];if(u){O.preventDefault();for(let n=0;n<u.length;n++)u[n].call(this.art,O);this.art.emit("hotkey",O)}}}})}add(e,c){return this.keys[e]?this.keys[e].push(c):this.keys[e]=[c],this}remove(e,c){if(this.keys[e]){const O=this.keys[e].indexOf(c);O!==-1&&this.keys[e].splice(O,1)}return this}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6G6hZ":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./utils/component"),c=a.interopDefault(e);class O extends c.default{constructor(L){super(L);const{option:u,template:{$layer:n}}=L;this.name="layer",this.$parent=n;for(let f=0;f<u.layers.length;f++)this.add(u.layers[f])}}i.default=O},{"./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"3dsEe":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./utils"),c=R("./utils/component"),O=a.interopDefault(c);class S extends O.default{constructor(u){super(u),this.name="loading",(0,e.append)(u.template.$loading,u.icons.loading)}}i.default=S},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],dWGTw:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("./utils");i.default=class{constructor(e){this.art=e,this.timer=null}set show(e){const{constructor:c,template:{$player:O,$noticeInner:S}}=this.art;e?(S.innerText=e instanceof Error?e.message.trim():e,(0,a.addClass)(O,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{S.innerText="",(0,a.removeClass)(O,"art-notice-show")},c.NOTICE_TIME)):(0,a.removeClass)(O,"art-notice-show")}}},{"./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"5POkG":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./utils"),c=R("./utils/component"),O=a.interopDefault(c);class S extends O.default{constructor(u){super(u),this.name="mask";const{template:n,icons:f,events:h}=u,m=(0,e.append)(n.$state,f.state),v=(0,e.append)(n.$state,f.error);(0,e.setStyle)(v,"display","none"),u.on("destroy",()=>{(0,e.setStyle)(m,"display","none"),(0,e.setStyle)(v,"display",null)}),h.proxy(n.$state,"click",()=>u.play())}}i.default=S},{"./utils":"71aH7","./utils/component":"18nVI","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"6OeNg":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../utils"),c=R("bundle-text:./loading.svg"),O=a.interopDefault(c),S=R("bundle-text:./state.svg"),L=a.interopDefault(S),u=R("bundle-text:./check.svg"),n=a.interopDefault(u),f=R("bundle-text:./play.svg"),h=a.interopDefault(f),m=R("bundle-text:./pause.svg"),v=a.interopDefault(m),T=R("bundle-text:./volume.svg"),o=a.interopDefault(T),t=R("bundle-text:./volume-close.svg"),s=a.interopDefault(t),g=R("bundle-text:./screenshot.svg"),E=a.interopDefault(g),d=R("bundle-text:./setting.svg"),r=a.interopDefault(d),l=R("bundle-text:./arrow-left.svg"),A=a.interopDefault(l),x=R("bundle-text:./arrow-right.svg"),b=a.interopDefault(x),D=R("bundle-text:./playback-rate.svg"),p=a.interopDefault(D),y=R("bundle-text:./aspect-ratio.svg"),I=a.interopDefault(y),C=R("bundle-text:./config.svg"),P=a.interopDefault(C),w=R("bundle-text:./pip.svg"),k=a.interopDefault(w),F=R("bundle-text:./lock.svg"),_=a.interopDefault(F),B=R("bundle-text:./unlock.svg"),N=a.interopDefault(B),U=R("bundle-text:./fullscreen-off.svg"),j=a.interopDefault(U),K=R("bundle-text:./fullscreen-on.svg"),H=a.interopDefault(K),G=R("bundle-text:./fullscreen-web-off.svg"),W=a.interopDefault(G),X=R("bundle-text:./fullscreen-web-on.svg"),z=a.interopDefault(X),Q=R("bundle-text:./switch-on.svg"),$=a.interopDefault(Q),Y=R("bundle-text:./switch-off.svg"),J=a.interopDefault(Y),q=R("bundle-text:./flip.svg"),tt=a.interopDefault(q),et=R("bundle-text:./error.svg"),rt=a.interopDefault(et),V=R("bundle-text:./close.svg"),it=a.interopDefault(V),at=R("bundle-text:./airplay.svg"),ot=a.interopDefault(at);i.default=class{constructor(ut){const nt={loading:O.default,state:L.default,play:h.default,pause:v.default,check:n.default,volume:o.default,volumeClose:s.default,screenshot:E.default,setting:r.default,pip:k.default,arrowLeft:A.default,arrowRight:b.default,playbackRate:p.default,aspectRatio:I.default,config:P.default,lock:_.default,flip:tt.default,unlock:N.default,fullscreenOff:j.default,fullscreenOn:H.default,fullscreenWebOff:W.default,fullscreenWebOn:z.default,switchOn:$.default,switchOff:J.default,error:rt.default,close:it.default,airplay:ot.default,...ut.option.icons};Object.keys(nt).forEach(ft=>{(0,e.def)(this,ft,{get:()=>{const st=(0,e.createElement)("i");return(0,e.addClass)(st,"art-icon"),(0,e.addClass)(st,`art-icon-${ft}`),(0,e.append)(st,nt[ft]),st}})})}}},{"../utils":"71aH7","bundle-text:./loading.svg":"7tDub","bundle-text:./state.svg":"1ElZc","bundle-text:./check.svg":"lmgoP","bundle-text:./play.svg":"lVWoQ","bundle-text:./pause.svg":"5Mnax","bundle-text:./volume.svg":"w3eIa","bundle-text:./volume-close.svg":"rHjo1","bundle-text:./screenshot.svg":"2KcqM","bundle-text:./setting.svg":"8rQMV","bundle-text:./arrow-left.svg":"kqGBE","bundle-text:./arrow-right.svg":"aFjpC","bundle-text:./playback-rate.svg":"lx7ZM","bundle-text:./aspect-ratio.svg":"2sEjf","bundle-text:./config.svg":"fQTgE","bundle-text:./pip.svg":"2CaxO","bundle-text:./lock.svg":"aCGnW","bundle-text:./unlock.svg":"bTrAV","bundle-text:./fullscreen-off.svg":"bA3p0","bundle-text:./fullscreen-on.svg":"fTuY8","bundle-text:./fullscreen-web-off.svg":"tvKf4","bundle-text:./fullscreen-web-on.svg":"1F1oB","bundle-text:./switch-on.svg":"7qNHs","bundle-text:./switch-off.svg":"28aV8","bundle-text:./flip.svg":"1uXI6","bundle-text:./error.svg":"9f4dh","bundle-text:./close.svg":"4nTtS","bundle-text:./airplay.svg":"cDPXC","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7tDub":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],"1ElZc":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],lmgoP:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],lVWoQ:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],"5Mnax":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],w3eIa:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],rHjo1:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"2KcqM":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"8rQMV":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],kqGBE:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],aFjpC:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" height="32" width="32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],lx7ZM:[function(R,M,i){M.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2sEjf":[function(R,M,i){M.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],fQTgE:[function(R,M,i){M.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2CaxO":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],aCGnW:[function(R,M,i){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],bTrAV:[function(R,M,i){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bA3p0:[function(R,M,i){M.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fTuY8:[function(R,M,i){M.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],tvKf4:[function(R,M,i){M.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],"1F1oB":[function(R,M,i){M.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"7qNHs":[function(R,M,i){M.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],"28aV8":[function(R,M,i){M.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],"1uXI6":[function(R,M,i){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9f4dh":[function(R,M,i){M.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],"4nTtS":[function(R,M,i){M.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],cDPXC:[function(R,M,i){M.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],"3eYNH":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./flip"),c=a.interopDefault(e),O=R("./aspectRatio"),S=a.interopDefault(O),L=R("./playbackRate"),u=a.interopDefault(L),n=R("./subtitleOffset"),f=a.interopDefault(n),h=R("../utils/component"),m=a.interopDefault(h),v=R("../utils");class T extends m.default{constructor(t){super(t);const{option:s,proxy:g,template:{$setting:E,$player:d}}=t;if(this.name="setting",this.$parent=E,this.option=[],this.events=[],this.cache=new Map,s.setting){s.playbackRate&&this.option.push((0,u.default)(t)),s.aspectRatio&&this.option.push((0,S.default)(t)),s.flip&&this.option.push((0,c.default)(t)),s.subtitleOffset&&this.option.push((0,f.default)(t));for(let r=0;r<s.settings.length;r++)this.option.push(s.settings[r]);this.update(),t.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),g(d,"click",r=>{!this.show||(0,v.includeFromEvent)(r,t.controls.setting)||(0,v.includeFromEvent)(r,this.$parent)||(this.show=!1,this.init(this.option))})}}static makeRecursion(t,s,g){for(let E=0;E<t.length;E++){const d=t[E];d.$parentItem=s,d.$parentList=g,d.selector&&T.makeRecursion(d.selector,d,t)}return t}update(){return this.cache=new Map,this.events.forEach(t=>t()),this.events=[],this.$parent.innerHTML="",this.option=T.makeRecursion(this.option),this.init(this.option),this.option}add(t){return this.option.push(t),this.update(),t}creatHeader(t){const{icons:s,proxy:g}=this.art,E=(0,v.createElement)("div");(0,v.addClass)(E,"art-setting-item"),(0,v.addClass)(E,"art-setting-item-back");const d=(0,v.append)(E,'<div class="art-setting-item-left"></div>'),r=(0,v.createElement)("div");(0,v.addClass)(r,"art-setting-item-left-icon"),(0,v.append)(r,s.arrowLeft),(0,v.append)(d,r),(0,v.append)(d,t.$parentItem.html);const l=g(E,"click",()=>this.init(t.$parentList));return this.events.push(l),E}creatItem(t,s){const{icons:g,proxy:E}=this.art,d=(0,v.createElement)("div");(0,v.addClass)(d,"art-setting-item"),(0,v.isStringOrNumber)(s.name)&&(d.dataset.name=s.name),(0,v.isStringOrNumber)(s.value)&&(d.dataset.value=s.value);const r=(0,v.append)(d,'<div class="art-setting-item-left"></div>'),l=(0,v.append)(d,'<div class="art-setting-item-right"></div>'),A=(0,v.createElement)("div");switch((0,v.addClass)(A,"art-setting-item-left-icon"),t){case"switch":case"range":(0,v.append)(A,(0,v.isStringOrNumber)(s.icon)||s.icon instanceof Element?s.icon:g.config);break;case"selector":s.selector&&s.selector.length?(0,v.append)(A,(0,v.isStringOrNumber)(s.icon)||s.icon instanceof Element?s.icon:g.config):(0,v.append)(A,g.check)}(0,v.append)(r,A),s.$icon=A,(0,v.def)(s,"icon",{configurable:!0,get:()=>A.innerHTML,set(D){(0,v.isStringOrNumber)(D)&&(A.innerHTML=D)}});const x=(0,v.createElement)("div");(0,v.addClass)(x,"art-setting-item-left-text"),(0,v.append)(x,s.html||""),(0,v.append)(r,x),s.$html=x,(0,v.def)(s,"html",{configurable:!0,get:()=>x.innerHTML,set(D){(0,v.isStringOrNumber)(D)&&(x.innerHTML=D)}});const b=(0,v.createElement)("div");switch((0,v.addClass)(b,"art-setting-item-right-tooltip"),(0,v.append)(b,s.tooltip||""),(0,v.append)(l,b),s.$tooltip=b,(0,v.def)(s,"tooltip",{configurable:!0,get:()=>b.innerHTML,set(D){(0,v.isStringOrNumber)(D)&&(b.innerHTML=D)}}),t){case"switch":{const D=(0,v.createElement)("div");(0,v.addClass)(D,"art-setting-item-right-icon");const p=(0,v.append)(D,g.switchOn),y=(0,v.append)(D,g.switchOff);(0,v.setStyle)(s.switch?y:p,"display","none"),(0,v.append)(l,D),s.$switch=s.switch,(0,v.def)(s,"switch",{configurable:!0,get:()=>s.$switch,set(I){s.$switch=I,I?((0,v.setStyle)(y,"display","none"),(0,v.setStyle)(p,"display",null)):((0,v.setStyle)(y,"display",null),(0,v.setStyle)(p,"display","none"))}});break}case"range":{const D=(0,v.createElement)("div");(0,v.addClass)(D,"art-setting-item-right-icon");const p=(0,v.append)(D,'<input type="range">');p.value=s.range[0]||0,p.min=s.range[1]||0,p.max=s.range[2]||10,p.step=s.range[3]||1,(0,v.addClass)(p,"art-setting-range"),(0,v.append)(l,D),s.$range=p,(0,v.def)(s,"range",{configurable:!0,get:()=>p.valueAsNumber,set(y){p.value=Number(y)}})}break;case"selector":if(s.selector&&s.selector.length){const D=(0,v.createElement)("div");(0,v.addClass)(D,"art-setting-item-right-icon"),(0,v.append)(D,g.arrowRight),(0,v.append)(l,D)}}switch(t){case"switch":if(s.onSwitch){const D=E(d,"click",async p=>{s.switch=await s.onSwitch.call(this.art,s,d,p)});this.events.push(D)}break;case"range":if(s.$range){if(s.onRange){const D=E(s.$range,"change",async p=>{s.tooltip=await s.onRange.call(this.art,s,d,p)});this.events.push(D)}if(s.onChange){const D=E(s.$range,"input",async p=>{s.tooltip=await s.onChange.call(this.art,s,d,p)});this.events.push(D)}}break;case"selector":{const D=E(d,"click",async p=>{if(s.selector&&s.selector.length)this.init(s.selector,s.width);else{(0,v.inverseClass)(d,"art-current");for(let y=0;y<s.$parentItem.selector.length;y++){const I=s.$parentItem.selector[y];I.default=I===s}if(s.$parentList&&this.init(s.$parentList),s.$parentItem&&s.$parentItem.onSelect){const y=await s.$parentItem.onSelect.call(this.art,s,d,p);s.$parentItem.$tooltip&&(0,v.isStringOrNumber)(y)&&(s.$parentItem.$tooltip.innerHTML=y)}}});this.events.push(D),s.default&&(0,v.addClass)(d,"art-current")}}return d}updateStyle(t){const{controls:s,constructor:g,template:{$player:E,$setting:d}}=this.art;if(s.setting){const r=t||g.SETTING_WIDTH,{left:l,width:A}=s.setting.getBoundingClientRect(),{left:x,width:b}=E.getBoundingClientRect(),D=l-x+A/2-r/2;D+r>b?((0,v.setStyle)(d,"left","auto"),(0,v.setStyle)(d,"right","10px")):((0,v.setStyle)(d,"left",`${D}px`),(0,v.setStyle)(d,"right","auto"))}else(0,v.setStyle)(d,"left","auto"),(0,v.setStyle)(d,"right","10px")}init(t,s){const{constructor:g}=this.art;if(this.cache.has(t)){const E=this.cache.get(t);(0,v.inverseClass)(E,"art-current"),(0,v.setStyle)(this.$parent,"width",`${E.dataset.width}px`),(0,v.setStyle)(this.$parent,"height",`${E.dataset.height}px`),this.updateStyle(Number(E.dataset.width))}else{const E=(0,v.createElement)("div");(0,v.addClass)(E,"art-setting-panel"),E.dataset.width=s||g.SETTING_WIDTH,E.dataset.height=t.length*g.SETTING_ITEM_HEIGHT,t[0]&&t[0].$parentItem&&((0,v.append)(E,this.creatHeader(t[0])),E.dataset.height=Number(E.dataset.height)+g.SETTING_ITEM_HEIGHT);for(let d=0;d<t.length;d++){const r=t[d];(0,v.has)(r,"switch")?(0,v.append)(E,this.creatItem("switch",r)):(0,v.has)(r,"range")?(0,v.append)(E,this.creatItem("range",r)):(0,v.append)(E,this.creatItem("selector",r))}(0,v.append)(this.$parent,E),this.cache.set(t,E),(0,v.inverseClass)(E,"art-current"),(0,v.setStyle)(this.$parent,"width",`${E.dataset.width}px`),(0,v.setStyle)(this.$parent,"height",`${E.dataset.height}px`),this.updateStyle(Number(E.dataset.width)),t[0]&&t[0].$parentItem&&t[0].$parentItem.mounted&&t[0].$parentItem.mounted.call(this.art,E,t[0].$parentItem)}}}i.default=T},{"./flip":"kONUB","./aspectRatio":"84NBV","./playbackRate":"aetWt","./subtitleOffset":"fIBkO","../utils/component":"18nVI","../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],kONUB:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,icons:O,constructor:{SETTING_ITEM_WIDTH:S,FLIP:L}}=e;function u(n,f,h){f&&(f.innerText=c.get((0,a.capitalize)(h)));const m=(0,a.queryAll)(".art-setting-item",n).find(v=>v.dataset.value===h);m&&(0,a.inverseClass)(m,"art-current")}return{width:S,html:c.get("Video Flip"),tooltip:c.get((0,a.capitalize)(e.flip)),icon:O.flip,selector:L.map(n=>({value:n,default:n===e.flip,html:c.get((0,a.capitalize)(n))})),onSelect:n=>(e.flip=n.value,n.value),mounted:(n,f)=>{u(n,f.$tooltip,e.flip),e.on("flip",()=>{u(n,f.$tooltip,e.flip)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"84NBV":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,icons:O,constructor:{SETTING_ITEM_WIDTH:S,ASPECT_RATIO:L}}=e;function u(f){return f==="default"?c.get("Default"):f}function n(f,h,m){h&&(h.innerText=u(m));const v=(0,a.queryAll)(".art-setting-item",f).find(T=>T.dataset.value===m);v&&(0,a.inverseClass)(v,"art-current")}return{width:S,html:c.get("Aspect Ratio"),icon:O.aspectRatio,tooltip:u(e.aspectRatio),selector:L.map(f=>({value:f,default:f===e.aspectRatio,html:u(f)})),onSelect:f=>(e.aspectRatio=f.value,f.value),mounted:(f,h)=>{n(f,h.$tooltip,e.aspectRatio),e.on("aspectRatio",()=>{n(f,h.$tooltip,e.aspectRatio)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],aetWt:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,icons:O,constructor:{SETTING_ITEM_WIDTH:S,PLAYBACK_RATE:L}}=e;function u(f){return f===1?c.get("Normal"):f}function n(f,h,m){h&&(h.innerText=u(m));const v=(0,a.queryAll)(".art-setting-item",f).find(T=>Number(T.dataset.value)===m);v&&(0,a.inverseClass)(v,"art-current")}return{width:S,html:c.get("Play Speed"),tooltip:u(e.playbackRate),icon:O.playbackRate,selector:L.map(f=>({value:f,default:f===e.playbackRate,html:u(f)})),onSelect:f=>(e.playbackRate=f.value,f.value),mounted:(f,h)=>{n(f,h.$tooltip,e.playbackRate),e.on("video:ratechange",()=>{n(f,h.$tooltip,e.playbackRate)})}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],fIBkO:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a){const{i18n:e,icons:c,constructor:O}=a;return{width:O.SETTING_ITEM_WIDTH,html:e.get("Subtitle Offset"),icon:c.subtitle,tooltip:"0s",range:[0,-5,5,.1],onChange:S=>(a.subtitleOffset=S.range,S.range+"s")}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"2aaJe":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(a){try{const e=JSON.parse(window.localStorage.getItem(this.name))||{};return a?e[a]:e}catch{return a?this.settings[a]:this.settings}}set(a,e){try{const c=Object.assign({},this.get(),{[a]:e});window.localStorage.setItem(this.name,JSON.stringify(c))}catch{this.settings[a]=e}}del(a){try{const e=this.get();delete e[a],window.localStorage.setItem(this.name,JSON.stringify(e))}catch{delete this.settings[a]}}clear(){try{window.localStorage.removeItem(this.name)}catch{this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"8MTUM":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("../utils"),c=R("./miniProgressBar"),O=a.interopDefault(c),S=R("./autoOrientation"),L=a.interopDefault(S),u=R("./autoPlayback"),n=a.interopDefault(u),f=R("./fastForward"),h=a.interopDefault(f),m=R("./lock"),v=a.interopDefault(m);i.default=class{constructor(T){this.art=T,this.id=0;const{option:o}=T;o.miniProgressBar&&!o.isLive&&this.add(O.default),o.lock&&e.isMobile&&this.add(v.default),o.autoPlayback&&!o.isLive&&this.add(n.default),o.autoOrientation&&e.isMobile&&this.add(L.default),o.fastForward&&e.isMobile&&!o.isLive&&this.add(h.default);for(let t=0;t<o.plugins.length;t++)this.add(o.plugins[t])}add(T){this.id+=1;const o=T.call(this.art,this.art),t=o&&o.name||T.name||`plugin${this.id}`;return(0,e.errorHandle)(!(0,e.has)(this,t),`Cannot add a plugin that already has the same name: ${t}`),(0,e.def)(this,t,{value:o}),this}}},{"../utils":"71aH7","./miniProgressBar":"87pSL","./autoOrientation":"ePEg5","./autoPlayback":"cVO99","./fastForward":"hFDwt","./lock":"1hsTH","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"87pSL":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function(a){return a.on("ready",()=>{a.layers.add({name:"miniProgressBar",mounted(e){a.on("destroy",()=>{e.style.display="none"}),a.on("video:timeupdate",()=>{e.style.width=100*a.played+"%"}),a.on("setBar",(c,O)=>{c==="played"&&(e.style.width=100*O+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],ePEg5:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{option:c,constructor:O,template:{$player:S,$video:L}}=e;return e.on("fullscreenWeb",u=>{if(u){const{videoWidth:n,videoHeight:f}=L,{clientWidth:h,clientHeight:m}=document.documentElement;(n>f&&h<m||n<f&&h>m)&&setTimeout(()=>{(0,a.setStyle)(S,"width",`${m}px`),(0,a.setStyle)(S,"height",`${h}px`),(0,a.setStyle)(S,"transform-origin","0 0"),(0,a.setStyle)(S,"transform",`rotate(90deg) translate(0, -${h}px)`),(0,a.addClass)(S,"art-auto-orientation"),e.isRotate=!0,e.emit("resize")},O.MOBILE_AUTO_ORIENTATION_TIME)}else(0,a.hasClass)(S,"art-auto-orientation")&&((0,a.setStyle)(S,"width",null),(0,a.setStyle)(S,"height",null),(0,a.setStyle)(S,"transform",null),(0,a.setStyle)(S,"transform-origin",null),(0,a.removeClass)(S,"art-auto-orientation"),e.isRotate=!1,e.aspectRatioReset=!0,e.autoSize=c.autoSize,e.notice.show="",e.emit("resize"))}),e.on("fullscreen",async u=>{const n=screen.orientation.type;if(u){const{videoWidth:f,videoHeight:h}=L,{clientWidth:m,clientHeight:v}=document.documentElement;if(f>h&&m<v||f<h&&m>v){const T=n.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(T),(0,a.addClass)(S,"art-auto-orientation-fullscreen")}}else(0,a.hasClass)(S,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(n),(0,a.removeClass)(S,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,a.hasClass)(S,"art-auto-orientation")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],cVO99:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{i18n:c,icons:O,storage:S,constructor:L,proxy:u,template:{$poster:n}}=e,f=e.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),h=(0,a.query)(".art-autoPlayback-last",f),m=(0,a.query)(".art-autoPlayback-jump",f),v=(0,a.query)(".art-autoPlayback-close",f);return e.on("video:timeupdate",()=>{const T=S.get("times")||{},o=Object.keys(T);o.length>L.AUTO_PLAYBACK_MAX&&delete T[o[0]],T[e.option.id||e.option.url]=e.currentTime,S.set("times",T)}),e.on("ready",()=>{const T=(S.get("times")||{})[e.option.id||e.option.url];T&&T>=L.AUTO_PLAYBACK_MIN&&((0,a.append)(v,O.close),(0,a.setStyle)(f,"display","flex"),h.innerText=`${c.get("Last Seen")} ${(0,a.secondToTime)(T)}`,m.innerText=c.get("Jump Play"),u(v,"click",()=>{(0,a.setStyle)(f,"display","none")}),u(m,"click",()=>{e.seek=T,e.play(),(0,a.setStyle)(n,"display","none"),(0,a.setStyle)(f,"display","none")}),e.once("video:timeupdate",()=>{setTimeout(()=>{(0,a.setStyle)(f,"display","none")},L.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return S.get("times")||{}},clear:()=>S.del("times"),delete(T){const o=S.get("times")||{};return delete o[T],S.set("times",o),o}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],hFDwt:[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{constructor:c,proxy:O,template:{$player:S,$video:L}}=e;let u=null,n=!1,f=1;const h=()=>{clearTimeout(u),n&&(n=!1,e.playbackRate=f,(0,a.removeClass)(S,"art-fast-forward"))};return O(L,"touchstart",m=>{m.touches.length===1&&e.playing&&!e.isLock&&(u=setTimeout(()=>{n=!0,f=e.playbackRate,e.playbackRate=c.FAST_FORWARD_VALUE,(0,a.addClass)(S,"art-fast-forward")},c.FAST_FORWARD_TIME))}),O(document,"touchmove",h),O(document,"touchend",h),{name:"fastForward",get state(){return(0,a.hasClass)(S,"art-fast-forward")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"1hsTH":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i);var a=R("../utils");i.default=function(e){const{layers:c,icons:O,template:{$player:S}}=e;return c.add({name:"lock",mounted(L){const u=(0,a.append)(L,O.lock),n=(0,a.append)(L,O.unlock);(0,a.setStyle)(u,"display","none"),e.on("lock",f=>{f?((0,a.setStyle)(u,"display","inline-flex"),(0,a.setStyle)(n,"display","none")):((0,a.setStyle)(u,"display","none"),(0,a.setStyle)(n,"display","inline-flex"))})},click(){(0,a.hasClass)(S,"art-lock")?((0,a.removeClass)(S,"art-lock"),this.isLock=!1):((0,a.addClass)(S,"art-lock"),this.isLock=!0)}}),{name:"lock",get state(){return(0,a.hasClass)(S,"art-lock")}}}},{"../utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"7mil2":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./config"),c=a.interopDefault(e),O=R("./utils");i.default=class{constructor(S){const{option:L,proxy:u,template:{$video:n}}=S;for(let m=0;m<c.default.events.length;m++)u(n,c.default.events[m],v=>{S.emit(`video:${v.type}`,v)});Object.keys(L.moreVideoAttr).forEach(m=>{n[m]=L.moreVideoAttr[m]}),n.controls=!0,L.muted&&(n.muted=L.muted),L.volume&&(n.volume=(0,O.clamp)(L.volume,0,1)),L.poster&&(n.poster=L.poster),L.autoplay&&(n.autoplay=L.autoplay),L.playsInline&&(n.playsInline=!0,n["webkit-playsinline"]=!0);const f=L.type||(0,O.getExt)(L.url),h=L.customType[f];f&&h?h(n,L.url,S):(n.src=L.url,S.emit("url",n.src))}}},{"./config":"lyjeQ","./utils":"71aH7","@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}]},["5lTcX"],"5lTcX","parcelRequire4dc0")})(Ut);const Xt=Ft(Ut.exports);var Nt={exports:{}};/*!
 * artplayer-plugin-danmuku.js v4.4.11
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(xt,kt){(function(R,M,i,a,e){var c=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Pt<"u"?Pt:{},O=typeof c.parcelRequire93cf=="function"&&c.parcelRequire93cf,S=O.cache||{},L=typeof Rt=="function"&&Rt.bind(xt);function u(h,m){if(!S[h]){if(!R[h]){var v=typeof c.parcelRequire93cf=="function"&&c.parcelRequire93cf;if(!m&&v)return v(h,!0);if(O)return O(h,!0);if(L&&typeof h=="string")return L(h);var T=new Error("Cannot find module '"+h+"'");throw T.code="MODULE_NOT_FOUND",T}t.resolve=function(s){var g=R[h][1][s];return g!=null?g:s},t.cache={};var o=S[h]=new u.Module(h);R[h][0].call(o.exports,t,o,o.exports,this)}return S[h].exports;function t(s){var g=t.resolve(s);return g===!1?{}:u(g)}}u.isParcelRequire=!0,u.Module=function(h){this.id=h,this.bundle=u,this.exports={}},u.modules=R,u.cache=S,u.parent=O,u.register=function(h,m){R[h]=[function(v,T){T.exports=m},{}]},Object.defineProperty(u,"root",{get:function(){return c.parcelRequire93cf}}),c.parcelRequire93cf=u;for(var n=0;n<M.length;n++)u(M[n]);var f=u(i);xt.exports=f})({E13ST:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./danmuku"),c=a.interopDefault(e),O=R("./setting"),S=a.interopDefault(O);function L(u){return n=>{(function(h){const{version:m,utils:{errorHandle:v}}=h.constructor,T=m.split(".").map(Number);v(T[0]+T[1]/100>=4.04,`Artplayer.js@${m} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 4.4.x \u7248\u672C\u4EE5\u4E0A`)})(n);const f=new c.default(n,u);return(0,S.default)(n,f),{name:"artplayerPluginDanmuku",emit:f.emit.bind(f),load:f.load.bind(f),config:f.config.bind(f),hide:f.hide.bind(f),show:f.show.bind(f),reset:f.reset.bind(f),get option(){return f.option},get isHide(){return f.isHide},get isStop(){return f.isStop}}}}i.default=L,L.env="production",L.version="4.4.11",L.build="2022-10-11 10:47:51",typeof window<"u"&&(window.artplayerPluginDanmuku=L)},{"./danmuku":"8Gtnh","./setting":"jAkJm","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"8Gtnh":[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("./bilibili"),c=R("./getDanmuTop"),O=a.interopDefault(c);class S{constructor(u,n){const{constructor:f,template:h}=u;if(this.utils=f.utils,this.validator=f.validator,this.$danmuku=h.$danmuku,this.$player=h.$player,this.art=u,this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(n),this.option.useWorker)try{this.worker=new Worker(R("27c3930ee158179a"))}catch{}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),u.on("video:play",this.start),u.on("video:playing",this.start),u.on("video:pause",this.stop),u.on("video:waiting",this.stop),u.on("fullscreen",this.reset),u.on("fullscreenWeb",this.reset),u.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:u}=this.utils,n=this.option.margin[0],{clientHeight:f}=this.$player;return typeof n=="number"?u(n,0,f):typeof n=="string"&&n.endsWith("%")?u(f*(parseFloat(n)/100),0,f):S.option.margin[0]}get marginBottom(){const{clamp:u}=this.utils,n=this.option.margin[1],{clientHeight:f}=this.$player;return typeof n=="number"?u(n,0,f):typeof n=="string"&&n.endsWith("%")?u(f*(parseFloat(n)/100),0,f):S.option.margin[1]}filter(u,n){return this.queue.filter(f=>f.$state===u).map(n)}getLeft(u){const n=u.getBoundingClientRect();return this.isRotate?n.top:n.left}getRef(){const u=this.$refs.pop();if(u)return u;const n=document.createElement("div");return n.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,n}getReady(){const{currentTime:u}=this.art;return this.queue.filter(n=>n.$state==="ready"||n.$state==="wait"&&u+.1>=n.time&&n.time>=u-.1)}getEmits(){const u=[],{clientWidth:n}=this.$player,f=this.getLeft(this.$player);return this.filter("emit",h=>{const m=h.$ref.offsetTop,v=this.getLeft(h.$ref)-f,T=h.$ref.clientHeight,o=h.$ref.clientWidth,t=v+o,s=n-t,g=t/h.$restTime,E={};E.top=m,E.left=v,E.height=T,E.width=o,E.right=s,E.speed=g,E.distance=t,E.time=h.$restTime,E.mode=h.mode,u.push(E)}),u}getFontSize(u){const{clamp:n}=this.utils,{clientHeight:f}=this.$player;return typeof u=="number"?n(u,12,f):typeof u=="string"&&u.endsWith("%")?n(f*(parseFloat(u)/100),12,f):S.option.fontSize}postMessage(u={}){return new Promise(n=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)u.id=Date.now(),this.worker.postMessage(u),this.worker.onmessage=f=>{const{data:h}=f;h.id===u.id&&n(h)};else{const f=(0,O.default)(u);n({top:f})}})}async load(){try{let u=[];u=typeof this.option.danmuku=="function"?await this.option.danmuku():typeof this.option.danmuku.then=="function"?await this.option.danmuku:typeof this.option.danmuku=="string"?await(0,e.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.option.danmuku,this.utils.errorHandle(Array.isArray(u),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",u),this.queue=[],this.$danmuku.innerText="",u.forEach(n=>this.emit(n))}catch(u){throw this.art.emit("artplayerPluginDanmuku:error",u),u}return this}config(u){const{clamp:n}=this.utils;return this.option=Object.assign({},S.option,this.option,u),this.validator(this.option,S.scheme),this.option.speed=n(this.option.speed,1,10),this.option.opacity=n(this.option.opacity,0,1),this.option.lockTime=n(Math.floor(this.option.lockTime),0,60),this.option.maxLength=n(this.option.maxLength,0,500),this.option.minWidth=n(this.option.minWidth,0,500),this.option.maxWidth=n(this.option.maxWidth,0,1/0),u.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(u){u.$state="wait",u.$ref&&(u.$ref.style.visibility="hidden",u.$ref.style.marginLeft="0px",u.$ref.style.transform="translateX(0px)",u.$ref.style.transition="transform 0s linear 0s",this.$refs.push(u.$ref),u.$ref=null)}continue(){const{clientWidth:u}=this.$player;return this.filter("stop",n=>{switch(n.$state="emit",n.$lastStartTime=Date.now(),n.mode){case 0:{const f=u+n.$ref.clientWidth;n.$ref.style.transform=`translateX(${-f}px)`,n.$ref.style.transition=`transform ${n.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:u}=this.$player;return this.filter("emit",n=>{switch(n.$state="stop",n.mode){case 0:{const f=u-(this.getLeft(n.$ref)-this.getLeft(this.$player));n.$ref.style.transform=`translateX(${-f}px)`,n.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(u=>this.makeWait(u)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",h=>{const m=(Date.now()-h.$lastStartTime)/1e3;h.$restTime-=m,h.$lastStartTime=Date.now(),h.$restTime<=0&&this.makeWait(h)});const u=this.getReady(),{clientWidth:n,clientHeight:f}=this.$player;for(let h=0;h<u.length;h++){const m=u[h];m.$ref=this.getRef(),m.$ref.innerText=m.text,this.$danmuku.appendChild(m.$ref),m.$ref.style.left=`${n}px`,m.$ref.style.opacity=this.option.opacity,m.$ref.style.fontSize=`${this.option.fontSize}px`,m.$ref.style.color=m.color,m.$ref.style.border=m.border?`1px solid ${m.color}`:null,m.$ref.style.backgroundColor=m.border?"rgb(0 0 0 / 50%)":null,m.$ref.style.marginLeft="0px",m.$lastStartTime=Date.now(),m.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const v={mode:m.mode,height:m.$ref.clientHeight,speed:(n+m.$ref.clientWidth)/m.$restTime},{top:T}=await this.postMessage({target:v,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:n,clientHeight:f,marginBottom:this.marginBottom,marginTop:this.marginTop});if(m.$ref)if(this.isStop||T===void 0)m.$state="ready",this.$refs.push(m.$ref),m.$ref=null;else switch(m.$state="emit",m.$ref.style.visibility="visible",m.mode){case 0:{m.$ref.style.top=`${T}px`;const o=n+m.$ref.clientWidth;m.$ref.style.transform=`translateX(${-o}px)`,m.$ref.style.transition=`transform ${m.$restTime}s linear 0s`;break}case 1:m.$ref.style.left="50%",m.$ref.style.top=`${T}px`,m.$ref.style.marginLeft=`-${m.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(u=>this.makeWait(u)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(u){return this.validator(u,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),u.text.trim()&&this.option.filter(u)?(u.time?u.time=this.utils.clamp(u.time,0,1/0):u.time=this.art.currentTime+.5,u.mode===void 0&&(u.mode=this.option.mode),u.color===void 0&&(u.color=this.option.color),this.queue.push({...u,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("fullscreen",this.reset),this.art.off("fullscreenWeb",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}i.default=S},{"./bilibili":"KnwDr","./getDanmuTop":"2Abxf","27c3930ee158179a":"anHwN","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],KnwDr:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");function e(S){switch(S){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function c(S){if(typeof S!="string")return[];const L=S.matchAll(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(L).map(u=>{const n=u.groups.p.split(",");return n.length>=8?{text:u.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(n[0]),mode:e(Number(n[1])),fontSize:Number(n[2]),color:`#${Number(n[3]).toString(16)}`,timestamp:Number(n[4]),pool:Number(n[5]),userID:n[6],rowID:Number(n[7])}:null}).filter(Boolean)}function O(S){return fetch(S).then(L=>L.text()).then(L=>c(L))}a.defineInteropFlag(i),a.export(i,"getMode",()=>e),a.export(i,"bilibiliDanmuParseFromXml",()=>c),a.export(i,"bilibiliDanmuParseFromUrl",()=>O)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"9v6Cv":[function(R,M,i){i.interopDefault=function(a){return a&&a.__esModule?a:{default:a}},i.defineInteropFlag=function(a){Object.defineProperty(a,"__esModule",{value:!0})},i.exportAll=function(a,e){return Object.keys(a).forEach(function(c){c==="default"||c==="__esModule"||e.hasOwnProperty(c)||Object.defineProperty(e,c,{enumerable:!0,get:function(){return a[c]}})}),e},i.export=function(a,e,c){Object.defineProperty(a,e,{enumerable:!0,get:c})}},{}],"2Abxf":[function(R,M,i){R("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(i),i.default=function({target:a,emits:e,clientWidth:c,clientHeight:O,marginBottom:S,marginTop:L,antiOverlap:u}){const n=e.filter(h=>h.mode===a.mode&&h.top<=O-S).sort((h,m)=>h.top-m.top);if(n.length===0)return L;n.unshift({top:0,left:0,right:0,height:L,width:c,speed:0,distance:c}),n.push({top:O-S,left:0,right:0,height:S,width:c,speed:0,distance:c});for(let h=1;h<n.length;h+=1){const m=n[h],v=n[h-1],T=v.top+v.height;if(m.top-T>=a.height)return T}const f=[];for(let h=1;h<n.length-1;h+=1){const m=n[h];if(f.length){const v=f[f.length-1];v[0].top===m.top?v.push(m):f.push([m])}else f.push([m])}if(!u){switch(a.mode){case 0:f.sort((h,m)=>{const v=Math.min(...m.map(o=>o.right)),T=Math.min(...h.map(o=>o.right));return v*m.length-T*h.length});break;case 1:f.sort((h,m)=>{const v=Math.max(...m.map(T=>T.width));return Math.max(...h.map(T=>T.width))*h.length-v*m.length})}return f[0][0].top}switch(a.mode){case 0:{const h=f.find(m=>m.every(v=>c<v.distance?!1:a.speed<v.speed?!0:v.right/(a.speed-v.speed)>v.time));return h&&h[0]?h[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],anHwN:[function(R,M,i){M.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],jAkJm:[function(R,M,i){var a=R("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(i);var e=R("bundle-text:./style.less"),c=a.interopDefault(e),O=R("bundle-text:./img/danmu-on.svg"),S=a.interopDefault(O),L=R("bundle-text:./img/danmu-off.svg"),u=a.interopDefault(L),n=R("bundle-text:./img/danmu-config.svg"),f=a.interopDefault(n),h=R("bundle-text:./img/danmu-style.svg"),m=a.interopDefault(h);if(i.default=function(v,T){const{option:o}=T,{template:{$controlsCenter:t,$player:s},constructor:{utils:{removeClass:g,addClass:E,append:d,setStyle:r,tooltip:l,query:A,inverseClass:x}}}=v;function b(C,P){const w=document.createElement("i");return d(w,C),E(w,"art-icon"),E(w,`art-icon-${P}`),w}const D=b(S.default,"danmu-on"),p=b(u.default,"danmu-off"),y=b(f.default,"danmu-config"),I=b(m.default,"danmu-style");(function(){const C=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map(z=>`<div class="art-danmuku-style-panel-color${o.color===z?" art-current":""}" data-color="${z}" style="background-color:${z}"></div>`),P=d(t,`<div class="art-danmuku-emitter" style="max-width: ${o.maxWidth?`${o.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${C.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${o.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),w=A(".art-danmuku-style",P),k=A(".art-danmuku-input",P),F=A(".art-danmuku-send",P),_=A(".art-danmuku-style-panel-inner",P),B=A(".art-danmuku-style-panel-modes",P),N=A(".art-danmuku-style-panel-colors",P),U=o.mount||d(s,'<div class="art-layer-danmuku-emitter"></div>');v.option.backdrop&&E(_,"art-backdrop-filter"),o.theme&&E(P,`art-danmuku-theme-${o.theme}`);let j=null,K=o.mode,H=o.color;function G(z){z<=0?(j=null,F.innerText="\u53D1\u9001",g(F,"art-disabled")):(F.innerText=z,j=setTimeout(()=>G(z-1),1e3))}function W(){const z={mode:K,color:H,border:!0,text:k.value.trim()};j===null&&o.beforeEmit(z)&&(k.value="",T.emit(z),E(F,"art-disabled"),G(o.lockTime),v.emit("artplayerPluginDanmuku:emit",z))}function X(){t.clientWidth<o.minWidth?(d(U,P),r(U,"display","flex"),E(P,"art-danmuku-mount"),o.mount||r(s,"marginBottom","40px")):(d(t,P),r(U,"display","none"),g(P,"art-danmuku-mount"),o.mount||r(s,"marginBottom",null))}d(w,I),v.proxy(F,"click",W),v.proxy(k,"keypress",z=>{z.key==="Enter"&&(z.preventDefault(),W())}),v.proxy(B,"click",z=>{const{dataset:Q}=z.target;Q.mode&&(K=Number(Q.mode),x(z.target,"art-current"))}),v.proxy(N,"click",z=>{const{dataset:Q}=z.target;Q.color&&(H=Q.color,x(z.target,"art-current"))}),X(),v.on("resize",()=>{v.isInput||X()}),v.on("destroy",()=>{o.mount&&P.parentElement===o.mount&&o.mount.removeChild(P)})})(),v.controls.add({position:"right",name:"danmuku",click:function(){T.isHide?(T.show(),v.notice.show="\u5F39\u5E55\u663E\u793A",r(D,"display",null),r(p,"display","none")):(T.hide(),v.notice.show="\u5F39\u5E55\u9690\u85CF",r(D,"display","none"),r(p,"display",null))},mounted(C){d(C,D),d(C,p),l(C,"\u5F39\u5E55\u5F00\u5173"),r(p,"display","none")}}),v.setting.add({name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:y,selector:[{width:200,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(C){return T.config({speed:C.time}),C.html}},{width:200,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(C){return T.config({fontSize:C.fontSize}),C.html}},{width:200,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(C){return T.config({opacity:C.opacity}),C.html}},{width:200,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(C){return T.config({margin:C.margin}),C.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:o.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:o.antiOverlap,onSwitch:C=>(T.config({antiOverlap:!C.switch}),C.tooltip=C.switch?"\u5173\u95ED":"\u5F00\u542F",!C.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:o.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:o.synchronousPlayback,onSwitch:C=>(T.config({synchronousPlayback:!C.switch}),C.tooltip=C.switch?"\u5173\u95ED":"\u5F00\u542F",!C.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const v=document.createElement("style");v.id="artplayer-plugin-danmuku",v.textContent=c.default,document.head.appendChild(v)}},{"bundle-text:./style.less":"chNhY","bundle-text:./img/danmu-on.svg":"j5M2a","bundle-text:./img/danmu-off.svg":"d9WLf","bundle-text:./img/danmu-config.svg":"8Y3Ij","bundle-text:./img/danmu-style.svg":"hltwt","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],chNhY:[function(R,M,i){M.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;color:#fff;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#ffffff4d;border-radius:3px;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter *,.art-danmuku-emitter :before,.art-danmuku-emitter :after{box-sizing:border-box;margin:0;padding:0}.art-danmuku-emitter .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-danmuku-emitter .art-icon svg{fill:#fff}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 3px 3px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{height:34px;max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],j5M2a:[function(R,M,i){M.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],d9WLf:[function(R,M,i){M.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"8Y3Ij":[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],hltwt:[function(R,M,i){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}]},["E13ST"],"E13ST")})(Nt);const Qt=Ft(Nt.exports);var jt={exports:{}};(function(xt,kt){typeof window<"u"&&function(M,i){xt.exports=i()}(Pt,function(){return function(R){var M={};function i(a){if(M[a])return M[a].exports;var e=M[a]={i:a,l:!1,exports:{}};return R[a].call(e.exports,e,e.exports,i),e.l=!0,e.exports}return i.m=R,i.c=M,i.d=function(a,e,c){i.o(a,e)||Object.defineProperty(a,e,{enumerable:!0,get:c})},i.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i.t=function(a,e){if(e&1&&(a=i(a)),e&8||e&4&&typeof a=="object"&&a&&a.__esModule)return a;var c=Object.create(null);if(i.r(c),Object.defineProperty(c,"default",{enumerable:!0,value:a}),e&2&&typeof a!="string")for(var O in a)i.d(c,O,function(S){return a[S]}.bind(null,O));return c},i.n=function(a){var e=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(e,"a",e),e},i.o=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)},i.p="/dist/",i(i.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(R,M,i){var a=Object.prototype.hasOwnProperty,e="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(e=!1));function O(n,f,h){this.fn=n,this.context=f,this.once=h||!1}function S(n,f,h,m,v){if(typeof h!="function")throw new TypeError("The listener must be a function");var T=new O(h,m||n,v),o=e?e+f:f;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],T]:n._events[o].push(T):(n._events[o]=T,n._eventsCount++),n}function L(n,f){--n._eventsCount===0?n._events=new c:delete n._events[f]}function u(){this._events=new c,this._eventsCount=0}u.prototype.eventNames=function(){var f=[],h,m;if(this._eventsCount===0)return f;for(m in h=this._events)a.call(h,m)&&f.push(e?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(h)):f},u.prototype.listeners=function(f){var h=e?e+f:f,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var v=0,T=m.length,o=new Array(T);v<T;v++)o[v]=m[v].fn;return o},u.prototype.listenerCount=function(f){var h=e?e+f:f,m=this._events[h];return m?m.fn?1:m.length:0},u.prototype.emit=function(f,h,m,v,T,o){var t=e?e+f:f;if(!this._events[t])return!1;var s=this._events[t],g=arguments.length,E,d;if(s.fn){switch(s.once&&this.removeListener(f,s.fn,void 0,!0),g){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,h),!0;case 3:return s.fn.call(s.context,h,m),!0;case 4:return s.fn.call(s.context,h,m,v),!0;case 5:return s.fn.call(s.context,h,m,v,T),!0;case 6:return s.fn.call(s.context,h,m,v,T,o),!0}for(d=1,E=new Array(g-1);d<g;d++)E[d-1]=arguments[d];s.fn.apply(s.context,E)}else{var r=s.length,l;for(d=0;d<r;d++)switch(s[d].once&&this.removeListener(f,s[d].fn,void 0,!0),g){case 1:s[d].fn.call(s[d].context);break;case 2:s[d].fn.call(s[d].context,h);break;case 3:s[d].fn.call(s[d].context,h,m);break;case 4:s[d].fn.call(s[d].context,h,m,v);break;default:if(!E)for(l=1,E=new Array(g-1);l<g;l++)E[l-1]=arguments[l];s[d].fn.apply(s[d].context,E)}}return!0},u.prototype.on=function(f,h,m){return S(this,f,h,m,!1)},u.prototype.once=function(f,h,m){return S(this,f,h,m,!0)},u.prototype.removeListener=function(f,h,m,v){var T=e?e+f:f;if(!this._events[T])return this;if(!h)return L(this,T),this;var o=this._events[T];if(o.fn)o.fn===h&&(!v||o.once)&&(!m||o.context===m)&&L(this,T);else{for(var t=0,s=[],g=o.length;t<g;t++)(o[t].fn!==h||v&&!o[t].once||m&&o[t].context!==m)&&s.push(o[t]);s.length?this._events[T]=s.length===1?s[0]:s:L(this,T)}return this},u.prototype.removeAllListeners=function(f){var h;return f?(h=e?e+f:f,this._events[h]&&L(this,h)):(this._events=new c,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=e,u.EventEmitter=u,R.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(R,M,i){(function(a){var e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,c=/^(?=([^\/?#]*))\1([^]*)$/,O=/(?:\/|^)\.(?=\/)/g,S=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,L={buildAbsoluteURL:function(u,n,f){if(f=f||{},u=u.trim(),n=n.trim(),!n){if(!f.alwaysNormalize)return u;var h=L.parseURL(u);if(!h)throw new Error("Error trying to parse base URL.");return h.path=L.normalizePath(h.path),L.buildURLFromParts(h)}var m=L.parseURL(n);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return f.alwaysNormalize?(m.path=L.normalizePath(m.path),L.buildURLFromParts(m)):n;var v=L.parseURL(u);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var T=c.exec(v.path);v.netLoc=T[1],v.path=T[2]}v.netLoc&&!v.path&&(v.path="/");var o={scheme:v.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(o.netLoc=v.netLoc,m.path[0]!=="/"))if(!m.path)o.path=v.path,m.params||(o.params=v.params,m.query||(o.query=v.query));else{var t=v.path,s=t.substring(0,t.lastIndexOf("/")+1)+m.path;o.path=L.normalizePath(s)}return o.path===null&&(o.path=f.alwaysNormalize?L.normalizePath(m.path):m.path),L.buildURLFromParts(o)},parseURL:function(u){var n=e.exec(u);return n?{scheme:n[1]||"",netLoc:n[2]||"",path:n[3]||"",params:n[4]||"",query:n[5]||"",fragment:n[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(O,"");u.length!==(u=u.replace(S,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};R.exports=L})()},"./node_modules/webworkify-webpack/index.js":function(R,M,i){function a(f){var h={};function m(T){if(h[T])return h[T].exports;var o=h[T]={i:T,l:!1,exports:{}};return f[T].call(o.exports,o,o.exports,m),o.l=!0,o.exports}m.m=f,m.c=h,m.i=function(T){return T},m.d=function(T,o,t){m.o(T,o)||Object.defineProperty(T,o,{configurable:!1,enumerable:!0,get:t})},m.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},m.n=function(T){var o=T&&T.__esModule?function(){return T.default}:function(){return T};return m.d(o,"a",o),o},m.o=function(T,o){return Object.prototype.hasOwnProperty.call(T,o)},m.p="/",m.oe=function(T){throw console.error(T),T};var v=m(m.s=ENTRY_MODULE);return v.default||v}var e="[\\.|\\-|\\+|\\w|/|@]+",c="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+e+").*?\\)";function O(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function S(f){return!isNaN(1*f)}function L(f,h,m){var v={};v[m]=[];var T=h.toString(),o=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return v;for(var t=o[1],s=new RegExp("(\\\\n|\\W)"+O(t)+c,"g"),g;g=s.exec(T);)g[3]!=="dll-reference"&&v[m].push(g[3]);for(s=new RegExp("\\("+O(t)+'\\("(dll-reference\\s('+e+'))"\\)\\)'+c,"g");g=s.exec(T);)f[g[2]]||(v[m].push(g[1]),f[g[2]]=i(g[1]).m),v[g[2]]=v[g[2]]||[],v[g[2]].push(g[4]);for(var E=Object.keys(v),d=0;d<E.length;d++)for(var r=0;r<v[E[d]].length;r++)S(v[E[d]][r])&&(v[E[d]][r]=1*v[E[d]][r]);return v}function u(f){var h=Object.keys(f);return h.reduce(function(m,v){return m||f[v].length>0},!1)}function n(f,h){for(var m={main:[h]},v={main:[]},T={main:{}};u(m);)for(var o=Object.keys(m),t=0;t<o.length;t++){var s=o[t],g=m[s],E=g.pop();if(T[s]=T[s]||{},!(T[s][E]||!f[s][E])){T[s][E]=!0,v[s]=v[s]||[],v[s].push(E);for(var d=L(f,f[s][E],s),r=Object.keys(d),l=0;l<r.length;l++)m[r[l]]=m[r[l]]||[],m[r[l]]=m[r[l]].concat(d[r[l]])}}return v}R.exports=function(f,h){h=h||{};var m={main:i.m},v=h.all?{main:Object.keys(m.main)}:n(m,f),T="";Object.keys(v).filter(function(E){return E!=="main"}).forEach(function(E){for(var d=0;v[E][d];)d++;v[E].push(d),m[E][d]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+E+" = ("+a.toString().replace("ENTRY_MODULE",JSON.stringify(d))+")({"+v[E].map(function(r){return""+JSON.stringify(r)+": "+m[E][r].toString()}).join(",")+`});
`}),T=T+"new (("+a.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+v.main.map(function(E){return""+JSON.stringify(E)+": "+m.main[E].toString()}).join(",")+"}))(self);";var o=new window.Blob([T],{type:"text/javascript"});if(h.bare)return o;var t=window.URL||window.webkitURL||window.mozURL||window.msURL,s=t.createObjectURL(o),g=new window.Worker(s);return g.objectURL=s,g}},"./src/config.ts":function(R,M,i){i.r(M),i.d(M,"hlsDefaultConfig",function(){return l}),i.d(M,"mergeConfig",function(){return x}),i.d(M,"enableStreamingMode",function(){return b});var a=i("./src/controller/abr-controller.ts"),e=i("./src/controller/audio-stream-controller.ts"),c=i("./src/controller/audio-track-controller.ts"),O=i("./src/controller/subtitle-stream-controller.ts"),S=i("./src/controller/subtitle-track-controller.ts"),L=i("./src/controller/buffer-controller.ts"),u=i("./src/controller/timeline-controller.ts"),n=i("./src/controller/cap-level-controller.ts"),f=i("./src/controller/fps-controller.ts"),h=i("./src/controller/eme-controller.ts"),m=i("./src/controller/cmcd-controller.ts"),v=i("./src/utils/xhr-loader.ts"),T=i("./src/utils/fetch-loader.ts"),o=i("./src/utils/cues.ts"),t=i("./src/utils/mediakeys-helper.ts"),s=i("./src/utils/logger.ts");function g(){return g=Object.assign?Object.assign.bind():function(D){for(var p=1;p<arguments.length;p++){var y=arguments[p];for(var I in y)Object.prototype.hasOwnProperty.call(y,I)&&(D[I]=y[I])}return D},g.apply(this,arguments)}function E(D,p){var y=Object.keys(D);if(Object.getOwnPropertySymbols){var I=Object.getOwnPropertySymbols(D);p&&(I=I.filter(function(C){return Object.getOwnPropertyDescriptor(D,C).enumerable})),y.push.apply(y,I)}return y}function d(D){for(var p=1;p<arguments.length;p++){var y=arguments[p]!=null?arguments[p]:{};p%2?E(Object(y),!0).forEach(function(I){r(D,I,y[I])}):Object.getOwnPropertyDescriptors?Object.defineProperties(D,Object.getOwnPropertyDescriptors(y)):E(Object(y)).forEach(function(I){Object.defineProperty(D,I,Object.getOwnPropertyDescriptor(y,I))})}return D}function r(D,p,y){return p in D?Object.defineProperty(D,p,{value:y,enumerable:!0,configurable:!0,writable:!0}):D[p]=y,D}var l=d(d({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:v.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:a.default,bufferController:L.default,capLevelController:n.default,fpsController:f.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},A()),{},{subtitleStreamController:O.SubtitleStreamController,subtitleTrackController:S.default,timelineController:u.TimelineController,audioStreamController:e.default,audioTrackController:c.default,emeController:h.default,cmcdController:m.default});function A(){return{cueHandler:o.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function x(D,p){if((p.liveSyncDurationCount||p.liveMaxLatencyDurationCount)&&(p.liveSyncDuration||p.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(p.liveMaxLatencyDurationCount!==void 0&&(p.liveSyncDurationCount===void 0||p.liveMaxLatencyDurationCount<=p.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(p.liveMaxLatencyDuration!==void 0&&(p.liveSyncDuration===void 0||p.liveMaxLatencyDuration<=p.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return g({},D,p)}function b(D){var p=D.loader;if(p!==T.default&&p!==v.default)s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),D.progressive=!1;else{var y=Object(T.fetchSupported)();y&&(D.loader=T.default,D.progressive=!0,D.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(R,M,i){i.r(M);var a=i("./src/polyfills/number.ts"),e=i("./src/utils/ewma-bandwidth-estimator.ts"),c=i("./src/events.ts"),O=i("./src/utils/buffer-helper.ts"),S=i("./src/errors.ts"),L=i("./src/types/loader.ts"),u=i("./src/utils/logger.ts");function n(m,v){for(var T=0;T<v.length;T++){var o=v[T];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}function f(m,v,T){return v&&n(m.prototype,v),T&&n(m,T),Object.defineProperty(m,"prototype",{writable:!1}),m}var h=function(){function m(T){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=T;var o=T.config;this.bwEstimator=new e.default(o.abrEwmaSlowVoD,o.abrEwmaFastVoD,o.abrEwmaDefaultEstimate),this.registerListeners()}var v=m.prototype;return v.registerListeners=function(){var o=this.hls;o.on(c.Events.FRAG_LOADING,this.onFragLoading,this),o.on(c.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(c.Events.ERROR,this.onError,this)},v.unregisterListeners=function(){var o=this.hls;o.off(c.Events.FRAG_LOADING,this.onFragLoading,this),o.off(c.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(c.Events.ERROR,this.onError,this)},v.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},v.onFragLoading=function(o,t){var s=t.frag;if(s.type===L.PlaylistLevelType.MAIN&&!this.timer){var g;this.fragCurrent=s,this.partCurrent=(g=t.part)!=null?g:null,this.timer=self.setInterval(this.onCheck,100)}},v.onLevelLoaded=function(o,t){var s=this.hls.config;t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},v._abandonRulesCheck=function(){var o=this.fragCurrent,t=this.partCurrent,s=this.hls,g=s.autoLevelEnabled,E=s.config,d=s.media;if(!(!o||!d)){var r=t?t.stats:o.stats,l=t?t.duration:o.duration;if(r.aborted){u.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!g||d.paused||!d.playbackRate||!d.readyState)){var A=performance.now()-r.loading.start,x=Math.abs(d.playbackRate);if(!(A<=500*l/x)){var b=s.levels,D=s.minAutoLevel,p=b[o.level],y=r.total||Math.max(r.loaded,Math.round(l*p.maxBitrate/8)),I=Math.max(1,r.bwEstimate?r.bwEstimate/8:r.loaded*1e3/A),C=(y-r.loaded)/I,P=d.currentTime,w=(O.BufferHelper.bufferInfo(d,P,E.maxBufferHole).end-P)/x;if(!(w>=2*l/x||C<=w)){var k=Number.POSITIVE_INFINITY,F;for(F=o.level-1;F>D;F--){var _=b[F].maxBitrate;if(k=l*_/(8*.8*I),k<w)break}if(!(k>=C)){var B=this.bwEstimator.getEstimate();u.logger.warn("Fragment "+o.sn+(t?" part "+t.index:"")+" of level "+o.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+(Object(a.isFiniteNumber)(B)?(B/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+C.toFixed(3)+` s
      Estimated load time for the next fragment: `+k.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),s.nextLoadLevel=F,this.bwEstimator.sample(A,r.loaded),this.clearTimer(),o.loader&&(this.fragCurrent=this.partCurrent=null,o.loader.abort()),s.trigger(c.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:o,part:t,stats:r})}}}}}},v.onFragLoaded=function(o,t){var s=t.frag,g=t.part;if(s.type===L.PlaylistLevelType.MAIN&&Object(a.isFiniteNumber)(s.sn)){var E=g?g.stats:s.stats,d=g?g.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[s.level],l=(r.loaded?r.loaded.bytes:0)+E.loaded,A=(r.loaded?r.loaded.duration:0)+d;r.loaded={bytes:l,duration:A},r.realBitrate=Math.round(8*l/A)}if(s.bitrateTest){var x={stats:E,frag:s,part:g,id:s.type};this.onFragBuffered(c.Events.FRAG_BUFFERED,x),s.bitrateTest=!1}}},v.onFragBuffered=function(o,t){var s=t.frag,g=t.part,E=g?g.stats:s.stats;if(!E.aborted&&!(s.type!==L.PlaylistLevelType.MAIN||s.sn==="initSegment")){var d=E.parsing.end-E.loading.start;this.bwEstimator.sample(d,E.loaded),E.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}},v.onError=function(o,t){switch(t.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},v.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},v.getNextABRAutoLevel=function(){var o=this.fragCurrent,t=this.partCurrent,s=this.hls,g=s.maxAutoLevel,E=s.config,d=s.minAutoLevel,r=s.media,l=t?t.duration:o?o.duration:0,A=r?r.currentTime:0,x=r&&r.playbackRate!==0?Math.abs(r.playbackRate):1,b=this.bwEstimator?this.bwEstimator.getEstimate():E.abrEwmaDefaultEstimate,D=(O.BufferHelper.bufferInfo(r,A,E.maxBufferHole).end-A)/x,p=this.findBestLevel(b,d,g,D,E.abrBandWidthFactor,E.abrBandWidthUpFactor);if(p>=0)return p;u.logger.trace((D?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var y=l?Math.min(l,E.maxStarvationDelay):E.maxStarvationDelay,I=E.abrBandWidthFactor,C=E.abrBandWidthUpFactor;if(!D){var P=this.bitrateTestDelay;if(P){var w=l?Math.min(l,E.maxLoadingDelay):E.maxLoadingDelay;y=w-P,u.logger.trace("bitrate test took "+Math.round(1e3*P)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*y)+" ms"),I=C=1}}return p=this.findBestLevel(b,d,g,D+y,I,C),Math.max(p,0)},v.findBestLevel=function(o,t,s,g,E,d){for(var r,l=this.fragCurrent,A=this.partCurrent,x=this.lastLoadedFragLevel,b=this.hls.levels,D=b[x],p=!!(D!=null&&(r=D.details)!==null&&r!==void 0&&r.live),y=D==null?void 0:D.codecSet,I=A?A.duration:l?l.duration:0,C=s;C>=t;C--){var P=b[C];if(!(!P||y&&P.codecSet!==y)){var w=P.details,k=(A?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||I,F=void 0;C<=x?F=E*o:F=d*o;var _=b[C].maxBitrate,B=_*k/F;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+C+"/"+Math.round(F)+"/"+_+"/"+k+"/"+g+"/"+B),F>_&&(!B||p&&!this.bitrateTestDelay||B<g))return C}}return-1},f(m,[{key:"nextAutoLevel",get:function(){var o=this._nextAutoLevel,t=this.bwEstimator;if(o!==-1&&(!t||!t.canEstimate()))return o;var s=this.getNextABRAutoLevel();return o!==-1&&(s=Math.min(o,s)),s},set:function(o){this._nextAutoLevel=o}}]),m}();M.default=h},"./src/controller/audio-stream-controller.ts":function(R,M,i){i.r(M);var a=i("./src/polyfills/number.ts"),e=i("./src/controller/base-stream-controller.ts"),c=i("./src/events.ts"),O=i("./src/utils/buffer-helper.ts"),S=i("./src/controller/fragment-tracker.ts"),L=i("./src/types/level.ts"),u=i("./src/types/loader.ts"),n=i("./src/loader/fragment.ts"),f=i("./src/demux/chunk-cache.ts"),h=i("./src/demux/transmuxer-interface.ts"),m=i("./src/types/transmuxer.ts"),v=i("./src/controller/fragment-finders.ts"),T=i("./src/utils/discontinuities.ts"),o=i("./src/errors.ts");function t(){return t=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var A=arguments[l];for(var x in A)Object.prototype.hasOwnProperty.call(A,x)&&(r[x]=A[x])}return r},t.apply(this,arguments)}function s(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,g(r,l)}function g(r,l){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,b){return x.__proto__=b,x},g(r,l)}var E=100,d=function(r){s(l,r);function l(x,b){var D;return D=r.call(this,x,b,"[audio-stream-controller]")||this,D.videoBuffer=null,D.videoTrackCC=-1,D.waitingVideoCC=-1,D.audioSwitch=!1,D.trackId=-1,D.waitingData=null,D.mainDetails=null,D.bufferFlushed=!1,D.cachedTrackLoadedData=null,D._registerListeners(),D}var A=l.prototype;return A.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},A._registerListeners=function(){var b=this.hls;b.on(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.on(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.on(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.on(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.on(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),b.on(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),b.on(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),b.on(c.Events.ERROR,this.onError,this),b.on(c.Events.BUFFER_RESET,this.onBufferReset,this),b.on(c.Events.BUFFER_CREATED,this.onBufferCreated,this),b.on(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),b.on(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.on(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},A._unregisterListeners=function(){var b=this.hls;b.off(c.Events.MEDIA_ATTACHED,this.onMediaAttached,this),b.off(c.Events.MEDIA_DETACHING,this.onMediaDetaching,this),b.off(c.Events.MANIFEST_LOADING,this.onManifestLoading,this),b.off(c.Events.LEVEL_LOADED,this.onLevelLoaded,this),b.off(c.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),b.off(c.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),b.off(c.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),b.off(c.Events.ERROR,this.onError,this),b.off(c.Events.BUFFER_RESET,this.onBufferReset,this),b.off(c.Events.BUFFER_CREATED,this.onBufferCreated,this),b.off(c.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),b.off(c.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),b.off(c.Events.FRAG_BUFFERED,this.onFragBuffered,this)},A.onInitPtsFound=function(b,D){var p=D.frag,y=D.id,I=D.initPTS;if(y==="main"){var C=p.cc;this.initPTS[p.cc]=I,this.log("InitPTS for cc: "+C+" found from main: "+I),this.videoTrackCC=C,this.state===e.State.WAITING_INIT_PTS&&this.tick()}},A.startLoad=function(b){if(!this.levels){this.startPosition=b,this.state=e.State.STOPPED;return}var D=this.lastCurrentTime;this.stopLoad(),this.setInterval(E),this.fragLoadError=0,D>0&&b===-1?(this.log("Override startPosition with lastCurrentTime @"+D.toFixed(3)),b=D,this.state=e.State.IDLE):(this.loadedmetadata=!1,this.state=e.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=b,this.tick()},A.doTick=function(){switch(this.state){case e.State.IDLE:this.doTickIdle();break;case e.State.WAITING_TRACK:{var b,D=this.levels,p=this.trackId,y=D==null||(b=D[p])===null||b===void 0?void 0:b.details;if(y){if(this.waitForCdnTuneIn(y))break;this.state=e.State.WAITING_INIT_PTS}break}case e.State.FRAG_LOADING_WAITING_RETRY:{var I,C=performance.now(),P=this.retryDate;(!P||C>=P||(I=this.media)!==null&&I!==void 0&&I.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=e.State.IDLE);break}case e.State.WAITING_INIT_PTS:{var w=this.waitingData;if(w){var k=w.frag,F=w.part,_=w.cache,B=w.complete;if(this.initPTS[k.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=e.State.FRAG_LOADING;var N=_.flush(),U={frag:k,part:F,payload:N,networkDetails:null};this._handleFragmentLoadProgress(U),B&&r.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+k.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),K=O.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),H=Object(v.fragmentWithinToleranceTest)(K.end,this.config.maxFragLookUpTolerance,k);H<0&&(this.log("Waiting fragment cc ("+k.cc+") @ "+k.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=e.State.IDLE}}this.onTickEnd()},A.clearWaitingFragment=function(){var b=this.waitingData;b&&(this.fragmentTracker.removeFragment(b.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=e.State.IDLE)},A.resetLoadingState=function(){this.clearWaitingFragment(),r.prototype.resetLoadingState.call(this)},A.onTickEnd=function(){var b=this.media;if(!(!b||!b.readyState)){var D=this.mediaBuffer?this.mediaBuffer:b,p=D.buffered;!this.loadedmetadata&&p.length&&(this.loadedmetadata=!0),this.lastCurrentTime=b.currentTime}},A.doTickIdle=function(){var b,D,p=this.hls,y=this.levels,I=this.media,C=this.trackId,P=p.config;if(!(!y||!y[C])&&!(!I&&(this.startFragRequested||!P.startFragPrefetch))){var w=y[C],k=w.details;if(!k||k.live&&this.levelLastLoaded!==C||this.waitForCdnTuneIn(k)){this.state=e.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,n.ElementaryStreamTypes.AUDIO,u.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,u.PlaylistLevelType.AUDIO);if(F!==null){var _=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,u.PlaylistLevelType.MAIN),B=F.len,N=this.getMaxBufferLength(_==null?void 0:_.len),U=this.audioSwitch;if(!(B>=N&&!U)){if(!U&&this._streamEnded(F,k)){p.trigger(c.Events.BUFFER_EOS,{type:"audio"}),this.state=e.State.ENDED;return}var j=k.fragments,K=j[0].start,H=F.end;if(U){var G=this.getLoadPosition();H=G,k.PTSKnown&&G<K&&(F.end>K||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),I.currentTime=K+.05)}if(!(_&&H>_.end+k.targetduration)&&!((!_||!_.len)&&F.len)){var W=this.getNextFragment(H,k);if(!W){this.bufferFlushed=!0;return}((b=W.decryptdata)===null||b===void 0?void 0:b.keyFormat)==="identity"&&!((D=W.decryptdata)!==null&&D!==void 0&&D.key)?this.loadKey(W,k):this.loadFragment(W,k,H)}}}}},A.getMaxBufferLength=function(b){var D=r.prototype.getMaxBufferLength.call(this);return b?Math.max(D,b):D},A.onMediaDetaching=function(){this.videoBuffer=null,r.prototype.onMediaDetaching.call(this)},A.onAudioTracksUpdated=function(b,D){var p=D.audioTracks;this.resetTransmuxer(),this.levels=p.map(function(y){return new L.Level(y)})},A.onAudioTrackSwitching=function(b,D){var p=!!D.url;this.trackId=D.id;var y=this.fragCurrent;y!=null&&y.loader&&y.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),p?this.setInterval(E):this.resetTransmuxer(),p?(this.audioSwitch=!0,this.state=e.State.IDLE):this.state=e.State.STOPPED,this.tick()},A.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},A.onLevelLoaded=function(b,D){this.mainDetails=D.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(c.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},A.onAudioTrackLoaded=function(b,D){var p;if(this.mainDetails==null){this.cachedTrackLoadedData=D;return}var y=this.levels,I=D.details,C=D.id;if(!y){this.warn("Audio tracks were reset while loading level "+C);return}this.log("Track "+C+" loaded ["+I.startSN+","+I.endSN+"],duration:"+I.totalduration);var P=y[C],w=0;if(I.live||(p=P.details)!==null&&p!==void 0&&p.live){var k=this.mainDetails;if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed||!k)return;!P.details&&I.hasProgramDateTime&&k.hasProgramDateTime?(Object(T.alignMediaPlaylistByPDT)(I,k),w=I.fragments[0].start):w=this.alignPlaylists(I,P.details)}P.details=I,this.levelLastLoaded=C,!this.startFragRequested&&(this.mainDetails||!I.live)&&this.setStartPosition(P.details,w),this.state===e.State.WAITING_TRACK&&!this.waitForCdnTuneIn(I)&&(this.state=e.State.IDLE),this.tick()},A._handleFragmentLoadProgress=function(b){var D,p=b.frag,y=b.part,I=b.payload,C=this.config,P=this.trackId,w=this.levels;if(!w){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+p.sn+" of level "+p.level+" will not be buffered");return}var k=w[P];console.assert(k,"Audio track is defined on fragment load progress");var F=k.details;console.assert(F,"Audio track details are defined on fragment load progress");var _=C.defaultAudioCodec||k.audioCodec||"mp4a.40.2",B=this.transmuxer;B||(B=this.transmuxer=new h.default(this.hls,u.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[p.cc],U=(D=p.initSegment)===null||D===void 0?void 0:D.data;if(N!==void 0){var j=!1,K=y?y.index:-1,H=K!==-1,G=new m.ChunkMetadata(p.level,p.sn,p.stats.chunkCount,I.byteLength,K,H);B.push(I,U,_,"",p,y,F.totalduration,j,G,N)}else{this.log("Unknown video PTS for cc "+p.cc+", waiting for video PTS before demuxing audio frag "+p.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+P);var W=this.waitingData=this.waitingData||{frag:p,part:y,cache:new f.default,complete:!1},X=W.cache;X.push(new Uint8Array(I)),this.waitingVideoCC=this.videoTrackCC,this.state=e.State.WAITING_INIT_PTS}},A._handleFragmentLoadComplete=function(b){if(this.waitingData){this.waitingData.complete=!0;return}r.prototype._handleFragmentLoadComplete.call(this,b)},A.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},A.onBufferCreated=function(b,D){var p=D.tracks.audio;p&&(this.mediaBuffer=p.buffer),D.tracks.video&&(this.videoBuffer=D.tracks.video.buffer)},A.onFragBuffered=function(b,D){var p=D.frag,y=D.part;if(p.type===u.PlaylistLevelType.AUDIO){if(this.fragContextChanged(p)){this.warn("Fragment "+p.sn+(y?" p: "+y.index:"")+" of level "+p.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}p.sn!=="initSegment"&&(this.fragPrevious=p,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(p,y)}},A.onError=function(b,D){switch(D.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u.PlaylistLevelType.AUDIO,D);break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==e.State.ERROR&&this.state!==e.State.STOPPED&&(this.state=D.fatal?e.State.ERROR:e.State.IDLE,this.warn(D.details+" while loading frag, switching to "+this.state+" state"));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if(D.parent==="audio"&&(this.state===e.State.PARSING||this.state===e.State.PARSED)){var p=!0,y=this.getFwdBufferInfo(this.mediaBuffer,u.PlaylistLevelType.AUDIO);y&&y.len>.5&&(p=!this.reduceMaxBufferLength(y.len)),p&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},A.onBufferFlushed=function(b,D){var p=D.type;p===n.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},A._handleTransmuxComplete=function(b){var D,p="audio",y=this.hls,I=b.remuxResult,C=b.chunkMeta,P=this.getCurrentContext(C);if(!P){this.warn("The loading context changed while buffering fragment "+C.sn+" of level "+C.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(C.level);return}var w=P.frag,k=P.part,F=P.level.details,_=I.audio,B=I.text,N=I.id3,U=I.initSegment;if(!(this.fragContextChanged(w)||!F)){if(this.state=e.State.PARSING,this.audioSwitch&&_&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,w,C),y.trigger(c.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:p,tracks:U.tracks})),_){var j=_.startPTS,K=_.endPTS,H=_.startDTS,G=_.endDTS;k&&(k.elementaryStreams[n.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:K,startDTS:H,endDTS:G}),w.setElementaryStreamInfo(n.ElementaryStreamTypes.AUDIO,j,K,H,G),this.bufferFragmentData(_,w,k,C)}if(N!=null&&(D=N.samples)!==null&&D!==void 0&&D.length){var W=t({id:p,frag:w,details:F},N);y.trigger(c.Events.FRAG_PARSING_METADATA,W)}if(B){var X=t({id:p,frag:w,details:F},B);y.trigger(c.Events.FRAG_PARSING_USERDATA,X)}}},A._bufferInitSegment=function(b,D,p){if(this.state===e.State.PARSING){b.video&&delete b.video;var y=b.audio;if(!!y){y.levelCodec=y.codec,y.id="audio",this.log("Init audio buffer, container:"+y.container+", codecs[parsed]=["+y.codec+"]"),this.hls.trigger(c.Events.BUFFER_CODECS,b);var I=y.initSegment;if(I!=null&&I.byteLength){var C={type:"audio",frag:D,part:null,chunkMeta:p,parent:D.type,data:I};this.hls.trigger(c.Events.BUFFER_APPENDING,C)}this.tick()}}},A.loadFragment=function(b,D,p){var y=this.fragmentTracker.getState(b);this.fragCurrent=b,(this.audioSwitch||y===S.FragmentState.NOT_LOADED||y===S.FragmentState.PARTIAL)&&(b.sn==="initSegment"?this._loadInitSegment(b):D.live&&!Object(a.isFiniteNumber)(this.initPTS[b.cc])?(this.log("Waiting for video PTS in continuity counter "+b.cc+" of live stream before loading audio fragment "+b.sn+" of level "+this.trackId),this.state=e.State.WAITING_INIT_PTS):(this.startFragRequested=!0,r.prototype.loadFragment.call(this,b,D,p)))},A.completeAudioSwitch=function(){var b=this.hls,D=this.media,p=this.trackId;D&&(this.log("Switching audio track : flushing all audio"),r.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,b.trigger(c.Events.AUDIO_TRACK_SWITCHED,{id:p})},l}(e.default);M.default=d},"./src/controller/audio-track-controller.ts":function(R,M,i){i.r(M);var a=i("./src/events.ts"),e=i("./src/errors.ts"),c=i("./src/controller/base-playlist-controller.ts"),O=i("./src/types/loader.ts");function S(h,m){for(var v=0;v<m.length;v++){var T=m[v];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(h,T.key,T)}}function L(h,m,v){return m&&S(h.prototype,m),v&&S(h,v),Object.defineProperty(h,"prototype",{writable:!1}),h}function u(h,m){h.prototype=Object.create(m.prototype),h.prototype.constructor=h,n(h,m)}function n(h,m){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,o){return T.__proto__=o,T},n(h,m)}var f=function(h){u(m,h);function m(T){var o;return o=h.call(this,T,"[audio-track-controller]")||this,o.tracks=[],o.groupId=null,o.tracksInGroup=[],o.trackId=-1,o.trackName="",o.selectDefaultTrack=!0,o.registerListeners(),o}var v=m.prototype;return v.registerListeners=function(){var o=this.hls;o.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),o.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),o.on(a.Events.ERROR,this.onError,this)},v.unregisterListeners=function(){var o=this.hls;o.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),o.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),o.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),o.off(a.Events.ERROR,this.onError,this)},v.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,h.prototype.destroy.call(this)},v.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},v.onManifestParsed=function(o,t){this.tracks=t.audioTracks||[]},v.onAudioTrackLoaded=function(o,t){var s=t.id,g=t.details,E=this.tracksInGroup[s];if(!E){this.warn("Invalid audio track id "+s);return}var d=E.details;E.details=t.details,this.log("audioTrack "+s+" loaded ["+g.startSN+"-"+g.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,t,d))},v.onLevelLoading=function(o,t){this.switchLevel(t.level)},v.onLevelSwitching=function(o,t){this.switchLevel(t.level)},v.switchLevel=function(o){var t=this.hls.levels[o];if(!!(t!=null&&t.audioGroupIds)){var s=t.audioGroupIds[t.urlId];if(this.groupId!==s){this.groupId=s;var g=this.tracks.filter(function(d){return!s||d.groupId===s});this.selectDefaultTrack&&!g.some(function(d){return d.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=g;var E={audioTracks:g};this.log("Updating audio tracks, "+g.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(a.Events.AUDIO_TRACKS_UPDATED,E),this.selectInitialTrack()}}},v.onError=function(o,t){h.prototype.onError.call(this,o,t),!(t.fatal||!t.context)&&t.context.type===O.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},v.setAudioTrack=function(o){var t=this.tracksInGroup;if(o<0||o>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var s=t[this.trackId];this.log("Now switching to audio-track index "+o);var g=t[o],E=g.id,d=g.groupId,r=d===void 0?"":d,l=g.name,A=g.type,x=g.url;if(this.trackId=o,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHING,{id:E,groupId:r,name:l,type:A,url:x}),!(g.details&&!g.details.live)){var b=this.switchParams(g.url,s==null?void 0:s.details);this.loadPlaylist(b)}},v.selectInitialTrack=function(){var o=this.tracksInGroup;console.assert(o.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,s=this.findTrackId(t)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},v.findTrackId=function(o){for(var t=this.tracksInGroup,s=0;s<t.length;s++){var g=t[s];if((!this.selectDefaultTrack||g.default)&&(!o||o===g.name))return g.id}return-1},v.loadPlaylist=function(o){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var s=t.id,g=t.groupId,E=t.url;if(o)try{E=o.addDirectives(E)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(a.Events.AUDIO_TRACK_LOADING,{url:E,id:s,groupId:g,deliveryDirectives:o||null})}},L(m,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(o){this.selectDefaultTrack=!1,this.setAudioTrack(o)}}]),m}(c.default);M.default=f},"./src/controller/base-playlist-controller.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return L});var a=i("./src/polyfills/number.ts"),e=i("./src/types/level.ts"),c=i("./src/controller/level-helper.ts"),O=i("./src/utils/logger.ts"),S=i("./src/errors.ts"),L=function(){function u(f,h){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=O.logger.log.bind(O.logger,h+":"),this.warn=O.logger.warn.bind(O.logger,h+":"),this.hls=f}var n=u.prototype;return n.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},n.onError=function(h,m){m.fatal&&m.type===S.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},n.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},n.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},n.stopLoad=function(){this.canLoad=!1,this.clearTimer()},n.switchParams=function(h,m){var v=m==null?void 0:m.renditionReports;if(v)for(var T=0;T<v.length;T++){var o=v[T],t=""+o.URI;if(t===h.slice(-t.length)){var s=parseInt(o["LAST-MSN"]),g=parseInt(o["LAST-PART"]);if(m&&this.hls.config.lowLatencyMode){var E=Math.min(m.age-m.partTarget,m.targetduration);g!==void 0&&E>m.partTarget&&(g+=1)}if(Object(a.isFiniteNumber)(s))return new e.HlsUrlParameters(s,Object(a.isFiniteNumber)(g)?g:void 0,e.HlsSkip.No)}}},n.loadPlaylist=function(h){},n.shouldLoadTrack=function(h){return this.canLoad&&h&&!!h.url&&(!h.details||h.details.live)},n.playlistLoaded=function(h,m,v){var T=this,o=m.details,t=m.stats,s=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(o.advancedDateTime=Date.now()-s,o.live||v!=null&&v.live){if(o.reloaded(v),v&&this.log("live playlist "+h+" "+(o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:"MISSED")),v&&o.fragments.length>0&&Object(c.mergeDetails)(v,o),!this.canLoad||!o.live)return;var g,E=void 0,d=void 0;if(o.canBlockReload&&o.endSN&&o.advanced){var r=this.hls.config.lowLatencyMode,l=o.lastPartSn,A=o.endSN,x=o.lastPartIndex,b=x!==-1,D=l===A,p=r?0:x;b?(E=D?A+1:l,d=D?p:x+1):E=A+1;var y=o.age,I=y+o.ageHeader,C=Math.min(I-o.partTarget,o.targetduration*1.5);if(C>0){if(v&&C>v.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+v.tuneInGoal+" to: "+C+" with playlist age: "+o.age),C=0;else{var P=Math.floor(C/o.targetduration);if(E+=P,d!==void 0){var w=Math.round(C%o.targetduration/o.partTarget);d+=w}this.log("CDN Tune-in age: "+o.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+C+" skip sn "+P+" to part "+d)}o.tuneInGoal=C}if(g=this.getDeliveryDirectives(o,m.deliveryDirectives,E,d),r||!D){this.loadPlaylist(g);return}}else g=this.getDeliveryDirectives(o,m.deliveryDirectives,E,d);var k=Object(c.computeReloadInterval)(o,t);E!==void 0&&o.canBlockReload&&(k-=o.partTarget||1),this.log("reload live playlist "+h+" in "+Math.round(k)+" ms"),this.timer=self.setTimeout(function(){return T.loadPlaylist(g)},k)}else this.clearTimer()},n.getDeliveryDirectives=function(h,m,v,T){var o=Object(e.getSkipValue)(h,v);return m!=null&&m.skip&&h.deltaUpdateFailed&&(v=m.msn,T=m.part,o=e.HlsSkip.No),new e.HlsUrlParameters(v,T,o)},n.retryLoadingOrFail=function(h){var m=this,v=this.hls.config,T=this.retryCount<v.levelLoadingMaxRetry;if(T){var o;if(this.retryCount++,h.details.indexOf("LoadTimeOut")>-1&&(o=h.context)!==null&&o!==void 0&&o.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+h.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*v.levelLoadingRetryDelay,v.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return m.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+h.details+'"')}}else this.warn('cannot recover from error "'+h.details+'"'),this.clearTimer(),h.fatal=!0;return T},u}()},"./src/controller/base-stream-controller.ts":function(R,M,i){i.r(M),i.d(M,"State",function(){return A}),i.d(M,"default",function(){return x});var a=i("./src/polyfills/number.ts"),e=i("./src/task-loop.ts"),c=i("./src/controller/fragment-tracker.ts"),O=i("./src/utils/buffer-helper.ts"),S=i("./src/utils/logger.ts"),L=i("./src/events.ts"),u=i("./src/errors.ts"),n=i("./src/types/transmuxer.ts"),f=i("./src/utils/mp4-tools.ts"),h=i("./src/utils/discontinuities.ts"),m=i("./src/controller/fragment-finders.ts"),v=i("./src/controller/level-helper.ts"),T=i("./src/loader/fragment-loader.ts"),o=i("./src/crypt/decrypter.ts"),t=i("./src/utils/time-ranges.ts"),s=i("./src/types/loader.ts");function g(b,D){for(var p=0;p<D.length;p++){var y=D[p];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(b,y.key,y)}}function E(b,D,p){return D&&g(b.prototype,D),p&&g(b,p),Object.defineProperty(b,"prototype",{writable:!1}),b}function d(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function r(b,D){b.prototype=Object.create(D.prototype),b.prototype.constructor=b,l(b,D)}function l(b,D){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,I){return y.__proto__=I,y},l(b,D)}var A={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},x=function(b){r(D,b);function D(y,I,C){var P;return P=b.call(this)||this,P.hls=void 0,P.fragPrevious=null,P.fragCurrent=null,P.fragmentTracker=void 0,P.transmuxer=null,P._state=A.STOPPED,P.media=void 0,P.mediaBuffer=void 0,P.config=void 0,P.bitrateTest=!1,P.lastCurrentTime=0,P.nextLoadPosition=0,P.startPosition=0,P.loadedmetadata=!1,P.fragLoadError=0,P.retryDate=0,P.levels=null,P.fragmentLoader=void 0,P.levelLastLoaded=null,P.startFragRequested=!1,P.decrypter=void 0,P.initPTS=[],P.onvseeking=null,P.onvended=null,P.logPrefix="",P.log=void 0,P.warn=void 0,P.logPrefix=C,P.log=S.logger.log.bind(S.logger,C+":"),P.warn=S.logger.warn.bind(S.logger,C+":"),P.hls=y,P.fragmentLoader=new T.default(y.config),P.fragmentTracker=I,P.config=y.config,P.decrypter=new o.default(y,y.config),y.on(L.Events.KEY_LOADED,P.onKeyLoaded,d(P)),P}var p=D.prototype;return p.doTick=function(){this.onTickEnd()},p.onTickEnd=function(){},p.startLoad=function(I){},p.stopLoad=function(){this.fragmentLoader.abort();var I=this.fragCurrent;I&&this.fragmentTracker.removeFragment(I),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=A.STOPPED},p._streamEnded=function(I,C){var P=this.fragCurrent,w=this.fragmentTracker;if(!C.live&&P&&P.sn>=C.endSN&&!I.nextStart){var k=C.partList;if(k!=null&&k.length){var F=k[k.length-1],_=O.BufferHelper.isBuffered(this.media,F.start+F.duration/2);return _}var B=w.getState(P);return B===c.FragmentState.PARTIAL||B===c.FragmentState.OK}return!1},p.onMediaAttached=function(I,C){var P=this.media=this.mediaBuffer=C.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),P.addEventListener("seeking",this.onvseeking),P.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===A.STOPPED&&this.startLoad(w.startPosition)},p.onMediaDetaching=function(){var I=this.media;I!=null&&I.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),I&&(I.removeEventListener("seeking",this.onvseeking),I.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},p.onMediaSeeking=function(){var I=this.config,C=this.fragCurrent,P=this.media,w=this.mediaBuffer,k=this.state,F=P?P.currentTime:0,_=O.BufferHelper.bufferInfo(w||P,F,I.maxBufferHole);if(this.log("media seeking to "+(Object(a.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+k),k===A.ENDED)this.resetLoadingState();else if(C&&!_.len){var B=I.maxFragLookUpTolerance,N=C.start-B,U=C.start+C.duration+B,j=F>U;(F<N||j)&&(j&&C.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),C.loader.abort()),this.resetLoadingState())}P&&(this.lastCurrentTime=F),!this.loadedmetadata&&!_.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},p.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},p.onKeyLoaded=function(I,C){if(!(this.state!==A.KEY_LOADING||C.frag!==this.fragCurrent||!this.levels)){this.state=A.IDLE;var P=this.levels[C.frag.level].details;P&&this.loadFragment(C.frag,P,C.frag.start)}},p.onHandlerDestroying=function(){this.stopLoad(),b.prototype.onHandlerDestroying.call(this)},p.onHandlerDestroyed=function(){this.state=A.STOPPED,this.hls.off(L.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,b.prototype.onHandlerDestroyed.call(this)},p.loadKey=function(I,C){this.log("Loading key for "+I.sn+" of ["+C.startSN+"-"+C.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+I.level),this.state=A.KEY_LOADING,this.fragCurrent=I,this.hls.trigger(L.Events.KEY_LOADING,{frag:I})},p.loadFragment=function(I,C,P){this._loadFragForPlayback(I,C,P)},p._loadFragForPlayback=function(I,C,P){var w=this,k=function(_){if(w.fragContextChanged(I)){w.warn("Fragment "+I.sn+(_.part?" p: "+_.part.index:"")+" of level "+I.level+" was dropped during download."),w.fragmentTracker.removeFragment(I);return}I.stats.chunkCount++,w._handleFragmentLoadProgress(_)};this._doFragLoad(I,C,P,k).then(function(F){if(!!F){w.fragLoadError=0;var _=w.state;if(w.fragContextChanged(I)){(_===A.FRAG_LOADING||!w.fragCurrent&&_===A.PARSING)&&(w.fragmentTracker.removeFragment(I),w.state=A.IDLE);return}"payload"in F&&(w.log("Loaded fragment "+I.sn+" of level "+I.level),w.hls.trigger(L.Events.FRAG_LOADED,F)),w._handleFragmentLoadComplete(F)}}).catch(function(F){w.state!==A.STOPPED&&(w.warn(F),w.resetFragmentLoading(I))})},p.flushMainBuffer=function(I,C,P){if(P===void 0&&(P=null),!!(I-C)){var w={startOffset:I,endOffset:C,type:P};this.fragLoadError=0,this.hls.trigger(L.Events.BUFFER_FLUSHING,w)}},p._loadInitSegment=function(I){var C=this;this._doFragLoad(I).then(function(P){if(!P||C.fragContextChanged(I)||!C.levels)throw new Error("init load aborted");return P}).then(function(P){var w=C.hls,k=P.payload,F=I.decryptdata;if(k&&k.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var _=self.performance.now();return C.decrypter.webCryptoDecrypt(new Uint8Array(k),F.key.buffer,F.iv.buffer).then(function(B){var N=self.performance.now();return w.trigger(L.Events.FRAG_DECRYPTED,{frag:I,payload:B,stats:{tstart:_,tdecrypt:N}}),P.payload=B,P})}return P}).then(function(P){var w=C.fragCurrent,k=C.hls,F=C.levels;if(!F)throw new Error("init load aborted, missing levels");var _=F[I.level].details;console.assert(_,"Level details are defined when init segment is loaded");var B=I.stats;C.state=A.IDLE,C.fragLoadError=0,I.data=new Uint8Array(P.payload),B.parsing.start=B.buffering.start=self.performance.now(),B.parsing.end=B.buffering.end=self.performance.now(),P.frag===w&&k.trigger(L.Events.FRAG_BUFFERED,{stats:B,frag:w,part:null,id:I.type}),C.tick()}).catch(function(P){C.warn(P),C.resetFragmentLoading(I)})},p.fragContextChanged=function(I){var C=this.fragCurrent;return!I||!C||I.level!==C.level||I.sn!==C.sn||I.urlId!==C.urlId},p.fragBufferedComplete=function(I,C){var P=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+I.type+" sn: "+I.sn+(C?" part: "+C.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+I.level+" "+t.default.toString(O.BufferHelper.getBuffered(P))),this.state=A.IDLE,this.tick()},p._handleFragmentLoadComplete=function(I){var C=this.transmuxer;if(!!C){var P=I.frag,w=I.part,k=I.partsLoaded,F=!k||k.length===0||k.some(function(B){return!B}),_=new n.ChunkMetadata(P.level,P.sn,P.stats.chunkCount+1,0,w?w.index:-1,!F);C.flush(_)}},p._handleFragmentLoadProgress=function(I){},p._doFragLoad=function(I,C,P,w){var k=this;if(P===void 0&&(P=null),!this.levels)throw new Error("frag load aborted, missing levels");if(P=Math.max(I.start,P||0),this.config.lowLatencyMode&&C){var F=C.partList;if(F&&w){P>I.end&&C.fragmentHint&&(I=C.fragmentHint);var _=this.getNextPart(F,I,P);if(_>-1){var B=F[_];return this.log("Loading part sn: "+I.sn+" p: "+B.index+" cc: "+I.cc+" of playlist ["+C.startSN+"-"+C.endSN+"] parts [0-"+_+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+I.level+", target: "+parseFloat(P.toFixed(3))),this.nextLoadPosition=B.start+B.duration,this.state=A.FRAG_LOADING,this.hls.trigger(L.Events.FRAG_LOADING,{frag:I,part:F[_],targetBufferTime:P}),this.doFragPartsLoad(I,F,_,w).catch(function(N){return k.handleFragLoadError(N)})}else if(!I.url||this.loadedEndOfParts(F,P))return Promise.resolve(null)}}return this.log("Loading fragment "+I.sn+" cc: "+I.cc+" "+(C?"of ["+C.startSN+"-"+C.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+I.level+", target: "+parseFloat(P.toFixed(3))),Object(a.isFiniteNumber)(I.sn)&&!this.bitrateTest&&(this.nextLoadPosition=I.start+I.duration),this.state=A.FRAG_LOADING,this.hls.trigger(L.Events.FRAG_LOADING,{frag:I,targetBufferTime:P}),this.fragmentLoader.load(I,w).catch(function(N){return k.handleFragLoadError(N)})},p.doFragPartsLoad=function(I,C,P,w){var k=this;return new Promise(function(F,_){var B=[],N=function U(j){var K=C[j];k.fragmentLoader.loadPart(I,K,w).then(function(H){B[K.index]=H;var G=H.part;k.hls.trigger(L.Events.FRAG_LOADED,H);var W=C[j+1];if(W&&W.fragment===I)U(j+1);else return F({frag:I,part:G,partsLoaded:B})}).catch(_)};N(P)})},p.handleFragLoadError=function(I){var C=I.data;return C&&C.details===u.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(C.frag,C.part):this.hls.trigger(L.Events.ERROR,C),null},p._handleTransmuxerFlush=function(I){var C=this.getCurrentContext(I);if(!C||this.state!==A.PARSING){this.fragCurrent||(this.state=A.IDLE);return}var P=C.frag,w=C.part,k=C.level,F=self.performance.now();P.stats.parsing.end=F,w&&(w.stats.parsing.end=F),this.updateLevelTiming(P,w,k,I.partial)},p.getCurrentContext=function(I){var C=this.levels,P=I.level,w=I.sn,k=I.part;if(!C||!C[P])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+P+". The current chunk will not be buffered."),null;var F=C[P],_=k>-1?Object(v.getPartWith)(F,w,k):null,B=_?_.fragment:Object(v.getFragmentWithSN)(F,w,this.fragCurrent);return B?{frag:B,part:_,level:F}:null},p.bufferFragmentData=function(I,C,P,w){if(!(!I||this.state!==A.PARSING)){var k=I.data1,F=I.data2,_=k;if(k&&F&&(_=Object(f.appendUint8Array)(k,F)),!(!_||!_.length)){var B={type:I.type,frag:C,part:P,chunkMeta:w,parent:C.type,data:_};this.hls.trigger(L.Events.BUFFER_APPENDING,B),I.dropped&&I.independent&&!P&&this.flushBufferGap(C)}}},p.flushBufferGap=function(I){var C=this.media;if(!!C){if(!O.BufferHelper.isBuffered(C,C.currentTime)){this.flushMainBuffer(0,I.start);return}var P=C.currentTime,w=O.BufferHelper.bufferInfo(C,P,0),k=I.duration,F=Math.min(this.config.maxFragLookUpTolerance*2,k*.25),_=Math.max(Math.min(I.start-F,w.end-F),P+F);I.start-_>F&&this.flushMainBuffer(_,I.start)}},p.getFwdBufferInfo=function(I,C){var P=this.config,w=this.getLoadPosition();if(!Object(a.isFiniteNumber)(w))return null;var k=O.BufferHelper.bufferInfo(I,w,P.maxBufferHole);if(k.len===0&&k.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(w,C);if(F&&k.nextStart<F.end)return O.BufferHelper.bufferInfo(I,w,Math.max(k.nextStart,P.maxBufferHole))}return k},p.getMaxBufferLength=function(I){var C=this.config,P;return I?P=Math.max(8*C.maxBufferSize/I,C.maxBufferLength):P=C.maxBufferLength,Math.min(P,C.maxMaxBufferLength)},p.reduceMaxBufferLength=function(I){var C=this.config,P=I||C.maxBufferLength;return C.maxMaxBufferLength>=P?(C.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+C.maxMaxBufferLength+"s"),!0):!1},p.getNextFragment=function(I,C){var P=C.fragments,w=P.length;if(!w)return null;var k=this.config,F=P[0].start,_;if(C.live){var B=k.initialLiveManifestSize;if(w<B)return this.warn("Not enough fragments to start playback (have: "+w+", need: "+B+")"),null;!C.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(_=this.getInitialLiveFragment(C,P),this.startPosition=_?this.hls.liveSyncPosition||_.start:I)}else I<=F&&(_=P[0]);if(!_){var N=k.lowLatencyMode?C.partEnd:C.fragmentEnd;_=this.getFragmentAtPosition(I,N,C)}return this.mapToInitFragWhenRequired(_)},p.mapToInitFragWhenRequired=function(I){return I!=null&&I.initSegment&&!(I!=null&&I.initSegment.data)&&!this.bitrateTest?I.initSegment:I},p.getNextPart=function(I,C,P){for(var w=-1,k=!1,F=!0,_=0,B=I.length;_<B;_++){var N=I[_];if(F=F&&!N.independent,w>-1&&P<N.start)break;var U=N.loaded;!U&&(k||N.independent||F)&&N.fragment===C&&(w=_),k=U}return w},p.loadedEndOfParts=function(I,C){var P=I[I.length-1];return P&&C>P.start&&P.loaded},p.getInitialLiveFragment=function(I,C){var P=this.fragPrevious,w=null;if(P){if(I.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+P.programDateTime),w=Object(m.findFragmentByPDT)(C,P.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var k=P.sn+1;if(k>=I.startSN&&k<=I.endSN){var F=C[k-I.startSN];P.cc===F.cc&&(w=F,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(m.findFragWithCC)(C,P.cc),w&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn))}}else{var _=this.hls.liveSyncPosition;_!==null&&(w=this.getFragmentAtPosition(_,this.bitrateTest?I.fragmentEnd:I.edge,I))}return w},p.getFragmentAtPosition=function(I,C,P){var w=this.config,k=this.fragPrevious,F=P.fragments,_=P.endSN,B=P.fragmentHint,N=w.maxFragLookUpTolerance,U=!!(w.lowLatencyMode&&P.partList&&B);U&&B&&!this.bitrateTest&&(F=F.concat(B),_=B.sn);var j;if(I<C){var K=I>C-N?0:N;j=Object(m.findFragmentByPTS)(k,F,I,K)}else j=F[F.length-1];if(j){var H=j.sn-P.startSN,G=k&&j.level===k.level,W=F[H+1];k&&j.sn===k.sn&&!U&&G&&(j.sn<_&&this.fragmentTracker.getState(W)!==c.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+W.sn),j=W):j=null)}return j},p.synchronizeToLiveEdge=function(I){var C=this.config,P=this.media;if(!!P){var w=this.hls.liveSyncPosition,k=P.currentTime,F=I.fragments[0].start,_=I.edge,B=k>=F-C.maxFragLookUpTolerance&&k<=_;if(w!==null&&P.duration>w&&(k<w||!B)){var N=C.liveMaxLatencyDuration!==void 0?C.liveMaxLatencyDuration:C.liveMaxLatencyDurationCount*I.targetduration;(!B&&P.readyState<4||k<_-N)&&(this.loadedmetadata||(this.nextLoadPosition=w),P.readyState&&(this.warn("Playback: "+k.toFixed(3)+" is located too far from the end of live sliding playlist: "+_+", reset currentTime to : "+w.toFixed(3)),P.currentTime=w))}}},p.alignPlaylists=function(I,C){var P=this.levels,w=this.levelLastLoaded,k=this.fragPrevious,F=w!==null?P[w]:null,_=I.fragments.length;if(!_)return this.warn("No fragments in live playlist"),0;var B=I.fragments[0].start,N=!C,U=I.alignedSliding&&Object(a.isFiniteNumber)(B);if(N||!U&&!B){Object(h.alignStream)(k,F,I);var j=I.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(C?C.startSN:"na")+"->"+I.startSN+" prev-sn: "+(k?k.sn:"na")+" fragments: "+_),j}return B},p.waitForCdnTuneIn=function(I){var C=3;return I.live&&I.canBlockReload&&I.partTarget&&I.tuneInGoal>Math.max(I.partHoldBack,I.partTarget*C)},p.setStartPosition=function(I,C){var P=this.startPosition;if(P<C&&(P=-1),P===-1||this.lastCurrentTime===-1){var w=I.startTimeOffset;Object(a.isFiniteNumber)(w)?(P=C+w,w<0&&(P+=I.totalduration),P=Math.min(Math.max(C,P),C+I.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+P),this.startPosition=P):I.live?P=this.hls.liveSyncPosition||C:this.startPosition=P=0,this.lastCurrentTime=P}this.nextLoadPosition=P},p.getLoadPosition=function(){var I=this.media,C=0;return this.loadedmetadata&&I?C=I.currentTime:this.nextLoadPosition&&(C=this.nextLoadPosition),C},p.handleFragLoadAborted=function(I,C){this.transmuxer&&I.sn!=="initSegment"&&I.stats.aborted&&(this.warn("Fragment "+I.sn+(C?" part"+C.index:"")+" of level "+I.level+" was aborted"),this.resetFragmentLoading(I))},p.resetFragmentLoading=function(I){(!this.fragCurrent||!this.fragContextChanged(I))&&(this.state=A.IDLE)},p.onFragmentOrKeyLoadError=function(I,C){if(!C.fatal){var P=C.frag;if(!(!P||P.type!==I)){var w=this.fragCurrent;console.assert(w&&P.sn===w.sn&&P.level===w.level&&P.urlId===w.urlId,"Frag load error must match current frag to retry");var k=this.config;if(this.fragLoadError+1<=k.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(P.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*k.fragLoadingRetryDelay,k.fragLoadingMaxRetryTimeout);this.warn("Fragment "+P.sn+" of "+I+" "+P.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=A.FRAG_LOADING_WAITING_RETRY}else C.levelRetry?(I===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=A.IDLE):(S.logger.error(C.details+" reaches max retry, redispatch as fatal ..."),C.fatal=!0,this.hls.stopLoad(),this.state=A.ERROR)}}},p.afterBufferFlushed=function(I,C,P){if(!!I){var w=O.BufferHelper.getBuffered(I);this.fragmentTracker.detectEvictedFragments(C,w,P),this.state===A.ENDED&&this.resetLoadingState()}},p.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=A.IDLE},p.resetLiveStartWhenNotLoaded=function(I){if(!this.loadedmetadata){this.startFragRequested=!1;var C=this.levels?this.levels[I].details:null;if(C!=null&&C.live)return this.startPosition=-1,this.setStartPosition(C,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},p.updateLevelTiming=function(I,C,P,w){var k=this,F=P.details;console.assert(!!F,"level.details must be defined");var _=Object.keys(I.elementaryStreams).reduce(function(B,N){var U=I.elementaryStreams[N];if(U){var j=U.endPTS-U.startPTS;if(j<=0)return k.warn("Could not parse fragment "+I.sn+" "+N+" duration reliably ("+j+")"),B||!1;var K=w?0:Object(v.updateFragPTSDTS)(F,I,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return k.hls.trigger(L.Events.LEVEL_PTS_UPDATED,{details:F,level:P,drift:K,type:N,frag:I,start:U.startPTS,end:U.endPTS}),!0}return B},!1);_||(this.warn("Found no media in fragment "+I.sn+" of level "+P.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=A.PARSED,this.hls.trigger(L.Events.FRAG_PARSED,{frag:I,part:C})},p.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},E(D,[{key:"state",get:function(){return this._state},set:function(I){var C=this._state;C!==I&&(this._state=I,this.log(C+"->"+I))}}]),D}(e.default)},"./src/controller/buffer-controller.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return m});var a=i("./src/polyfills/number.ts"),e=i("./src/events.ts"),c=i("./src/utils/logger.ts"),O=i("./src/errors.ts"),S=i("./src/utils/buffer-helper.ts"),L=i("./src/utils/mediasource-helper.ts"),u=i("./src/loader/fragment.ts"),n=i("./src/controller/buffer-operation-queue.ts"),f=Object(L.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,m=function(){function v(o){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var s=t.hls,g=t.media,E=t.mediaSource;c.logger.log("[buffer-controller]: Media source opened"),g&&(t.updateMediaElementDuration(),s.trigger(e.Events.MEDIA_ATTACHED,{media:g})),E&&E.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){c.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){c.logger.log("[buffer-controller]: Media source ended")},this.hls=o,this._initSourceBuffer(),this.registerListeners()}var T=v.prototype;return T.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},T.destroy=function(){this.unregisterListeners(),this.details=null},T.registerListeners=function(){var t=this.hls;t.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(e.Events.BUFFER_RESET,this.onBufferReset,this),t.on(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(e.Events.BUFFER_EOS,this.onBufferEos,this),t.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(e.Events.FRAG_PARSED,this.onFragParsed,this),t.on(e.Events.FRAG_CHANGED,this.onFragChanged,this)},T.unregisterListeners=function(){var t=this.hls;t.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(e.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(e.Events.BUFFER_RESET,this.onBufferReset,this),t.off(e.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(e.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(e.Events.BUFFER_EOS,this.onBufferEos,this),t.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(e.Events.FRAG_PARSED,this.onFragParsed,this),t.off(e.Events.FRAG_CHANGED,this.onFragChanged,this)},T._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new n.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},T.onManifestParsed=function(t,s){var g=2;(s.audio&&!s.video||!s.altAudio)&&(g=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=g,this.details=null,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},T.onMediaAttaching=function(t,s){var g=this.media=s.media;if(g&&f){var E=this.mediaSource=new f;E.addEventListener("sourceopen",this._onMediaSourceOpen),E.addEventListener("sourceended",this._onMediaSourceEnded),E.addEventListener("sourceclose",this._onMediaSourceClose),g.src=self.URL.createObjectURL(E),this._objectUrl=g.src}},T.onMediaDetaching=function(){var t=this.media,s=this.mediaSource,g=this._objectUrl;if(s){if(c.logger.log("[buffer-controller]: media source detaching"),s.readyState==="open")try{s.endOfStream()}catch(E){c.logger.warn("[buffer-controller]: onMediaDetaching: "+E.message+" while calling endOfStream")}this.onBufferReset(),s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(g&&self.URL.revokeObjectURL(g),t.src===g?(t.removeAttribute("src"),t.load()):c.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(e.Events.MEDIA_DETACHED,void 0)},T.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(s){var g=t.sourceBuffer[s];try{g&&(t.removeBufferListeners(s),t.mediaSource&&t.mediaSource.removeSourceBuffer(g),t.sourceBuffer[s]=void 0)}catch(E){c.logger.warn("[buffer-controller]: Failed to reset the "+s+" buffer",E)}}),this._initSourceBuffer()},T.onBufferCodecs=function(t,s){var g=this,E=this.getSourceBufferTypes().length;Object.keys(s).forEach(function(d){if(E){var r=g.tracks[d];if(r&&typeof r.buffer.changeType=="function"){var l=s[d],A=l.id,x=l.codec,b=l.levelCodec,D=l.container,p=l.metadata,y=(r.levelCodec||r.codec).replace(h,"$1"),I=(b||x).replace(h,"$1");if(y!==I){var C=D+";codecs="+(b||x);g.appendChangeType(d,C),c.logger.log("[buffer-controller]: switching codec "+y+" to "+I),g.tracks[d]={buffer:r.buffer,codec:x,container:D,levelCodec:b,metadata:p,id:A}}}}else g.pendingTracks[d]=s[d]}),!E&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},T.appendChangeType=function(t,s){var g=this,E=this.operationQueue,d={execute:function(){var l=g.sourceBuffer[t];l&&(c.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+s),l.changeType(s)),E.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(l){c.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",l)}};E.append(d,t)},T.onBufferAppending=function(t,s){var g=this,E=this.hls,d=this.operationQueue,r=this.tracks,l=s.data,A=s.type,x=s.frag,b=s.part,D=s.chunkMeta,p=D.buffering[A],y=self.performance.now();p.start=y;var I=x.stats.buffering,C=b?b.stats.buffering:null;I.start===0&&(I.start=y),C&&C.start===0&&(C.start=y);var P=r.audio,w=A==="audio"&&D.id===1&&(P==null?void 0:P.container)==="audio/mpeg",k={execute:function(){if(p.executeStart=self.performance.now(),w){var _=g.sourceBuffer[A];if(_){var B=x.start-_.timestampOffset;Math.abs(B)>=.1&&(c.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+x.start+" (delta: "+B+") sn: "+x.sn+")"),_.timestampOffset=x.start)}}g.appendExecutor(l,A)},onStart:function(){},onComplete:function(){var _=self.performance.now();p.executeEnd=p.end=_,I.first===0&&(I.first=_),C&&C.first===0&&(C.first=_);var B=g.sourceBuffer,N={};for(var U in B)N[U]=S.BufferHelper.getBuffered(B[U]);g.appendError=0,g.hls.trigger(e.Events.BUFFER_APPENDED,{type:A,frag:x,part:b,chunkMeta:D,parent:x.type,timeRanges:N})},onError:function(_){c.logger.error("[buffer-controller]: Error encountered while trying to append to the "+A+" SourceBuffer",_);var B={type:O.ErrorTypes.MEDIA_ERROR,parent:x.type,details:O.ErrorDetails.BUFFER_APPEND_ERROR,err:_,fatal:!1};_.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=O.ErrorDetails.BUFFER_FULL_ERROR:(g.appendError++,B.details=O.ErrorDetails.BUFFER_APPEND_ERROR,g.appendError>E.config.appendErrorMaxRetry&&(c.logger.error("[buffer-controller]: Failed "+E.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0)),E.trigger(e.Events.ERROR,B)}};d.append(k,A)},T.onBufferFlushing=function(t,s){var g=this,E=this.operationQueue,d=function(l){return{execute:g.removeExecutor.bind(g,l,s.startOffset,s.endOffset),onStart:function(){},onComplete:function(){g.hls.trigger(e.Events.BUFFER_FLUSHED,{type:l})},onError:function(x){c.logger.warn("[buffer-controller]: Failed to remove from "+l+" SourceBuffer",x)}}};s.type?E.append(d(s.type),s.type):this.getSourceBufferTypes().forEach(function(r){E.append(d(r),r)})},T.onFragParsed=function(t,s){var g=this,E=s.frag,d=s.part,r=[],l=d?d.elementaryStreams:E.elementaryStreams;l[u.ElementaryStreamTypes.AUDIOVIDEO]?r.push("audiovideo"):(l[u.ElementaryStreamTypes.AUDIO]&&r.push("audio"),l[u.ElementaryStreamTypes.VIDEO]&&r.push("video"));var A=function(){var b=self.performance.now();E.stats.buffering.end=b,d&&(d.stats.buffering.end=b);var D=d?d.stats:E.stats;g.hls.trigger(e.Events.FRAG_BUFFERED,{frag:E,part:d,stats:D,id:E.type})};r.length===0&&c.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+E.type+" level: "+E.level+" sn: "+E.sn),this.blockBuffers(A,r)},T.onFragChanged=function(t,s){this.flushBackBuffer()},T.onBufferEos=function(t,s){var g=this,E=this.getSourceBufferTypes().reduce(function(d,r){var l=g.sourceBuffer[r];return(!s.type||s.type===r)&&l&&!l.ended&&(l.ended=!0,c.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),d&&!!(!l||l.ended)},!0);E&&this.blockBuffers(function(){var d=g.mediaSource;!d||d.readyState!=="open"||d.endOfStream()})},T.onLevelUpdated=function(t,s){var g=s.details;!g.fragments.length||(this.details=g,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},T.flushBackBuffer=function(){var t=this.hls,s=this.details,g=this.media,E=this.sourceBuffer;if(!(!g||s===null)){var d=this.getSourceBufferTypes();if(!!d.length){var r=s.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!(!Object(a.isFiniteNumber)(r)||r<0)){var l=g.currentTime,A=s.levelTargetDuration,x=Math.max(r,A),b=Math.floor(l/A)*A-x;d.forEach(function(D){var p=E[D];if(p){var y=S.BufferHelper.getBuffered(p);y.length>0&&b>y.start(0)&&(t.trigger(e.Events.BACK_BUFFER_REACHED,{bufferEnd:b}),s.live&&t.trigger(e.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:b}),t.trigger(e.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:b,type:D}))}})}}}},T.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var t=this.details,s=this.hls,g=this.media,E=this.mediaSource,d=t.fragments[0].start+t.totalduration,r=g.duration,l=Object(a.isFiniteNumber)(E.duration)?E.duration:0;t.live&&s.config.liveDurationInfinity?(c.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),E.duration=1/0,this.updateSeekableRange(t)):(d>l&&d>r||!Object(a.isFiniteNumber)(r))&&(c.logger.log("[buffer-controller]: Updating Media Source duration to "+d.toFixed(3)),E.duration=d)}},T.updateSeekableRange=function(t){var s=this.mediaSource,g=t.fragments,E=g.length;if(E&&t.live&&s!==null&&s!==void 0&&s.setLiveSeekableRange){var d=Math.max(0,g[0].start),r=Math.max(d,d+t.totalduration);s.setLiveSeekableRange(d,r)}},T.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,s=this.operationQueue,g=this.pendingTracks,E=Object.keys(g).length;if(E&&!t||E===2){this.createSourceBuffers(g),this.pendingTracks={};var d=this.getSourceBufferTypes();if(d.length===0){this.hls.trigger(e.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}d.forEach(function(r){s.executeNext(r)})}},T.createSourceBuffers=function(t){var s=this.sourceBuffer,g=this.mediaSource;if(!g)throw Error("createSourceBuffers called when mediaSource was null");var E=0;for(var d in t)if(!s[d]){var r=t[d];if(!r)throw Error("source buffer exists for track "+d+", however track does not");var l=r.levelCodec||r.codec,A=r.container+";codecs="+l;c.logger.log("[buffer-controller]: creating sourceBuffer("+A+")");try{var x=s[d]=g.addSourceBuffer(A),b=d;this.addBufferListener(b,"updatestart",this._onSBUpdateStart),this.addBufferListener(b,"updateend",this._onSBUpdateEnd),this.addBufferListener(b,"error",this._onSBUpdateError),this.tracks[d]={buffer:x,codec:l,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id},E++}catch(D){c.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+D.message),this.hls.trigger(e.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:D,mimeType:A})}}E&&this.hls.trigger(e.Events.BUFFER_CREATED,{tracks:this.tracks})},T._onSBUpdateStart=function(t){var s=this.operationQueue,g=s.current(t);g.onStart()},T._onSBUpdateEnd=function(t){var s=this.operationQueue,g=s.current(t);g.onComplete(),s.shiftAndExecuteNext(t)},T._onSBUpdateError=function(t,s){c.logger.error("[buffer-controller]: "+t+" SourceBuffer error",s),this.hls.trigger(e.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var g=this.operationQueue.current(t);g&&g.onError(s)},T.removeExecutor=function(t,s,g){var E=this.media,d=this.mediaSource,r=this.operationQueue,l=this.sourceBuffer,A=l[t];if(!E||!d||!A){c.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(t);return}var x=Object(a.isFiniteNumber)(E.duration)?E.duration:1/0,b=Object(a.isFiniteNumber)(d.duration)?d.duration:1/0,D=Math.max(0,s),p=Math.min(g,x,b);p>D?(c.logger.log("[buffer-controller]: Removing ["+D+","+p+"] from the "+t+" SourceBuffer"),console.assert(!A.updating,t+" sourceBuffer must not be updating"),A.remove(D,p)):r.shiftAndExecuteNext(t)},T.appendExecutor=function(t,s){var g=this.operationQueue,E=this.sourceBuffer,d=E[s];if(!d){c.logger.warn("[buffer-controller]: Attempting to append to the "+s+" SourceBuffer, but it does not exist"),g.shiftAndExecuteNext(s);return}d.ended=!1,console.assert(!d.updating,s+" sourceBuffer must not be updating"),d.appendBuffer(t)},T.blockBuffers=function(t,s){var g=this;if(s===void 0&&(s=this.getSourceBufferTypes()),!s.length){c.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}var E=this.operationQueue,d=s.map(function(r){return E.appendBlocker(r)});Promise.all(d).then(function(){t(),s.forEach(function(r){var l=g.sourceBuffer[r];(!l||!l.updating)&&E.shiftAndExecuteNext(r)})})},T.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},T.addBufferListener=function(t,s,g){var E=this.sourceBuffer[t];if(!!E){var d=g.bind(this,t);this.listeners[t].push({event:s,listener:d}),E.addEventListener(s,d)}},T.removeBufferListeners=function(t){var s=this.sourceBuffer[t];!s||this.listeners[t].forEach(function(g){s.removeEventListener(g.event,g.listener)})},v}()},"./src/controller/buffer-operation-queue.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return e});var a=i("./src/utils/logger.ts"),e=function(){function c(S){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=S}var O=c.prototype;return O.append=function(L,u){var n=this.queues[u];n.push(L),n.length===1&&this.buffers[u]&&this.executeNext(u)},O.insertAbort=function(L,u){var n=this.queues[u];n.unshift(L),this.executeNext(u)},O.appendBlocker=function(L){var u,n=new Promise(function(h){u=h}),f={execute:u,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(f,L),n},O.executeNext=function(L){var u=this.buffers,n=this.queues,f=u[L],h=n[L];if(h.length){var m=h[0];try{m.execute()}catch(v){a.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),m.onError(v),(!f||!f.updating)&&(h.shift(),this.executeNext(L))}}},O.shiftAndExecuteNext=function(L){this.queues[L].shift(),this.executeNext(L)},O.current=function(L){return this.queues[L][0]},c}()},"./src/controller/cap-level-controller.ts":function(R,M,i){i.r(M);var a=i("./src/events.ts");function e(S,L){for(var u=0;u<L.length;u++){var n=L[u];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(S,n.key,n)}}function c(S,L,u){return L&&e(S.prototype,L),u&&e(S,u),Object.defineProperty(S,"prototype",{writable:!1}),S}var O=function(){function S(u){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=u,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var L=S.prototype;return L.setStreamController=function(n){this.streamController=n},L.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},L.registerListeners=function(){var n=this.hls;n.on(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),n.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.unregisterListener=function(){var n=this.hls;n.off(a.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),n.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(a.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.onFpsDropLevelCapping=function(n,f){S.isLevelAllowed(f.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(f.droppedLevel)},L.onMediaAttaching=function(n,f){this.media=f.media instanceof HTMLVideoElement?f.media:null},L.onManifestParsed=function(n,f){var h=this.hls;this.restrictedLevels=[],this.firstLevel=f.firstLevel,h.config.capLevelToPlayerSize&&f.video&&this.startCapping()},L.onBufferCodecs=function(n,f){var h=this.hls;h.config.capLevelToPlayerSize&&f.video&&this.startCapping()},L.onMediaDetaching=function(){this.stopCapping()},L.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var n=this.hls.levels;if(n.length){var f=this.hls;f.autoLevelCapping=this.getMaxLevel(n.length-1),f.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=f.autoLevelCapping}}},L.getMaxLevel=function(n){var f=this,h=this.hls.levels;if(!h.length)return-1;var m=h.filter(function(v,T){return S.isLevelAllowed(T,f.restrictedLevels)&&T<=n});return this.clientRect=null,S.getMaxLevelByMediaSize(m,this.mediaWidth,this.mediaHeight)},L.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},L.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},L.getDimensions=function(){if(this.clientRect)return this.clientRect;var n=this.media,f={width:0,height:0};if(n){var h=n.getBoundingClientRect();f.width=h.width,f.height=h.height,!f.width&&!f.height&&(f.width=h.right-h.left||n.width||0,f.height=h.bottom-h.top||n.height||0)}return this.clientRect=f,f},S.isLevelAllowed=function(n,f){return f===void 0&&(f=[]),f.indexOf(n)===-1},S.getMaxLevelByMediaSize=function(n,f,h){if(!n||!n.length)return-1;for(var m=function(s,g){return g?s.width!==g.width||s.height!==g.height:!0},v=n.length-1,T=0;T<n.length;T+=1){var o=n[T];if((o.width>=f||o.height>=h)&&m(o,n[T+1])){v=T;break}}return v},c(S,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var n=1;if(!this.hls.config.ignoreDevicePixelRatio)try{n=self.devicePixelRatio}catch{}return n}}]),S}();M.default=O},"./src/controller/cmcd-controller.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return m});var a=i("./src/events.ts"),e=i("./src/types/cmcd.ts"),c=i("./src/utils/buffer-helper.ts"),O=i("./src/utils/logger.ts");function S(v,T){for(var o=0;o<T.length;o++){var t=T[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function L(v,T,o){return T&&S(v.prototype,T),o&&S(v,o),Object.defineProperty(v,"prototype",{writable:!1}),v}function u(v,T){var o=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(o)return(o=o.call(v)).next.bind(o);if(Array.isArray(v)||(o=n(v))||T&&v&&typeof v.length=="number"){o&&(v=o);var t=0;return function(){return t>=v.length?{done:!0}:{done:!1,value:v[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n(v,T){if(!!v){if(typeof v=="string")return f(v,T);var o=Object.prototype.toString.call(v).slice(8,-1);if(o==="Object"&&v.constructor&&(o=v.constructor.name),o==="Map"||o==="Set")return Array.from(v);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return f(v,T)}}function f(v,T){(T==null||T>v.length)&&(T=v.length);for(var o=0,t=new Array(T);o<T;o++)t[o]=v[o];return t}function h(){return h=Object.assign?Object.assign.bind():function(v){for(var T=1;T<arguments.length;T++){var o=arguments[T];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(v[t]=o[t])}return v},h.apply(this,arguments)}var m=function(){function v(o){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(E){try{t.apply(E,{ot:e.CMCDObjectType.MANIFEST,su:!t.initialized})}catch(d){O.logger.warn("Could not generate manifest CMCD data.",d)}},this.applyFragmentData=function(E){try{var d=E.frag,r=t.hls.levels[d.level],l=t.getObjectType(d),A={d:d.duration*1e3,ot:l};(l===e.CMCDObjectType.VIDEO||l===e.CMCDObjectType.AUDIO||l==e.CMCDObjectType.MUXED)&&(A.br=r.bitrate/1e3,A.tb=t.getTopBandwidth(l)/1e3,A.bl=t.getBufferLength(l)),t.apply(E,A)}catch(x){O.logger.warn("Could not generate segment CMCD data.",x)}},this.hls=o;var s=this.config=o.config,g=s.cmcd;g!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=g.sessionId||v.uuid(),this.cid=g.contentId,this.useHeaders=g.useHeaders===!0,this.registerListeners())}var T=v.prototype;return T.registerListeners=function(){var t=this.hls;t.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this)},T.unregisterListeners=function(){var t=this.hls;t.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},T.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},T.onMediaAttached=function(t,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},T.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},T.onBufferCreated=function(t,s){var g,E;this.audioBuffer=(g=s.tracks.audio)===null||g===void 0?void 0:g.buffer,this.videoBuffer=(E=s.tracks.video)===null||E===void 0?void 0:E.buffer},T.createData=function(){var t;return{v:e.CMCDVersion,sf:e.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)===null||t===void 0?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},T.apply=function(t,s){s===void 0&&(s={}),h(s,this.createData());var g=s.ot===e.CMCDObjectType.INIT||s.ot===e.CMCDObjectType.VIDEO||s.ot===e.CMCDObjectType.MUXED;if(this.starved&&g&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering),this.useHeaders){var E=v.toHeaders(s);if(!Object.keys(E).length)return;t.headers||(t.headers={}),h(t.headers,E)}else{var d=v.toQuery(s);if(!d)return;t.url=v.appendQueryToUri(t.url,d)}},T.getObjectType=function(t){var s=t.type;if(s==="subtitle")return e.CMCDObjectType.TIMED_TEXT;if(t.sn==="initSegment")return e.CMCDObjectType.INIT;if(s==="audio")return e.CMCDObjectType.AUDIO;if(s==="main")return this.hls.audioTracks.length?e.CMCDObjectType.VIDEO:e.CMCDObjectType.MUXED},T.getTopBandwidth=function(t){var s=0,g,E=this.hls;if(t===e.CMCDObjectType.AUDIO)g=E.audioTracks;else{var d=E.maxAutoLevel,r=d>-1?d+1:E.levels.length;g=E.levels.slice(0,r)}for(var l=u(g),A;!(A=l()).done;){var x=A.value;x.bitrate>s&&(s=x.bitrate)}return s>0?s:NaN},T.getBufferLength=function(t){var s=this.hls.media,g=t===e.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!g||!s)return NaN;var E=c.BufferHelper.bufferInfo(g,s.currentTime,this.config.maxBufferHole);return E.len*1e3},T.createPlaylistLoader=function(){var t=this.config.pLoader,s=this.applyPlaylistData,g=t||this.config.loader;return function(){function E(r){this.loader=void 0,this.loader=new g(r)}var d=E.prototype;return d.destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(l,A,x){s(l),this.loader.load(l,A,x)},L(E,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),E}()},T.createFragmentLoader=function(){var t=this.config.fLoader,s=this.applyFragmentData,g=t||this.config.loader;return function(){function E(r){this.loader=void 0,this.loader=new g(r)}var d=E.prototype;return d.destroy=function(){this.loader.destroy()},d.abort=function(){this.loader.abort()},d.load=function(l,A,x){s(l),this.loader.load(l,A,x)},L(E,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),E}()},v.uuid=function(){var t=URL.createObjectURL(new Blob),s=t.toString();return URL.revokeObjectURL(t),s.slice(s.lastIndexOf("/")+1)},v.serialize=function(t){for(var s=[],g=function(w){return!Number.isNaN(w)&&w!=null&&w!==""&&w!==!1},E=function(w){return Math.round(w)},d=function(w){return E(w/100)*100},r=function(w){return encodeURIComponent(w)},l={br:E,d:E,bl:d,dl:d,mtp:d,nor:r,rtp:d,tb:E},A=Object.keys(t||{}).sort(),x=u(A),b;!(b=x()).done;){var D=b.value,p=t[D];if(!!g(p)&&!(D==="v"&&p===1)&&!(D=="pr"&&p===1)){var y=l[D];y&&(p=y(p));var I=typeof p,C=void 0;D==="ot"||D==="sf"||D==="st"?C=D+"="+p:I==="boolean"?C=D:I==="number"?C=D+"="+p:C=D+"="+JSON.stringify(p),s.push(C)}}return s.join(",")},v.toHeaders=function(t){for(var s=Object.keys(t),g={},E=["Object","Request","Session","Status"],d=[{},{},{},{}],r={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},l=0,A=s;l<A.length;l++){var x=A[l],b=r[x]!=null?r[x]:1;d[b][x]=t[x]}for(var D=0;D<d.length;D++){var p=v.serialize(d[D]);p&&(g["CMCD-"+E[D]]=p)}return g},v.toQuery=function(t){return"CMCD="+encodeURIComponent(v.serialize(t))},v.appendQueryToUri=function(t,s){if(!s)return t;var g=t.includes("?")?"&":"?";return""+t+g+s},v}()},"./src/controller/eme-controller.ts":function(R,M,i){i.r(M);var a=i("./src/events.ts"),e=i("./src/errors.ts"),c=i("./src/utils/logger.ts"),O=i("./src/utils/mediakeys-helper.ts");function S(m,v){for(var T=0;T<v.length;T++){var o=v[T];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}function L(m,v,T){return v&&S(m.prototype,v),T&&S(m,T),Object.defineProperty(m,"prototype",{writable:!1}),m}var u=3,n=function(v,T,o){var t={audioCapabilities:[],videoCapabilities:[]};return v.forEach(function(s){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:o.audioRobustness||""})}),T.forEach(function(s){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:o.videoRobustness||""})}),[t]},f=function(v,T,o,t){switch(v){case O.KeySystems.WIDEVINE:return n(T,o,t);default:throw new Error("Unknown key-system: "+v)}},h=function(){function m(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var v=m.prototype;return v.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},v._registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},v._unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(a.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this)},v.getLicenseServerUrl=function(o){switch(o){case O.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+o+'"')},v._attemptKeySystemAccess=function(o,t,s){var g=this,E=f(o,t,s,this._drmSystemOptions);c.logger.log("Requesting encrypted media key-system access");var d=this.requestMediaKeySystemAccess(o,E);this.mediaKeysPromise=d.then(function(r){return g._onMediaKeySystemAccessObtained(o,r)}),d.catch(function(r){c.logger.error('Failed to obtain key-system "'+o+'" access:',r)})},v._onMediaKeySystemAccessObtained=function(o,t){var s=this;c.logger.log('Access for key-system "'+o+'" obtained');var g={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:o};this._mediaKeysList.push(g);var E=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(d){return g.mediaKeys=d,c.logger.log('Media-keys created for key-system "'+o+'"'),s._onMediaKeysCreated(),d});return E.catch(function(d){c.logger.error("Failed to create media-keys:",d)}),E},v._onMediaKeysCreated=function(){var o=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),o._onNewMediaKeySession(t.mediaKeysSession))})},v._onNewMediaKeySession=function(o){var t=this;c.logger.log("New key-system session "+o.sessionId),o.addEventListener("message",function(s){t._onKeySessionMessage(o,s.message)},!1)},v._onKeySessionMessage=function(o,t){c.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(s){c.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),o.update(s).catch(function(g){c.logger.warn("Updating key-session failed: "+g)})})},v.onMediaEncrypted=function(o){var t=this;if(c.logger.log('Media is encrypted using "'+o.initDataType+'" init data type'),!this.mediaKeysPromise){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var s=function(E){!t._media||(t._attemptSetMediaKeys(E),t._generateRequestWithPreferredKeySession(o.initDataType,o.initData))};this.mediaKeysPromise.then(s).catch(s)},v._attemptSetMediaKeys=function(o){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},v._generateRequestWithPreferredKeySession=function(o,t){var s=this,g=this._mediaKeysList[0];if(!g){c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(g.mediaKeysSessionInitialized){c.logger.warn("Key-Session already initialized but requested again");return}var E=g.mediaKeysSession;if(!E){c.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){c.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}c.logger.log('Generating key-session request for "'+o+'" init data type'),g.mediaKeysSessionInitialized=!0,E.generateRequest(o,t).then(function(){c.logger.debug("Key-session generation succeeded")}).catch(function(d){c.logger.error("Error generating key-session request:",d),s.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},v._createLicenseXhr=function(o,t,s){var g=new XMLHttpRequest;g.responseType="arraybuffer",g.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,g,o,t,s);var E=this._licenseXhrSetup;if(E)try{E.call(this.hls,g,o),E=void 0}catch(d){c.logger.error(d)}try{g.readyState||g.open("POST",o,!0),E&&E.call(this.hls,g,o)}catch(d){throw new Error("issue setting up KeySystem license XHR "+d)}return g},v._onLicenseRequestReadyStageChange=function(o,t,s,g){switch(o.readyState){case 4:if(o.status===200){this._requestLicenseFailureCount=0,c.logger.log("License request succeeded");var E=o.response,d=this._licenseResponseCallback;if(d)try{E=d.call(this.hls,o,t)}catch(l){c.logger.error(l)}g(E)}else{if(c.logger.error("License Request XHR failed ("+t+"). Status: "+o.status+" ("+o.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u){this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var r=u-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+r+" attempts left"),this._requestLicense(s,g)}break}},v._generateLicenseRequestChallenge=function(o,t){switch(o.mediaKeySystemDomain){case O.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+o.mediaKeySystemDomain)},v._requestLicense=function(o,t){c.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s){c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var g=this.getLicenseServerUrl(s.mediaKeySystemDomain),E=this._createLicenseXhr(g,o,t);c.logger.log("Sending license request to URL: "+g);var d=this._generateLicenseRequestChallenge(s,o);E.send(d)}catch(r){c.logger.error("Failure requesting DRM license: "+r),this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.KEY_SYSTEM_ERROR,details:e.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},v.onMediaAttached=function(o,t){if(!!this._emeEnabled){var s=t.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},v.onMediaDetached=function(){var o=this._media,t=this._mediaKeysList;!o||(o.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return o.setMediaKeys(null)}).catch(function(){}))},v.onManifestParsed=function(o,t){if(!!this._emeEnabled){var s=t.levels.map(function(E){return E.audioCodec}).filter(function(E){return!!E}),g=t.levels.map(function(E){return E.videoCodec}).filter(function(E){return!!E});this._attemptKeySystemAccess(O.KeySystems.WIDEVINE,s,g)}},L(m,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),m}();M.default=h},"./src/controller/fps-controller.ts":function(R,M,i){i.r(M);var a=i("./src/events.ts"),e=i("./src/utils/logger.ts"),c=function(){function O(L){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=L,this.registerListeners()}var S=O.prototype;return S.setStreamController=function(u){this.streamController=u},S.registerListeners=function(){this.hls.on(a.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},S.unregisterListeners=function(){this.hls.off(a.Events.MEDIA_ATTACHING,this.onMediaAttaching)},S.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},S.onMediaAttaching=function(u,n){var f=this.hls.config;if(f.capLevelOnFPSDrop){var h=n.media instanceof self.HTMLVideoElement?n.media:null;this.media=h,h&&typeof h.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),f.fpsDroppedMonitoringPeriod)}},S.checkFPS=function(u,n,f){var h=performance.now();if(n){if(this.lastTime){var m=h-this.lastTime,v=f-this.lastDroppedFrames,T=n-this.lastDecodedFrames,o=1e3*v/m,t=this.hls;if(t.trigger(a.Events.FPS_DROP,{currentDropped:v,currentDecoded:T,totalDroppedFrames:f}),o>0&&v>t.config.fpsDroppedMonitoringThreshold*T){var s=t.currentLevel;e.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),s>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=s)&&(s=s-1,t.trigger(a.Events.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:t.currentLevel}),t.autoLevelCapping=s,this.streamController.nextLevelSwitch())}}this.lastTime=h,this.lastDroppedFrames=f,this.lastDecodedFrames=n}},S.checkFPSInterval=function(){var u=this.media;if(u)if(this.isVideoPlaybackQualityAvailable){var n=u.getVideoPlaybackQuality();this.checkFPS(u,n.totalVideoFrames,n.droppedVideoFrames)}else this.checkFPS(u,u.webkitDecodedFrameCount,u.webkitDroppedFrameCount)},O}();M.default=c},"./src/controller/fragment-finders.ts":function(R,M,i){i.r(M),i.d(M,"findFragmentByPDT",function(){return c}),i.d(M,"findFragmentByPTS",function(){return O}),i.d(M,"fragmentWithinToleranceTest",function(){return S}),i.d(M,"pdtWithinToleranceTest",function(){return L}),i.d(M,"findFragWithCC",function(){return u});var a=i("./src/polyfills/number.ts"),e=i("./src/utils/binary-search.ts");function c(n,f,h){if(f===null||!Array.isArray(n)||!n.length||!Object(a.isFiniteNumber)(f))return null;var m=n[0].programDateTime;if(f<(m||0))return null;var v=n[n.length-1].endProgramDateTime;if(f>=(v||0))return null;h=h||0;for(var T=0;T<n.length;++T){var o=n[T];if(L(f,h,o))return o}return null}function O(n,f,h,m){h===void 0&&(h=0),m===void 0&&(m=0);var v=null;if(n?v=f[n.sn-f[0].sn+1]||null:h===0&&f[0].start===0&&(v=f[0]),v&&S(h,m,v)===0)return v;var T=e.default.search(f,S.bind(null,h,m));return T||v}function S(n,f,h){n===void 0&&(n=0),f===void 0&&(f=0);var m=Math.min(f,h.duration+(h.deltaPTS?h.deltaPTS:0));return h.start+h.duration-m<=n?1:h.start-m>n&&h.start?-1:0}function L(n,f,h){var m=Math.min(f,h.duration+(h.deltaPTS?h.deltaPTS:0))*1e3,v=h.endProgramDateTime||0;return v-m>n}function u(n,f){return e.default.search(n,function(h){return h.cc<f?1:h.cc>f?-1:0})}},"./src/controller/fragment-tracker.ts":function(R,M,i){i.r(M),i.d(M,"FragmentState",function(){return c}),i.d(M,"FragmentTracker",function(){return O});var a=i("./src/events.ts"),e=i("./src/types/loader.ts"),c;(function(u){u.NOT_LOADED="NOT_LOADED",u.APPENDING="APPENDING",u.PARTIAL="PARTIAL",u.OK="OK"})(c||(c={}));var O=function(){function u(f){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=f,this._registerListeners()}var n=u.prototype;return n._registerListeners=function(){var h=this.hls;h.on(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.on(a.Events.FRAG_LOADED,this.onFragLoaded,this)},n._unregisterListeners=function(){var h=this.hls;h.off(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),h.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),h.off(a.Events.FRAG_LOADED,this.onFragLoaded,this)},n.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},n.getAppendedFrag=function(h,m){if(m===e.PlaylistLevelType.MAIN){var v=this.activeFragment,T=this.activeParts;if(!v)return null;if(T)for(var o=T.length;o--;){var t=T[o],s=t?t.end:v.appendedPTS;if(t.start<=h&&s!==void 0&&h<=s)return o>9&&(this.activeParts=T.slice(o-9)),t}else if(v.start<=h&&v.appendedPTS!==void 0&&h<=v.appendedPTS)return v}return this.getBufferedFrag(h,m)},n.getBufferedFrag=function(h,m){for(var v=this.fragments,T=Object.keys(v),o=T.length;o--;){var t=v[T[o]];if((t==null?void 0:t.body.type)===m&&t.buffered){var s=t.body;if(s.start<=h&&h<=s.end)return s}}return null},n.detectEvictedFragments=function(h,m,v){var T=this;Object.keys(this.fragments).forEach(function(o){var t=T.fragments[o];if(!!t){if(!t.buffered){t.body.type===v&&T.removeFragment(t.body);return}var s=t.range[h];!s||s.time.some(function(g){var E=!T.isTimeBuffered(g.startPTS,g.endPTS,m);return E&&T.removeFragment(t.body),E})}})},n.detectPartialFragments=function(h){var m=this,v=this.timeRanges,T=h.frag,o=h.part;if(!(!v||T.sn==="initSegment")){var t=L(T),s=this.fragments[t];!s||(Object.keys(v).forEach(function(g){var E=T.elementaryStreams[g];if(!!E){var d=v[g],r=o!==null||E.partial===!0;s.range[g]=m.getBufferedTimes(T,o,r,d)}}),s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},n.fragBuffered=function(h){var m=L(h),v=this.fragments[m];v&&(v.loaded=null,v.buffered=!0)},n.getBufferedTimes=function(h,m,v,T){for(var o={time:[],partial:v},t=m?m.start:h.start,s=m?m.end:h.end,g=h.minEndPTS||s,E=h.maxStartPTS||t,d=0;d<T.length;d++){var r=T.start(d)-this.bufferPadding,l=T.end(d)+this.bufferPadding;if(E>=r&&g<=l){o.time.push({startPTS:Math.max(t,T.start(d)),endPTS:Math.min(s,T.end(d))});break}else if(t<l&&s>r)o.partial=!0,o.time.push({startPTS:Math.max(t,T.start(d)),endPTS:Math.min(s,T.end(d))});else if(s<=r)break}return o},n.getPartialFragment=function(h){var m=null,v,T,o,t=0,s=this.bufferPadding,g=this.fragments;return Object.keys(g).forEach(function(E){var d=g[E];!d||S(d)&&(T=d.body.start-s,o=d.body.end+s,h>=T&&h<=o&&(v=Math.min(h-T,o-h),t<=v&&(m=d.body,t=v)))}),m},n.getState=function(h){var m=L(h),v=this.fragments[m];return v?v.buffered?S(v)?c.PARTIAL:c.OK:c.APPENDING:c.NOT_LOADED},n.isTimeBuffered=function(h,m,v){for(var T,o,t=0;t<v.length;t++){if(T=v.start(t)-this.bufferPadding,o=v.end(t)+this.bufferPadding,h>=T&&m<=o)return!0;if(m<=T)return!1}return!1},n.onFragLoaded=function(h,m){var v=m.frag,T=m.part;if(!(v.sn==="initSegment"||v.bitrateTest||T)){var o=L(v);this.fragments[o]={body:v,loaded:m,buffered:!1,range:Object.create(null)}}},n.onBufferAppended=function(h,m){var v=this,T=m.frag,o=m.part,t=m.timeRanges;if(T.type===e.PlaylistLevelType.MAIN)if(this.activeFragment=T,o){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(o)}else this.activeParts=null;this.timeRanges=t,Object.keys(t).forEach(function(g){var E=t[g];if(v.detectEvictedFragments(g,E),!o)for(var d=0;d<E.length;d++)T.appendedPTS=Math.max(E.end(d),T.appendedPTS||0)})},n.onFragBuffered=function(h,m){this.detectPartialFragments(m)},n.hasFragment=function(h){var m=L(h);return!!this.fragments[m]},n.removeFragmentsInRange=function(h,m,v){var T=this;Object.keys(this.fragments).forEach(function(o){var t=T.fragments[o];if(!!t&&t.buffered){var s=t.body;s.type===v&&s.start<m&&s.end>h&&T.removeFragment(s)}})},n.removeFragment=function(h){var m=L(h);h.stats.loaded=0,h.clearElementaryStreamInfo(),delete this.fragments[m]},n.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},u}();function S(u){var n,f;return u.buffered&&(((n=u.range.video)===null||n===void 0?void 0:n.partial)||((f=u.range.audio)===null||f===void 0?void 0:f.partial))}function L(u){return u.type+"_"+u.level+"_"+u.urlId+"_"+u.sn}},"./src/controller/gap-controller.ts":function(R,M,i){i.r(M),i.d(M,"STALL_MINIMUM_DURATION_MS",function(){return S}),i.d(M,"MAX_START_GAP_JUMP",function(){return L}),i.d(M,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return u}),i.d(M,"SKIP_BUFFER_RANGE_START",function(){return n}),i.d(M,"default",function(){return f});var a=i("./src/utils/buffer-helper.ts"),e=i("./src/errors.ts"),c=i("./src/events.ts"),O=i("./src/utils/logger.ts"),S=250,L=2,u=.1,n=.05,f=function(){function h(v,T,o,t){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=v,this.media=T,this.fragmentTracker=o,this.hls=t}var m=h.prototype;return m.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},m.poll=function(T,o){var t=this.config,s=this.media,g=this.stalled;if(s!==null){var E=s.currentTime,d=s.seeking,r=this.seeking&&!d,l=!this.seeking&&d;if(this.seeking=d,E!==T){if(this.moved=!0,g!==null){if(this.stallReported){var A=self.performance.now()-g;O.logger.warn("playback not stuck anymore @"+E+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((l||r)&&(this.stalled=null),!(s.paused&&!d||s.ended||s.playbackRate===0||!a.BufferHelper.getBuffered(s).length)){var x=a.BufferHelper.bufferInfo(s,E,0),b=x.len>0,D=x.nextStart||0;if(!(!b&&!D)){if(d){var p=x.len>L,y=!D||o&&o.start<=E||D-E>L&&!this.fragmentTracker.getPartialFragment(E);if(p||y)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var I,C=Math.max(D,x.start||0)-E,P=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,w=P==null||(I=P.details)===null||I===void 0?void 0:I.live,k=w?P.details.targetduration*2:L;if(C>0&&C<=k){this._trySkipBufferHole(null);return}}var F=self.performance.now();if(g===null){this.stalled=F;return}var _=F-g;if(!(!d&&_>=S&&(this._reportStall(x),!this.media))){var B=a.BufferHelper.bufferInfo(s,E,t.maxBufferHole);this._tryFixBufferStall(B,_)}}}}},m._tryFixBufferStall=function(T,o){var t=this.config,s=this.fragmentTracker,g=this.media;if(g!==null){var E=g.currentTime,d=s.getPartialFragment(E);if(d){var r=this._trySkipBufferHole(d);if(r||!this.media)return}T.len>t.maxBufferHole&&o>t.highBufferWatchdogPeriod*1e3&&(O.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},m._reportStall=function(T){var o=this.hls,t=this.media,s=this.stallReported;!s&&t&&(this.stallReported=!0,O.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer ("+JSON.stringify(T)+")"),o.trigger(c.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:T.len}))},m._trySkipBufferHole=function(T){var o=this.config,t=this.hls,s=this.media;if(s===null)return 0;for(var g=s.currentTime,E=0,d=a.BufferHelper.getBuffered(s),r=0;r<d.length;r++){var l=d.start(r);if(g+o.maxBufferHole>=E&&g<l){var A=Math.max(l+n,s.currentTime+u);return O.logger.warn("skipping hole, adjusting currentTime from "+g+" to "+A),this.moved=!0,this.stalled=null,s.currentTime=A,T&&t.trigger(c.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+g+" to "+A,frag:T}),A}E=d.end(r)}return 0},m._tryNudgeBuffer=function(){var T=this.config,o=this.hls,t=this.media,s=this.nudgeRetry;if(t!==null){var g=t.currentTime;if(this.nudgeRetry++,s<T.nudgeMaxRetry){var E=g+(s+1)*T.nudgeOffset;O.logger.warn("Nudging 'currentTime' from "+g+" to "+E),t.currentTime=E,o.trigger(c.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else O.logger.error("Playhead still not moving while enough data buffered @"+g+" after "+T.nudgeMaxRetry+" nudges"),o.trigger(c.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},h}()},"./src/controller/id3-track-controller.ts":function(R,M,i){i.r(M);var a=i("./src/polyfills/number.ts"),e=i("./src/events.ts"),c=i("./src/utils/texttrack-utils.ts"),O=i("./src/demux/id3.ts"),S=i("./src/loader/date-range.ts"),L=i("./src/types/demuxer.ts"),u=.25;function n(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function f(v,T){return v.getTime()/1e3-T}function h(v){return Uint8Array.from(v.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var m=function(){function v(o){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=o,this._registerListeners()}var T=v.prototype;return T.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},T._registerListeners=function(){var t=this.hls;t.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},T._unregisterListeners=function(){var t=this.hls;t.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(e.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},T.onMediaAttached=function(t,s){this.media=s.media},T.onMediaDetaching=function(){!this.id3Track||(Object(c.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},T.onManifestLoading=function(){this.dateRangeCuesAppended={}},T.createTrack=function(t){var s=this.getID3Track(t.textTracks);return s.mode="hidden",s},T.getID3Track=function(t){if(!!this.media){for(var s=0;s<t.length;s++){var g=t[s];if(g.kind==="metadata"&&g.label==="id3")return Object(c.sendAddTrackEvent)(g,this.media),g}return this.media.addTextTrack("metadata","id3")}},T.onFragParsingMetadata=function(t,s){if(!!this.media){var g=this.hls.config,E=g.enableEmsgMetadataCues,d=g.enableID3MetadataCues;if(!(!E&&!d)){var r=s.frag,l=s.samples,A=s.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var x=A.edge||r.end,b=n(),D=!1,p={},y=0;y<l.length;y++){var I=l[y].type;if(!(I===L.MetadataSchema.emsg&&!E||!d)){var C=O.getID3Frames(l[y].data);if(C){var P=l[y].pts,w=x,k=w-P;k<=0&&(w=P+u);for(var F=0;F<C.length;F++){var _=C[F];if(!O.isTimeStampFrame(_)){var B=new b(P,w,"");B.value=_,I&&(B.type=I),this.id3Track.addCue(B),p[_.key]=null,D=!0}}}}}D&&this.updateId3CueEnds(p)}}},T.updateId3CueEnds=function(t){var s,g=(s=this.id3Track)===null||s===void 0?void 0:s.cues;if(g)for(var E=g.length;E--;){var d,r=g[E],l=(d=r.value)===null||d===void 0?void 0:d.key;if(l&&l in t){var A=t[l];A&&r.endTime!==A&&(r.endTime=A),t[l]=r.startTime}}},T.onBufferFlushing=function(t,s){var g=s.startOffset,E=s.endOffset,d=s.type,r=this.id3Track,l=this.hls;if(!!l){var A=l.config,x=A.enableEmsgMetadataCues,b=A.enableID3MetadataCues;if(r&&(x||b)){var D;d==="audio"?D=function(y){return y.type===L.MetadataSchema.audioId3&&b}:d==="video"?D=function(y){return y.type===L.MetadataSchema.emsg&&x}:D=function(y){return y.type===L.MetadataSchema.audioId3&&b||y.type===L.MetadataSchema.emsg&&x},Object(c.removeCuesInRange)(r,g,E,D)}}},T.onLevelUpdated=function(t,s){var g=this,E=s.details;if(!(!this.media||!E.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var d=this.dateRangeCuesAppended,r=this.id3Track,l=E.dateRanges,A=Object.keys(l);if(r)for(var x=Object.keys(d).filter(function(k){return!A.includes(k)}),b=function(F){var _=x[F];Object.keys(d[_].cues).forEach(function(B){r.removeCue(d[_].cues[B])}),delete d[_]},D=x.length;D--;)b(D);var p=E.fragments[E.fragments.length-1];if(!(A.length===0||!Object(a.isFiniteNumber)(p==null?void 0:p.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=p.programDateTime/1e3-p.start,I=E.edge||p.end,C=n(),P=function(F){var _=A[F],B=l[_],N=d[_],U=(N==null?void 0:N.cues)||{},j=(N==null?void 0:N.durationKnown)||!1,K=f(B.startDate,y),H=I,G=B.endDate;if(G)H=f(G,y),j=!0;else if(B.endOnNext&&!j){var W=A.reduce(function(J,q){var tt=l[q];return tt.class===B.class&&tt.id!==q&&tt.startDate>B.startDate&&J.push(tt),J},[]).sort(function(J,q){return J.startDate.getTime()-q.startDate.getTime()})[0];W&&(H=f(W.startDate,y),j=!0)}for(var X=Object.keys(B.attr),z=0;z<X.length;z++){var Q=X[z];if(!(Q===S.DateRangeAttribute.ID||Q===S.DateRangeAttribute.CLASS||Q===S.DateRangeAttribute.START_DATE||Q===S.DateRangeAttribute.DURATION||Q===S.DateRangeAttribute.END_DATE||Q===S.DateRangeAttribute.END_ON_NEXT)){var $=U[Q];if($)j&&!N.durationKnown&&($.endTime=H);else{var Y=B.attr[Q];$=new C(K,H,""),(Q===S.DateRangeAttribute.SCTE35_OUT||Q===S.DateRangeAttribute.SCTE35_IN)&&(Y=h(Y)),$.value={key:Q,data:Y},$.type=L.MetadataSchema.dateRange,g.id3Track.addCue($),U[Q]=$}}}d[_]={cues:U,dateRange:B,durationKnown:j}},w=0;w<A.length;w++)P(w)}}},v}();M.default=m},"./src/controller/latency-controller.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return L});var a=i("./src/errors.ts"),e=i("./src/events.ts"),c=i("./src/utils/logger.ts");function O(u,n){for(var f=0;f<n.length;f++){var h=n[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(u,h.key,h)}}function S(u,n,f){return n&&O(u.prototype,n),f&&O(u,f),Object.defineProperty(u,"prototype",{writable:!1}),u}var L=function(){function u(f){var h=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return h.timeupdate()},this.hls=f,this.config=f.config,this.registerListeners()}var n=u.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},n.registerListeners=function(){this.hls.on(e.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(e.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(e.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(e.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(e.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(e.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(e.Events.ERROR,this.onError)},n.onMediaAttached=function(h,m){this.media=m.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(h,m){var v=m.details;this.levelDetails=v,v.advanced&&this.timeupdate(),!v.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(h,m){m.details===a.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,c.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){var h=this.media,m=this.levelDetails;if(!(!h||!m)){this.currentTime=h.currentTime;var v=this.computeLatency();if(v!==null){this._latency=v;var T=this.config,o=T.lowLatencyMode,t=T.maxLiveSyncPlaybackRate;if(!(!o||t===1)){var s=this.targetLatency;if(s!==null){var g=v-s,E=Math.min(this.maxLatency,s+m.targetduration),d=g<E;if(m.live&&d&&g>.05&&this.forwardBufferLength>1){var r=Math.min(2,Math.max(1,t)),l=Math.round(2/(1+Math.exp(-.75*g-this.edgeStalled))*20)/20;h.playbackRate=Math.min(r,Math.max(1,l))}else h.playbackRate!==1&&h.playbackRate!==0&&(h.playbackRate=1)}}}}},n.estimateLiveEdge=function(){var h=this.levelDetails;return h===null?null:h.edge+h.age},n.computeLatency=function(){var h=this.estimateLiveEdge();return h===null?null:h-this.currentTime},S(u,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var h=this.config,m=this.levelDetails;return h.liveMaxLatencyDuration!==void 0?h.liveMaxLatencyDuration:m?h.liveMaxLatencyDurationCount*m.targetduration:0}},{key:"targetLatency",get:function(){var h=this.levelDetails;if(h===null)return null;var m=h.holdBack,v=h.partHoldBack,T=h.targetduration,o=this.config,t=o.liveSyncDuration,s=o.liveSyncDurationCount,g=o.lowLatencyMode,E=this.hls.userConfig,d=g&&v||m;(E.liveSyncDuration||E.liveSyncDurationCount||d===0)&&(d=t!==void 0?t:s*T);var r=T,l=1;return d+Math.min(this.stallCount*l,r)}},{key:"liveSyncPosition",get:function(){var h=this.estimateLiveEdge(),m=this.targetLatency,v=this.levelDetails;if(h===null||m===null||v===null)return null;var T=v.edge,o=h-m-this.edgeStalled,t=T-v.totalduration,s=T-(this.config.lowLatencyMode&&v.partTarget||v.targetduration);return Math.min(Math.max(t,o),s)}},{key:"drift",get:function(){var h=this.levelDetails;return h===null?1:h.drift}},{key:"edgeStalled",get:function(){var h=this.levelDetails;if(h===null)return 0;var m=(this.config.lowLatencyMode&&h.partTarget||h.targetduration)*3;return Math.max(h.age-m,0)}},{key:"forwardBufferLength",get:function(){var h=this.media,m=this.levelDetails;if(!h||!m)return 0;var v=h.buffered.length;return(v?h.buffered.end(v-1):m.edge)-this.currentTime}}]),u}()},"./src/controller/level-controller.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return o});var a=i("./src/types/level.ts"),e=i("./src/events.ts"),c=i("./src/errors.ts"),O=i("./src/utils/codecs.ts"),S=i("./src/controller/level-helper.ts"),L=i("./src/controller/base-playlist-controller.ts"),u=i("./src/types/loader.ts");function n(){return n=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var g=arguments[s];for(var E in g)Object.prototype.hasOwnProperty.call(g,E)&&(t[E]=g[E])}return t},n.apply(this,arguments)}function f(t,s){for(var g=0;g<s.length;g++){var E=s[g];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(t,E.key,E)}}function h(t,s,g){return s&&f(t.prototype,s),g&&f(t,g),Object.defineProperty(t,"prototype",{writable:!1}),t}function m(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,v(t,s)}function v(t,s){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,d){return E.__proto__=d,E},v(t,s)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),o=function(t){m(s,t);function s(E){var d;return d=t.call(this,E,"[level-controller]")||this,d._levels=[],d._firstLevel=-1,d._startLevel=void 0,d.currentLevelIndex=-1,d.manualLevelIndex=-1,d.onParsedComplete=void 0,d._registerListeners(),d}var g=s.prototype;return g._registerListeners=function(){var d=this.hls;d.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.on(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(e.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(e.Events.ERROR,this.onError,this)},g._unregisterListeners=function(){var d=this.hls;d.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(e.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(e.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(e.Events.ERROR,this.onError,this)},g.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},g.startLoad=function(){var d=this._levels;d.forEach(function(r){r.loadError=0}),t.prototype.startLoad.call(this)},g.onManifestLoaded=function(d,r){var l=[],A=[],x=[],b,D={},p,y=!1,I=!1,C=!1;if(r.levels.forEach(function(F){var _=F.attrs;y=y||!!(F.width&&F.height),I=I||!!F.videoCodec,C=C||!!F.audioCodec,T&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var B=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;p=D[B],p?p.url.push(F.url):(p=new a.Level(F),D[B]=p,l.push(p)),_&&(_.AUDIO&&Object(S.addGroupId)(p,"audio",_.AUDIO),_.SUBTITLES&&Object(S.addGroupId)(p,"text",_.SUBTITLES))}),(y||I)&&C&&(l=l.filter(function(F){var _=F.videoCodec,B=F.width,N=F.height;return!!_||!!(B&&N)})),l=l.filter(function(F){var _=F.audioCodec,B=F.videoCodec;return(!_||Object(O.isCodecSupportedInMp4)(_,"audio"))&&(!B||Object(O.isCodecSupportedInMp4)(B,"video"))}),r.audioTracks&&(A=r.audioTracks.filter(function(F){return!F.audioCodec||Object(O.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(S.assignTrackIdsByGroup)(A)),r.subtitles&&(x=r.subtitles,Object(S.assignTrackIdsByGroup)(x)),l.length>0){b=l[0].bitrate,l.sort(function(F,_){return F.bitrate-_.bitrate}),this._levels=l;for(var P=0;P<l.length;P++)if(l[P].bitrate===b){this._firstLevel=P,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+b);break}var w=C&&!I,k={levels:l,audioTracks:A,subtitleTracks:x,firstLevel:this._firstLevel,stats:r.stats,audio:C,video:I,altAudio:!w&&A.some(function(F){return!!F.url})};this.hls.trigger(e.Events.MANIFEST_PARSED,k),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(e.Events.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,reason:"no level with compatible codecs found in manifest"})},g.onError=function(d,r){if(t.prototype.onError.call(this,d,r),!r.fatal){var l=r.context,A=this._levels[this.currentLevelIndex];if(l&&(l.type===u.PlaylistContextType.AUDIO_TRACK&&A.audioGroupIds&&l.groupId===A.audioGroupIds[A.urlId]||l.type===u.PlaylistContextType.SUBTITLE_TRACK&&A.textGroupIds&&l.groupId===A.textGroupIds[A.urlId])){this.redundantFailover(this.currentLevelIndex);return}var x=!1,b=!0,D;switch(r.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var p=this._levels[r.frag.level];p?(p.fragmentError++,p.fragmentError>this.hls.config.fragLoadingMaxRetry&&(D=r.frag.level)):D=r.frag.level}break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:l&&(l.deliveryDirectives&&(b=!1),D=l.level),x=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:D=r.level,x=!0;break}D!==void 0&&this.recoverLevel(r,D,x,b)}},g.recoverLevel=function(d,r,l,A){var x=d.details,b=this._levels[r];if(b.loadError++,l){var D=this.retryLoadingOrFail(d);if(D)d.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(A){var p=b.url.length;if(p>1&&b.loadError<p)d.levelRetry=!0,this.redundantFailover(r);else if(this.manualLevelIndex===-1){var y=r===0?this._levels.length-1:r-1;this.currentLevelIndex!==y&&this._levels[y].loadError===0&&(this.warn(x+": switch to "+y),d.levelRetry=!0,this.hls.nextAutoLevel=y)}}},g.redundantFailover=function(d){var r=this._levels[d],l=r.url.length;if(l>1){var A=(r.urlId+1)%l;this.warn("Switching to redundant URL-id "+A),this._levels.forEach(function(x){x.urlId=A}),this.level=d}},g.onFragLoaded=function(d,r){var l=r.frag;if(l!==void 0&&l.type===u.PlaylistLevelType.MAIN){var A=this._levels[l.level];A!==void 0&&(A.fragmentError=0,A.loadError=0)}},g.onLevelLoaded=function(d,r){var l,A=r.level,x=r.details,b=this._levels[A];if(!b){var D;this.warn("Invalid level index "+A),(D=r.deliveryDirectives)!==null&&D!==void 0&&D.skip&&(x.deltaUpdateFailed=!0);return}A===this.currentLevelIndex?(b.fragmentError===0&&(b.loadError=0,this.retryCount=0),this.playlistLoaded(A,r,b.details)):(l=r.deliveryDirectives)!==null&&l!==void 0&&l.skip&&(x.deltaUpdateFailed=!0)},g.onAudioTrackSwitched=function(d,r){var l=this.hls.levels[this.currentLevelIndex];if(!!l&&l.audioGroupIds){for(var A=-1,x=this.hls.audioTracks[r.id].groupId,b=0;b<l.audioGroupIds.length;b++)if(l.audioGroupIds[b]===x){A=b;break}A!==l.urlId&&(l.urlId=A,this.startLoad())}},g.loadPlaylist=function(d){var r=this.currentLevelIndex,l=this._levels[r];if(this.canLoad&&l&&l.url.length>0){var A=l.urlId,x=l.url[A];if(d)try{x=d.addDirectives(x)}catch(b){this.warn("Could not construct new URL with HLS Delivery Directives: "+b)}this.log("Attempt loading level index "+r+(d?" at sn "+d.msn+" part "+d.part:"")+" with URL-id "+A+" "+x),this.clearTimer(),this.hls.trigger(e.Events.LEVEL_LOADING,{url:x,level:r,id:A,deliveryDirectives:d||null})}},g.removeLevel=function(d,r){var l=function(b,D){return D!==r},A=this._levels.filter(function(x,b){return b!==d?!0:x.url.length>1&&r!==void 0?(x.url=x.url.filter(l),x.audioGroupIds&&(x.audioGroupIds=x.audioGroupIds.filter(l)),x.textGroupIds&&(x.textGroupIds=x.textGroupIds.filter(l)),x.urlId=0,!0):!1}).map(function(x,b){var D=x.details;return D!=null&&D.fragments&&D.fragments.forEach(function(p){p.level=b}),x});this._levels=A,this.hls.trigger(e.Events.LEVELS_UPDATED,{levels:A})},h(s,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(d){var r,l=this._levels;if(l.length!==0&&!(this.currentLevelIndex===d&&(r=l[d])!==null&&r!==void 0&&r.details)){if(d<0||d>=l.length){var A=d<0;if(this.hls.trigger(e.Events.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:d,fatal:A,reason:"invalid level idx"}),A)return;d=Math.min(d,l.length-1)}this.clearTimer();var x=this.currentLevelIndex,b=l[x],D=l[d];this.log("switching to level "+d+" from "+x),this.currentLevelIndex=d;var p=n({},D,{level:d,maxBitrate:D.maxBitrate,uri:D.uri,urlId:D.urlId});delete p._urlId,this.hls.trigger(e.Events.LEVEL_SWITCHING,p);var y=D.details;if(!y||y.live){var I=this.switchParams(D.uri,b==null?void 0:b.details);this.loadPlaylist(I)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(d){this.manualLevelIndex=d,this._startLevel===void 0&&(this._startLevel=d),d!==-1&&(this.level=d)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(d){this._firstLevel=d}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var d=this.hls.config.startLevel;return d!==void 0?d:this._firstLevel}else return this._startLevel},set:function(d){this._startLevel=d}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(d){this.level=d,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=d)}}]),s}(L.default)},"./src/controller/level-helper.ts":function(R,M,i){i.r(M),i.d(M,"addGroupId",function(){return S}),i.d(M,"assignTrackIdsByGroup",function(){return L}),i.d(M,"updatePTS",function(){return u}),i.d(M,"updateFragPTSDTS",function(){return f}),i.d(M,"mergeDetails",function(){return h}),i.d(M,"mapPartIntersection",function(){return v}),i.d(M,"mapFragmentIntersection",function(){return T}),i.d(M,"adjustSliding",function(){return o}),i.d(M,"addSliding",function(){return t}),i.d(M,"computeReloadInterval",function(){return s}),i.d(M,"getFragmentWithSN",function(){return g}),i.d(M,"getPartWith",function(){return E});var a=i("./src/polyfills/number.ts"),e=i("./src/utils/logger.ts"),c=i("./src/loader/date-range.ts");function O(){return O=Object.assign?Object.assign.bind():function(d){for(var r=1;r<arguments.length;r++){var l=arguments[r];for(var A in l)Object.prototype.hasOwnProperty.call(l,A)&&(d[A]=l[A])}return d},O.apply(this,arguments)}function S(d,r,l){switch(r){case"audio":d.audioGroupIds||(d.audioGroupIds=[]),d.audioGroupIds.push(l);break;case"text":d.textGroupIds||(d.textGroupIds=[]),d.textGroupIds.push(l);break}}function L(d){var r={};d.forEach(function(l){var A=l.groupId||"";l.id=r[A]=r[A]||0,r[A]++})}function u(d,r,l){var A=d[r],x=d[l];n(A,x)}function n(d,r){var l=r.startPTS;if(Object(a.isFiniteNumber)(l)){var A=0,x;r.sn>d.sn?(A=l-d.start,x=d):(A=d.start-l,x=r),x.duration!==A&&(x.duration=A)}else if(r.sn>d.sn){var b=d.cc===r.cc;b&&d.minEndPTS?r.start=d.start+(d.minEndPTS-d.start):r.start=d.start+d.duration}else r.start=Math.max(d.start-r.duration,0)}function f(d,r,l,A,x,b){var D=A-l;D<=0&&(e.logger.warn("Fragment should have a positive duration",r),A=l+r.duration,b=x+r.duration);var p=l,y=A,I=r.startPTS,C=r.endPTS;if(Object(a.isFiniteNumber)(I)){var P=Math.abs(I-l);Object(a.isFiniteNumber)(r.deltaPTS)?r.deltaPTS=Math.max(P,r.deltaPTS):r.deltaPTS=P,p=Math.max(l,I),l=Math.min(l,I),x=Math.min(x,r.startDTS),y=Math.min(A,C),A=Math.max(A,C),b=Math.max(b,r.endDTS)}r.duration=A-l;var w=l-r.start;r.appendedPTS=A,r.start=r.startPTS=l,r.maxStartPTS=p,r.startDTS=x,r.endPTS=A,r.minEndPTS=y,r.endDTS=b;var k=r.sn;if(!d||k<d.startSN||k>d.endSN)return 0;var F,_=k-d.startSN,B=d.fragments;for(B[_]=r,F=_;F>0;F--)n(B[F],B[F-1]);for(F=_;F<B.length-1;F++)n(B[F],B[F+1]);return d.fragmentHint&&n(B[B.length-1],d.fragmentHint),d.PTSKnown=d.alignedSliding=!0,w}function h(d,r){for(var l=null,A=d.fragments,x=A.length-1;x>=0;x--){var b=A[x].initSegment;if(b){l=b;break}}d.fragmentHint&&delete d.fragmentHint.endPTS;var D=0,p;if(T(d,r,function(F,_){F.relurl&&(D=F.cc-_.cc),Object(a.isFiniteNumber)(F.startPTS)&&Object(a.isFiniteNumber)(F.endPTS)&&(_.start=_.startPTS=F.startPTS,_.startDTS=F.startDTS,_.appendedPTS=F.appendedPTS,_.maxStartPTS=F.maxStartPTS,_.endPTS=F.endPTS,_.endDTS=F.endDTS,_.minEndPTS=F.minEndPTS,_.duration=F.endPTS-F.startPTS,_.duration&&(p=_),r.PTSKnown=r.alignedSliding=!0),_.elementaryStreams=F.elementaryStreams,_.loader=F.loader,_.stats=F.stats,_.urlId=F.urlId,F.initSegment&&(_.initSegment=F.initSegment,l=F.initSegment)}),l){var y=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;y.forEach(function(F){var _;(!F.initSegment||F.initSegment.relurl===((_=l)===null||_===void 0?void 0:_.relurl))&&(F.initSegment=l)})}if(r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(function(F){return!F}),r.deltaUpdateFailed){e.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var I=r.skippedSegments;I--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=m(d.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));var C=r.fragments;if(D){e.logger.warn("discontinuity sliding from playlist, take drift into account");for(var P=0;P<C.length;P++)C[P].cc+=D}r.skippedSegments&&(r.startCC=r.fragments[0].cc),v(d.partList,r.partList,function(F,_){_.elementaryStreams=F.elementaryStreams,_.stats=F.stats}),p?f(r,p,p.startPTS,p.endPTS,p.startDTS,p.endDTS):o(d,r),C.length&&(r.totalduration=r.edge-C[0].start),r.driftStartTime=d.driftStartTime,r.driftStart=d.driftStart;var w=r.advancedDateTime;if(r.advanced&&w){var k=r.edge;r.driftStart||(r.driftStartTime=w,r.driftStart=k),r.driftEndTime=w,r.driftEnd=k}else r.driftEndTime=d.driftEndTime,r.driftEnd=d.driftEnd,r.advancedDateTime=d.advancedDateTime}function m(d,r,l){var A=O({},d);return l&&l.forEach(function(x){delete A[x]}),Object.keys(r).forEach(function(x){var b=new c.DateRange(r[x].attr,A[x]);b.isValid?A[x]=b:e.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(r[x].attr)+'"')}),A}function v(d,r,l){if(d&&r)for(var A=0,x=0,b=d.length;x<=b;x++){var D=d[x],p=r[x+A];D&&p&&D.index===p.index&&D.fragment.sn===p.fragment.sn?l(D,p):A--}}function T(d,r,l){for(var A=r.skippedSegments,x=Math.max(d.startSN,r.startSN)-r.startSN,b=(d.fragmentHint?1:0)+(A?r.endSN:Math.min(d.endSN,r.endSN))-r.startSN,D=r.startSN-d.startSN,p=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,y=d.fragmentHint?d.fragments.concat(d.fragmentHint):d.fragments,I=x;I<=b;I++){var C=y[D+I],P=p[I];A&&!P&&I<A&&(P=r.fragments[I]=C),C&&P&&l(C,P)}}function o(d,r){var l=r.startSN+r.skippedSegments-d.startSN,A=d.fragments;l<0||l>=A.length||t(r,A[l].start)}function t(d,r){if(r){for(var l=d.fragments,A=d.skippedSegments;A<l.length;A++)l[A].start+=r;d.fragmentHint&&(d.fragmentHint.start+=r)}}function s(d,r){var l=1e3*d.levelTargetDuration,A=l/2,x=d.age,b=x>0&&x<l*3,D=r.loading.end-r.loading.start,p,y=d.availabilityDelay;if(d.updated===!1)if(b){var I=333*d.misses;p=Math.max(Math.min(A,D*2),I),d.availabilityDelay=(d.availabilityDelay||0)+p}else p=A;else b?(y=Math.min(y||l/2,x),d.availabilityDelay=y,p=y+l-x):p=l-D;return Math.round(p)}function g(d,r,l){if(!d||!d.details)return null;var A=d.details,x=A.fragments[r-A.startSN];return x||(x=A.fragmentHint,x&&x.sn===r)?x:r<A.startSN&&l&&l.sn===r?l:null}function E(d,r,l){if(!d||!d.details)return null;var A=d.details.partList;if(A)for(var x=A.length;x--;){var b=A[x];if(b.index===l&&b.fragment.sn===r)return b}return null}},"./src/controller/stream-controller.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return E});var a=i("./src/polyfills/number.ts"),e=i("./src/controller/base-stream-controller.ts"),c=i("./src/is-supported.ts"),O=i("./src/events.ts"),S=i("./src/utils/buffer-helper.ts"),L=i("./src/controller/fragment-tracker.ts"),u=i("./src/types/loader.ts"),n=i("./src/loader/fragment.ts"),f=i("./src/demux/transmuxer-interface.ts"),h=i("./src/types/transmuxer.ts"),m=i("./src/controller/gap-controller.ts"),v=i("./src/errors.ts");function T(d,r){for(var l=0;l<r.length;l++){var A=r[l];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(d,A.key,A)}}function o(d,r,l){return r&&T(d.prototype,r),l&&T(d,l),Object.defineProperty(d,"prototype",{writable:!1}),d}function t(d,r){d.prototype=Object.create(r.prototype),d.prototype.constructor=d,s(d,r)}function s(d,r){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(A,x){return A.__proto__=x,A},s(d,r)}var g=100,E=function(d){t(r,d);function r(A,x){var b;return b=d.call(this,A,x,"[stream-controller]")||this,b.audioCodecSwap=!1,b.gapController=null,b.level=-1,b._forceStartLoad=!1,b.altAudio=!1,b.audioOnly=!1,b.fragPlaying=null,b.onvplaying=null,b.onvseeked=null,b.fragLastKbps=0,b.couldBacktrack=!1,b.backtrackFragment=null,b.audioCodecSwitch=!1,b.videoBuffer=null,b._registerListeners(),b}var l=r.prototype;return l._registerListeners=function(){var x=this.hls;x.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),x.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),x.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),x.on(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),x.on(O.Events.ERROR,this.onError,this),x.on(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),x.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),x.on(O.Events.BUFFER_CREATED,this.onBufferCreated,this),x.on(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),x.on(O.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),x.on(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var x=this.hls;x.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),x.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),x.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),x.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),x.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),x.off(O.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),x.off(O.Events.ERROR,this.onError,this),x.off(O.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),x.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),x.off(O.Events.BUFFER_CREATED,this.onBufferCreated,this),x.off(O.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),x.off(O.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),x.off(O.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},l.startLoad=function(x){if(this.levels){var b=this.lastCurrentTime,D=this.hls;if(this.stopLoad(),this.setInterval(g),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var p=D.startLevel;p===-1&&(D.config.testBandwidth?(p=0,this.bitrateTest=!0):p=D.nextAutoLevel),this.level=D.nextLoadLevel=p,this.loadedmetadata=!1}b>0&&x===-1&&(this.log("Override startPosition with lastCurrentTime @"+b.toFixed(3)),x=b),this.state=e.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=x,this.tick()}else this._forceStartLoad=!0,this.state=e.State.STOPPED},l.stopLoad=function(){this._forceStartLoad=!1,d.prototype.stopLoad.call(this)},l.doTick=function(){switch(this.state){case e.State.IDLE:this.doTickIdle();break;case e.State.WAITING_LEVEL:{var x,b=this.levels,D=this.level,p=b==null||(x=b[D])===null||x===void 0?void 0:x.details;if(p&&(!p.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(p))break;this.state=e.State.IDLE;break}break}case e.State.FRAG_LOADING_WAITING_RETRY:{var y,I=self.performance.now(),C=this.retryDate;(!C||I>=C||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=e.State.IDLE)}break}this.onTickEnd()},l.onTickEnd=function(){d.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},l.doTickIdle=function(){var x,b,D=this.hls,p=this.levelLastLoaded,y=this.levels,I=this.media,C=D.config,P=D.nextLoadLevel;if(!(p===null||!I&&(this.startFragRequested||!C.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!y||!y[P])){var w=y[P];this.level=D.nextLoadLevel=P;var k=w.details;if(!k||this.state===e.State.WAITING_LEVEL||k.live&&this.levelLastLoaded!==P){this.state=e.State.WAITING_LEVEL;return}var F=this.getMainFwdBufferInfo();if(F!==null){var _=F.len,B=this.getMaxBufferLength(w.maxBitrate);if(!(_>=B)){if(this._streamEnded(F,k)){var N={};this.altAudio&&(N.type="video"),this.hls.trigger(O.Events.BUFFER_EOS,N),this.state=e.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>F.end&&(this.backtrackFragment=null);var U=this.backtrackFragment?this.backtrackFragment.start:F.end,j=this.getNextFragment(U,k);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"&&this.fragmentTracker.getState(j)!==L.FragmentState.OK){var K,H=((K=this.backtrackFragment)!=null?K:j).sn,G=H-k.startSN,W=k.fragments[G-1];W&&j.cc===W.cc&&(j=W,this.fragmentTracker.removeFragment(W))}else this.backtrackFragment&&F.len&&(this.backtrackFragment=null);if(j&&this.fragmentTracker.getState(j)===L.FragmentState.OK&&this.nextLoadPosition>U){var X=this.audioOnly&&!this.altAudio?n.ElementaryStreamTypes.AUDIO:n.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(I,X,u.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,k)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((x=j.decryptdata)===null||x===void 0?void 0:x.keyFormat)==="identity"&&!((b=j.decryptdata)!==null&&b!==void 0&&b.key)?this.loadKey(j,k):this.loadFragment(j,k,U))}}}},l.loadFragment=function(x,b,D){var p,y=this.fragmentTracker.getState(x);this.fragCurrent=x,y===L.FragmentState.NOT_LOADED||y===L.FragmentState.PARTIAL?x.sn==="initSegment"?this._loadInitSegment(x):this.bitrateTest?(x.bitrateTest=!0,this.log("Fragment "+x.sn+" of level "+x.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(x)):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,x,b,D)):y===L.FragmentState.APPENDING?this.reduceMaxBufferLength(x.duration)&&this.fragmentTracker.removeFragment(x):((p=this.media)===null||p===void 0?void 0:p.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},l.getAppendedFrag=function(x){var b=this.fragmentTracker.getAppendedFrag(x,u.PlaylistLevelType.MAIN);return b&&"fragment"in b?b.fragment:b},l.getBufferedFrag=function(x){return this.fragmentTracker.getBufferedFrag(x,u.PlaylistLevelType.MAIN)},l.followingBufferedFrag=function(x){return x?this.getBufferedFrag(x.end+.5):null},l.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},l.nextLevelSwitch=function(){var x=this.levels,b=this.media;if(b!=null&&b.readyState){var D,p=this.getAppendedFrag(b.currentTime);if(p&&p.start>1&&this.flushMainBuffer(0,p.start-1),!b.paused&&x){var y=this.hls.nextLoadLevel,I=x[y],C=this.fragLastKbps;C&&this.fragCurrent?D=this.fragCurrent.duration*I.maxBitrate/(1e3*C)+1:D=0}else D=0;var P=this.getBufferedFrag(b.currentTime+D);if(P){var w=this.followingBufferedFrag(P);if(w){this.abortCurrentFrag();var k=w.maxStartPTS?w.maxStartPTS:w.start,F=w.duration,_=Math.max(P.end,k+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(_,Number.POSITIVE_INFINITY)}}}},l.abortCurrentFrag=function(){var x=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,x!=null&&x.loader&&x.loader.abort(),this.state){case e.State.KEY_LOADING:case e.State.FRAG_LOADING:case e.State.FRAG_LOADING_WAITING_RETRY:case e.State.PARSING:case e.State.PARSED:this.state=e.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},l.flushMainBuffer=function(x,b){d.prototype.flushMainBuffer.call(this,x,b,this.altAudio?"video":null)},l.onMediaAttached=function(x,b){d.prototype.onMediaAttached.call(this,x,b);var D=b.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),D.addEventListener("playing",this.onvplaying),D.addEventListener("seeked",this.onvseeked),this.gapController=new m.default(this.config,D,this.fragmentTracker,this.hls)},l.onMediaDetaching=function(){var x=this.media;x&&(x.removeEventListener("playing",this.onvplaying),x.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),d.prototype.onMediaDetaching.call(this)},l.onMediaPlaying=function(){this.tick()},l.onMediaSeeked=function(){var x=this.media,b=x?x.currentTime:null;Object(a.isFiniteNumber)(b)&&this.log("Media seeked to "+b.toFixed(3)),this.tick()},l.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(O.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},l.onManifestParsed=function(x,b){var D=!1,p=!1,y;b.levels.forEach(function(I){y=I.audioCodec,y&&(y.indexOf("mp4a.40.2")!==-1&&(D=!0),y.indexOf("mp4a.40.5")!==-1&&(p=!0))}),this.audioCodecSwitch=D&&p&&!Object(c.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=b.levels,this.startFragRequested=!1},l.onLevelLoading=function(x,b){var D=this.levels;if(!(!D||this.state!==e.State.IDLE)){var p=D[b.level];(!p.details||p.details.live&&this.levelLastLoaded!==b.level||this.waitForCdnTuneIn(p.details))&&(this.state=e.State.WAITING_LEVEL)}},l.onLevelLoaded=function(x,b){var D,p=this.levels,y=b.level,I=b.details,C=I.totalduration;if(!p){this.warn("Levels were reset while loading level "+y);return}this.log("Level "+y+" loaded ["+I.startSN+","+I.endSN+"], cc ["+I.startCC+", "+I.endCC+"] duration:"+C);var P=this.fragCurrent;P&&(this.state===e.State.FRAG_LOADING||this.state===e.State.FRAG_LOADING_WAITING_RETRY)&&P.level!==b.level&&P.loader&&(this.state=e.State.IDLE,this.backtrackFragment=null,P.loader.abort());var w=p[y],k=0;if(I.live||(D=w.details)!==null&&D!==void 0&&D.live){if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed)return;k=this.alignPlaylists(I,w.details)}if(w.details=I,this.levelLastLoaded=y,this.hls.trigger(O.Events.LEVEL_UPDATED,{details:I,level:y}),this.state===e.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(I))return;this.state=e.State.IDLE}this.startFragRequested?I.live&&this.synchronizeToLiveEdge(I):this.setStartPosition(I,k),this.tick()},l._handleFragmentLoadProgress=function(x){var b,D=x.frag,p=x.part,y=x.payload,I=this.levels;if(!I){this.warn("Levels were reset while fragment load was in progress. Fragment "+D.sn+" of level "+D.level+" will not be buffered");return}var C=I[D.level],P=C.details;if(!P){this.warn("Dropping fragment "+D.sn+" of level "+D.level+" after level details were reset");return}var w=C.videoCodec,k=P.PTSKnown||!P.live,F=(b=D.initSegment)===null||b===void 0?void 0:b.data,_=this._getAudioCodec(C),B=this.transmuxer=this.transmuxer||new f.default(this.hls,u.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=p?p.index:-1,U=N!==-1,j=new h.ChunkMetadata(D.level,D.sn,D.stats.chunkCount,y.byteLength,N,U),K=this.initPTS[D.cc];B.push(y,F,_,w,D,p,P.totalduration,k,j,K)},l.onAudioTrackSwitching=function(x,b){var D=this.altAudio,p=!!b.url,y=b.id;if(!p){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var I=this.fragCurrent;I!=null&&I.loader&&(this.log("Switching to main audio track, cancel main fragment load"),I.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var C=this.hls;D&&C.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),C.trigger(O.Events.AUDIO_TRACK_SWITCHED,{id:y})}},l.onAudioTrackSwitched=function(x,b){var D=b.id,p=!!this.hls.audioTracks[D].url;if(p){var y=this.videoBuffer;y&&this.mediaBuffer!==y&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=y)}this.altAudio=p,this.tick()},l.onBufferCreated=function(x,b){var D=b.tracks,p,y,I=!1;for(var C in D){var P=D[C];if(P.id==="main"){if(y=C,p=P,C==="video"){var w=D[C];w&&(this.videoBuffer=w.buffer)}}else I=!0}I&&p?(this.log("Alternate track found, use "+y+".buffered to schedule main fragment loading"),this.mediaBuffer=p.buffer):this.mediaBuffer=this.media},l.onFragBuffered=function(x,b){var D=b.frag,p=b.part;if(!(D&&D.type!==u.PlaylistLevelType.MAIN)){if(this.fragContextChanged(D)){this.warn("Fragment "+D.sn+(p?" p: "+p.index:"")+" of level "+D.level+" finished buffering, but was aborted. state: "+this.state),this.state===e.State.PARSED&&(this.state=e.State.IDLE);return}var y=p?p.stats:D.stats;this.fragLastKbps=Math.round(8*y.total/(y.buffering.end-y.loading.first)),D.sn!=="initSegment"&&(this.fragPrevious=D),this.fragBufferedComplete(D,p)}},l.onError=function(x,b){switch(b.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(u.PlaylistLevelType.MAIN,b);break;case v.ErrorDetails.LEVEL_LOAD_ERROR:case v.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==e.State.ERROR&&(b.fatal?(this.warn(""+b.details),this.state=e.State.ERROR):!b.levelRetry&&this.state===e.State.WAITING_LEVEL&&(this.state=e.State.IDLE));break;case v.ErrorDetails.BUFFER_FULL_ERROR:if(b.parent==="main"&&(this.state===e.State.PARSING||this.state===e.State.PARSED)){var D=!0,p=this.getFwdBufferInfo(this.media,u.PlaylistLevelType.MAIN);p&&p.len>.5&&(D=!this.reduceMaxBufferLength(p.len)),D&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},l.checkBuffer=function(){var x=this.media,b=this.gapController;if(!(!x||!b||!x.readyState)){var D=S.BufferHelper.getBuffered(x);if(!this.loadedmetadata&&D.length)this.loadedmetadata=!0,this.seekToStartPos();else{var p=this.state!==e.State.IDLE?this.fragCurrent:null;b.poll(this.lastCurrentTime,p)}this.lastCurrentTime=x.currentTime}},l.onFragLoadEmergencyAborted=function(){this.state=e.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},l.onBufferFlushed=function(x,b){var D=b.type;if(D!==n.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var p=(D===n.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(p,D,u.PlaylistLevelType.MAIN)}},l.onLevelsUpdated=function(x,b){this.levels=b.levels},l.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},l.seekToStartPos=function(){var x=this.media,b=x.currentTime,D=this.startPosition;if(D>=0&&b<D){if(x.seeking){this.log("could not seek to "+D+", already seeking at "+b);return}var p=S.BufferHelper.getBuffered(x),y=p.length?p.start(0):0,I=y-D;I>0&&(I<this.config.maxBufferHole||I<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+I+" to match buffer start"),D+=I,this.startPosition=D),this.log("seek to target start position "+D+" from current time "+b),x.currentTime=D}},l._getAudioCodec=function(x){var b=this.config.defaultAudioCodec||x.audioCodec;return this.audioCodecSwap&&b&&(this.log("Swapping audio codec"),b.indexOf("mp4a.40.5")!==-1?b="mp4a.40.2":b="mp4a.40.5"),b},l._loadBitrateTestFrag=function(x){var b=this;this._doFragLoad(x).then(function(D){var p=b.hls;if(!(!D||p.nextLoadLevel||b.fragContextChanged(x))){b.fragLoadError=0,b.state=e.State.IDLE,b.startFragRequested=!1,b.bitrateTest=!1;var y=x.stats;y.parsing.start=y.parsing.end=y.buffering.start=y.buffering.end=self.performance.now(),p.trigger(O.Events.FRAG_LOADED,D)}})},l._handleTransmuxComplete=function(x){var b,D="main",p=this.hls,y=x.remuxResult,I=x.chunkMeta,C=this.getCurrentContext(I);if(!C){this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(I.level);return}var P=C.frag,w=C.part,k=C.level,F=y.video,_=y.text,B=y.id3,N=y.initSegment,U=k.details,j=this.altAudio?void 0:y.audio;if(!this.fragContextChanged(P)){if(this.state=e.State.PARSING,N){N.tracks&&(this._bufferInitSegment(k,N.tracks,P,I),p.trigger(O.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:D,tracks:N.tracks}));var K=N.initPTS,H=N.timescale;Object(a.isFiniteNumber)(K)&&(this.initPTS[P.cc]=K,p.trigger(O.Events.INIT_PTS_FOUND,{frag:P,id:D,initPTS:K,timescale:H}))}if(F&&y.independent!==!1){if(U){var G=F.startPTS,W=F.endPTS,X=F.startDTS,z=F.endDTS;if(w)w.elementaryStreams[F.type]={startPTS:G,endPTS:W,startDTS:X,endDTS:z};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var Q=this.getMainFwdBufferInfo(),$=(Q?Q.end:this.getLoadPosition())+this.config.maxBufferHole,Y=F.firstKeyFramePTS?F.firstKeyFramePTS:G;if($<Y-this.config.maxBufferHole){this.backtrack(P);return}P.setElementaryStreamInfo(F.type,P.start,W,P.start,z,!0)}P.setElementaryStreamInfo(F.type,G,W,X,z),this.backtrackFragment&&(this.backtrackFragment=P),this.bufferFragmentData(F,P,w,I)}}else if(y.independent===!1){this.backtrack(P);return}if(j){var J=j.startPTS,q=j.endPTS,tt=j.startDTS,et=j.endDTS;w&&(w.elementaryStreams[n.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:q,startDTS:tt,endDTS:et}),P.setElementaryStreamInfo(n.ElementaryStreamTypes.AUDIO,J,q,tt,et),this.bufferFragmentData(j,P,w,I)}if(U&&B!==null&&B!==void 0&&(b=B.samples)!==null&&b!==void 0&&b.length){var rt={id:D,frag:P,details:U,samples:B.samples};p.trigger(O.Events.FRAG_PARSING_METADATA,rt)}if(U&&_){var V={id:D,frag:P,details:U,samples:_.samples};p.trigger(O.Events.FRAG_PARSING_USERDATA,V)}}},l._bufferInitSegment=function(x,b,D,p){var y=this;if(this.state===e.State.PARSING){this.audioOnly=!!b.audio&&!b.video,this.altAudio&&!this.audioOnly&&delete b.audio;var I=b.audio,C=b.video,P=b.audiovideo;if(I){var w=x.audioCodec,k=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(w&&(w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),I.metadata.channelCount!==1&&k.indexOf("firefox")===-1&&(w="mp4a.40.5")),k.indexOf("android")!==-1&&I.container!=="audio/mpeg"&&(w="mp4a.40.2",this.log("Android: force audio codec to "+w)),x.audioCodec&&x.audioCodec!==w&&this.log('Swapping manifest audio codec "'+x.audioCodec+'" for "'+w+'"'),I.levelCodec=w,I.id="main",this.log("Init audio buffer, container:"+I.container+", codecs[selected/level/parsed]=["+(w||"")+"/"+(x.audioCodec||"")+"/"+I.codec+"]")}C&&(C.levelCodec=x.videoCodec,C.id="main",this.log("Init video buffer, container:"+C.container+", codecs[level/parsed]=["+(x.videoCodec||"")+"/"+C.codec+"]")),P&&this.log("Init audiovideo buffer, container:"+P.container+", codecs[level/parsed]=["+(x.attrs.CODECS||"")+"/"+P.codec+"]"),this.hls.trigger(O.Events.BUFFER_CODECS,b),Object.keys(b).forEach(function(F){var _=b[F],B=_.initSegment;B!=null&&B.byteLength&&y.hls.trigger(O.Events.BUFFER_APPENDING,{type:F,data:B,frag:D,part:null,chunkMeta:p,parent:D.type})}),this.tick()}},l.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,u.PlaylistLevelType.MAIN)},l.backtrack=function(x){this.couldBacktrack=!0,this.backtrackFragment=x,this.resetTransmuxer(),this.flushBufferGap(x),this.fragmentTracker.removeFragment(x),this.fragPrevious=null,this.nextLoadPosition=x.start,this.state=e.State.IDLE},l.checkFragmentChanged=function(){var x=this.media,b=null;if(x&&x.readyState>1&&x.seeking===!1){var D=x.currentTime;if(S.BufferHelper.isBuffered(x,D)?b=this.getAppendedFrag(D):S.BufferHelper.isBuffered(x,D+.1)&&(b=this.getAppendedFrag(D+.1)),b){this.backtrackFragment=null;var p=this.fragPlaying,y=b.level;(!p||b.sn!==p.sn||p.level!==y||b.urlId!==p.urlId)&&(this.hls.trigger(O.Events.FRAG_CHANGED,{frag:b}),(!p||p.level!==y)&&this.hls.trigger(O.Events.LEVEL_SWITCHED,{level:y}),this.fragPlaying=b)}}},o(r,[{key:"nextLevel",get:function(){var x=this.nextBufferedFrag;return x?x.level:-1}},{key:"currentFrag",get:function(){var x=this.media;return x?this.fragPlaying||this.getAppendedFrag(x.currentTime):null}},{key:"currentProgramDateTime",get:function(){var x=this.media;if(x){var b=x.currentTime,D=this.currentFrag;if(D&&Object(a.isFiniteNumber)(b)&&Object(a.isFiniteNumber)(D.programDateTime)){var p=D.programDateTime+(b-D.start)*1e3;return new Date(p)}}return null}},{key:"currentLevel",get:function(){var x=this.currentFrag;return x?x.level:-1}},{key:"nextBufferedFrag",get:function(){var x=this.currentFrag;return x?this.followingBufferedFrag(x):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),r}(e.default)},"./src/controller/subtitle-stream-controller.ts":function(R,M,i){i.r(M),i.d(M,"SubtitleStreamController",function(){return t});var a=i("./src/events.ts"),e=i("./src/utils/buffer-helper.ts"),c=i("./src/controller/fragment-finders.ts"),O=i("./src/utils/discontinuities.ts"),S=i("./src/controller/level-helper.ts"),L=i("./src/controller/fragment-tracker.ts"),u=i("./src/controller/base-stream-controller.ts"),n=i("./src/types/loader.ts"),f=i("./src/types/level.ts");function h(s,g){for(var E=0;E<g.length;E++){var d=g[E];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(s,d.key,d)}}function m(s,g,E){return g&&h(s.prototype,g),E&&h(s,E),Object.defineProperty(s,"prototype",{writable:!1}),s}function v(s,g){s.prototype=Object.create(g.prototype),s.prototype.constructor=s,T(s,g)}function T(s,g){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,r){return d.__proto__=r,d},T(s,g)}var o=500,t=function(s){v(g,s);function g(d,r){var l;return l=s.call(this,d,r,"[subtitle-stream-controller]")||this,l.levels=[],l.currentTrackId=-1,l.tracksBuffered=[],l.mainDetails=null,l._registerListeners(),l}var E=g.prototype;return E.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},E._registerListeners=function(){var r=this.hls;r.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(a.Events.ERROR,this.onError,this),r.on(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},E._unregisterListeners=function(){var r=this.hls;r.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(a.Events.ERROR,this.onError,this),r.off(a.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(a.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(a.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(a.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},E.startLoad=function(){this.stopLoad(),this.state=u.State.IDLE,this.setInterval(o),this.tick()},E.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},E.onLevelLoaded=function(r,l){this.mainDetails=l.details},E.onSubtitleFragProcessed=function(r,l){var A=l.frag,x=l.success;if(this.fragPrevious=A,this.state=u.State.IDLE,!!x){var b=this.tracksBuffered[this.currentTrackId];if(!!b){for(var D,p=A.start,y=0;y<b.length;y++)if(p>=b[y].start&&p<=b[y].end){D=b[y];break}var I=A.start+A.duration;D?D.end=I:(D={start:p,end:I},b.push(D)),this.fragmentTracker.fragBuffered(A)}}},E.onBufferFlushing=function(r,l){var A=l.startOffset,x=l.endOffset;if(A===0&&x!==Number.POSITIVE_INFINITY){var b=this.currentTrackId,D=this.levels;if(!D.length||!D[b]||!D[b].details)return;var p=D[b].details,y=p.targetduration,I=x-y;if(I<=0)return;l.endOffsetSubtitles=Math.max(0,I),this.tracksBuffered.forEach(function(C){for(var P=0;P<C.length;){if(C[P].end<=I){C.shift();continue}else if(C[P].start<I)C[P].start=I;else break;P++}}),this.fragmentTracker.removeFragmentsInRange(A,I,n.PlaylistLevelType.SUBTITLE)}},E.onError=function(r,l){var A,x=l.frag;!x||x.type!==n.PlaylistLevelType.SUBTITLE||((A=this.fragCurrent)!==null&&A!==void 0&&A.loader&&this.fragCurrent.loader.abort(),this.state=u.State.IDLE)},E.onSubtitleTracksUpdated=function(r,l){var A=this,x=l.subtitleTracks;this.tracksBuffered=[],this.levels=x.map(function(b){return new f.Level(b)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(b){A.tracksBuffered[b.id]=[]}),this.mediaBuffer=null},E.onSubtitleTrackSwitch=function(r,l){if(this.currentTrackId=l.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var A=this.levels[this.currentTrackId];A!=null&&A.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,A&&this.setInterval(o)},E.onSubtitleTrackLoaded=function(r,l){var A,x=l.details,b=l.id,D=this.currentTrackId,p=this.levels;if(!!p.length){var y=p[D];if(!(b>=p.length||b!==D||!y)){if(this.mediaBuffer=this.mediaBufferTimeRanges,x.live||(A=y.details)!==null&&A!==void 0&&A.live){var I=this.mainDetails;if(x.deltaUpdateFailed||!I)return;var C=I.fragments[0];if(!y.details)x.hasProgramDateTime&&I.hasProgramDateTime?Object(O.alignMediaPlaylistByPDT)(x,I):C&&Object(S.addSliding)(x,C.start);else{var P=this.alignPlaylists(x,y.details);P===0&&C&&Object(S.addSliding)(x,C.start)}}if(y.details=x,this.levelLastLoaded=b,this.tick(),x.live&&!this.fragCurrent&&this.media&&this.state===u.State.IDLE){var w=Object(c.findFragmentByPTS)(null,x.fragments,this.media.currentTime,0);w||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0)}}}},E._handleFragmentLoadComplete=function(r){var l=r.frag,A=r.payload,x=l.decryptdata,b=this.hls;if(!this.fragContextChanged(l)&&A&&A.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var D=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(A),x.key.buffer,x.iv.buffer).then(function(p){var y=performance.now();b.trigger(a.Events.FRAG_DECRYPTED,{frag:l,payload:p,stats:{tstart:D,tdecrypt:y}})})}},E.doTick=function(){if(!this.media){this.state=u.State.IDLE;return}if(this.state===u.State.IDLE){var r=this.currentTrackId,l=this.levels;if(!l.length||!l[r]||!l[r].details)return;var A=l[r].details,x=A.targetduration,b=this.config,D=this.media,p=e.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,D.currentTime-x,b.maxBufferHole),y=p.end,I=p.len,C=this.getMaxBufferLength()+x;if(I>C)return;console.assert(A,"Subtitle track details are defined on idle subtitle stream controller tick");var P=A.fragments,w=P.length,k=A.edge,F,_=this.fragPrevious;if(y<k){var B=b.maxFragLookUpTolerance;F=Object(c.findFragmentByPTS)(_,P,Math.max(P[0].start,y),B),!F&&_&&_.start<P[0].start&&(F=P[0])}else F=P[w-1];if(F=this.mapToInitFragWhenRequired(F),!F)return;F.encrypted?this.loadKey(F,A):this.fragmentTracker.getState(F)===L.FragmentState.NOT_LOADED&&this.loadFragment(F,A,y)}},E.loadFragment=function(r,l,A){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r):s.prototype.loadFragment.call(this,r,l,A)},m(g,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),g}(u.default)},"./src/controller/subtitle-track-controller.ts":function(R,M,i){i.r(M);var a=i("./src/events.ts"),e=i("./src/utils/texttrack-utils.ts"),c=i("./src/controller/base-playlist-controller.ts"),O=i("./src/types/loader.ts");function S(m,v){for(var T=0;T<v.length;T++){var o=v[T];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(m,o.key,o)}}function L(m,v,T){return v&&S(m.prototype,v),T&&S(m,T),Object.defineProperty(m,"prototype",{writable:!1}),m}function u(m,v){m.prototype=Object.create(v.prototype),m.prototype.constructor=m,n(m,v)}function n(m,v){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},n(m,v)}var f=function(m){u(v,m);function v(o){var t;return t=m.call(this,o,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t._subtitleDisplay=!0,t.registerListeners(),t}var T=v.prototype;return T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},T.registerListeners=function(){var t=this.hls;t.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(a.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var t=this.hls;t.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(a.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(a.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(a.Events.ERROR,this.onError,this)},T.onMediaAttached=function(t,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},T.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},T.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=h(this.media.textTracks);t.forEach(function(s){Object(e.clearCurrentCues)(s)}),this.subtitleTrack=-1,this.media=null}},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},T.onManifestParsed=function(t,s){this.tracks=s.subtitleTracks},T.onSubtitleTrackLoaded=function(t,s){var g=s.id,E=s.details,d=this.trackId,r=this.tracksInGroup[d];if(!r){this.warn("Invalid subtitle track id "+g);return}var l=r.details;r.details=s.details,this.log("subtitle track "+g+" loaded ["+E.startSN+"-"+E.endSN+"]"),g===this.trackId&&(this.retryCount=0,this.playlistLoaded(g,s,l))},T.onLevelLoading=function(t,s){this.switchLevel(s.level)},T.onLevelSwitching=function(t,s){this.switchLevel(s.level)},T.switchLevel=function(t){var s=this.hls.levels[t];if(!!(s!=null&&s.textGroupIds)){var g=s.textGroupIds[s.urlId];if(this.groupId!==g){var E=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,d=this.tracks.filter(function(A){return!g||A.groupId===g});this.tracksInGroup=d;var r=this.findTrackId(E==null?void 0:E.name)||this.findTrackId();this.groupId=g;var l={subtitleTracks:d};this.log("Updating subtitle tracks, "+d.length+' track(s) found in "'+g+'" group-id'),this.hls.trigger(a.Events.SUBTITLE_TRACKS_UPDATED,l),r!==-1&&this.setSubtitleTrack(r,E)}}},T.findTrackId=function(t){for(var s=this.tracksInGroup,g=0;g<s.length;g++){var E=s[g];if((!this.selectDefaultTrack||E.default)&&(!t||t===E.name))return E.id}return-1},T.onError=function(t,s){m.prototype.onError.call(this,t,s),!(s.fatal||!s.context)&&s.context.type===O.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},T.loadPlaylist=function(t){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var g=s.id,E=s.groupId,d=s.url;if(t)try{d=t.addDirectives(d)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+g),this.hls.trigger(a.Events.SUBTITLE_TRACK_LOADING,{url:d,id:g,groupId:E,deliveryDirectives:t||null})}},T.toggleTrackModes=function(t){var s=this,g=this.media,E=this.trackId;if(!!g){var d=h(g.textTracks),r=d.filter(function(x){return x.groupId===s.groupId});if(t===-1)[].slice.call(d).forEach(function(x){x.mode="disabled"});else{var l=r[E];l&&(l.mode="disabled")}var A=r[t];A&&(A.mode=this.subtitleDisplay?"showing":"hidden")}},T.setSubtitleTrack=function(t,s){var g,E=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(g=E[t])!==null&&g!==void 0&&g.details)||t<-1||t>=E.length)){this.clearTimer();var d=E[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,d){var r=d.id,l=d.groupId,A=l===void 0?"":l,x=d.name,b=d.type,D=d.url;this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:r,groupId:A,name:x,type:b,url:D});var p=this.switchParams(d.url,s==null?void 0:s.details);this.loadPlaylist(p)}else this.hls.trigger(a.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},T.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,s=h(this.media.textTracks),g=0;g<s.length;g++)if(s[g].mode==="hidden")t=g;else if(s[g].mode==="showing"){t=g;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},L(v,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,s)}}]),v}(c.default);function h(m){for(var v=[],T=0;T<m.length;T++){var o=m[T];o.kind==="subtitles"&&o.label&&v.push(m[T])}return v}M.default=f},"./src/controller/timeline-controller.ts":function(R,M,i){i.r(M),i.d(M,"TimelineController",function(){return m});var a=i("./src/polyfills/number.ts"),e=i("./src/events.ts"),c=i("./src/utils/cea-608-parser.ts"),O=i("./src/utils/output-filter.ts"),S=i("./src/utils/webvtt-parser.ts"),L=i("./src/utils/texttrack-utils.ts"),u=i("./src/utils/imsc1-ttml-parser.ts"),n=i("./src/utils/mp4-tools.ts"),f=i("./src/types/loader.ts"),h=i("./src/utils/logger.ts"),m=function(){function t(g){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this.captionsProperties=void 0,this.hls=g,this.config=g.config,this.Cues=g.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var E=new O.default(this,"textTrack1"),d=new O.default(this,"textTrack2"),r=new O.default(this,"textTrack3"),l=new O.default(this,"textTrack4");this.cea608Parser1=new c.default(1,E,d),this.cea608Parser2=new c.default(3,r,l)}g.on(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),g.on(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.on(e.Events.FRAG_LOADING,this.onFragLoading,this),g.on(e.Events.FRAG_LOADED,this.onFragLoaded,this),g.on(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),g.on(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),g.on(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),g.on(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),g.on(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var s=t.prototype;return s.destroy=function(){var E=this.hls;E.off(e.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),E.off(e.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(e.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.off(e.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.off(e.Events.FRAG_LOADING,this.onFragLoading,this),E.off(e.Events.FRAG_LOADED,this.onFragLoaded,this),E.off(e.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),E.off(e.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),E.off(e.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),E.off(e.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),E.off(e.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},s.addCues=function(E,d,r,l,A){for(var x=!1,b=A.length;b--;){var D=A[b],p=T(D[0],D[1],d,r);if(p>=0&&(D[0]=Math.min(D[0],d),D[1]=Math.max(D[1],r),x=!0,p/(r-d)>.5))return}if(x||A.push([d,r]),this.config.renderTextTracksNatively){var y=this.captionsTracks[E];this.Cues.newCue(y,d,r,l)}else{var I=this.Cues.newCue(null,d,r,l);this.hls.trigger(e.Events.CUES_PARSED,{type:"captions",cues:I,track:E})}},s.onInitPtsFound=function(E,d){var r=this,l=d.frag,A=d.id,x=d.initPTS,b=d.timescale,D=this.unparsedVttFrags;A==="main"&&(this.initPTS[l.cc]=x,this.timescale[l.cc]=b),D.length&&(this.unparsedVttFrags=[],D.forEach(function(p){r.onFragLoaded(e.Events.FRAG_LOADED,p)}))},s.getExistingTrack=function(E){var d=this.media;if(d)for(var r=0;r<d.textTracks.length;r++){var l=d.textTracks[r];if(l[E])return l}return null},s.createCaptionsTrack=function(E){this.config.renderTextTracksNatively?this.createNativeTrack(E):this.createNonNativeTrack(E)},s.createNativeTrack=function(E){if(!this.captionsTracks[E]){var d=this.captionsProperties,r=this.captionsTracks,l=this.media,A=d[E],x=A.label,b=A.languageCode,D=this.getExistingTrack(E);if(D)r[E]=D,Object(L.clearCurrentCues)(r[E]),Object(L.sendAddTrackEvent)(r[E],l);else{var p=this.createTextTrack("captions",x,b);p&&(p[E]=!0,r[E]=p)}}},s.createNonNativeTrack=function(E){if(!this.nonNativeCaptionsTracks[E]){var d=this.captionsProperties[E];if(!!d){var r=d.label,l={_id:E,label:r,kind:"captions",default:d.media?!!d.media.default:!1,closedCaptions:d.media};this.nonNativeCaptionsTracks[E]=l,this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[l]})}}},s.createTextTrack=function(E,d,r){var l=this.media;if(!!l)return l.addTextTrack(E,d,r)},s.onMediaAttaching=function(E,d){this.media=d.media,this._cleanTracks()},s.onMediaDetaching=function(){var E=this.captionsTracks;Object.keys(E).forEach(function(d){Object(L.clearCurrentCues)(E[d]),delete E[d]}),this.nonNativeCaptionsTracks={}},s.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=o(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},s._cleanTracks=function(){var E=this.media;if(!!E){var d=E.textTracks;if(d)for(var r=0;r<d.length;r++)Object(L.clearCurrentCues)(d[r])}},s.onSubtitleTracksUpdated=function(E,d){var r=this;this.textTracks=[];var l=d.subtitleTracks||[],A=l.some(function(p){return p.textCodec===u.IMSC1_CODEC});if(this.config.enableWebVTT||A&&this.config.enableIMSC1){var x=this.tracks&&l&&this.tracks.length===l.length;if(this.tracks=l||[],this.config.renderTextTracksNatively){var b=this.media?this.media.textTracks:[];this.tracks.forEach(function(p,y){var I;if(y<b.length){for(var C=null,P=0;P<b.length;P++)if(v(b[P],p)){C=b[P];break}C&&(I=C)}if(I)Object(L.clearCurrentCues)(I);else{var w=r._captionsOrSubtitlesFromCharacteristics(p);I=r.createTextTrack(w,p.name,p.lang),I&&(I.mode="disabled")}I&&(I.groupId=p.groupId,r.textTracks.push(I))})}else if(!x&&this.tracks&&this.tracks.length){var D=this.tracks.map(function(p){return{label:p.name,kind:p.type.toLowerCase(),default:p.default,subtitleTrack:p}});this.hls.trigger(e.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:D})}}},s._captionsOrSubtitlesFromCharacteristics=function(E){var d;if((d=E.attrs)!==null&&d!==void 0&&d.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(E.attrs.CHARACTERISTICS),l=/describes-music-and-sound/gi.test(E.attrs.CHARACTERISTICS);if(r&&l)return"captions"}return"subtitles"},s.onManifestLoaded=function(E,d){var r=this;this.config.enableCEA708Captions&&d.captions&&d.captions.forEach(function(l){var A=/(?:CC|SERVICE)([1-4])/.exec(l.instreamId);if(!!A){var x="textTrack"+A[1],b=r.captionsProperties[x];!b||(b.label=l.name,l.lang&&(b.languageCode=l.lang),b.media=l)}})},s.onFragLoading=function(E,d){var r=this.cea608Parser1,l=this.cea608Parser2,A=this.lastSn,x=this.lastPartIndex;if(!(!this.enabled||!(r&&l))&&d.frag.type===f.PlaylistLevelType.MAIN){var b,D,p=d.frag.sn,y=(b=d==null||(D=d.part)===null||D===void 0?void 0:D.index)!=null?b:-1;p===A+1||p===A&&y===x+1||(r.reset(),l.reset()),this.lastSn=p,this.lastPartIndex=y}},s.onFragLoaded=function(E,d){var r=d.frag,l=d.payload,A=this.initPTS,x=this.unparsedVttFrags;if(r.type===f.PlaylistLevelType.SUBTITLE)if(l.byteLength){if(!Object(a.isFiniteNumber)(A[r.cc])){x.push(d),A.length&&this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")});return}var b=r.decryptdata,D="stats"in d;if(b==null||b.key==null||b.method!=="AES-128"||D){var p=this.tracks[r.level],y=this.vttCCs;y[r.cc]||(y[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),p&&p.textCodec===u.IMSC1_CODEC?this._parseIMSC1(r,l):this._parseVTTs(r,l,y)}}else this.hls.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},s._parseIMSC1=function(E,d){var r=this,l=this.hls;Object(u.parseIMSC1)(d,this.initPTS[E.cc],this.timescale[E.cc],function(A){r._appendCues(A,E.level),l.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:E})},function(A){h.logger.log("Failed to parse IMSC1: "+A),l.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:A})})},s._parseVTTs=function(E,d,r){var l,A=this,x=this.hls,b=(l=E.initSegment)!==null&&l!==void 0&&l.data?Object(n.appendUint8Array)(E.initSegment.data,new Uint8Array(d)):d;Object(S.parseWebVTT)(b,this.initPTS[E.cc],this.timescale[E.cc],r,E.cc,E.start,function(D){A._appendCues(D,E.level),x.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:E})},function(D){A._fallbackToIMSC1(E,d),h.logger.log("Failed to parse VTT cue: "+D),x.trigger(e.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:E,error:D})})},s._fallbackToIMSC1=function(E,d){var r=this,l=this.tracks[E.level];l.textCodec||Object(u.parseIMSC1)(d,this.initPTS[E.cc],this.timescale[E.cc],function(){l.textCodec=u.IMSC1_CODEC,r._parseIMSC1(E,d)},function(){l.textCodec="wvtt"})},s._appendCues=function(E,d){var r=this.hls;if(this.config.renderTextTracksNatively){var l=this.textTracks[d];if(!l||l.mode==="disabled")return;E.forEach(function(b){return Object(L.addCueToTrack)(l,b)})}else{var A=this.tracks[d];if(!A)return;var x=A.default?"default":"subtitles"+d;r.trigger(e.Events.CUES_PARSED,{type:"subtitles",cues:E,track:x})}},s.onFragDecrypted=function(E,d){var r=d.frag;if(r.type===f.PlaylistLevelType.SUBTITLE){if(!Object(a.isFiniteNumber)(this.initPTS[r.cc])){this.unparsedVttFrags.push(d);return}this.onFragLoaded(e.Events.FRAG_LOADED,d)}},s.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},s.onFragParsingUserdata=function(E,d){var r=this.cea608Parser1,l=this.cea608Parser2;if(!(!this.enabled||!(r&&l)))for(var A=0;A<d.samples.length;A++){var x=d.samples[A].bytes;if(x){var b=this.extractCea608Data(x);r.addData(d.samples[A].pts,b[0]),l.addData(d.samples[A].pts,b[1])}}},s.onBufferFlushing=function(E,d){var r=d.startOffset,l=d.endOffset,A=d.endOffsetSubtitles,x=d.type,b=this.media;if(!(!b||b.currentTime<l)){if(!x||x==="video"){var D=this.captionsTracks;Object.keys(D).forEach(function(y){return Object(L.removeCuesInRange)(D[y],r,l)})}if(this.config.renderTextTracksNatively&&r===0&&A!==void 0){var p=this.textTracks;Object.keys(p).forEach(function(y){return Object(L.removeCuesInRange)(p[y],r,A)})}}},s.extractCea608Data=function(E){for(var d=[[],[]],r=E[0]&31,l=2,A=0;A<r;A++){var x=E[l++],b=127&E[l++],D=127&E[l++];if(!(b===0&&D===0)){var p=(4&x)!==0;if(p){var y=3&x;(y===0||y===1)&&(d[y].push(b),d[y].push(D))}}}return d},t}();function v(t,s){return t&&t.label===s.name&&!(t.textTrack1||t.textTrack2)}function T(t,s,g,E){return Math.min(s,E)-Math.max(t,g)}function o(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return a});var a=function(){function e(O,S){this.subtle=void 0,this.aesIV=void 0,this.subtle=O,this.aesIV=S}var c=e.prototype;return c.decrypt=function(S,L){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},L,S)},e}()},"./src/crypt/aes-decryptor.ts":function(R,M,i){i.r(M),i.d(M,"removePadding",function(){return e}),i.d(M,"default",function(){return c});var a=i("./src/utils/typed-array.ts");function e(O){var S=O.byteLength,L=S&&new DataView(O.buffer).getUint8(S-1);return L?Object(a.sliceUint8)(O,0,S-L):O}var c=function(){function O(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var S=O.prototype;return S.uint8ArrayToUint32Array_=function(u){for(var n=new DataView(u),f=new Uint32Array(4),h=0;h<4;h++)f[h]=n.getUint32(h*4);return f},S.initTable=function(){var u=this.sBox,n=this.invSBox,f=this.subMix,h=f[0],m=f[1],v=f[2],T=f[3],o=this.invSubMix,t=o[0],s=o[1],g=o[2],E=o[3],d=new Uint32Array(256),r=0,l=0,A=0;for(A=0;A<256;A++)A<128?d[A]=A<<1:d[A]=A<<1^283;for(A=0;A<256;A++){var x=l^l<<1^l<<2^l<<3^l<<4;x=x>>>8^x&255^99,u[r]=x,n[x]=r;var b=d[r],D=d[b],p=d[D],y=d[x]*257^x*16843008;h[r]=y<<24|y>>>8,m[r]=y<<16|y>>>16,v[r]=y<<8|y>>>24,T[r]=y,y=p*16843009^D*65537^b*257^r*16843008,t[x]=y<<24|y>>>8,s[x]=y<<16|y>>>16,g[x]=y<<8|y>>>24,E[x]=y,r?(r=b^d[d[d[p^b]]],l^=d[d[l]]):r=l=1}},S.expandKey=function(u){for(var n=this.uint8ArrayToUint32Array_(u),f=!0,h=0;h<n.length&&f;)f=n[h]===this.key[h],h++;if(!f){this.key=n;var m=this.keySize=n.length;if(m!==4&&m!==6&&m!==8)throw new Error("Invalid aes key size="+m);var v=this.ksRows=(m+6+1)*4,T,o,t=this.keySchedule=new Uint32Array(v),s=this.invKeySchedule=new Uint32Array(v),g=this.sBox,E=this.rcon,d=this.invSubMix,r=d[0],l=d[1],A=d[2],x=d[3],b,D;for(T=0;T<v;T++){if(T<m){b=t[T]=n[T];continue}D=b,T%m===0?(D=D<<8|D>>>24,D=g[D>>>24]<<24|g[D>>>16&255]<<16|g[D>>>8&255]<<8|g[D&255],D^=E[T/m|0]<<24):m>6&&T%m===4&&(D=g[D>>>24]<<24|g[D>>>16&255]<<16|g[D>>>8&255]<<8|g[D&255]),t[T]=b=(t[T-m]^D)>>>0}for(o=0;o<v;o++)T=v-o,o&3?D=t[T]:D=t[T-4],o<4||T<=4?s[o]=D:s[o]=r[g[D>>>24]]^l[g[D>>>16&255]]^A[g[D>>>8&255]]^x[g[D&255]],s[o]=s[o]>>>0}},S.networkToHostOrderSwap=function(u){return u<<24|(u&65280)<<8|(u&16711680)>>8|u>>>24},S.decrypt=function(u,n,f){for(var h=this.keySize+6,m=this.invKeySchedule,v=this.invSBox,T=this.invSubMix,o=T[0],t=T[1],s=T[2],g=T[3],E=this.uint8ArrayToUint32Array_(f),d=E[0],r=E[1],l=E[2],A=E[3],x=new Int32Array(u),b=new Int32Array(x.length),D,p,y,I,C,P,w,k,F,_,B,N,U,j,K=this.networkToHostOrderSwap;n<x.length;){for(F=K(x[n]),_=K(x[n+1]),B=K(x[n+2]),N=K(x[n+3]),C=F^m[0],P=N^m[1],w=B^m[2],k=_^m[3],U=4,j=1;j<h;j++)D=o[C>>>24]^t[P>>16&255]^s[w>>8&255]^g[k&255]^m[U],p=o[P>>>24]^t[w>>16&255]^s[k>>8&255]^g[C&255]^m[U+1],y=o[w>>>24]^t[k>>16&255]^s[C>>8&255]^g[P&255]^m[U+2],I=o[k>>>24]^t[C>>16&255]^s[P>>8&255]^g[w&255]^m[U+3],C=D,P=p,w=y,k=I,U=U+4;D=v[C>>>24]<<24^v[P>>16&255]<<16^v[w>>8&255]<<8^v[k&255]^m[U],p=v[P>>>24]<<24^v[w>>16&255]<<16^v[k>>8&255]<<8^v[C&255]^m[U+1],y=v[w>>>24]<<24^v[k>>16&255]<<16^v[C>>8&255]<<8^v[P&255]^m[U+2],I=v[k>>>24]<<24^v[C>>16&255]<<16^v[P>>8&255]<<8^v[w&255]^m[U+3],b[n]=K(D^d),b[n+1]=K(I^r),b[n+2]=K(y^l),b[n+3]=K(p^A),d=F,r=_,l=B,A=N,n=n+4}return b.buffer},O}()},"./src/crypt/decrypter.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return n});var a=i("./src/crypt/aes-crypto.ts"),e=i("./src/crypt/fast-aes-key.ts"),c=i("./src/crypt/aes-decryptor.ts"),O=i("./src/utils/logger.ts"),S=i("./src/utils/mp4-tools.ts"),L=i("./src/utils/typed-array.ts"),u=16,n=function(){function f(m,v,T){var o=T===void 0?{}:T,t=o.removePKCS7Padding,s=t===void 0?!0:t;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=m,this.config=v,this.removePKCS7Padding=s,s)try{var g=self.crypto;g&&(this.subtle=g.subtle||g.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var h=f.prototype;return h.destroy=function(){this.observer=null},h.isSync=function(){return this.config.enableSoftwareAES},h.flush=function(){var v=this.currentResult;if(!v){this.reset();return}var T=new Uint8Array(v);return this.reset(),this.removePKCS7Padding?Object(c.removePadding)(T):T},h.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},h.decrypt=function(v,T,o,t){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(v),T,o);var s=this.flush();s&&t(s.buffer)}else this.webCryptoDecrypt(new Uint8Array(v),T,o).then(t)},h.softwareDecrypt=function(v,T,o){var t=this.currentIV,s=this.currentResult,g=this.remainderData;this.logOnce("JS AES decrypt"),g&&(v=Object(S.appendUint8Array)(g,v),this.remainderData=null);var E=this.getValidChunk(v);if(!E.length)return null;t&&(o=t);var d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new c.default),d.expandKey(T);var r=s;return this.currentResult=d.decrypt(E.buffer,0,o),this.currentIV=Object(L.sliceUint8)(E,-16).buffer,r||null},h.webCryptoDecrypt=function(v,T,o){var t=this,s=this.subtle;return(this.key!==T||!this.fastAesKey)&&(this.key=T,this.fastAesKey=new e.default(s,T)),this.fastAesKey.expandKey().then(function(g){if(!s)return Promise.reject(new Error("web crypto not initialized"));var E=new a.default(s,o);return E.decrypt(v.buffer,g)}).catch(function(g){return t.onWebCryptoError(g,v,T,o)})},h.onWebCryptoError=function(v,T,o,t){return O.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",v),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(T,o,t)},h.getValidChunk=function(v){var T=v,o=v.length-v.length%u;return o!==v.length&&(T=Object(L.sliceUint8)(v,0,o),this.remainderData=Object(L.sliceUint8)(v,o)),T},h.logOnce=function(v){!this.logEnabled||(O.logger.log("[decrypter.ts]: "+v),this.logEnabled=!1)},f}()},"./src/crypt/fast-aes-key.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return a});var a=function(){function e(O,S){this.subtle=void 0,this.key=void 0,this.subtle=O,this.key=S}var c=e.prototype;return c.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}()},"./src/demux/aacdemuxer.ts":function(R,M,i){i.r(M);var a=i("./src/demux/base-audio-demuxer.ts"),e=i("./src/demux/adts.ts"),c=i("./src/utils/logger.ts"),O=i("./src/demux/id3.ts");function S(n,f){n.prototype=Object.create(f.prototype),n.prototype.constructor=n,L(n,f)}function L(n,f){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,v){return m.__proto__=v,m},L(n,f)}var u=function(n){S(f,n);function f(m,v){var T;return T=n.call(this)||this,T.observer=void 0,T.config=void 0,T.observer=m,T.config=v,T}var h=f.prototype;return h.resetInitSegment=function(v,T,o,t){n.prototype.resetInitSegment.call(this,v,T,o,t),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:T,duration:t,inputTimeScale:9e4,dropped:0}},f.probe=function(v){if(!v)return!1;for(var T=O.getID3Data(v,0)||[],o=T.length,t=v.length;o<t;o++)if(e.probe(v,o))return c.logger.log("ADTS sync word found !"),!0;return!1},h.canParse=function(v,T){return e.canParse(v,T)},h.appendFrame=function(v,T,o){e.initTrackConfig(v,this.observer,T,o,v.manifestCodec);var t=e.appendFrame(v,T,o,this.basePTS,this.frameIndex);if(t&&t.missing===0)return t},f}(a.default);u.minProbeByteLength=9,M.default=u},"./src/demux/adts.ts":function(R,M,i){i.r(M),i.d(M,"getAudioConfig",function(){return O}),i.d(M,"isHeaderPattern",function(){return S}),i.d(M,"getHeaderLength",function(){return L}),i.d(M,"getFullFrameLength",function(){return u}),i.d(M,"canGetFrameLength",function(){return n}),i.d(M,"isHeader",function(){return f}),i.d(M,"canParse",function(){return h}),i.d(M,"probe",function(){return m}),i.d(M,"initTrackConfig",function(){return v}),i.d(M,"getFrameDuration",function(){return T}),i.d(M,"parseFrameHeader",function(){return o}),i.d(M,"appendFrame",function(){return t});var a=i("./src/utils/logger.ts"),e=i("./src/errors.ts"),c=i("./src/events.ts");function O(s,g,E,d){var r,l,A,x,b=navigator.userAgent.toLowerCase(),D=d,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=((g[E+2]&192)>>>6)+1;var y=(g[E+2]&60)>>>2;if(y>p.length-1){s.trigger(c.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+y});return}return A=(g[E+2]&1)<<2,A|=(g[E+3]&192)>>>6,a.logger.log("manifest codec:"+d+", ADTS type:"+r+", samplingIndex:"+y),/firefox/i.test(b)?y>=6?(r=5,x=new Array(4),l=y-3):(r=2,x=new Array(2),l=y):b.indexOf("android")!==-1?(r=2,x=new Array(2),l=y):(r=5,x=new Array(4),d&&(d.indexOf("mp4a.40.29")!==-1||d.indexOf("mp4a.40.5")!==-1)||!d&&y>=6?l=y-3:((d&&d.indexOf("mp4a.40.2")!==-1&&(y>=6&&A===1||/vivaldi/i.test(b))||!d&&A===1)&&(r=2,x=new Array(2)),l=y)),x[0]=r<<3,x[0]|=(y&14)>>1,x[1]|=(y&1)<<7,x[1]|=A<<3,r===5&&(x[1]|=(l&14)>>1,x[2]=(l&1)<<7,x[2]|=2<<2,x[3]=0),{config:x,samplerate:p[y],channelCount:A,codec:"mp4a.40."+r,manifestCodec:D}}function S(s,g){return s[g]===255&&(s[g+1]&246)===240}function L(s,g){return s[g+1]&1?7:9}function u(s,g){return(s[g+3]&3)<<11|s[g+4]<<3|(s[g+5]&224)>>>5}function n(s,g){return g+5<s.length}function f(s,g){return g+1<s.length&&S(s,g)}function h(s,g){return n(s,g)&&S(s,g)&&u(s,g)<=s.length-g}function m(s,g){if(f(s,g)){var E=L(s,g);if(g+E>=s.length)return!1;var d=u(s,g);if(d<=E)return!1;var r=g+d;return r===s.length||f(s,r)}return!1}function v(s,g,E,d,r){if(!s.samplerate){var l=O(g,E,d,r);if(!l)return;s.config=l.config,s.samplerate=l.samplerate,s.channelCount=l.channelCount,s.codec=l.codec,s.manifestCodec=l.manifestCodec,a.logger.log("parsed codec:"+s.codec+", rate:"+l.samplerate+", channels:"+l.channelCount)}}function T(s){return 1024*9e4/s}function o(s,g){var E=L(s,g);if(g+E<=s.length){var d=u(s,g)-E;if(d>0)return{headerLength:E,frameLength:d}}}function t(s,g,E,d,r){var l=T(s.samplerate),A=d+r*l,x=o(g,E),b;if(x){var D=x.frameLength,p=x.headerLength,y=p+D,I=Math.max(0,E+y-g.length);I?(b=new Uint8Array(y-p),b.set(g.subarray(E+p,g.length),0)):b=g.subarray(E+p,E+y);var C={unit:b,pts:A};return I||s.samples.push(C),{sample:C,length:y,missing:I}}var P=g.length-E;b=new Uint8Array(P),b.set(g.subarray(E,g.length),0);var w={unit:b,pts:A};return{sample:w,length:P,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(R,M,i){i.r(M),i.d(M,"initPTSFn",function(){return n});var a=i("./src/polyfills/number.ts"),e=i("./src/demux/id3.ts"),c=i("./src/types/demuxer.ts"),O=i("./src/demux/dummy-demuxed-track.ts"),S=i("./src/utils/mp4-tools.ts"),L=i("./src/utils/typed-array.ts"),u=function(){function f(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var h=f.prototype;return h.resetInitSegment=function(v,T,o,t){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},h.resetTimeStamp=function(v){this.initPTS=v,this.resetContiguity()},h.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},h.canParse=function(v,T){return!1},h.appendFrame=function(v,T,o){},h.demux=function(v,T){this.cachedData&&(v=Object(S.appendUint8Array)(this.cachedData,v),this.cachedData=null);var o=e.getID3Data(v,0),t=o?o.length:0,s,g,E=this._audioTrack,d=this._id3Track,r=o?e.getTimeStamp(o):void 0,l=v.length;for((this.basePTS===null||this.frameIndex===0&&Object(a.isFiniteNumber)(r))&&(this.basePTS=n(r,T,this.initPTS)),o&&o.length>0&&d.samples.push({pts:this.basePTS,dts:this.basePTS,data:o,type:c.MetadataSchema.audioId3}),g=this.basePTS;t<l;){if(this.canParse(v,t)){var A=this.appendFrame(E,v,t);A?(this.frameIndex++,g=A.sample.pts,t+=A.length,s=t):t=l}else e.canParse(v,t)?(o=e.getID3Data(v,t),d.samples.push({pts:g,dts:g,data:o,type:c.MetadataSchema.audioId3}),t+=o.length,s=t):t++;if(t===l&&s!==l){var x=Object(L.sliceUint8)(v,s);this.cachedData?this.cachedData=Object(S.appendUint8Array)(this.cachedData,x):this.cachedData=x}}return{audioTrack:E,videoTrack:Object(O.dummyTrack)(),id3Track:d,textTrack:Object(O.dummyTrack)()}},h.demuxSampleAes=function(v,T,o){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},h.flush=function(v){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),{audioTrack:this._audioTrack,videoTrack:Object(O.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(O.dummyTrack)()}},h.destroy=function(){},f}(),n=function(h,m,v){return Object(a.isFiniteNumber)(h)?h*90:m*9e4+(v||0)};M.default=u},"./src/demux/chunk-cache.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return a});var a=function(){function c(){this.chunks=[],this.dataLength=0}var O=c.prototype;return O.push=function(L){this.chunks.push(L),this.dataLength+=L.length},O.flush=function(){var L=this.chunks,u=this.dataLength,n;if(L.length)L.length===1?n=L[0]:n=e(L,u);else return new Uint8Array(0);return this.reset(),n},O.reset=function(){this.chunks.length=0,this.dataLength=0},c}();function e(c,O){for(var S=new Uint8Array(O),L=0,u=0;u<c.length;u++){var n=c[u];S.set(n,L),L+=n.length}return S}},"./src/demux/dummy-demuxed-track.ts":function(R,M,i){i.r(M),i.d(M,"dummyTrack",function(){return a});function a(e,c){return e===void 0&&(e=""),c===void 0&&(c=9e4),{type:e,id:-1,pid:-1,inputTimeScale:c,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(R,M,i){i.r(M);var a=i("./src/utils/logger.ts"),e=function(){function c(S){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=S,this.bytesAvailable=S.byteLength,this.word=0,this.bitsAvailable=0}var O=c.prototype;return O.loadWord=function(){var L=this.data,u=this.bytesAvailable,n=L.byteLength-u,f=new Uint8Array(4),h=Math.min(4,u);if(h===0)throw new Error("no bytes available");f.set(L.subarray(n,n+h)),this.word=new DataView(f.buffer).getUint32(0),this.bitsAvailable=h*8,this.bytesAvailable-=h},O.skipBits=function(L){var u;this.bitsAvailable>L?(this.word<<=L,this.bitsAvailable-=L):(L-=this.bitsAvailable,u=L>>3,L-=u>>3,this.bytesAvailable-=u,this.loadWord(),this.word<<=L,this.bitsAvailable-=L)},O.readBits=function(L){var u=Math.min(this.bitsAvailable,L),n=this.word>>>32-u;return L>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=u,this.bitsAvailable>0?this.word<<=u:this.bytesAvailable>0&&this.loadWord(),u=L-u,u>0&&this.bitsAvailable?n<<u|this.readBits(u):n},O.skipLZ=function(){var L;for(L=0;L<this.bitsAvailable;++L)if((this.word&2147483648>>>L)!==0)return this.word<<=L,this.bitsAvailable-=L,L;return this.loadWord(),L+this.skipLZ()},O.skipUEG=function(){this.skipBits(1+this.skipLZ())},O.skipEG=function(){this.skipBits(1+this.skipLZ())},O.readUEG=function(){var L=this.skipLZ();return this.readBits(L+1)-1},O.readEG=function(){var L=this.readUEG();return 1&L?1+L>>>1:-1*(L>>>1)},O.readBoolean=function(){return this.readBits(1)===1},O.readUByte=function(){return this.readBits(8)},O.readUShort=function(){return this.readBits(16)},O.readUInt=function(){return this.readBits(32)},O.skipScalingList=function(L){for(var u=8,n=8,f,h=0;h<L;h++)n!==0&&(f=this.readEG(),n=(u+f+256)%256),u=n===0?u:n},O.readSPS=function(){var L=0,u=0,n=0,f=0,h,m,v,T=this.readUByte.bind(this),o=this.readBits.bind(this),t=this.readUEG.bind(this),s=this.readBoolean.bind(this),g=this.skipBits.bind(this),E=this.skipEG.bind(this),d=this.skipUEG.bind(this),r=this.skipScalingList.bind(this);T();var l=T();if(o(5),g(3),T(),d(),l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128){var A=t();if(A===3&&g(1),d(),d(),g(1),s())for(m=A!==3?8:12,v=0;v<m;v++)s()&&(v<6?r(16):r(64))}d();var x=t();if(x===0)t();else if(x===1)for(g(1),E(),E(),h=t(),v=0;v<h;v++)E();d(),g(1);var b=t(),D=t(),p=o(1);p===0&&g(1),g(1),s()&&(L=t(),u=t(),n=t(),f=t());var y=[1,1];if(s()&&s()){var I=T();switch(I){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:{y=[T()<<8|T(),T()<<8|T()];break}}}return{width:Math.ceil((b+1)*16-L*2-u*2),height:(2-p)*(D+1)*16-(p?2:4)*(n+f),pixelRatio:y}},O.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},c}();M.default=e},"./src/demux/id3.ts":function(R,M,i){i.r(M),i.d(M,"isHeader",function(){return a}),i.d(M,"isFooter",function(){return e}),i.d(M,"getID3Data",function(){return c}),i.d(M,"canParse",function(){return S}),i.d(M,"getTimeStamp",function(){return L}),i.d(M,"isTimeStampFrame",function(){return u}),i.d(M,"getID3Frames",function(){return f}),i.d(M,"decodeFrame",function(){return h}),i.d(M,"utf8ArrayToStr",function(){return t}),i.d(M,"testables",function(){return s});var a=function(r,l){return l+10<=r.length&&r[l]===73&&r[l+1]===68&&r[l+2]===51&&r[l+3]<255&&r[l+4]<255&&r[l+6]<128&&r[l+7]<128&&r[l+8]<128&&r[l+9]<128},e=function(r,l){return l+10<=r.length&&r[l]===51&&r[l+1]===68&&r[l+2]===73&&r[l+3]<255&&r[l+4]<255&&r[l+6]<128&&r[l+7]<128&&r[l+8]<128&&r[l+9]<128},c=function(r,l){for(var A=l,x=0;a(r,l);){x+=10;var b=O(r,l+6);x+=b,e(r,l+10)&&(x+=10),l+=x}if(x>0)return r.subarray(A,A+x)},O=function(r,l){var A=0;return A=(r[l]&127)<<21,A|=(r[l+1]&127)<<14,A|=(r[l+2]&127)<<7,A|=r[l+3]&127,A},S=function(r,l){return a(r,l)&&O(r,l+6)+10<=r.length-l},L=function(r){for(var l=f(r),A=0;A<l.length;A++){var x=l[A];if(u(x))return o(x)}},u=function(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"},n=function(r){var l=String.fromCharCode(r[0],r[1],r[2],r[3]),A=O(r,4),x=10;return{type:l,size:A,data:r.subarray(x,x+A)}},f=function(r){for(var l=0,A=[];a(r,l);){var x=O(r,l+6);l+=10;for(var b=l+x;l+8<b;){var D=n(r.subarray(l)),p=h(D);p&&A.push(p),l+=D.size+10}e(r,l)&&(l+=10)}return A},h=function(r){return r.type==="PRIV"?m(r):r.type[0]==="W"?T(r):v(r)},m=function(r){if(!(r.size<2)){var l=t(r.data,!0),A=new Uint8Array(r.data.subarray(l.length+1));return{key:r.type,info:l,data:A.buffer}}},v=function(r){if(!(r.size<2)){if(r.type==="TXXX"){var l=1,A=t(r.data.subarray(l),!0);l+=A.length+1;var x=t(r.data.subarray(l));return{key:r.type,info:A,data:x}}var b=t(r.data.subarray(1));return{key:r.type,data:b}}},T=function(r){if(r.type==="WXXX"){if(r.size<2)return;var l=1,A=t(r.data.subarray(l),!0);l+=A.length+1;var x=t(r.data.subarray(l));return{key:r.type,info:A,data:x}}var b=t(r.data);return{key:r.type,data:b}},o=function(r){if(r.data.byteLength===8){var l=new Uint8Array(r.data),A=l[3]&1,x=(l[4]<<23)+(l[5]<<15)+(l[6]<<7)+l[7];return x/=45,A&&(x+=4772185884e-2),Math.round(x)}},t=function(r,l){l===void 0&&(l=!1);var A=E();if(A){var x=A.decode(r);if(l){var b=x.indexOf("\0");return b!==-1?x.substring(0,b):x}return x.replace(/\0/g,"")}for(var D=r.length,p,y,I,C="",P=0;P<D;){if(p=r[P++],p===0&&l)return C;if(p===0||p===3)continue;switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:C+=String.fromCharCode(p);break;case 12:case 13:y=r[P++],C+=String.fromCharCode((p&31)<<6|y&63);break;case 14:y=r[P++],I=r[P++],C+=String.fromCharCode((p&15)<<12|(y&63)<<6|(I&63)<<0);break}}return C},s={decodeTextFrame:v},g;function E(){return!g&&typeof self.TextDecoder<"u"&&(g=new self.TextDecoder("utf-8")),g}},"./src/demux/mp3demuxer.ts":function(R,M,i){i.r(M);var a=i("./src/demux/base-audio-demuxer.ts"),e=i("./src/demux/id3.ts"),c=i("./src/utils/logger.ts"),O=i("./src/demux/mpegaudio.ts");function S(n,f){n.prototype=Object.create(f.prototype),n.prototype.constructor=n,L(n,f)}function L(n,f){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,v){return m.__proto__=v,m},L(n,f)}var u=function(n){S(f,n);function f(){return n.apply(this,arguments)||this}var h=f.prototype;return h.resetInitSegment=function(v,T,o,t){n.prototype.resetInitSegment.call(this,v,T,o,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:T,duration:t,inputTimeScale:9e4,dropped:0}},f.probe=function(v){if(!v)return!1;for(var T=e.getID3Data(v,0)||[],o=T.length,t=v.length;o<t;o++)if(O.probe(v,o))return c.logger.log("MPEG Audio sync word found !"),!0;return!1},h.canParse=function(v,T){return O.canParse(v,T)},h.appendFrame=function(v,T,o){if(this.basePTS!==null)return O.appendFrame(v,T,o,this.basePTS,this.frameIndex)},f}(a.default);u.minProbeByteLength=4,M.default=u},"./src/demux/mp4demuxer.ts":function(R,M,i){i.r(M);var a=i("./src/polyfills/number.ts"),e=i("./src/types/demuxer.ts"),c=i("./src/utils/mp4-tools.ts"),O=i("./src/demux/dummy-demuxed-track.ts"),S=/\/emsg[-/]ID3/i,L=function(){function u(f,h){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=h}var n=u.prototype;return n.resetTimeStamp=function(){},n.resetInitSegment=function(h,m,v,T){var o=Object(c.parseInitSegment)(h),t=this.videoTrack=Object(O.dummyTrack)("video",1),s=this.audioTrack=Object(O.dummyTrack)("audio",1),g=this.txtTrack=Object(O.dummyTrack)("text",1);if(this.id3Track=Object(O.dummyTrack)("id3",1),this.timeOffset=0,o.video){var E=o.video,d=E.id,r=E.timescale,l=E.codec;t.id=d,t.timescale=g.timescale=r,t.codec=l}if(o.audio){var A=o.audio,x=A.id,b=A.timescale,D=A.codec;s.id=x,s.timescale=b,s.codec=D}g.id=c.RemuxerTrackIdConfig.text,t.sampleDuration=0,t.duration=s.duration=T},n.resetContiguity=function(){},u.probe=function(h){return h=h.length>16384?h.subarray(0,16384):h,Object(c.findBox)(h,["moof"]).length>0},n.demux=function(h,m){this.timeOffset=m;var v=h,T=this.videoTrack,o=this.txtTrack;if(this.config.progressive){this.remainderData&&(v=Object(c.appendUint8Array)(this.remainderData,h));var t=Object(c.segmentValidRange)(v);this.remainderData=t.remainder,T.samples=t.valid||new Uint8Array}else T.samples=v;var s=this.extractID3Track(T,m);return o.samples=Object(c.parseSamples)(m,T),{videoTrack:T,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},n.flush=function(){var h=this.timeOffset,m=this.videoTrack,v=this.txtTrack;m.samples=this.remainderData||new Uint8Array,this.remainderData=null;var T=this.extractID3Track(m,this.timeOffset);return v.samples=Object(c.parseSamples)(h,m),{videoTrack:m,audioTrack:Object(O.dummyTrack)(),id3Track:T,textTrack:Object(O.dummyTrack)()}},n.extractID3Track=function(h,m){var v=this.id3Track;if(h.samples.length){var T=Object(c.findBox)(h.samples,["emsg"]);T&&T.forEach(function(o){var t=Object(c.parseEmsg)(o);if(S.test(t.schemeIdUri)){var s=Object(a.isFiniteNumber)(t.presentationTime)?t.presentationTime/t.timeScale:m+t.presentationTimeDelta/t.timeScale,g=t.payload;v.samples.push({data:g,len:g.byteLength,dts:s,pts:s,type:e.MetadataSchema.emsg})}})}return v},n.demuxSampleAes=function(h,m,v){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},n.destroy=function(){},u}();L.minProbeByteLength=1024,M.default=L},"./src/demux/mpegaudio.ts":function(R,M,i){i.r(M),i.d(M,"appendFrame",function(){return L}),i.d(M,"parseHeader",function(){return u}),i.d(M,"isHeaderPattern",function(){return n}),i.d(M,"isHeader",function(){return f}),i.d(M,"canParse",function(){return h}),i.d(M,"probe",function(){return m});var a=null,e=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],c=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],O=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],S=[0,1,1,4];function L(v,T,o,t,s){if(!(o+24>T.length)){var g=u(T,o);if(g&&o+g.frameLength<=T.length){var E=g.samplesPerFrame*9e4/g.sampleRate,d=t+s*E,r={unit:T.subarray(o,o+g.frameLength),pts:d,dts:d};return v.config=[],v.channelCount=g.channelCount,v.samplerate=g.sampleRate,v.samples.push(r),{sample:r,length:g.frameLength,missing:0}}}}function u(v,T){var o=v[T+1]>>3&3,t=v[T+1]>>1&3,s=v[T+2]>>4&15,g=v[T+2]>>2&3;if(o!==1&&s!==0&&s!==15&&g!==3){var E=v[T+2]>>1&1,d=v[T+3]>>6,r=o===3?3-t:t===3?3:4,l=e[r*14+s-1]*1e3,A=o===3?0:o===2?1:2,x=c[A*3+g],b=d===3?1:2,D=O[o][t],p=S[t],y=D*8*p,I=Math.floor(D*l/x+E)*p;if(a===null){var C=navigator.userAgent||"",P=C.match(/Chrome\/(\d+)/i);a=P?parseInt(P[1]):0}var w=!!a&&a<=87;return w&&t===2&&l>=224e3&&d===0&&(v[T+3]=v[T+3]|128),{sampleRate:x,channelCount:b,frameLength:I,samplesPerFrame:y}}}function n(v,T){return v[T]===255&&(v[T+1]&224)===224&&(v[T+1]&6)!==0}function f(v,T){return T+1<v.length&&n(v,T)}function h(v,T){var o=4;return n(v,T)&&o<=v.length-T}function m(v,T){if(T+1<v.length&&n(v,T)){var o=4,t=u(v,T),s=o;t!=null&&t.frameLength&&(s=t.frameLength);var g=T+s;return g===v.length||f(v,g)}return!1}},"./src/demux/sample-aes.ts":function(R,M,i){i.r(M);var a=i("./src/crypt/decrypter.ts"),e=i("./src/demux/tsdemuxer.ts"),c=function(){function O(L,u,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new a.default(L,u,{removePKCS7Padding:!1})}var S=O.prototype;return S.decryptBuffer=function(u,n){this.decrypter.decrypt(u,this.keyData.key.buffer,this.keyData.iv.buffer,n)},S.decryptAacSample=function(u,n,f,h){var m=u[n].unit;if(!(m.length<=16)){var v=m.subarray(16,m.length-m.length%16),T=v.buffer.slice(v.byteOffset,v.byteOffset+v.length),o=this;this.decryptBuffer(T,function(t){var s=new Uint8Array(t);m.set(s,16),h||o.decryptAacSamples(u,n+1,f)})}},S.decryptAacSamples=function(u,n,f){for(;;n++){if(n>=u.length){f();return}if(!(u[n].unit.length<32)){var h=this.decrypter.isSync();if(this.decryptAacSample(u,n,f,h),!h)return}}},S.getAvcEncryptedData=function(u){for(var n=Math.floor((u.length-48)/160)*16+16,f=new Int8Array(n),h=0,m=32;m<u.length-16;m+=160,h+=16)f.set(u.subarray(m,m+16),h);return f},S.getAvcDecryptedUnit=function(u,n){for(var f=new Uint8Array(n),h=0,m=32;m<u.length-16;m+=160,h+=16)u.set(f.subarray(h,h+16),m);return u},S.decryptAvcSample=function(u,n,f,h,m,v){var T=Object(e.discardEPB)(m.data),o=this.getAvcEncryptedData(T),t=this;this.decryptBuffer(o.buffer,function(s){m.data=t.getAvcDecryptedUnit(T,s),v||t.decryptAvcSamples(u,n,f+1,h)})},S.decryptAvcSamples=function(u,n,f,h){if(u instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;n++,f=0){if(n>=u.length){h();return}for(var m=u[n].units;!(f>=m.length);f++){var v=m[f];if(!(v.data.length<=48||v.type!==1&&v.type!==5)){var T=this.decrypter.isSync();if(this.decryptAvcSample(u,n,f,h,v,T),!T)return}}}},O}();M.default=c},"./src/demux/transmuxer-interface.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return f});var a=i("./node_modules/webworkify-webpack/index.js"),e=i("./src/events.ts"),c=i("./src/demux/transmuxer.ts"),O=i("./src/utils/logger.ts"),S=i("./src/errors.ts"),L=i("./src/utils/mediasource-helper.ts"),u=i("./node_modules/eventemitter3/index.js"),n=Object(L.getMediaSource)()||{isTypeSupported:function(){return!1}},f=function(){function h(v,T,o,t){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=v,this.id=T,this.onTransmuxComplete=o,this.onFlush=t;var g=v.config,E=function(x,b){b=b||{},b.frag=s.frag,b.id=s.id,v.trigger(x,b)};this.observer=new u.EventEmitter,this.observer.on(e.Events.FRAG_DECRYPTED,E),this.observer.on(e.Events.ERROR,E);var d={mp4:n.isTypeSupported("video/mp4"),mpeg:n.isTypeSupported("audio/mpeg"),mp3:n.isTypeSupported('audio/mp4; codecs="mp3"')},r=navigator.vendor;if(g.enableWorker&&typeof Worker<"u"){O.logger.log("demuxing in webworker");var l;try{l=this.worker=a("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(A){v.trigger(e.Events.ERROR,{type:S.ErrorTypes.OTHER_ERROR,details:S.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(A.message+"  ("+A.filename+":"+A.lineno+")")})},l.postMessage({cmd:"init",typeSupported:d,vendor:r,id:T,config:JSON.stringify(g)})}catch(A){O.logger.warn("Error in worker:",A),O.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new c.default(this.observer,d,g,r,T),this.worker=null}}else this.transmuxer=new c.default(this.observer,d,g,r,T)}var m=h.prototype;return m.destroy=function(){var T=this.worker;if(T)T.removeEventListener("message",this.onwmsg),T.terminate(),this.worker=null,this.onwmsg=void 0;else{var o=this.transmuxer;o&&(o.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},m.push=function(T,o,t,s,g,E,d,r,l,A){var x,b,D=this;l.transmuxing.start=self.performance.now();var p=this.transmuxer,y=this.worker,I=E?E.start:g.start,C=g.decryptdata,P=this.frag,w=!(P&&g.cc===P.cc),k=!(P&&l.level===P.level),F=P?l.sn-P.sn:-1,_=this.part?l.part-this.part.index:-1,B=F===0&&l.id>1&&l.id===(P==null?void 0:P.stats.chunkCount),N=!k&&(F===1||F===0&&(_===1||B&&_<=0)),U=self.performance.now();(k||F||g.stats.parsing.start===0)&&(g.stats.parsing.start=U),E&&(_||!N)&&(E.stats.parsing.start=U);var j=!(P&&((x=g.initSegment)===null||x===void 0?void 0:x.url)===((b=P.initSegment)===null||b===void 0?void 0:b.url)),K=new c.TransmuxState(w,N,r,k,I,j);if(!N||w||j){O.logger.log("[transmuxer-interface, "+g.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+w+`
        trackSwitch: `+k+`
        contiguous: `+N+`
        accurateTimeOffset: `+r+`
        timeOffset: `+I+`
        initSegmentChange: `+j);var H=new c.TransmuxConfig(t,s,o,d,A);this.configureTransmuxer(H)}if(this.frag=g,this.part=E,y)y.postMessage({cmd:"demux",data:T,decryptdata:C,chunkMeta:l,state:K},T instanceof ArrayBuffer?[T]:[]);else if(p){var G=p.push(T,C,l,K);Object(c.isPromise)(G)?G.then(function(W){D.handleTransmuxComplete(W)}):this.handleTransmuxComplete(G)}},m.flush=function(T){var o=this;T.transmuxing.start=self.performance.now();var t=this.transmuxer,s=this.worker;if(s)s.postMessage({cmd:"flush",chunkMeta:T});else if(t){var g=t.flush(T);Object(c.isPromise)(g)?g.then(function(E){o.handleFlushResult(E,T)}):this.handleFlushResult(g,T)}},m.handleFlushResult=function(T,o){var t=this;T.forEach(function(s){t.handleTransmuxComplete(s)}),this.onFlush(o)},m.onWorkerMessage=function(T){var o=T.data,t=this.hls;switch(o.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(o.data);break}case"flush":{this.onFlush(o.data);break}case"workerLog":O.logger[o.data.logType]&&O.logger[o.data.logType](o.data.message);break;default:{o.data=o.data||{},o.data.frag=this.frag,o.data.id=this.id,t.trigger(o.event,o.data);break}}},m.configureTransmuxer=function(T){var o=this.worker,t=this.transmuxer;o?o.postMessage({cmd:"configure",config:T}):t&&t.configure(T)},m.handleTransmuxComplete=function(T){T.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(T)},h}()},"./src/demux/transmuxer-worker.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return S});var a=i("./src/demux/transmuxer.ts"),e=i("./src/events.ts"),c=i("./src/utils/logger.ts"),O=i("./node_modules/eventemitter3/index.js");function S(h){var m=new O.EventEmitter,v=function(t,s){h.postMessage({event:t,data:s})};m.on(e.Events.FRAG_DECRYPTED,v),m.on(e.Events.ERROR,v);var T=function(){var t=function(E){var d=function(l){v("workerLog",{logType:E,message:l})};c.logger[E]=d};for(var s in c.logger)t(s)};h.addEventListener("message",function(o){var t=o.data;switch(t.cmd){case"init":{var s=JSON.parse(t.config);h.transmuxer=new a.default(m,t.typeSupported,s,t.vendor,t.id),Object(c.enableLogs)(s.debug),T(),v("init",null);break}case"configure":{h.transmuxer.configure(t.config);break}case"demux":{var g=h.transmuxer.push(t.data,t.decryptdata,t.chunkMeta,t.state);Object(a.isPromise)(g)?g.then(function(r){L(h,r)}):L(h,g);break}case"flush":{var E=t.chunkMeta,d=h.transmuxer.flush(E);Object(a.isPromise)(d)?d.then(function(r){n(h,r,E)}):n(h,d,E);break}}})}function L(h,m){if(f(m.remuxResult))return!1;var v=[],T=m.remuxResult,o=T.audio,t=T.video;return o&&u(v,o),t&&u(v,t),h.postMessage({event:"transmuxComplete",data:m},v),!0}function u(h,m){m.data1&&h.push(m.data1.buffer),m.data2&&h.push(m.data2.buffer)}function n(h,m,v){var T=m.reduce(function(o,t){return L(h,t)||o},!1);T||h.postMessage({event:"transmuxComplete",data:m[0]}),h.postMessage({event:"flush",data:v})}function f(h){return!h.audio&&!h.video&&!h.text&&!h.id3&&!h.initSegment}},"./src/demux/transmuxer.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return s}),i.d(M,"isPromise",function(){return d}),i.d(M,"TransmuxConfig",function(){return r}),i.d(M,"TransmuxState",function(){return l});var a=i("./src/events.ts"),e=i("./src/errors.ts"),c=i("./src/crypt/decrypter.ts"),O=i("./src/demux/aacdemuxer.ts"),S=i("./src/demux/mp4demuxer.ts"),L=i("./src/demux/tsdemuxer.ts"),u=i("./src/demux/mp3demuxer.ts"),n=i("./src/remux/mp4-remuxer.ts"),f=i("./src/remux/passthrough-remuxer.ts"),h=i("./src/demux/chunk-cache.ts"),m=i("./src/utils/mp4-tools.ts"),v=i("./src/utils/logger.ts"),T;try{T=self.performance.now.bind(self.performance)}catch{v.logger.debug("Unable to use Performance API on this environment"),T=self.Date.now}var o=[{demux:L.default,remux:n.default},{demux:S.default,remux:f.default},{demux:O.default,remux:n.default},{demux:u.default,remux:n.default}],t=1024;o.forEach(function(A){var x=A.demux;t=Math.max(t,x.minProbeByteLength)});var s=function(){function A(b,D,p,y,I){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new h.default,this.observer=b,this.typeSupported=D,this.config=p,this.vendor=y,this.id=I}var x=A.prototype;return x.configure=function(D){this.transmuxConfig=D,this.decrypter&&this.decrypter.reset()},x.push=function(D,p,y,I){var C=this,P=y.transmuxing;P.executeStart=T();var w=new Uint8Array(D),k=this.cache,F=this.config,_=this.currentTransmuxState,B=this.transmuxConfig;I&&(this.currentTransmuxState=I);var N=g(w,p);if(N&&N.method==="AES-128"){var U=this.getDecrypter();if(F.enableSoftwareAES){var j=U.softwareDecrypt(w,N.key.buffer,N.iv.buffer);if(!j)return P.executeEnd=T(),E(y);w=new Uint8Array(j)}else return this.decryptionPromise=U.webCryptoDecrypt(w,N.key.buffer,N.iv.buffer).then(function(it){var at=C.push(it,null,y);return C.decryptionPromise=null,at}),this.decryptionPromise}var K=I||_,H=K.contiguous,G=K.discontinuity,W=K.trackSwitch,X=K.accurateTimeOffset,z=K.timeOffset,Q=K.initSegmentChange,$=B.audioCodec,Y=B.videoCodec,J=B.defaultInitPts,q=B.duration,tt=B.initSegmentData;if((G||W||Q)&&this.resetInitSegment(tt,$,Y,q),(G||Q)&&this.resetInitialTimestamp(J),H||this.resetContiguity(),this.needsProbing(w,G,W)){if(k.dataLength){var et=k.flush();w=Object(m.appendUint8Array)(et,w)}this.configureTransmuxer(w,B)}var rt=this.transmux(w,N,z,X,y),V=this.currentTransmuxState;return V.contiguous=!0,V.discontinuity=!1,V.trackSwitch=!1,P.executeEnd=T(),rt},x.flush=function(D){var p=this,y=D.transmuxing;y.executeStart=T();var I=this.decrypter,C=this.cache,P=this.currentTransmuxState,w=this.decryptionPromise;if(w)return w.then(function(){return p.flush(D)});var k=[],F=P.timeOffset;if(I){var _=I.flush();_&&k.push(this.push(_,null,D))}var B=C.dataLength;C.reset();var N=this.demuxer,U=this.remuxer;if(!N||!U)return B>=t&&this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),y.executeEnd=T(),[E(D)];var j=N.flush(F);return d(j)?j.then(function(K){return p.flushRemux(k,K,D),k}):(this.flushRemux(k,j,D),k)},x.flushRemux=function(D,p,y){var I=p.audioTrack,C=p.videoTrack,P=p.id3Track,w=p.textTrack,k=this.currentTransmuxState,F=k.accurateTimeOffset,_=k.timeOffset;v.logger.log("[transmuxer.ts]: Flushed fragment "+y.sn+(y.part>-1?" p: "+y.part:"")+" of level "+y.level);var B=this.remuxer.remux(I,C,P,w,_,F,!0,this.id);D.push({remuxResult:B,chunkMeta:y}),y.transmuxing.executeEnd=T()},x.resetInitialTimestamp=function(D){var p=this.demuxer,y=this.remuxer;!p||!y||(p.resetTimeStamp(D),y.resetTimeStamp(D))},x.resetContiguity=function(){var D=this.demuxer,p=this.remuxer;!D||!p||(D.resetContiguity(),p.resetNextTimestamp())},x.resetInitSegment=function(D,p,y,I){var C=this.demuxer,P=this.remuxer;!C||!P||(C.resetInitSegment(D,p,y,I),P.resetInitSegment(D,p,y))},x.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},x.transmux=function(D,p,y,I,C){var P;return p&&p.method==="SAMPLE-AES"?P=this.transmuxSampleAes(D,p,y,I,C):P=this.transmuxUnencrypted(D,y,I,C),P},x.transmuxUnencrypted=function(D,p,y,I){var C=this.demuxer.demux(D,p,!1,!this.config.progressive),P=C.audioTrack,w=C.videoTrack,k=C.id3Track,F=C.textTrack,_=this.remuxer.remux(P,w,k,F,p,y,!1,this.id);return{remuxResult:_,chunkMeta:I}},x.transmuxSampleAes=function(D,p,y,I,C){var P=this;return this.demuxer.demuxSampleAes(D,p,y).then(function(w){var k=P.remuxer.remux(w.audioTrack,w.videoTrack,w.id3Track,w.textTrack,y,I,!1,P.id);return{remuxResult:k,chunkMeta:C}})},x.configureTransmuxer=function(D,p){for(var y=this.config,I=this.observer,C=this.typeSupported,P=this.vendor,w=p.audioCodec,k=p.defaultInitPts,F=p.duration,_=p.initSegmentData,B=p.videoCodec,N,U=0,j=o.length;U<j;U++)if(o[U].demux.probe(D)){N=o[U];break}N||(v.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:S.default,remux:f.default});var K=this.demuxer,H=this.remuxer,G=N.remux,W=N.demux;(!H||!(H instanceof G))&&(this.remuxer=new G(I,y,C,P)),(!K||!(K instanceof W))&&(this.demuxer=new W(I,y,C),this.probe=W.probe),this.resetInitSegment(_,w,B,F),this.resetInitialTimestamp(k)},x.needsProbing=function(D,p,y){return!this.demuxer||!this.remuxer||p||y},x.getDecrypter=function(){var D=this.decrypter;return D||(D=this.decrypter=new c.default(this.observer,this.config)),D},A}();function g(A,x){var b=null;return A.byteLength>0&&x!=null&&x.key!=null&&x.iv!==null&&x.method!=null&&(b=x),b}var E=function(x){return{remuxResult:{},chunkMeta:x}};function d(A){return"then"in A&&A.then instanceof Function}var r=function(x,b,D,p,y){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=x,this.videoCodec=b,this.initSegmentData=D,this.duration=p,this.defaultInitPts=y},l=function(x,b,D,p,y,I){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=x,this.contiguous=b,this.accurateTimeOffset=D,this.trackSwitch=p,this.timeOffset=y,this.initSegmentChange=I}},"./src/demux/tsdemuxer.ts":function(R,M,i){i.r(M),i.d(M,"discardEPB",function(){return g});var a=i("./src/demux/adts.ts"),e=i("./src/demux/mpegaudio.ts"),c=i("./src/demux/exp-golomb.ts"),O=i("./src/demux/sample-aes.ts"),S=i("./src/events.ts"),L=i("./src/utils/mp4-tools.ts"),u=i("./src/utils/logger.ts"),n=i("./src/errors.ts"),f=i("./src/types/demuxer.ts");function h(){return h=Object.assign?Object.assign.bind():function(E){for(var d=1;d<arguments.length;d++){var r=arguments[d];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(E[l]=r[l])}return E},h.apply(this,arguments)}var m=function(){function E(r,l,A){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=r,this.config=l,this.typeSupported=A}E.probe=function(l){var A=E.syncOffset(l);return A<0?!1:(A&&u.logger.warn("MPEG2-TS detected but first sync word found @ offset "+A+", junk ahead ?"),!0)},E.syncOffset=function(l){for(var A=Math.min(1e3,l.length-564),x=0;x<A;){if(l[x]===71&&l[x+188]===71&&l[x+2*188]===71)return x;x++}return-1},E.createTrack=function(l,A){return{container:l==="video"||l==="audio"?"video/mp2t":void 0,type:l,id:L.RemuxerTrackIdConfig[l],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:l==="audio"?A:void 0}};var d=E.prototype;return d.resetInitSegment=function(l,A,x,b){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=E.createTrack("video"),this._audioTrack=E.createTrack("audio",b),this._id3Track=E.createTrack("id3"),this._txtTrack=E.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=A,this.videoCodec=x,this._duration=b},d.resetTimeStamp=function(){},d.resetContiguity=function(){var l=this._audioTrack,A=this._avcTrack,x=this._id3Track;l&&(l.pesData=null),A&&(A.pesData=null),x&&(x.pesData=null),this.aacOverFlow=null},d.demux=function(l,A,x,b){x===void 0&&(x=!1),b===void 0&&(b=!1),x||(this.sampleAes=null);var D,p=this._avcTrack,y=this._audioTrack,I=this._id3Track,C=this._txtTrack,P=p.pid,w=p.pesData,k=y.pid,F=I.pid,_=y.pesData,B=I.pesData,N=!1,U=this.pmtParsed,j=this._pmtId,K=l.length;if(this.remainderData&&(l=Object(L.appendUint8Array)(this.remainderData,l),K=l.length,this.remainderData=null),K<188&&!b)return this.remainderData=l,{audioTrack:y,videoTrack:p,id3Track:I,textTrack:C};var H=Math.max(0,E.syncOffset(l));K-=(K+H)%188,K<l.byteLength&&!b&&(this.remainderData=new Uint8Array(l.buffer,K,l.buffer.byteLength-K));for(var G=0,W=H;W<K;W+=188)if(l[W]===71){var X=!!(l[W+1]&64),z=((l[W+1]&31)<<8)+l[W+2],Q=(l[W+3]&48)>>4,$=void 0;if(Q>1){if($=W+5+l[W+4],$===W+188)continue}else $=W+4;switch(z){case P:X&&(w&&(D=t(w))&&this.parseAVCPES(p,C,D,!1),w={data:[],size:0}),w&&(w.data.push(l.subarray($,W+188)),w.size+=W+188-$);break;case k:if(X){if(_&&(D=t(_)))switch(y.segmentCodec){case"aac":this.parseAACPES(y,D);break;case"mp3":this.parseMPEGPES(y,D);break}_={data:[],size:0}}_&&(_.data.push(l.subarray($,W+188)),_.size+=W+188-$);break;case F:X&&(B&&(D=t(B))&&this.parseID3PES(I,D),B={data:[],size:0}),B&&(B.data.push(l.subarray($,W+188)),B.size+=W+188-$);break;case 0:X&&($+=l[$]+1),j=this._pmtId=T(l,$);break;case j:{X&&($+=l[$]+1);var Y=o(l,$,this.typeSupported,x);P=Y.avc,P>0&&(p.pid=P),k=Y.audio,k>0&&(y.pid=k,y.segmentCodec=Y.segmentCodec),F=Y.id3,F>0&&(I.pid=F),N&&!U&&(u.logger.log("reparse from beginning"),N=!1,W=H-188),U=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else G++;G>0&&this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+G+" TS packet/s that do not start with 0x47"}),p.pesData=w,y.pesData=_,I.pesData=B;var J={audioTrack:y,videoTrack:p,id3Track:I,textTrack:C};return b&&this.extractRemainingSamples(J),J},d.flush=function(){var l=this.remainderData;this.remainderData=null;var A;return l?A=this.demux(l,-1,!1,!0):A={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(A),this.sampleAes?this.decrypt(A,this.sampleAes):A},d.extractRemainingSamples=function(l){var A=l.audioTrack,x=l.videoTrack,b=l.id3Track,D=l.textTrack,p=x.pesData,y=A.pesData,I=b.pesData,C;if(p&&(C=t(p))?(this.parseAVCPES(x,D,C,!0),x.pesData=null):x.pesData=p,y&&(C=t(y))){switch(A.segmentCodec){case"aac":this.parseAACPES(A,C);break;case"mp3":this.parseMPEGPES(A,C);break}A.pesData=null}else y!=null&&y.size&&u.logger.log("last AAC PES packet truncated,might overlap between fragments"),A.pesData=y;I&&(C=t(I))?(this.parseID3PES(b,C),b.pesData=null):b.pesData=I},d.demuxSampleAes=function(l,A,x){var b=this.demux(l,x,!0,!this.config.progressive),D=this.sampleAes=new O.default(this.observer,this.config,A);return this.decrypt(b,D)},d.decrypt=function(l,A){return new Promise(function(x){var b=l.audioTrack,D=l.videoTrack;b.samples&&b.segmentCodec==="aac"?A.decryptAacSamples(b.samples,0,function(){D.samples?A.decryptAvcSamples(D.samples,0,0,function(){x(l)}):x(l)}):D.samples&&A.decryptAvcSamples(D.samples,0,0,function(){x(l)})})},d.destroy=function(){this._duration=0},d.parseAVCPES=function(l,A,x,b){var D=this,p=this.parseAVCNALu(l,x.data),y=this.avcSample,I,C=!1;x.data=null,y&&p.length&&!l.audFound&&(s(y,l),y=this.avcSample=v(!1,x.pts,x.dts,"")),p.forEach(function(P){switch(P.type){case 1:{I=!0,y||(y=D.avcSample=v(!0,x.pts,x.dts,"")),y.frame=!0;var w=P.data;if(C&&w.length>4){var k=new c.default(w).readSliceType();(k===2||k===4||k===7||k===9)&&(y.key=!0)}break}case 5:I=!0,y||(y=D.avcSample=v(!0,x.pts,x.dts,"")),y.key=!0,y.frame=!0;break;case 6:{I=!0,Object(L.parseSEIMessageFromNALu)(g(P.data),x.pts,A.samples);break}case 7:if(I=!0,C=!0,!l.sps){var F=new c.default(P.data),_=F.readSPS();l.width=_.width,l.height=_.height,l.pixelRatio=_.pixelRatio,l.sps=[P.data],l.duration=D._duration;for(var B=P.data.subarray(1,4),N="avc1.",U=0;U<3;U++){var j=B[U].toString(16);j.length<2&&(j="0"+j),N+=j}l.codec=N}break;case 8:I=!0,l.pps||(l.pps=[P.data]);break;case 9:I=!1,l.audFound=!0,y&&s(y,l),y=D.avcSample=v(!1,x.pts,x.dts,"");break;case 12:I=!0;break;default:I=!1,y&&(y.debug+="unknown NAL "+P.type+" ");break}if(y&&I){var K=y.units;K.push(P)}}),b&&y&&(s(y,l),this.avcSample=null)},d.getLastNalUnit=function(l){var A,x=this.avcSample,b;if((!x||x.units.length===0)&&(x=l[l.length-1]),(A=x)!==null&&A!==void 0&&A.units){var D=x.units;b=D[D.length-1]}return b},d.parseAVCNALu=function(l,A){var x=A.byteLength,b=l.naluState||0,D=b,p=[],y=0,I,C,P,w=-1,k=0;for(b===-1&&(w=0,k=A[0]&31,b=0,y=1);y<x;){if(I=A[y++],!b){b=I?0:1;continue}if(b===1){b=I?0:2;continue}if(!I)b=3;else if(I===1){if(w>=0){var F={data:A.subarray(w,y-b-1),type:k};p.push(F)}else{var _=this.getLastNalUnit(l.samples);if(_&&(D&&y<=4-D&&_.state&&(_.data=_.data.subarray(0,_.data.byteLength-D)),C=y-b-1,C>0)){var B=new Uint8Array(_.data.byteLength+C);B.set(_.data,0),B.set(A.subarray(0,C),_.data.byteLength),_.data=B,_.state=0}}y<x?(P=A[y]&31,w=y,k=P,b=0):b=-1}else b=0}if(w>=0&&b>=0){var N={data:A.subarray(w,x),type:k,state:b};p.push(N)}if(p.length===0){var U=this.getLastNalUnit(l.samples);if(U){var j=new Uint8Array(U.data.byteLength+A.byteLength);j.set(U.data,0),j.set(A,U.data.byteLength),U.data=j}}return l.naluState=b,p},d.parseAACPES=function(l,A){var x=0,b=this.aacOverFlow,D=A.data;if(b){this.aacOverFlow=null;var p=b.missing,y=b.sample.unit.byteLength;if(p===-1){var I=new Uint8Array(y+D.byteLength);I.set(b.sample.unit,0),I.set(D,y),D=I}else{var C=y-p;b.sample.unit.set(D.subarray(0,p),C),l.samples.push(b.sample),x=b.missing}}var P,w;for(P=x,w=D.length;P<w-1&&!a.isHeader(D,P);P++);if(P!==x){var k,F;if(P<w-1?(k="AAC PES did not start with ADTS header,offset:"+P,F=!1):(k="no ADTS header found in AAC PES",F=!0),u.logger.warn("parsing error:"+k),this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:k}),F)return}a.initTrackConfig(l,this.observer,D,P,this.audioCodec);var _;if(A.pts!==void 0)_=A.pts;else if(b){var B=a.getFrameDuration(l.samplerate);_=b.sample.pts+B}else{u.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,U;P<w;)if(U=a.appendFrame(l,D,P,_,N),P+=U.length,U.missing){this.aacOverFlow=U;break}else for(N++;P<w-1&&!a.isHeader(D,P);P++);},d.parseMPEGPES=function(l,A){var x=A.data,b=x.length,D=0,p=0,y=A.pts;if(y===void 0){u.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;p<b;)if(e.isHeader(x,p)){var I=e.appendFrame(l,x,p,y,D);if(I)p+=I.length,D++;else break}else p++},d.parseID3PES=function(l,A){if(A.pts===void 0){u.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var x=h({},A,{type:this._avcTrack?f.MetadataSchema.emsg:f.MetadataSchema.audioId3});l.samples.push(x)},E}();m.minProbeByteLength=188;function v(E,d,r,l){return{key:E,frame:!1,pts:d,dts:r,units:[],debug:l,length:0}}function T(E,d){return(E[d+10]&31)<<8|E[d+11]}function o(E,d,r,l){var A={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},x=(E[d+1]&15)<<8|E[d+2],b=d+3+x-4,D=(E[d+10]&15)<<8|E[d+11];for(d+=12+D;d<b;){var p=(E[d+1]&31)<<8|E[d+2];switch(E[d]){case 207:if(!l){u.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:A.audio===-1&&(A.audio=p);break;case 21:A.id3===-1&&(A.id3=p);break;case 219:if(!l){u.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:A.avc===-1&&(A.avc=p);break;case 3:case 4:r.mpeg!==!0&&r.mp3!==!0?u.logger.log("MPEG audio found, not supported in this browser"):A.audio===-1&&(A.audio=p,A.segmentCodec="mp3");break;case 36:u.logger.warn("Unsupported HEVC stream type found");break}d+=((E[d+3]&15)<<8|E[d+4])+5}return A}function t(E){var d=0,r,l,A,x,b,D=E.data;if(!E||E.size===0)return null;for(;D[0].length<19&&D.length>1;){var p=new Uint8Array(D[0].length+D[1].length);p.set(D[0]),p.set(D[1],D[0].length),D[0]=p,D.splice(1,1)}r=D[0];var y=(r[0]<<16)+(r[1]<<8)+r[2];if(y===1){if(l=(r[4]<<8)+r[5],l&&l>E.size-6)return null;var I=r[7];I&192&&(x=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,I&64?(b=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,x-b>60*9e4&&(u.logger.warn(Math.round((x-b)/9e4)+"s delta between PTS and DTS, align them"),x=b)):b=x),A=r[8];var C=A+9;if(E.size<=C)return null;E.size-=C;for(var P=new Uint8Array(E.size),w=0,k=D.length;w<k;w++){r=D[w];var F=r.byteLength;if(C)if(C>F){C-=F;continue}else r=r.subarray(C),F-=C,C=0;P.set(r,d),d+=F}return l&&(l-=A+3),{data:P,pts:x,dts:b,len:l}}return null}function s(E,d){if(E.units.length&&E.frame){if(E.pts===void 0){var r=d.samples,l=r.length;if(l){var A=r[l-1];E.pts=A.pts,E.dts=A.dts}else{d.dropped++;return}}d.samples.push(E)}E.debug.length&&u.logger.log(E.pts+"/"+E.dts+":"+E.debug)}function g(E){for(var d=E.byteLength,r=[],l=1;l<d-2;)E[l]===0&&E[l+1]===0&&E[l+2]===3?(r.push(l+2),l+=2):l++;if(r.length===0)return E;var A=d-r.length,x=new Uint8Array(A),b=0;for(l=0;l<A;b++,l++)b===r[0]&&(b++,r.shift()),x[l]=E[b];return x}M.default=m},"./src/errors.ts":function(R,M,i){i.r(M),i.d(M,"ErrorTypes",function(){return a}),i.d(M,"ErrorDetails",function(){return e});var a;(function(c){c.NETWORK_ERROR="networkError",c.MEDIA_ERROR="mediaError",c.KEY_SYSTEM_ERROR="keySystemError",c.MUX_ERROR="muxError",c.OTHER_ERROR="otherError"})(a||(a={}));var e;(function(c){c.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",c.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",c.KEY_SYSTEM_NO_SESSION="keySystemNoSession",c.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",c.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",c.MANIFEST_LOAD_ERROR="manifestLoadError",c.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",c.MANIFEST_PARSING_ERROR="manifestParsingError",c.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",c.LEVEL_EMPTY_ERROR="levelEmptyError",c.LEVEL_LOAD_ERROR="levelLoadError",c.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",c.LEVEL_SWITCH_ERROR="levelSwitchError",c.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",c.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",c.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",c.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",c.FRAG_LOAD_ERROR="fragLoadError",c.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",c.FRAG_DECRYPT_ERROR="fragDecryptError",c.FRAG_PARSING_ERROR="fragParsingError",c.REMUX_ALLOC_ERROR="remuxAllocError",c.KEY_LOAD_ERROR="keyLoadError",c.KEY_LOAD_TIMEOUT="keyLoadTimeOut",c.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",c.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",c.BUFFER_APPEND_ERROR="bufferAppendError",c.BUFFER_APPENDING_ERROR="bufferAppendingError",c.BUFFER_STALLED_ERROR="bufferStalledError",c.BUFFER_FULL_ERROR="bufferFullError",c.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",c.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",c.INTERNAL_EXCEPTION="internalException",c.INTERNAL_ABORTED="aborted",c.UNKNOWN="unknown"})(e||(e={}))},"./src/events.ts":function(R,M,i){i.r(M),i.d(M,"Events",function(){return a});var a;(function(e){e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached"})(a||(a={}))},"./src/hls.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return g});var a=i("./node_modules/url-toolkit/src/url-toolkit.js"),e=i("./src/loader/playlist-loader.ts"),c=i("./src/loader/key-loader.ts"),O=i("./src/controller/id3-track-controller.ts"),S=i("./src/controller/latency-controller.ts"),L=i("./src/controller/level-controller.ts"),u=i("./src/controller/fragment-tracker.ts"),n=i("./src/controller/stream-controller.ts"),f=i("./src/is-supported.ts"),h=i("./src/utils/logger.ts"),m=i("./src/config.ts"),v=i("./node_modules/eventemitter3/index.js"),T=i("./src/events.ts"),o=i("./src/errors.ts");function t(E,d){for(var r=0;r<d.length;r++){var l=d[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(E,l.key,l)}}function s(E,d,r){return d&&t(E.prototype,d),r&&t(E,r),Object.defineProperty(E,"prototype",{writable:!1}),E}var g=function(){E.isSupported=function(){return Object(f.isSupported)()};function E(r){r===void 0&&(r={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new v.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var l=this.config=Object(m.mergeConfig)(E.DefaultConfig,r);this.userConfig=r,Object(h.enableLogs)(l.debug),this._autoLevelCapping=-1,l.progressive&&Object(m.enableStreamingMode)(l);var A=l.abrController,x=l.bufferController,b=l.capLevelController,D=l.fpsController,p=this.abrController=new A(this),y=this.bufferController=new x(this),I=this.capLevelController=new b(this),C=new D(this),P=new e.default(this),w=new c.default(this),k=new O.default(this),F=this.levelController=new L.default(this),_=new u.FragmentTracker(this),B=this.streamController=new n.default(this,_);I.setStreamController(B),C.setStreamController(B);var N=[F,B];this.networkControllers=N;var U=[P,w,p,y,I,C,k,_];this.audioTrackController=this.createController(l.audioTrackController,null,N),this.createController(l.audioStreamController,_,N),this.subtitleTrackController=this.createController(l.subtitleTrackController,null,N),this.createController(l.subtitleStreamController,_,N),this.createController(l.timelineController,null,U),this.emeController=this.createController(l.emeController,null,U),this.cmcdController=this.createController(l.cmcdController,null,U),this.latencyController=this.createController(S.default,null,U),this.coreComponents=U}var d=E.prototype;return d.createController=function(l,A,x){if(l){var b=A?new l(this,A):new l(this);return x&&x.push(b),b}return null},d.on=function(l,A,x){x===void 0&&(x=this),this._emitter.on(l,A,x)},d.once=function(l,A,x){x===void 0&&(x=this),this._emitter.once(l,A,x)},d.removeAllListeners=function(l){this._emitter.removeAllListeners(l)},d.off=function(l,A,x,b){x===void 0&&(x=this),this._emitter.off(l,A,x,b)},d.listeners=function(l){return this._emitter.listeners(l)},d.emit=function(l,A,x){return this._emitter.emit(l,A,x)},d.trigger=function(l,A){if(this.config.debug)return this.emit(l,l,A);try{return this.emit(l,l,A)}catch(x){h.logger.error("An internal error happened while handling event "+l+'. Error message: "'+x.message+'". Here is a stacktrace:',x),this.trigger(T.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:l,error:x})}return!1},d.listenerCount=function(l){return this._emitter.listenerCount(l)},d.destroy=function(){h.logger.log("destroy"),this.trigger(T.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(l){return l.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(l){return l.destroy()}),this.coreComponents.length=0},d.attachMedia=function(l){h.logger.log("attachMedia"),this._media=l,this.trigger(T.Events.MEDIA_ATTACHING,{media:l})},d.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(T.Events.MEDIA_DETACHING,void 0),this._media=null},d.loadSource=function(l){this.stopLoad();var A=this.media,x=this.url,b=this.url=a.buildAbsoluteURL(self.location.href,l,{alwaysNormalize:!0});h.logger.log("loadSource:"+b),A&&x&&x!==b&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(A)),this.trigger(T.Events.MANIFEST_LOADING,{url:l})},d.startLoad=function(l){l===void 0&&(l=-1),h.logger.log("startLoad("+l+")"),this.networkControllers.forEach(function(A){A.startLoad(l)})},d.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach(function(l){l.stopLoad()})},d.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},d.recoverMediaError=function(){h.logger.log("recoverMediaError");var l=this._media;this.detachMedia(),l&&this.attachMedia(l)},d.removeLevel=function(l,A){A===void 0&&(A=0),this.levelController.removeLevel(l,A)},s(E,[{key:"levels",get:function(){var l=this.levelController.levels;return l||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(l){h.logger.log("set currentLevel:"+l),this.loadLevel=l,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(l){h.logger.log("set nextLevel:"+l),this.levelController.manualLevel=l,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(l){h.logger.log("set loadLevel:"+l),this.levelController.manualLevel=l}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){h.logger.log("set firstLevel:"+l),this.levelController.firstLevel=l}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(l){h.logger.log("set startLevel:"+l),l!==-1&&(l=Math.max(l,this.minAutoLevel)),this.levelController.startLevel=l}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(l){var A=!!l;A!==this.config.capLevelToPlayerSize&&(A?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=A)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(l){this._autoLevelCapping!==l&&(h.logger.log("set autoLevelCapping:"+l),this._autoLevelCapping=l)}},{key:"bandwidthEstimate",get:function(){var l=this.abrController.bwEstimator;return l?l.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var l=this.levels,A=this.config.minAutoBitrate;if(!l)return 0;for(var x=l.length,b=0;b<x;b++)if(l[b].maxBitrate>=A)return b;return 0}},{key:"maxAutoLevel",get:function(){var l=this.levels,A=this.autoLevelCapping,x;return A===-1&&l&&l.length?x=l.length-1:x=A,x}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]}},{key:"audioTrack",get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var A=this.audioTrackController;A&&(A.audioTrack=l)}},{key:"subtitleTracks",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var A=this.subtitleTrackController;A&&(A.subtitleTrack=l)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var l=this.subtitleTrackController;return l?l.subtitleDisplay:!1},set:function(l){var A=this.subtitleTrackController;A&&(A.subtitleDisplay=l)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(l){this.config.lowLatencyMode=l}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return T.Events}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return E.defaultConfig?E.defaultConfig:m.hlsDefaultConfig},set:function(l){E.defaultConfig=l}}]),E}();g.defaultConfig=void 0},"./src/is-supported.ts":function(R,M,i){i.r(M),i.d(M,"isSupported",function(){return c}),i.d(M,"changeTypeSupported",function(){return O});var a=i("./src/utils/mediasource-helper.ts");function e(){return self.SourceBuffer||self.WebKitSourceBuffer}function c(){var S=Object(a.getMediaSource)();if(!S)return!1;var L=e(),u=S&&typeof S.isTypeSupported=="function"&&S.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!L||L.prototype&&typeof L.prototype.appendBuffer=="function"&&typeof L.prototype.remove=="function";return!!u&&!!n}function O(){var S,L=e();return typeof(L==null||(S=L.prototype)===null||S===void 0?void 0:S.changeType)=="function"}},"./src/loader/date-range.ts":function(R,M,i){i.r(M),i.d(M,"DateRangeAttribute",function(){return u}),i.d(M,"DateRange",function(){return n});var a=i("./src/polyfills/number.ts"),e=i("./src/utils/attr-list.ts"),c=i("./src/utils/logger.ts");function O(){return O=Object.assign?Object.assign.bind():function(f){for(var h=1;h<arguments.length;h++){var m=arguments[h];for(var v in m)Object.prototype.hasOwnProperty.call(m,v)&&(f[v]=m[v])}return f},O.apply(this,arguments)}function S(f,h){for(var m=0;m<h.length;m++){var v=h[m];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}function L(f,h,m){return h&&S(f.prototype,h),m&&S(f,m),Object.defineProperty(f,"prototype",{writable:!1}),f}var u;(function(f){f.ID="ID",f.CLASS="CLASS",f.START_DATE="START-DATE",f.DURATION="DURATION",f.END_DATE="END-DATE",f.END_ON_NEXT="END-ON-NEXT",f.PLANNED_DURATION="PLANNED-DURATION",f.SCTE35_OUT="SCTE35-OUT",f.SCTE35_IN="SCTE35-IN"})(u||(u={}));var n=function(){function f(h,m){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,m){var v=m.attr;for(var T in v)if(Object.prototype.hasOwnProperty.call(h,T)&&h[T]!==v[T]){c.logger.warn('DATERANGE tag attribute: "'+T+'" does not match for tags with ID: "'+h.ID+'"'),this._badValueForSameId=T;break}h=O(new e.AttrList({}),v,h)}if(this.attr=h,this._startDate=new Date(h[u.START_DATE]),u.END_DATE in this.attr){var o=new Date(this.attr[u.END_DATE]);Object(a.isFiniteNumber)(o.getTime())&&(this._endDate=o)}}return L(f,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var m=this.duration;return m!==null?new Date(this._startDate.getTime()+m*1e3):null}},{key:"duration",get:function(){if(u.DURATION in this.attr){var m=this.attr.decimalFloatingPoint(u.DURATION);if(Object(a.isFiniteNumber)(m))return m}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return u.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(u.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(u.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(a.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),f}()},"./src/loader/fragment-loader.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return m}),i.d(M,"LoadError",function(){return T});var a=i("./src/polyfills/number.ts"),e=i("./src/errors.ts");function c(o,t){o.prototype=Object.create(t.prototype),o.prototype.constructor=o,n(o,t)}function O(o){var t=typeof Map=="function"?new Map:void 0;return O=function(g){if(g===null||!u(g))return g;if(typeof g!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(g))return t.get(g);t.set(g,E)}function E(){return S(g,arguments,f(this).constructor)}return E.prototype=Object.create(g.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),n(E,g)},O(o)}function S(o,t,s){return L()?S=Reflect.construct.bind():S=function(E,d,r){var l=[null];l.push.apply(l,d);var A=Function.bind.apply(E,l),x=new A;return r&&n(x,r.prototype),x},S.apply(null,arguments)}function L(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function u(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function n(o,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,E){return g.__proto__=E,g},n(o,t)}function f(o){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},f(o)}var h=Math.pow(2,17),m=function(){function o(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var t=o.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(g,E){var d=this,r=g.url;if(!r)return Promise.reject(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:g,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var l=this.config,A=l.fLoader,x=l.loader;return new Promise(function(b,D){d.loader&&d.loader.destroy();var p=d.loader=g.loader=A?new A(l):new x(l),y=v(g),I={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:g.sn==="initSegment"?1/0:h};g.stats=p.stats,p.load(y,I,{onSuccess:function(P,w,k,F){d.resetLoader(g,p),b({frag:g,part:null,payload:P.data,networkDetails:F})},onError:function(P,w,k){d.resetLoader(g,p),D(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:g,response:P,networkDetails:k}))},onAbort:function(P,w,k){d.resetLoader(g,p),D(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:g,networkDetails:k}))},onTimeout:function(P,w,k){d.resetLoader(g,p),D(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:g,networkDetails:k}))},onProgress:function(P,w,k,F){E&&E({frag:g,part:null,payload:k,networkDetails:F})}})})},t.loadPart=function(g,E,d){var r=this;this.abort();var l=this.config,A=l.fLoader,x=l.loader;return new Promise(function(b,D){r.loader&&r.loader.destroy();var p=r.loader=g.loader=A?new A(l):new x(l),y=v(g,E),I={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:h};E.stats=p.stats,p.load(y,I,{onSuccess:function(P,w,k,F){r.resetLoader(g,p),r.updateStatsFromPart(g,E);var _={frag:g,part:E,payload:P.data,networkDetails:F};d(_),b(_)},onError:function(P,w,k){r.resetLoader(g,p),D(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:g,part:E,response:P,networkDetails:k}))},onAbort:function(P,w,k){g.stats.aborted=E.stats.aborted,r.resetLoader(g,p),D(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:g,part:E,networkDetails:k}))},onTimeout:function(P,w,k){r.resetLoader(g,p),D(new T({type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:g,part:E,networkDetails:k}))}})})},t.updateStatsFromPart=function(g,E){var d=g.stats,r=E.stats,l=r.total;if(d.loaded+=r.loaded,l){var A=Math.round(g.duration/E.duration),x=Math.min(Math.round(d.loaded/l),A),b=A-x,D=b*Math.round(d.loaded/x);d.total=d.loaded+D}else d.total=Math.max(d.loaded,d.total);var p=d.loading,y=r.loading;p.start?p.first+=y.first-y.start:(p.start=y.start,p.first=y.first),p.end=y.end},t.resetLoader=function(g,E){g.loader=null,this.loader===E&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),E.destroy()},o}();function v(o,t){t===void 0&&(t=null);var s=t||o,g={frag:o,part:t,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},E=s.byteRangeStartOffset,d=s.byteRangeEndOffset;return Object(a.isFiniteNumber)(E)&&Object(a.isFiniteNumber)(d)&&(g.rangeStart=E,g.rangeEnd=d),g}var T=function(o){c(t,o);function t(s){for(var g,E=arguments.length,d=new Array(E>1?E-1:0),r=1;r<E;r++)d[r-1]=arguments[r];return g=o.call.apply(o,[this].concat(d))||this,g.data=void 0,g.data=s,g}return t}(O(Error))},"./src/loader/fragment.ts":function(R,M,i){i.r(M),i.d(M,"ElementaryStreamTypes",function(){return h}),i.d(M,"BaseSegment",function(){return m}),i.d(M,"Fragment",function(){return v}),i.d(M,"Part",function(){return T});var a=i("./src/polyfills/number.ts"),e=i("./node_modules/url-toolkit/src/url-toolkit.js"),c=i("./src/utils/logger.ts"),O=i("./src/loader/level-key.ts"),S=i("./src/loader/load-stats.ts");function L(o,t){o.prototype=Object.create(t.prototype),o.prototype.constructor=o,u(o,t)}function u(o,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,E){return g.__proto__=E,g},u(o,t)}function n(o,t){for(var s=0;s<t.length;s++){var g=t[s];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(o,g.key,g)}}function f(o,t,s){return t&&n(o.prototype,t),s&&n(o,s),Object.defineProperty(o,"prototype",{writable:!1}),o}var h;(function(o){o.AUDIO="audio",o.VIDEO="video",o.AUDIOVIDEO="audiovideo"})(h||(h={}));var m=function(){function o(s){var g;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(g={},g[h.AUDIO]=null,g[h.VIDEO]=null,g[h.AUDIOVIDEO]=null,g),this.baseurl=s}var t=o.prototype;return t.setByteRange=function(g,E){var d=g.split("@",2),r=[];d.length===1?r[0]=E?E.byteRangeEndOffset:0:r[0]=parseInt(d[1]),r[1]=parseInt(d[0])+r[0],this._byteRange=r},f(o,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(e.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(g){this._url=g}}]),o}(),v=function(o){L(t,o);function t(g,E){var d;return d=o.call(this,E)||this,d._decryptdata=null,d.rawProgramDateTime=null,d.programDateTime=null,d.tagList=[],d.duration=0,d.sn=0,d.levelkey=void 0,d.type=void 0,d.loader=null,d.level=-1,d.cc=0,d.startPTS=void 0,d.endPTS=void 0,d.appendedPTS=void 0,d.startDTS=void 0,d.endDTS=void 0,d.start=0,d.deltaPTS=void 0,d.maxStartPTS=void 0,d.minEndPTS=void 0,d.stats=new S.LoadStats,d.urlId=0,d.data=void 0,d.bitrateTest=!1,d.title=null,d.initSegment=null,d.type=g,d}var s=t.prototype;return s.createInitializationVector=function(E){for(var d=new Uint8Array(16),r=12;r<16;r++)d[r]=E>>8*(15-r)&255;return d},s.setDecryptDataFromLevelKey=function(E,d){var r=E;return(E==null?void 0:E.method)==="AES-128"&&E.uri&&!E.iv&&(r=O.LevelKey.fromURI(E.uri),r.method=E.method,r.iv=this.createInitializationVector(d),r.keyFormat="identity"),r},s.setElementaryStreamInfo=function(E,d,r,l,A,x){x===void 0&&(x=!1);var b=this.elementaryStreams,D=b[E];if(!D){b[E]={startPTS:d,endPTS:r,startDTS:l,endDTS:A,partial:x};return}D.startPTS=Math.min(D.startPTS,d),D.endPTS=Math.max(D.endPTS,r),D.startDTS=Math.min(D.startDTS,l),D.endDTS=Math.max(D.endDTS,A)},s.clearElementaryStreamInfo=function(){var E=this.elementaryStreams;E[h.AUDIO]=null,E[h.VIDEO]=null,E[h.AUDIOVIDEO]=null},f(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var E=this.sn;typeof E!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),E=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,E)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(a.isFiniteNumber)(this.programDateTime))return null;var E=Object(a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+E*1e3}},{key:"encrypted",get:function(){var E;return!!((E=this.decryptdata)!==null&&E!==void 0&&E.keyFormat&&this.decryptdata.uri)}}]),t}(m),T=function(o){L(t,o);function t(s,g,E,d,r){var l;l=o.call(this,E)||this,l.fragOffset=0,l.duration=0,l.gap=!1,l.independent=!1,l.relurl=void 0,l.fragment=void 0,l.index=void 0,l.stats=new S.LoadStats,l.duration=s.decimalFloatingPoint("DURATION"),l.gap=s.bool("GAP"),l.independent=s.bool("INDEPENDENT"),l.relurl=s.enumeratedString("URI"),l.fragment=g,l.index=d;var A=s.enumeratedString("BYTERANGE");return A&&l.setByteRange(A,r),r&&(l.fragOffset=r.fragOffset+r.duration),l}return f(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var g=this.elementaryStreams;return!!(g.audio||g.video||g.audiovideo)}}]),t}(m)},"./src/loader/key-loader.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return O});var a=i("./src/events.ts"),e=i("./src/errors.ts"),c=i("./src/utils/logger.ts"),O=function(){function S(u){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=u,this._registerListeners()}var L=S.prototype;return L._registerListeners=function(){this.hls.on(a.Events.KEY_LOADING,this.onKeyLoading,this)},L._unregisterListeners=function(){this.hls.off(a.Events.KEY_LOADING,this.onKeyLoading)},L.destroy=function(){this._unregisterListeners();for(var n in this.loaders){var f=this.loaders[n];f&&f.destroy()}this.loaders={}},L.onKeyLoading=function(n,f){var h=f.frag,m=h.type,v=this.loaders[m];if(!h.decryptdata){c.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var T=h.decryptdata.uri;if(T!==this.decrypturl||this.decryptkey===null){var o=this.hls.config;if(v&&(c.logger.warn("abort previous key loader for type:"+m),v.abort()),!T){c.logger.warn("key uri is falsy");return}var t=o.loader,s=h.loader=this.loaders[m]=new t(o);this.decrypturl=T,this.decryptkey=null;var g={url:T,frag:h,responseType:"arraybuffer"},E={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:0},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};s.load(g,E,d)}else this.decryptkey&&(h.decryptdata.key=this.decryptkey,this.hls.trigger(a.Events.KEY_LOADED,{frag:h}))},L.loadsuccess=function(n,f,h){var m=h.frag;if(!m.decryptdata){c.logger.error("after key load, decryptdata unset");return}this.decryptkey=m.decryptdata.key=new Uint8Array(n.data),m.loader=null,delete this.loaders[m.type],this.hls.trigger(a.Events.KEY_LOADED,{frag:m})},L.loaderror=function(n,f){var h=f.frag,m=h.loader;m&&m.abort(),delete this.loaders[h.type],this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:h,response:n})},L.loadtimeout=function(n,f){var h=f.frag,m=h.loader;m&&m.abort(),delete this.loaders[h.type],this.hls.trigger(a.Events.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:h})},S}()},"./src/loader/level-details.ts":function(R,M,i){i.r(M),i.d(M,"LevelDetails",function(){return S});var a=i("./src/polyfills/number.ts");function e(L,u){for(var n=0;n<u.length;n++){var f=u[n];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(L,f.key,f)}}function c(L,u,n){return u&&e(L.prototype,u),n&&e(L,n),Object.defineProperty(L,"prototype",{writable:!1}),L}var O=10,S=function(){function L(n){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=n}var u=L.prototype;return u.reloaded=function(f){if(!f){this.advanced=!0,this.updated=!0;return}var h=this.lastPartSn-f.lastPartSn,m=this.lastPartIndex-f.lastPartIndex;this.updated=this.endSN!==f.endSN||!!m||!!h,this.advanced=this.endSN>f.endSN||h>0||h===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(f.misses*.6):this.misses=f.misses+1,this.availabilityDelay=f.availabilityDelay},c(L,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(a.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||O}},{key:"drift",get:function(){var f=this.driftEndTime-this.driftStartTime;if(f>0){var h=this.driftEnd-this.driftStart;return h*1e3/f}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var f;return(f=this.fragments)!==null&&f!==void 0&&f.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),L}()},"./src/loader/level-key.ts":function(R,M,i){i.r(M),i.d(M,"LevelKey",function(){return O});var a=i("./node_modules/url-toolkit/src/url-toolkit.js");function e(S,L){for(var u=0;u<L.length;u++){var n=L[u];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(S,n.key,n)}}function c(S,L,u){return L&&e(S.prototype,L),u&&e(S,u),Object.defineProperty(S,"prototype",{writable:!1}),S}var O=function(){S.fromURL=function(u,n){return new S(u,n)},S.fromURI=function(u){return new S(u)};function S(L,u){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,u?this._uri=Object(a.buildAbsoluteURL)(L,u,{alwaysNormalize:!0}):this._uri=L}return c(S,[{key:"uri",get:function(){return this._uri}}]),S}()},"./src/loader/load-stats.ts":function(R,M,i){i.r(M),i.d(M,"LoadStats",function(){return a});var a=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return s});var a=i("./src/polyfills/number.ts"),e=i("./node_modules/url-toolkit/src/url-toolkit.js"),c=i("./src/loader/date-range.ts"),O=i("./src/loader/fragment.ts"),S=i("./src/loader/level-details.ts"),L=i("./src/loader/level-key.ts"),u=i("./src/utils/attr-list.ts"),n=i("./src/utils/logger.ts"),f=i("./src/utils/codecs.ts"),h=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,v=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),T=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),o=/\.(mp4|m4s|m4v|m4a)$/i;function t(A){var x,b;return o.test((x=(b=e.parseURL(A))===null||b===void 0?void 0:b.path)!=null?x:"")}var s=function(){function A(){}return A.findGroup=function(b,D){for(var p=0;p<b.length;p++){var y=b[p];if(y.id===D)return y}},A.convertAVC1ToAVCOTI=function(b){var D=b.split(".");if(D.length>2){var p=D.shift()+".";return p+=parseInt(D.shift()).toString(16),p+=("000"+parseInt(D.shift()).toString(16)).slice(-4),p}return b},A.resolve=function(b,D){return e.buildAbsoluteURL(D,b,{alwaysNormalize:!0})},A.parseMasterPlaylist=function(b,D){var p=[],y={},I=!1;h.lastIndex=0;for(var C;(C=h.exec(b))!=null;)if(C[1]){var P=new u.AttrList(C[1]),w={attrs:P,bitrate:P.decimalInteger("AVERAGE-BANDWIDTH")||P.decimalInteger("BANDWIDTH"),name:P.NAME,url:A.resolve(C[2],D)},k=P.decimalResolution("RESOLUTION");k&&(w.width=k.width,w.height=k.height),g((P.CODECS||"").split(/[ ,]+/).filter(function(_){return _}),w),w.videoCodec&&w.videoCodec.indexOf("avc1")!==-1&&(w.videoCodec=A.convertAVC1ToAVCOTI(w.videoCodec)),p.push(w)}else if(C[3]){var F=new u.AttrList(C[3]);F["DATA-ID"]&&(I=!0,y[F["DATA-ID"]]=F)}return{levels:p,sessionData:I?y:null}},A.parseMasterPlaylistMedia=function(b,D,p,y){y===void 0&&(y=[]);var I,C=[],P=0;for(m.lastIndex=0;(I=m.exec(b))!==null;){var w=new u.AttrList(I[1]);if(w.TYPE===p){var k={attrs:w,bitrate:0,id:P++,groupId:w["GROUP-ID"],instreamId:w["INSTREAM-ID"],name:w.NAME||w.LANGUAGE||"",type:p,default:w.bool("DEFAULT"),autoselect:w.bool("AUTOSELECT"),forced:w.bool("FORCED"),lang:w.LANGUAGE,url:w.URI?A.resolve(w.URI,D):""};if(y.length){var F=A.findGroup(y,k.groupId)||y[0];E(k,F,"audioCodec"),E(k,F,"textCodec")}C.push(k)}}return C},A.parseLevelPlaylist=function(b,D,p,y,I){var C=new S.LevelDetails(D),P=C.fragments,w=null,k=0,F=0,_=0,B=0,N=null,U=new O.Fragment(y,D),j,K,H,G=-1,W=!1;for(v.lastIndex=0,C.m3u8=b;(j=v.exec(b))!==null;){W&&(W=!1,U=new O.Fragment(y,D),U.start=_,U.sn=k,U.cc=B,U.level=p,w&&(U.initSegment=w,U.rawProgramDateTime=w.rawProgramDateTime,w.rawProgramDateTime=null));var X=j[1];if(X){U.duration=parseFloat(X);var z=(" "+j[2]).slice(1);U.title=z||null,U.tagList.push(z?["INF",X,z]:["INF",X])}else if(j[3])Object(a.isFiniteNumber)(U.duration)&&(U.start=_,H&&(U.levelkey=H),U.sn=k,U.level=p,U.cc=B,U.urlId=I,P.push(U),U.relurl=(" "+j[3]).slice(1),r(U,N),N=U,_+=U.duration,k++,F=0,W=!0);else if(j[4]){var Q=(" "+j[4]).slice(1);N?U.setByteRange(Q,N):U.setByteRange(Q)}else if(j[5])U.rawProgramDateTime=(" "+j[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),G===-1&&(G=P.length);else{if(j=j[0].match(T),!j){n.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<j.length&&!(typeof j[K]<"u");K++);var $=(" "+j[K]).slice(1),Y=(" "+j[K+1]).slice(1),J=j[K+2]?(" "+j[K+2]).slice(1):"";switch($){case"PLAYLIST-TYPE":C.type=Y.toUpperCase();break;case"MEDIA-SEQUENCE":k=C.startSN=parseInt(Y);break;case"SKIP":{var q=new u.AttrList(Y),tt=q.decimalInteger("SKIPPED-SEGMENTS");if(Object(a.isFiniteNumber)(tt)){C.skippedSegments=tt;for(var et=tt;et--;)P.unshift(null);k+=tt}var rt=q.enumeratedString("RECENTLY-REMOVED-DATERANGES");rt&&(C.recentlyRemovedDateranges=rt.split("	"));break}case"TARGETDURATION":C.targetduration=parseFloat(Y);break;case"VERSION":C.version=parseInt(Y);break;case"EXTM3U":break;case"ENDLIST":C.live=!1;break;case"#":(Y||J)&&U.tagList.push(J?[Y,J]:[Y]);break;case"DISCONTINUITY":B++,U.tagList.push(["DIS"]);break;case"GAP":U.tagList.push([$]);break;case"BITRATE":U.tagList.push([$,Y]);break;case"DATERANGE":{var V=new u.AttrList(Y),it=new c.DateRange(V,C.dateRanges[V.ID]);it.isValid||C.skippedSegments?C.dateRanges[it.id]=it:n.logger.warn('Ignoring invalid DATERANGE tag: "'+Y+'"'),U.tagList.push(["EXT-X-DATERANGE",Y]);break}case"DISCONTINUITY-SEQUENCE":B=parseInt(Y);break;case"KEY":{var at,ot=new u.AttrList(Y),ut=ot.enumeratedString("METHOD"),nt=ot.URI,ft=ot.hexadecimalInteger("IV"),st=ot.enumeratedString("KEYFORMATVERSIONS"),dt=ot.enumeratedString("KEYID"),pt=(at=ot.enumeratedString("KEYFORMAT"))!=null?at:"identity",yt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(yt.indexOf(pt)>-1){n.logger.warn("Keyformat "+pt+" is not supported from the manifest");continue}else if(pt!=="identity")continue;ut&&(H=L.LevelKey.fromURL(D,nt),nt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ut)>=0&&(H.method=ut,H.keyFormat=pt,dt&&(H.keyID=dt),st&&(H.keyFormatVersions=st),H.iv=ft));break}case"START":{var gt=new u.AttrList(Y),lt=gt.decimalFloatingPoint("TIME-OFFSET");Object(a.isFiniteNumber)(lt)&&(C.startTimeOffset=lt);break}case"MAP":{var ct=new u.AttrList(Y);if(U.duration){var ht=new O.Fragment(y,D);l(ht,ct,p,H),w=ht,U.initSegment=w,w.rawProgramDateTime&&!U.rawProgramDateTime&&(U.rawProgramDateTime=w.rawProgramDateTime)}else l(U,ct,p,H),w=U,W=!0;break}case"SERVER-CONTROL":{var vt=new u.AttrList(Y);C.canBlockReload=vt.bool("CAN-BLOCK-RELOAD"),C.canSkipUntil=vt.optionalFloat("CAN-SKIP-UNTIL",0),C.canSkipDateRanges=C.canSkipUntil>0&&vt.bool("CAN-SKIP-DATERANGES"),C.partHoldBack=vt.optionalFloat("PART-HOLD-BACK",0),C.holdBack=vt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Et=new u.AttrList(Y);C.partTarget=Et.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Z=C.partList;Z||(Z=C.partList=[]);var mt=F>0?Z[Z.length-1]:void 0,St=F++,bt=new O.Part(new u.AttrList(Y),U,D,St,mt);Z.push(bt),U.duration+=bt.duration;break}case"PRELOAD-HINT":{var Dt=new u.AttrList(Y);C.preloadHint=Dt;break}case"RENDITION-REPORT":{var Tt=new u.AttrList(Y);C.renditionReports=C.renditionReports||[],C.renditionReports.push(Tt);break}default:n.logger.warn("line parsed but not handled: "+j);break}}}N&&!N.relurl?(P.pop(),_-=N.duration,C.partList&&(C.fragmentHint=N)):C.partList&&(r(U,N),U.cc=B,C.fragmentHint=U);var It=P.length,Ot=P[0],Lt=P[It-1];if(_+=C.skippedSegments*C.targetduration,_>0&&It&&Lt){C.averagetargetduration=_/It;var Ct=Lt.sn;C.endSN=Ct!=="initSegment"?Ct:0,Ot&&(C.startCC=Ot.cc,Ot.initSegment||C.fragments.every(function(At){return At.relurl&&t(At.relurl)})&&(n.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new O.Fragment(y,D),U.relurl=Lt.relurl,U.level=p,U.sn="initSegment",Ot.initSegment=U,C.needSidxRanges=!0))}else C.endSN=0,C.startCC=0;return C.fragmentHint&&(_+=C.fragmentHint.duration),C.totalduration=_,C.endCC=B,G>0&&d(P,G),C},A}();function g(A,x){["video","audio","text"].forEach(function(b){var D=A.filter(function(y){return Object(f.isCodecType)(y,b)});if(D.length){var p=D.filter(function(y){return y.lastIndexOf("avc1",0)===0||y.lastIndexOf("mp4a",0)===0});x[b+"Codec"]=p.length>0?p[0]:D[0],A=A.filter(function(y){return D.indexOf(y)===-1})}}),x.unknownCodecs=A}function E(A,x,b){var D=x[b];D&&(A[b]=D)}function d(A,x){for(var b=A[x],D=x;D--;){var p=A[D];if(!p)return;p.programDateTime=b.programDateTime-p.duration*1e3,b=p}}function r(A,x){A.rawProgramDateTime?A.programDateTime=Date.parse(A.rawProgramDateTime):x!=null&&x.programDateTime&&(A.programDateTime=x.endProgramDateTime),Object(a.isFiniteNumber)(A.programDateTime)||(A.programDateTime=null,A.rawProgramDateTime=null)}function l(A,x,b,D){A.relurl=x.URI,x.BYTERANGE&&A.setByteRange(x.BYTERANGE),A.level=b,A.sn="initSegment",D&&(A.levelkey=D),A.initSegment=null}},"./src/loader/playlist-loader.ts":function(R,M,i){i.r(M);var a=i("./src/polyfills/number.ts"),e=i("./src/events.ts"),c=i("./src/errors.ts"),O=i("./src/utils/logger.ts"),S=i("./src/utils/mp4-tools.ts"),L=i("./src/loader/m3u8-parser.ts"),u=i("./src/types/loader.ts"),n=i("./src/utils/attr-list.ts");function f(v){var T=v.type;switch(T){case u.PlaylistContextType.AUDIO_TRACK:return u.PlaylistLevelType.AUDIO;case u.PlaylistContextType.SUBTITLE_TRACK:return u.PlaylistLevelType.SUBTITLE;default:return u.PlaylistLevelType.MAIN}}function h(v,T){var o=v.url;return(o===void 0||o.indexOf("data:")===0)&&(o=T.url),o}var m=function(){function v(o){this.hls=void 0,this.loaders=Object.create(null),this.hls=o,this.registerListeners()}var T=v.prototype;return T.registerListeners=function(){var t=this.hls;t.on(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(e.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(e.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(e.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.unregisterListeners=function(){var t=this.hls;t.off(e.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(e.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(e.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(e.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.createInternalLoader=function(t){var s=this.hls.config,g=s.pLoader,E=s.loader,d=g||E,r=new d(s);return t.loader=r,this.loaders[t.type]=r,r},T.getInternalLoader=function(t){return this.loaders[t.type]},T.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},T.destroyInternalLoaders=function(){for(var t in this.loaders){var s=this.loaders[t];s&&s.destroy(),this.resetInternalLoader(t)}},T.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},T.onManifestLoading=function(t,s){var g=s.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:u.PlaylistContextType.MANIFEST,url:g,deliveryDirectives:null})},T.onLevelLoading=function(t,s){var g=s.id,E=s.level,d=s.url,r=s.deliveryDirectives;this.load({id:g,groupId:null,level:E,responseType:"text",type:u.PlaylistContextType.LEVEL,url:d,deliveryDirectives:r})},T.onAudioTrackLoading=function(t,s){var g=s.id,E=s.groupId,d=s.url,r=s.deliveryDirectives;this.load({id:g,groupId:E,level:null,responseType:"text",type:u.PlaylistContextType.AUDIO_TRACK,url:d,deliveryDirectives:r})},T.onSubtitleTrackLoading=function(t,s){var g=s.id,E=s.groupId,d=s.url,r=s.deliveryDirectives;this.load({id:g,groupId:E,level:null,responseType:"text",type:u.PlaylistContextType.SUBTITLE_TRACK,url:d,deliveryDirectives:r})},T.load=function(t){var s,g=this.hls.config,E=this.getInternalLoader(t);if(E){var d=E.context;if(d&&d.url===t.url){O.logger.trace("[playlist-loader]: playlist request ongoing");return}O.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),E.abort()}var r,l,A,x;switch(t.type){case u.PlaylistContextType.MANIFEST:r=g.manifestLoadingMaxRetry,l=g.manifestLoadingTimeOut,A=g.manifestLoadingRetryDelay,x=g.manifestLoadingMaxRetryTimeout;break;case u.PlaylistContextType.LEVEL:case u.PlaylistContextType.AUDIO_TRACK:case u.PlaylistContextType.SUBTITLE_TRACK:r=0,l=g.levelLoadingTimeOut;break;default:r=g.levelLoadingMaxRetry,l=g.levelLoadingTimeOut,A=g.levelLoadingRetryDelay,x=g.levelLoadingMaxRetryTimeout;break}if(E=this.createInternalLoader(t),(s=t.deliveryDirectives)!==null&&s!==void 0&&s.part){var b;if(t.type===u.PlaylistContextType.LEVEL&&t.level!==null?b=this.hls.levels[t.level].details:t.type===u.PlaylistContextType.AUDIO_TRACK&&t.id!==null?b=this.hls.audioTracks[t.id].details:t.type===u.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(b=this.hls.subtitleTracks[t.id].details),b){var D=b.partTarget,p=b.targetduration;D&&p&&(l=Math.min(Math.max(D*3,p*.8)*1e3,l))}}var y={timeout:l,maxRetry:r,retryDelay:A,maxRetryDelay:x,highWaterMark:0},I={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};E.load(t,y,I)},T.loadsuccess=function(t,s,g,E){if(E===void 0&&(E=null),g.isSidxRequest){this.handleSidxRequest(t,g),this.handlePlaylistLoaded(t,s,g,E);return}this.resetInternalLoader(g.type);var d=t.data;if(d.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,g,"no EXTM3U delimiter",E);return}s.parsing.start=performance.now(),d.indexOf("#EXTINF:")>0||d.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,s,g,E):this.handleMasterPlaylist(t,s,g,E)},T.loaderror=function(t,s,g){g===void 0&&(g=null),this.handleNetworkError(s,g,!1,t)},T.loadtimeout=function(t,s,g){g===void 0&&(g=null),this.handleNetworkError(s,g,!0)},T.handleMasterPlaylist=function(t,s,g,E){var d=this.hls,r=t.data,l=h(t,g),A=L.default.parseMasterPlaylist(r,l),x=A.levels,b=A.sessionData;if(!x.length){this.handleManifestParsingError(t,g,"no level found in manifest",E);return}var D=x.map(function(w){return{id:w.attrs.AUDIO,audioCodec:w.audioCodec}}),p=x.map(function(w){return{id:w.attrs.SUBTITLES,textCodec:w.textCodec}}),y=L.default.parseMasterPlaylistMedia(r,l,"AUDIO",D),I=L.default.parseMasterPlaylistMedia(r,l,"SUBTITLES",p),C=L.default.parseMasterPlaylistMedia(r,l,"CLOSED-CAPTIONS");if(y.length){var P=y.some(function(w){return!w.url});!P&&x[0].audioCodec&&!x[0].attrs.AUDIO&&(O.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new n.AttrList({}),bitrate:0,url:""}))}d.trigger(e.Events.MANIFEST_LOADED,{levels:x,audioTracks:y,subtitles:I,captions:C,url:l,stats:s,networkDetails:E,sessionData:b})},T.handleTrackOrLevelPlaylist=function(t,s,g,E){var d=this.hls,r=g.id,l=g.level,A=g.type,x=h(t,g),b=Object(a.isFiniteNumber)(r)?r:0,D=Object(a.isFiniteNumber)(l)?l:b,p=f(g),y=L.default.parseLevelPlaylist(t.data,x,D,p,b);if(!y.fragments.length){d.trigger(e.Events.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:x,reason:"no fragments found in level",level:typeof g.level=="number"?g.level:void 0});return}if(A===u.PlaylistContextType.MANIFEST){var I={attrs:new n.AttrList({}),bitrate:0,details:y,name:"",url:x};d.trigger(e.Events.MANIFEST_LOADED,{levels:[I],audioTracks:[],url:x,stats:s,networkDetails:E,sessionData:null})}if(s.parsing.end=performance.now(),y.needSidxRanges){var C,P=(C=y.fragments[0].initSegment)===null||C===void 0?void 0:C.url;this.load({url:P,isSidxRequest:!0,type:A,level:l,levelDetails:y,id:r,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}g.levelDetails=y,this.handlePlaylistLoaded(t,s,g,E)},T.handleSidxRequest=function(t,s){var g=new Uint8Array(t.data),E=Object(S.findBox)(g,["sidx"])[0];if(!!E){var d=Object(S.parseSegmentIndex)(E);if(!!d){var r=d.references,l=s.levelDetails;r.forEach(function(A,x){var b=A.info,D=l.fragments[x];if(D.byteRange.length===0&&D.setByteRange(String(1+b.end-b.start)+"@"+String(b.start)),D.initSegment){var p=Object(S.findBox)(g,["moov"])[0],y=p?p.length:null;D.initSegment.setByteRange(String(y)+"@0")}})}}},T.handleManifestParsingError=function(t,s,g,E){this.hls.trigger(e.Events.ERROR,{type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===u.PlaylistContextType.MANIFEST,url:t.url,reason:g,response:t,context:s,networkDetails:E})},T.handleNetworkError=function(t,s,g,E){g===void 0&&(g=!1),O.logger.warn("[playlist-loader]: A network "+(g?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var d=c.ErrorDetails.UNKNOWN,r=!1,l=this.getInternalLoader(t);switch(t.type){case u.PlaylistContextType.MANIFEST:d=g?c.ErrorDetails.MANIFEST_LOAD_TIMEOUT:c.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0;break;case u.PlaylistContextType.LEVEL:d=g?c.ErrorDetails.LEVEL_LOAD_TIMEOUT:c.ErrorDetails.LEVEL_LOAD_ERROR,r=!1;break;case u.PlaylistContextType.AUDIO_TRACK:d=g?c.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:c.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,r=!1;break;case u.PlaylistContextType.SUBTITLE_TRACK:d=g?c.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:c.ErrorDetails.SUBTITLE_LOAD_ERROR,r=!1;break}l&&this.resetInternalLoader(t.type);var A={type:c.ErrorTypes.NETWORK_ERROR,details:d,fatal:r,url:t.url,loader:l,context:t,networkDetails:s};E&&(A.response=E),this.hls.trigger(e.Events.ERROR,A)},T.handlePlaylistLoaded=function(t,s,g,E){var d=g.type,r=g.level,l=g.id,A=g.groupId,x=g.loader,b=g.levelDetails,D=g.deliveryDirectives;if(!(b!=null&&b.targetduration)){this.handleManifestParsingError(t,g,"invalid target duration",E);return}if(!!x)switch(b.live&&(x.getCacheAge&&(b.ageHeader=x.getCacheAge()||0),(!x.getCacheAge||isNaN(b.ageHeader))&&(b.ageHeader=0)),d){case u.PlaylistContextType.MANIFEST:case u.PlaylistContextType.LEVEL:this.hls.trigger(e.Events.LEVEL_LOADED,{details:b,level:r||0,id:l||0,stats:s,networkDetails:E,deliveryDirectives:D});break;case u.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(e.Events.AUDIO_TRACK_LOADED,{details:b,id:l||0,groupId:A||"",stats:s,networkDetails:E,deliveryDirectives:D});break;case u.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(e.Events.SUBTITLE_TRACK_LOADED,{details:b,id:l||0,groupId:A||"",stats:s,networkDetails:E,deliveryDirectives:D});break}},v}();M.default=m},"./src/polyfills/number.ts":function(R,M,i){i.r(M),i.d(M,"isFiniteNumber",function(){return a}),i.d(M,"MAX_SAFE_INTEGER",function(){return e});var a=Number.isFinite||function(c){return typeof c=="number"&&isFinite(c)},e=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(R,M,i){i.r(M);var a=function(){function e(){}return e.getSilentFrame=function(O,S){switch(O){case"mp4a.40.2":if(S===1)return new Uint8Array([0,200,0,128,35,128]);if(S===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(S===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(S===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(S===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(S===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(S===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},e}();M.default=a},"./src/remux/mp4-generator.ts":function(R,M,i){i.r(M);var a=Math.pow(2,32)-1,e=function(){function c(){}return c.init=function(){c.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var S;for(S in c.types)c.types.hasOwnProperty(S)&&(c.types[S]=[S.charCodeAt(0),S.charCodeAt(1),S.charCodeAt(2),S.charCodeAt(3)]);var L=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),u=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);c.HDLR_TYPES={video:L,audio:u};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);c.STTS=c.STSC=c.STCO=f,c.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),c.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),c.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),c.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]),m=new Uint8Array([97,118,99,49]),v=new Uint8Array([0,0,0,1]);c.FTYP=c.box(c.types.ftyp,h,v,h,m),c.DINF=c.box(c.types.dinf,c.box(c.types.dref,n))},c.box=function(S){for(var L=8,u=arguments.length,n=new Array(u>1?u-1:0),f=1;f<u;f++)n[f-1]=arguments[f];for(var h=n.length,m=h;h--;)L+=n[h].byteLength;var v=new Uint8Array(L);for(v[0]=L>>24&255,v[1]=L>>16&255,v[2]=L>>8&255,v[3]=L&255,v.set(S,4),h=0,L=8;h<m;h++)v.set(n[h],L),L+=n[h].byteLength;return v},c.hdlr=function(S){return c.box(c.types.hdlr,c.HDLR_TYPES[S])},c.mdat=function(S){return c.box(c.types.mdat,S)},c.mdhd=function(S,L){L*=S;var u=Math.floor(L/(a+1)),n=Math.floor(L%(a+1));return c.box(c.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,S&255,u>>24,u>>16&255,u>>8&255,u&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))},c.mdia=function(S){return c.box(c.types.mdia,c.mdhd(S.timescale,S.duration),c.hdlr(S.type),c.minf(S))},c.mfhd=function(S){return c.box(c.types.mfhd,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,S&255]))},c.minf=function(S){return S.type==="audio"?c.box(c.types.minf,c.box(c.types.smhd,c.SMHD),c.DINF,c.stbl(S)):c.box(c.types.minf,c.box(c.types.vmhd,c.VMHD),c.DINF,c.stbl(S))},c.moof=function(S,L,u){return c.box(c.types.moof,c.mfhd(S),c.traf(u,L))},c.moov=function(S){for(var L=S.length,u=[];L--;)u[L]=c.trak(S[L]);return c.box.apply(null,[c.types.moov,c.mvhd(S[0].timescale,S[0].duration)].concat(u).concat(c.mvex(S)))},c.mvex=function(S){for(var L=S.length,u=[];L--;)u[L]=c.trex(S[L]);return c.box.apply(null,[c.types.mvex].concat(u))},c.mvhd=function(S,L){L*=S;var u=Math.floor(L/(a+1)),n=Math.floor(L%(a+1)),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,S&255,u>>24,u>>16&255,u>>8&255,u&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return c.box(c.types.mvhd,f)},c.sdtp=function(S){var L=S.samples||[],u=new Uint8Array(4+L.length),n,f;for(n=0;n<L.length;n++)f=L[n].flags,u[n+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return c.box(c.types.sdtp,u)},c.stbl=function(S){return c.box(c.types.stbl,c.stsd(S),c.box(c.types.stts,c.STTS),c.box(c.types.stsc,c.STSC),c.box(c.types.stsz,c.STSZ),c.box(c.types.stco,c.STCO))},c.avc1=function(S){var L=[],u=[],n,f,h;for(n=0;n<S.sps.length;n++)f=S.sps[n],h=f.byteLength,L.push(h>>>8&255),L.push(h&255),L=L.concat(Array.prototype.slice.call(f));for(n=0;n<S.pps.length;n++)f=S.pps[n],h=f.byteLength,u.push(h>>>8&255),u.push(h&255),u=u.concat(Array.prototype.slice.call(f));var m=c.box(c.types.avcC,new Uint8Array([1,L[3],L[4],L[5],255,224|S.sps.length].concat(L).concat([S.pps.length]).concat(u))),v=S.width,T=S.height,o=S.pixelRatio[0],t=S.pixelRatio[1];return c.box(c.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>8&255,v&255,T>>8&255,T&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),m,c.box(c.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),c.box(c.types.pasp,new Uint8Array([o>>24,o>>16&255,o>>8&255,o&255,t>>24,t>>16&255,t>>8&255,t&255])))},c.esds=function(S){var L=S.config.length;return new Uint8Array([0,0,0,0,3,23+L,0,1,0,4,15+L,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([L]).concat(S.config).concat([6,1,2]))},c.mp4a=function(S){var L=S.samplerate;return c.box(c.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]),c.box(c.types.esds,c.esds(S)))},c.mp3=function(S){var L=S.samplerate;return c.box(c.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]))},c.stsd=function(S){return S.type==="audio"?S.segmentCodec==="mp3"&&S.codec==="mp3"?c.box(c.types.stsd,c.STSD,c.mp3(S)):c.box(c.types.stsd,c.STSD,c.mp4a(S)):c.box(c.types.stsd,c.STSD,c.avc1(S))},c.tkhd=function(S){var L=S.id,u=S.duration*S.timescale,n=S.width,f=S.height,h=Math.floor(u/(a+1)),m=Math.floor(u%(a+1));return c.box(c.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,L>>24&255,L>>16&255,L>>8&255,L&255,0,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,f>>8&255,f&255,0,0]))},c.traf=function(S,L){var u=c.sdtp(S),n=S.id,f=Math.floor(L/(a+1)),h=Math.floor(L%(a+1));return c.box(c.types.traf,c.box(c.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),c.box(c.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])),c.trun(S,u.length+16+20+8+16+8+8),u)},c.trak=function(S){return S.duration=S.duration||4294967295,c.box(c.types.trak,c.tkhd(S),c.mdia(S))},c.trex=function(S){var L=S.id;return c.box(c.types.trex,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},c.trun=function(S,L){var u=S.samples||[],n=u.length,f=12+16*n,h=new Uint8Array(f),m,v,T,o,t,s;for(L+=8+f,h.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255],0),m=0;m<n;m++)v=u[m],T=v.duration,o=v.size,t=v.flags,s=v.cts,h.set([T>>>24&255,T>>>16&255,T>>>8&255,T&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,s>>>24&255,s>>>16&255,s>>>8&255,s&255],12+16*m);return c.box(c.types.trun,h)},c.initSegment=function(S){c.types||c.init();var L=c.moov(S),u=new Uint8Array(c.FTYP.byteLength+L.byteLength);return u.set(c.FTYP),u.set(L,c.FTYP.byteLength),u},c}();e.types=void 0,e.HDLR_TYPES=void 0,e.STTS=void 0,e.STSC=void 0,e.STCO=void 0,e.STSZ=void 0,e.VMHD=void 0,e.SMHD=void 0,e.STSD=void 0,e.FTYP=void 0,e.DINF=void 0,M.default=e},"./src/remux/mp4-remuxer.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return s}),i.d(M,"normalizePts",function(){return g}),i.d(M,"flushTextTrackMetadataCueSamples",function(){return d}),i.d(M,"flushTextTrackUserdataCueSamples",function(){return r});var a=i("./src/polyfills/number.ts"),e=i("./src/remux/aac-helper.ts"),c=i("./src/remux/mp4-generator.ts"),O=i("./src/events.ts"),S=i("./src/errors.ts"),L=i("./src/utils/logger.ts"),u=i("./src/types/loader.ts"),n=i("./src/utils/timescale-conversion.ts");function f(){return f=Object.assign?Object.assign.bind():function(x){for(var b=1;b<arguments.length;b++){var D=arguments[b];for(var p in D)Object.prototype.hasOwnProperty.call(D,p)&&(x[p]=D[p])}return x},f.apply(this,arguments)}var h=10*1e3,m=1024,v=1152,T=null,o=null,t=!1,s=function(){function x(D,p,y,I){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=D,this.config=p,this.typeSupported=y,this.ISGenerated=!1,T===null){var C=navigator.userAgent||"",P=C.match(/Chrome\/(\d+)/i);T=P?parseInt(P[1]):0}if(o===null){var w=navigator.userAgent.match(/Safari\/(\d+)/i);o=w?parseInt(w[1]):0}t=!(!!T&&T>=75||!!o&&o>=600)}var b=x.prototype;return b.destroy=function(){},b.resetTimeStamp=function(p){L.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=p},b.resetNextTimestamp=function(){L.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},b.resetInitSegment=function(){L.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},b.getVideoStartPts=function(p){var y=!1,I=p.reduce(function(C,P){var w=P.pts-C;return w<-4294967296?(y=!0,g(C,P.pts)):w>0?C:P.pts},p[0].pts);return y&&L.logger.debug("PTS rollover detected"),I},b.remux=function(p,y,I,C,P,w,k,F){var _,B,N,U,j,K,H=P,G=P,W=p.pid>-1,X=y.pid>-1,z=y.samples.length,Q=p.samples.length>0,$=k&&z>0||z>1,Y=(!W||Q)&&(!X||$)||this.ISGenerated||k;if(Y){this.ISGenerated||(N=this.generateIS(p,y,P));var J=this.isVideoContiguous,q=-1,tt;if($&&(q=E(y.samples),!J&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,q>0){L.logger.warn("[mp4-remuxer]: Dropped "+q+" out of "+z+" video samples due to a missing keyframe");var et=this.getVideoStartPts(y.samples);y.samples=y.samples.slice(q),y.dropped+=q,G+=(y.samples[0].pts-et)/y.inputTimeScale,tt=G}else q===-1&&(L.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),K=!1);if(this.ISGenerated){if(Q&&$){var rt=this.getVideoStartPts(y.samples),V=g(p.samples[0].pts,rt)-rt,it=V/y.inputTimeScale;H+=Math.max(0,it),G+=Math.max(0,-it)}if(Q){if(p.samplerate||(L.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(p,y,P)),B=this.remuxAudio(p,H,this.isAudioContiguous,w,X||$||F===u.PlaylistLevelType.AUDIO?G:void 0),$){var at=B?B.endPTS-B.startPTS:0;y.inputTimeScale||(L.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(p,y,P)),_=this.remuxVideo(y,G,J,at)}}else $&&(_=this.remuxVideo(y,G,J,0));_&&(_.firstKeyFrame=q,_.independent=q!==-1,_.firstKeyFramePTS=tt)}}return this.ISGenerated&&(I.samples.length&&(j=d(I,P,this._initPTS,this._initDTS)),C.samples.length&&(U=r(C,P,this._initPTS))),{audio:B,video:_,initSegment:N,independent:K,text:U,id3:j}},b.generateIS=function(p,y,I){var C=p.samples,P=y.samples,w=this.typeSupported,k={},F=!Object(a.isFiniteNumber)(this._initPTS),_="audio/mp4",B,N,U;if(F&&(B=N=1/0),p.config&&C.length){switch(p.timescale=p.samplerate,p.segmentCodec){case"mp3":w.mpeg?(_="audio/mpeg",p.codec=""):w.mp3&&(p.codec="mp3");break}k.audio={id:"audio",container:_,codec:p.codec,initSegment:p.segmentCodec==="mp3"&&w.mpeg?new Uint8Array(0):c.default.initSegment([p]),metadata:{channelCount:p.channelCount}},F&&(U=p.inputTimeScale,B=N=C[0].pts-Math.round(U*I))}if(y.sps&&y.pps&&P.length&&(y.timescale=y.inputTimeScale,k.video={id:"main",container:"video/mp4",codec:y.codec,initSegment:c.default.initSegment([y]),metadata:{width:y.width,height:y.height}},F)){U=y.inputTimeScale;var j=this.getVideoStartPts(P),K=Math.round(U*I);N=Math.min(N,g(P[0].dts,j)-K),B=Math.min(B,j-K)}if(Object.keys(k).length)return this.ISGenerated=!0,F&&(this._initPTS=B,this._initDTS=N),{tracks:k,initPTS:B,timescale:U}},b.remuxVideo=function(p,y,I,C){var P=p.inputTimeScale,w=p.samples,k=[],F=w.length,_=this._initPTS,B=this.nextAvcDts,N=8,U=this.videoSampleDuration,j,K,H=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,W=0,X=!1;if(!I||B===null){var z=y*P,Q=w[0].pts-g(w[0].dts,w[0].pts);B=z-Q}for(var $=0;$<F;$++){var Y=w[$];if(Y.pts=g(Y.pts-_,B),Y.dts=g(Y.dts-_,B),Y.dts>Y.pts){var J=18e3;W=Math.max(Math.min(W,Y.pts-Y.dts),-1*J)}Y.dts<w[$>0?$-1:$].dts&&(X=!0)}X&&w.sort(function(wt,Bt){var Vt=wt.dts-Bt.dts,zt=wt.pts-Bt.pts;return Vt||zt}),j=w[0].dts,K=w[w.length-1].dts;var q=K-j,tt=q?Math.round(q/(F-1)):U||p.inputTimeScale/30;if(W<0){if(W<tt*-2){L.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(n.toMsFromMpegTsClock)(-tt,!0)+" ms");for(var et=W,rt=0;rt<F;rt++)w[rt].dts=et=Math.max(et,w[rt].pts-tt),w[rt].pts=Math.max(et,w[rt].pts)}else{L.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(n.toMsFromMpegTsClock)(W,!0)+" ms to overcome this issue");for(var V=0;V<F;V++)w[V].dts=w[V].dts+W}j=w[0].dts}if(I){var it=j-B,at=it>tt,ot=it<-1;if(at||ot){at?L.logger.warn("AVC: "+Object(n.toMsFromMpegTsClock)(it,!0)+" ms ("+it+"dts) hole between fragments detected, filling it"):L.logger.warn("AVC: "+Object(n.toMsFromMpegTsClock)(-it,!0)+" ms ("+it+"dts) overlapping between fragments detected"),j=B;var ut=w[0].pts-it;w[0].dts=j,w[0].pts=ut,L.logger.log("Video: First PTS/DTS adjusted: "+Object(n.toMsFromMpegTsClock)(ut,!0)+"/"+Object(n.toMsFromMpegTsClock)(j,!0)+", delta: "+Object(n.toMsFromMpegTsClock)(it,!0)+" ms")}}t&&(j=Math.max(0,j));for(var nt=0,ft=0,st=0;st<F;st++){for(var dt=w[st],pt=dt.units,yt=pt.length,gt=0,lt=0;lt<yt;lt++)gt+=pt[lt].data.length;ft+=gt,nt+=yt,dt.length=gt,dt.dts=Math.max(dt.dts,j),dt.pts=Math.max(dt.pts,dt.dts,0),H=Math.min(dt.pts,H),G=Math.max(dt.pts,G)}K=w[F-1].dts;var ct=ft+4*nt+8,ht;try{ht=new Uint8Array(ct)}catch{this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:S.ErrorTypes.MUX_ERROR,details:S.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ct,reason:"fail allocating video mdat "+ct});return}var vt=new DataView(ht.buffer);vt.setUint32(0,ct),ht.set(c.default.types.mdat,4);for(var Et=!1,Z=0;Z<F;Z++){for(var mt=w[Z],St=mt.units,bt=0,Dt=0,Tt=St.length;Dt<Tt;Dt++){var It=St[Dt],Ot=It.data,Lt=It.data.byteLength;vt.setUint32(N,Lt),N+=4,ht.set(Ot,N),N+=Lt,bt+=4+Lt}if(Z<F-1)U=w[Z+1].dts-mt.dts;else{var Ct=this.config,At=Z>0?mt.dts-w[Z-1].dts:tt;if(Ct.stretchShortVideoTrack&&this.nextAudioPts!==null){var Kt=Math.floor(Ct.maxBufferHole*P),Mt=(C?H+C*P:this.nextAudioPts)-mt.pts;Mt>Kt?(U=Mt-At,U<0?U=At:Et=!0,L.logger.log("[mp4-remuxer]: It is approximately "+Mt/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=At}else U=At}var Wt=Math.round(mt.pts-mt.dts);k.push(new l(mt.key,U,bt,Wt))}if(k.length&&T&&T<70){var _t=k[0].flags;_t.dependsOn=2,_t.isNonSync=0}console.assert(U!==null,"mp4SampleDuration must be computed"),U=Et||!U?tt:U,this.nextAvcDts=B=K+U,this.videoSampleDuration=U,this.isVideoContiguous=!0;var Ht=c.default.moof(p.sequenceNumber++,j,f({},p,{samples:k})),Gt="video",$t={data1:Ht,data2:ht,startPTS:H/P,endPTS:(G+U)/P,startDTS:j/P,endDTS:B/P,type:Gt,hasAudio:!1,hasVideo:!0,nb:k.length,dropped:p.dropped};return p.samples=[],p.dropped=0,console.assert(ht.length,"MDAT length must not be zero"),$t},b.remuxAudio=function(p,y,I,C,P){var w=p.inputTimeScale,k=p.samplerate?p.samplerate:w,F=w/k,_=p.segmentCodec==="aac"?m:v,B=_*F,N=this._initPTS,U=p.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],K=P!==void 0,H=p.samples,G=U?0:8,W=this.nextAudioPts||-1,X=y*w;if(this.isAudioContiguous=I=I||H.length&&W>0&&(C&&Math.abs(X-W)<9e3||Math.abs(g(H[0].pts-N,X)-W)<20*B),H.forEach(function(Tt){Tt.pts=g(Tt.pts-N,X)}),!I||W<0){if(H=H.filter(function(Tt){return Tt.pts>=0}),!H.length)return;P===0?W=0:C&&!K?W=Math.max(0,X):W=H[0].pts}if(p.segmentCodec==="aac")for(var z=this.config.maxAudioFramesDrift,Q=0,$=W;Q<H.length;Q++){var Y=H[Q],J=Y.pts,q=J-$,tt=Math.abs(1e3*q/w);if(q<=-z*B&&K)Q===0&&(L.logger.warn("Audio frame @ "+(J/w).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*q/w)+" ms."),this.nextAudioPts=W=$=J);else if(q>=z*B&&tt<h&&K){var et=Math.round(q/B);$=J-et*B,$<0&&(et--,$+=B),Q===0&&(this.nextAudioPts=W=$),L.logger.warn("[mp4-remuxer]: Injecting "+et+" audio frame @ "+($/w).toFixed(3)+"s due to "+Math.round(1e3*q/w)+" ms gap.");for(var rt=0;rt<et;rt++){var V=Math.max($,0),it=e.default.getSilentFrame(p.manifestCodec||p.codec,p.channelCount);it||(L.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),it=Y.unit.subarray()),H.splice(Q,0,{unit:it,pts:V}),$+=B,Q++}}Y.pts=$,$+=B}for(var at=null,ot=null,ut,nt=0,ft=H.length;ft--;)nt+=H[ft].unit.byteLength;for(var st=0,dt=H.length;st<dt;st++){var pt=H[st],yt=pt.unit,gt=pt.pts;if(ot!==null){var lt=j[st-1];lt.duration=Math.round((gt-ot)/F)}else if(I&&p.segmentCodec==="aac"&&(gt=W),at=gt,nt>0){nt+=G;try{ut=new Uint8Array(nt)}catch{this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:S.ErrorTypes.MUX_ERROR,details:S.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:nt,reason:"fail allocating audio mdat "+nt});return}if(!U){var ct=new DataView(ut.buffer);ct.setUint32(0,nt),ut.set(c.default.types.mdat,4)}}else return;ut.set(yt,G);var ht=yt.byteLength;G+=ht,j.push(new l(!0,_,ht,0)),ot=gt}var vt=j.length;if(!!vt){var Et=j[j.length-1];this.nextAudioPts=W=ot+F*Et.duration;var Z=U?new Uint8Array(0):c.default.moof(p.sequenceNumber++,at/F,f({},p,{samples:j}));p.samples=[];var mt=at/w,St=W/w,bt="audio",Dt={data1:Z,data2:ut,startPTS:mt,endPTS:St,startDTS:mt,endDTS:St,type:bt,hasAudio:!0,hasVideo:!1,nb:vt};return this.isAudioContiguous=!0,console.assert(ut.length,"MDAT length must not be zero"),Dt}},b.remuxEmptyAudio=function(p,y,I,C){var P=p.inputTimeScale,w=p.samplerate?p.samplerate:P,k=P/w,F=this.nextAudioPts,_=(F!==null?F:C.startDTS*P)+this._initDTS,B=C.endDTS*P+this._initDTS,N=k*m,U=Math.ceil((B-_)/N),j=e.default.getSilentFrame(p.manifestCodec||p.codec,p.channelCount);if(L.logger.warn("[mp4-remuxer]: remux empty Audio"),!j){L.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],H=0;H<U;H++){var G=_+H*N;K.push({unit:j,pts:G,dts:G})}return p.samples=K,this.remuxAudio(p,y,I,!1)},x}();function g(x,b){var D;if(b===null)return x;for(b<x?D=-8589934592:D=8589934592;Math.abs(x-b)>4294967296;)x+=D;return x}function E(x){for(var b=0;b<x.length;b++)if(x[b].key)return b;return-1}function d(x,b,D,p){var y=x.samples.length;if(!!y){for(var I=x.inputTimeScale,C=0;C<y;C++){var P=x.samples[C];P.pts=g(P.pts-D,b*I)/I,P.dts=g(P.dts-p,b*I)/I}var w=x.samples;return x.samples=[],{samples:w}}}function r(x,b,D){var p=x.samples.length;if(!!p){for(var y=x.inputTimeScale,I=0;I<p;I++){var C=x.samples[I];C.pts=g(C.pts-D,b*y)/y}x.samples.sort(function(w,k){return w.pts-k.pts});var P=x.samples;return x.samples=[],{samples:P}}}var l=function(b,D,p,y){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=D,this.size=p,this.cts=y,this.flags=new A(b)},A=function(b){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=b?2:1,this.isNonSync=b?0:1}},"./src/remux/passthrough-remuxer.ts":function(R,M,i){i.r(M);var a=i("./src/polyfills/number.ts"),e=i("./src/remux/mp4-remuxer.ts"),c=i("./src/utils/mp4-tools.ts"),O=i("./src/loader/fragment.ts"),S=i("./src/utils/logger.ts"),L=function(){function f(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var h=f.prototype;return h.destroy=function(){},h.resetTimeStamp=function(v){this.initPTS=v,this.lastEndDTS=null},h.resetNextTimestamp=function(){this.lastEndDTS=null},h.resetInitSegment=function(v,T,o){this.audioCodec=T,this.videoCodec=o,this.generateInitSegment(v),this.emitInitSegment=!0},h.generateInitSegment=function(v){var T=this.audioCodec,o=this.videoCodec;if(!v||!v.byteLength){this.initTracks=void 0,this.initData=void 0;return}var t=this.initData=Object(c.parseInitSegment)(v);T||(T=n(t.audio,O.ElementaryStreamTypes.AUDIO)),o||(o=n(t.video,O.ElementaryStreamTypes.VIDEO));var s={};t.audio&&t.video?s.audiovideo={container:"video/mp4",codec:T+","+o,initSegment:v,id:"main"}:t.audio?s.audio={container:"audio/mp4",codec:T,initSegment:v,id:"audio"}:t.video?s.video={container:"video/mp4",codec:o,initSegment:v,id:"main"}:S.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},h.remux=function(v,T,o,t,s){var g,E=this.initPTS,d=this.lastEndDTS,r={audio:void 0,video:void 0,text:t,id3:o,initSegment:void 0};Object(a.isFiniteNumber)(d)||(d=this.lastEndDTS=s||0);var l=T.samples;if(!l||!l.length)return r;var A={initPTS:void 0,timescale:1},x=this.initData;if((!x||!x.length)&&(this.generateInitSegment(l),x=this.initData),!x||!x.length)return S.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),r;this.emitInitSegment&&(A.tracks=this.initTracks,this.emitInitSegment=!1),Object(a.isFiniteNumber)(E)||(this.initPTS=A.initPTS=E=u(x,l,d));var b=Object(c.getDuration)(l,x),D=d,p=b+D;Object(c.offsetStartDTS)(x,l,E),b>0?this.lastEndDTS=p:(S.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!x.audio,I=!!x.video,C="";y&&(C+="audio"),I&&(C+="video");var P={data1:l,startPTS:D,startDTS:D,endPTS:p,endDTS:p,type:C,hasAudio:y,hasVideo:I,nb:1,dropped:0};r.audio=P.type==="audio"?P:void 0,r.video=P.type!=="audio"?P:void 0,r.initSegment=A;var w=(g=this.initPTS)!=null?g:0;return r.id3=Object(e.flushTextTrackMetadataCueSamples)(o,s,w,w),t.samples.length&&(r.text=Object(e.flushTextTrackUserdataCueSamples)(t,s,w)),r},f}(),u=function(h,m,v){return Object(c.getStartDTS)(h,m)-v};function n(f,h){var m=f==null?void 0:f.codec;return m&&m.length>4?m:m==="hvc1"||m==="hev1"?"hvc1.1.c.L120.90":m==="av01"?"av01.0.04M.08":m==="avc1"||h===O.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}M.default=L},"./src/task-loop.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return a});var a=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var c=e.prototype;return c.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},c.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},c.onHandlerDestroyed=function(){},c.hasInterval=function(){return!!this._tickInterval},c.hasNextTick=function(){return!!this._tickTimer},c.setInterval=function(S){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,S),!0)},c.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},c.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},c.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},c.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},c.doTick=function(){},e}()},"./src/types/cmcd.ts":function(R,M,i){i.r(M),i.d(M,"CMCDVersion",function(){return a}),i.d(M,"CMCDObjectType",function(){return e}),i.d(M,"CMCDStreamingFormat",function(){return c}),i.d(M,"CMCDStreamType",function(){return O});var a=1,e;(function(S){S.MANIFEST="m",S.AUDIO="a",S.VIDEO="v",S.MUXED="av",S.INIT="i",S.CAPTION="c",S.TIMED_TEXT="tt",S.KEY="k",S.OTHER="o"})(e||(e={}));var c;(function(S){S.DASH="d",S.HLS="h",S.SMOOTH="s",S.OTHER="o"})(c||(c={}));var O;(function(S){S.VOD="v",S.LIVE="l"})(O||(O={}))},"./src/types/demuxer.ts":function(R,M,i){i.r(M),i.d(M,"MetadataSchema",function(){return a});var a;(function(e){e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3"})(a||(a={}))},"./src/types/level.ts":function(R,M,i){i.r(M),i.d(M,"HlsSkip",function(){return c}),i.d(M,"getSkipValue",function(){return O}),i.d(M,"HlsUrlParameters",function(){return S}),i.d(M,"Level",function(){return L});function a(u,n){for(var f=0;f<n.length;f++){var h=n[f];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(u,h.key,h)}}function e(u,n,f){return n&&a(u.prototype,n),f&&a(u,f),Object.defineProperty(u,"prototype",{writable:!1}),u}var c;(function(u){u.No="",u.Yes="YES",u.v2="v2"})(c||(c={}));function O(u,n){var f=u.canSkipUntil,h=u.canSkipDateRanges,m=u.endSN,v=n!==void 0?n-m:0;return f&&v<f?h?c.v2:c.Yes:c.No}var S=function(){function u(f,h,m){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=f,this.part=h,this.skip=m}var n=u.prototype;return n.addDirectives=function(h){var m=new self.URL(h);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},u}(),L=function(){function u(n){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[n.url],this.attrs=n.attrs,this.bitrate=n.bitrate,n.details&&(this.details=n.details),this.id=n.id||0,this.name=n.name,this.width=n.width||0,this.height=n.height||0,this.audioCodec=n.audioCodec,this.videoCodec=n.videoCodec,this.unknownCodecs=n.unknownCodecs,this.codecSet=[n.videoCodec,n.audioCodec].filter(function(f){return f}).join(",").replace(/\.[^.,]+/g,"")}return e(u,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(f){var h=f%this.url.length;this._urlId!==h&&(this.details=void 0,this._urlId=h)}}]),u}()},"./src/types/loader.ts":function(R,M,i){i.r(M),i.d(M,"PlaylistContextType",function(){return a}),i.d(M,"PlaylistLevelType",function(){return e});var a;(function(c){c.MANIFEST="manifest",c.LEVEL="level",c.AUDIO_TRACK="audioTrack",c.SUBTITLE_TRACK="subtitleTrack"})(a||(a={}));var e;(function(c){c.MAIN="main",c.AUDIO="audio",c.SUBTITLE="subtitle"})(e||(e={}))},"./src/types/transmuxer.ts":function(R,M,i){i.r(M),i.d(M,"ChunkMetadata",function(){return a});var a=function(O,S,L,u,n,f){u===void 0&&(u=0),n===void 0&&(n=-1),f===void 0&&(f=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=e(),this.buffering={audio:e(),video:e(),audiovideo:e()},this.level=O,this.sn=S,this.id=L,this.size=u,this.part=n,this.partial=f};function e(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(R,M,i){i.r(M),i.d(M,"AttrList",function(){return c});var a=/^(\d+)x(\d+)$/,e=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,c=function(){function O(L){typeof L=="string"&&(L=O.parseAttrList(L));for(var u in L)L.hasOwnProperty(u)&&(this[u]=L[u])}var S=O.prototype;return S.decimalInteger=function(u){var n=parseInt(this[u],10);return n>Number.MAX_SAFE_INTEGER?1/0:n},S.hexadecimalInteger=function(u){if(this[u]){var n=(this[u]||"0x").slice(2);n=(n.length&1?"0":"")+n;for(var f=new Uint8Array(n.length/2),h=0;h<n.length/2;h++)f[h]=parseInt(n.slice(h*2,h*2+2),16);return f}else return null},S.hexadecimalIntegerAsNumber=function(u){var n=parseInt(this[u],16);return n>Number.MAX_SAFE_INTEGER?1/0:n},S.decimalFloatingPoint=function(u){return parseFloat(this[u])},S.optionalFloat=function(u,n){var f=this[u];return f?parseFloat(f):n},S.enumeratedString=function(u){return this[u]},S.bool=function(u){return this[u]==="YES"},S.decimalResolution=function(u){var n=a.exec(this[u]);if(n!==null)return{width:parseInt(n[1],10),height:parseInt(n[2],10)}},O.parseAttrList=function(u){var n,f={},h='"';for(e.lastIndex=0;(n=e.exec(u))!==null;){var m=n[2];m.indexOf(h)===0&&m.lastIndexOf(h)===m.length-1&&(m=m.slice(1,-1)),f[n[1]]=m}return f},O}()},"./src/utils/binary-search.ts":function(R,M,i){i.r(M);var a={search:function(c,O){for(var S=0,L=c.length-1,u=null,n=null;S<=L;){u=(S+L)/2|0,n=c[u];var f=O(n);if(f>0)S=u+1;else if(f<0)L=u-1;else return n}return null}};M.default=a},"./src/utils/buffer-helper.ts":function(R,M,i){i.r(M),i.d(M,"BufferHelper",function(){return c});var a=i("./src/utils/logger.ts"),e={length:0,start:function(){return 0},end:function(){return 0}},c=function(){function O(){}return O.isBuffered=function(L,u){try{if(L){for(var n=O.getBuffered(L),f=0;f<n.length;f++)if(u>=n.start(f)&&u<=n.end(f))return!0}}catch{}return!1},O.bufferInfo=function(L,u,n){try{if(L){var f=O.getBuffered(L),h=[],m;for(m=0;m<f.length;m++)h.push({start:f.start(m),end:f.end(m)});return this.bufferedInfo(h,u,n)}}catch{}return{len:0,start:u,end:u,nextStart:void 0}},O.bufferedInfo=function(L,u,n){u=Math.max(0,u),L.sort(function(r,l){var A=r.start-l.start;return A||l.end-r.end});var f=[];if(n)for(var h=0;h<L.length;h++){var m=f.length;if(m){var v=f[m-1].end;L[h].start-v<n?L[h].end>v&&(f[m-1].end=L[h].end):f.push(L[h])}else f.push(L[h])}else f=L;for(var T=0,o,t=u,s=u,g=0;g<f.length;g++){var E=f[g].start,d=f[g].end;if(u+n>=E&&u<d)t=E,s=d,T=s-u;else if(u+n<E){o=E;break}}return{len:T,start:t||0,end:s||0,nextStart:o}},O.getBuffered=function(L){try{return L.buffered}catch(u){return a.logger.log("failed to get media.buffered",u),e}},O}()},"./src/utils/cea-608-parser.ts":function(R,M,i){i.r(M),i.d(M,"Row",function(){return s}),i.d(M,"CaptionScreen",function(){return g});var a=i("./src/utils/logger.ts"),e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},c=function(b){var D=b;return e.hasOwnProperty(b)&&(D=e[b]),String.fromCharCode(D)},O=15,S=100,L={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},n={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},h=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m;(function(x){x[x.ERROR=0]="ERROR",x[x.TEXT=1]="TEXT",x[x.WARNING=2]="WARNING",x[x.INFO=2]="INFO",x[x.DEBUG=3]="DEBUG",x[x.DATA=3]="DATA"})(m||(m={}));var v=function(){function x(){this.time=null,this.verboseLevel=m.ERROR}var b=x.prototype;return b.log=function(p,y){this.verboseLevel>=p&&a.logger.log(this.time+" ["+p+"] "+y)},x}(),T=function(b){for(var D=[],p=0;p<b.length;p++)D.push(b[p].toString(16));return D},o=function(){function x(D,p,y,I,C){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=D||"white",this.underline=p||!1,this.italics=y||!1,this.background=I||"black",this.flash=C||!1}var b=x.prototype;return b.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},b.setStyles=function(p){for(var y=["foreground","underline","italics","background","flash"],I=0;I<y.length;I++){var C=y[I];p.hasOwnProperty(C)&&(this[C]=p[C])}},b.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},b.equals=function(p){return this.foreground===p.foreground&&this.underline===p.underline&&this.italics===p.italics&&this.background===p.background&&this.flash===p.flash},b.copy=function(p){this.foreground=p.foreground,this.underline=p.underline,this.italics=p.italics,this.background=p.background,this.flash=p.flash},b.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},x}(),t=function(){function x(D,p,y,I,C,P){this.uchar=void 0,this.penState=void 0,this.uchar=D||" ",this.penState=new o(p,y,I,C,P)}var b=x.prototype;return b.reset=function(){this.uchar=" ",this.penState.reset()},b.setChar=function(p,y){this.uchar=p,this.penState.copy(y)},b.setPenState=function(p){this.penState.copy(p)},b.equals=function(p){return this.uchar===p.uchar&&this.penState.equals(p.penState)},b.copy=function(p){this.uchar=p.uchar,this.penState.copy(p.penState)},b.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},x}(),s=function(){function x(D){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var p=0;p<S;p++)this.chars.push(new t);this.logger=D,this.pos=0,this.currPenState=new o}var b=x.prototype;return b.equals=function(p){for(var y=!0,I=0;I<S;I++)if(!this.chars[I].equals(p.chars[I])){y=!1;break}return y},b.copy=function(p){for(var y=0;y<S;y++)this.chars[y].copy(p.chars[y])},b.isEmpty=function(){for(var p=!0,y=0;y<S;y++)if(!this.chars[y].isEmpty()){p=!1;break}return p},b.setCursor=function(p){this.pos!==p&&(this.pos=p),this.pos<0?(this.logger.log(m.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>S&&(this.logger.log(m.DEBUG,"Too large cursor position "+this.pos),this.pos=S)},b.moveCursor=function(p){var y=this.pos+p;if(p>1)for(var I=this.pos+1;I<y+1;I++)this.chars[I].setPenState(this.currPenState);this.setCursor(y)},b.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},b.insertChar=function(p){p>=144&&this.backSpace();var y=c(p);if(this.pos>=S){this.logger.log(m.ERROR,"Cannot insert "+p.toString(16)+" ("+y+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(y,this.currPenState),this.moveCursor(1)},b.clearFromPos=function(p){var y;for(y=p;y<S;y++)this.chars[y].reset()},b.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},b.clearToEndOfRow=function(){this.clearFromPos(this.pos)},b.getTextString=function(){for(var p=[],y=!0,I=0;I<S;I++){var C=this.chars[I].uchar;C!==" "&&(y=!1),p.push(C)}return y?"":p.join("")},b.setPenStyles=function(p){this.currPenState.setStyles(p);var y=this.chars[this.pos];y.setPenState(this.currPenState)},x}(),g=function(){function x(D){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var p=0;p<O;p++)this.rows.push(new s(D));this.logger=D,this.currRow=O-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var b=x.prototype;return b.reset=function(){for(var p=0;p<O;p++)this.rows[p].clear();this.currRow=O-1},b.equals=function(p){for(var y=!0,I=0;I<O;I++)if(!this.rows[I].equals(p.rows[I])){y=!1;break}return y},b.copy=function(p){for(var y=0;y<O;y++)this.rows[y].copy(p.rows[y])},b.isEmpty=function(){for(var p=!0,y=0;y<O;y++)if(!this.rows[y].isEmpty()){p=!1;break}return p},b.backSpace=function(){var p=this.rows[this.currRow];p.backSpace()},b.clearToEndOfRow=function(){var p=this.rows[this.currRow];p.clearToEndOfRow()},b.insertChar=function(p){var y=this.rows[this.currRow];y.insertChar(p)},b.setPen=function(p){var y=this.rows[this.currRow];y.setPenStyles(p)},b.moveCursor=function(p){var y=this.rows[this.currRow];y.moveCursor(p)},b.setCursor=function(p){this.logger.log(m.INFO,"setCursor: "+p);var y=this.rows[this.currRow];y.setCursor(p)},b.setPAC=function(p){this.logger.log(m.INFO,"pacData = "+JSON.stringify(p));var y=p.row-1;if(this.nrRollUpRows&&y<this.nrRollUpRows-1&&(y=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==y){for(var I=0;I<O;I++)this.rows[I].clear();var C=this.currRow+1-this.nrRollUpRows,P=this.lastOutputScreen;if(P){var w=P.rows[C].cueStartTime,k=this.logger.time;if(w&&k!==null&&w<k)for(var F=0;F<this.nrRollUpRows;F++)this.rows[y-this.nrRollUpRows+F+1].copy(P.rows[C+F])}}this.currRow=y;var _=this.rows[this.currRow];if(p.indent!==null){var B=p.indent,N=Math.max(B-1,0);_.setCursor(p.indent),p.color=_.chars[N].penState.foreground}var U={foreground:p.color,underline:p.underline,italics:p.italics,background:"black",flash:!1};this.setPen(U)},b.setBkgData=function(p){this.logger.log(m.INFO,"bkgData = "+JSON.stringify(p)),this.backSpace(),this.setPen(p),this.insertChar(32)},b.setRollUpRows=function(p){this.nrRollUpRows=p},b.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(m.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(m.TEXT,this.getDisplayText());var p=this.currRow+1-this.nrRollUpRows,y=this.rows.splice(p,1)[0];y.clear(),this.rows.splice(this.currRow,0,y),this.logger.log(m.INFO,"Rolling up")},b.getDisplayText=function(p){p=p||!1;for(var y=[],I="",C=-1,P=0;P<O;P++){var w=this.rows[P].getTextString();w&&(C=P+1,p?y.push("Row "+C+": '"+w+"'"):y.push(w.trim()))}return y.length>0&&(p?I="["+y.join(" | ")+"]":I=y.join(`
`)),I},b.getTextAndFormat=function(){return this.rows},x}(),E=function(){function x(D,p,y){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=D,this.outputFilter=p,this.mode=null,this.verbose=0,this.displayedMemory=new g(y),this.nonDisplayedMemory=new g(y),this.lastOutputScreen=new g(y),this.currRollUpRow=this.displayedMemory.rows[O-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=y}var b=x.prototype;return b.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[O-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},b.getHandler=function(){return this.outputFilter},b.setHandler=function(p){this.outputFilter=p},b.setPAC=function(p){this.writeScreen.setPAC(p)},b.setBkgData=function(p){this.writeScreen.setBkgData(p)},b.setMode=function(p){p!==this.mode&&(this.mode=p,this.logger.log(m.INFO,"MODE="+p),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=p)},b.insertChars=function(p){for(var y=0;y<p.length;y++)this.writeScreen.insertChar(p[y]);var I=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(m.INFO,I+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(m.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},b.ccRCL=function(){this.logger.log(m.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},b.ccBS=function(){this.logger.log(m.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},b.ccAOF=function(){},b.ccAON=function(){},b.ccDER=function(){this.logger.log(m.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},b.ccRU=function(p){this.logger.log(m.INFO,"RU("+p+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(p)},b.ccFON=function(){this.logger.log(m.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},b.ccRDC=function(){this.logger.log(m.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},b.ccTR=function(){this.logger.log(m.INFO,"TR"),this.setMode("MODE_TEXT")},b.ccRTD=function(){this.logger.log(m.INFO,"RTD"),this.setMode("MODE_TEXT")},b.ccEDM=function(){this.logger.log(m.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},b.ccCR=function(){this.logger.log(m.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},b.ccENM=function(){this.logger.log(m.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},b.ccEOC=function(){if(this.logger.log(m.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var p=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=p,this.writeScreen=this.nonDisplayedMemory,this.logger.log(m.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},b.ccTO=function(p){this.logger.log(m.INFO,"TO("+p+") - Tab Offset"),this.writeScreen.moveCursor(p)},b.ccMIDROW=function(p){var y={flash:!1};if(y.underline=p%2===1,y.italics=p>=46,y.italics)y.foreground="white";else{var I=Math.floor(p/2)-16,C=["white","green","blue","cyan","red","yellow","magenta"];y.foreground=C[I]}this.logger.log(m.INFO,"MIDROW: "+JSON.stringify(y)),this.writeScreen.setPen(y)},b.outputDataUpdate=function(p){p===void 0&&(p=!1);var y=this.logger.time;y!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=y:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,y,this.lastOutputScreen),p&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:y),this.lastOutputScreen.copy(this.displayedMemory))},b.cueSplitAtTime=function(p){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,p,this.displayedMemory),this.cueStartTime=p))},x}(),d=function(){function x(D,p,y){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var I=new v;this.channels=[null,new E(D,p,I),new E(D+1,y,I)],this.cmdHistory=A(),this.logger=I}var b=x.prototype;return b.getHandler=function(p){return this.channels[p].getHandler()},b.setHandler=function(p,y){this.channels[p].setHandler(y)},b.addData=function(p,y){var I,C,P,w=!1;this.logger.time=p;for(var k=0;k<y.length;k+=2)if(C=y[k]&127,P=y[k+1]&127,!(C===0&&P===0)){if(this.logger.log(m.DATA,"["+T([y[k],y[k+1]])+"] -> ("+T([C,P])+")"),I=this.parseCmd(C,P),I||(I=this.parseMidrow(C,P)),I||(I=this.parsePAC(C,P)),I||(I=this.parseBackgroundAttributes(C,P)),!I&&(w=this.parseChars(C,P),w)){var F=this.currentChannel;if(F&&F>0){var _=this.channels[F];_.insertChars(w)}else this.logger.log(m.WARNING,"No channel found yet. TEXT-MODE?")}!I&&!w&&this.logger.log(m.WARNING,"Couldn't parse cleaned data "+T([C,P])+" orig: "+T([y[k],y[k+1]]))}},b.parseCmd=function(p,y){var I=this.cmdHistory,C=(p===20||p===28||p===21||p===29)&&y>=32&&y<=47,P=(p===23||p===31)&&y>=33&&y<=35;if(!(C||P))return!1;if(l(p,y,I))return r(null,null,I),this.logger.log(m.DEBUG,"Repeated command ("+T([p,y])+") is dropped"),!0;var w=p===20||p===21||p===23?1:2,k=this.channels[w];return p===20||p===21||p===28||p===29?y===32?k.ccRCL():y===33?k.ccBS():y===34?k.ccAOF():y===35?k.ccAON():y===36?k.ccDER():y===37?k.ccRU(2):y===38?k.ccRU(3):y===39?k.ccRU(4):y===40?k.ccFON():y===41?k.ccRDC():y===42?k.ccTR():y===43?k.ccRTD():y===44?k.ccEDM():y===45?k.ccCR():y===46?k.ccENM():y===47&&k.ccEOC():k.ccTO(y-32),r(p,y,I),this.currentChannel=w,!0},b.parseMidrow=function(p,y){var I=0;if((p===17||p===25)&&y>=32&&y<=47){if(p===17?I=1:I=2,I!==this.currentChannel)return this.logger.log(m.ERROR,"Mismatch channel in midrow parsing"),!1;var C=this.channels[I];return C?(C.ccMIDROW(y),this.logger.log(m.DEBUG,"MIDROW ("+T([p,y])+")"),!0):!1}return!1},b.parsePAC=function(p,y){var I,C=this.cmdHistory,P=(p>=17&&p<=23||p>=25&&p<=31)&&y>=64&&y<=127,w=(p===16||p===24)&&y>=64&&y<=95;if(!(P||w))return!1;if(l(p,y,C))return r(null,null,C),!0;var k=p<=23?1:2;y>=64&&y<=95?I=k===1?L[p]:n[p]:I=k===1?u[p]:f[p];var F=this.channels[k];return F?(F.setPAC(this.interpretPAC(I,y)),r(p,y,C),this.currentChannel=k,!0):!1},b.interpretPAC=function(p,y){var I,C={color:null,italics:!1,indent:null,underline:!1,row:p};return y>95?I=y-96:I=y-64,C.underline=(I&1)===1,I<=13?C.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(I/2)]:I<=15?(C.italics=!0,C.color="white"):C.indent=Math.floor((I-16)/2)*4,C},b.parseChars=function(p,y){var I,C=null,P=null;if(p>=25?(I=2,P=p-8):(I=1,P=p),P>=17&&P<=19){var w;P===17?w=y+80:P===18?w=y+112:w=y+144,this.logger.log(m.INFO,"Special char '"+c(w)+"' in channel "+I),C=[w]}else p>=32&&p<=127&&(C=y===0?[p]:[p,y]);if(C){var k=T(C);this.logger.log(m.DEBUG,"Char codes =  "+k.join(",")),r(p,y,this.cmdHistory)}return C},b.parseBackgroundAttributes=function(p,y){var I=(p===16||p===24)&&y>=32&&y<=47,C=(p===23||p===31)&&y>=45&&y<=47;if(!(I||C))return!1;var P,w={};p===16||p===24?(P=Math.floor((y-32)/2),w.background=h[P],y%2===1&&(w.background=w.background+"_semi")):y===45?w.background="transparent":(w.foreground="black",y===47&&(w.underline=!0));var k=p<=23?1:2,F=this.channels[k];return F.setBkgData(w),r(p,y,this.cmdHistory),!0},b.reset=function(){for(var p=0;p<Object.keys(this.channels).length;p++){var y=this.channels[p];y&&y.reset()}this.cmdHistory=A()},b.cueSplitAtTime=function(p){for(var y=0;y<this.channels.length;y++){var I=this.channels[y];I&&I.cueSplitAtTime(p)}},x}();function r(x,b,D){D.a=x,D.b=b}function l(x,b,D){return D.a===x&&D.b===b}function A(){return{a:null,b:null}}M.default=d},"./src/utils/codecs.ts":function(R,M,i){i.r(M),i.d(M,"isCodecType",function(){return e}),i.d(M,"isCodecSupportedInMp4",function(){return c});var a={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function e(O,S){var L=a[S];return!!L&&L[O.slice(0,4)]===!0}function c(O,S){return MediaSource.isTypeSupported((S||"video")+'/mp4;codecs="'+O+'"')}},"./src/utils/cues.ts":function(R,M,i){i.r(M);var a=i("./src/utils/vttparser.ts"),e=i("./src/utils/webvtt-parser.ts"),c=i("./src/utils/texttrack-utils.ts"),O=/\s/,S={newCue:function(u,n,f,h){for(var m=[],v,T,o,t,s,g=self.VTTCue||self.TextTrackCue,E=0;E<h.rows.length;E++)if(v=h.rows[E],o=!0,t=0,s="",!v.isEmpty()){for(var d=0;d<v.chars.length;d++)O.test(v.chars[d].uchar)&&o?t++:(s+=v.chars[d].uchar,o=!1);v.cueStartTime=n,n===f&&(f+=1e-4),t>=16?t--:t++;var r=Object(a.fixLineBreaks)(s.trim()),l=Object(e.generateCueId)(n,f,r);(!u||!u.cues||!u.cues.getCueById(l))&&(T=new g(n,f,r),T.id=l,T.line=E+1,T.align="left",T.position=10+Math.min(80,Math.floor(t*8/32)*10),m.push(T))}return u&&m.length&&(m.sort(function(A,x){return A.line==="auto"||x.line==="auto"?0:A.line>8&&x.line>8?x.line-A.line:A.line-x.line}),m.forEach(function(A){return Object(c.addCueToTrack)(u,A)})),m}};M.default=S},"./src/utils/discontinuities.ts":function(R,M,i){i.r(M),i.d(M,"findFirstFragWithCC",function(){return O}),i.d(M,"shouldAlignOnDiscontinuities",function(){return S}),i.d(M,"findDiscontinuousReferenceFrag",function(){return L}),i.d(M,"adjustSlidingStart",function(){return n}),i.d(M,"alignStream",function(){return f}),i.d(M,"alignPDT",function(){return m}),i.d(M,"alignFragmentByPDTDelta",function(){return v}),i.d(M,"alignMediaPlaylistByPDT",function(){return T});var a=i("./src/polyfills/number.ts"),e=i("./src/utils/logger.ts"),c=i("./src/controller/level-helper.ts");function O(o,t){for(var s=null,g=0,E=o.length;g<E;g++){var d=o[g];if(d&&d.cc===t){s=d;break}}return s}function S(o,t,s){return!!(t.details&&(s.endCC>s.startCC||o&&o.cc<s.startCC))}function L(o,t){var s=o.fragments,g=t.fragments;if(!g.length||!s.length){e.logger.log("No fragments to align");return}var E=O(s,g[0].cc);if(!E||E&&!E.startPTS){e.logger.log("No frag in previous level to align on");return}return E}function u(o,t){if(o){var s=o.start+t;o.start=o.startPTS=s,o.endPTS=s+o.duration}}function n(o,t){for(var s=t.fragments,g=0,E=s.length;g<E;g++)u(s[g],o);t.fragmentHint&&u(t.fragmentHint,o),t.alignedSliding=!0}function f(o,t,s){!t||(h(o,s,t),!s.alignedSliding&&t.details&&m(s,t.details),!s.alignedSliding&&t.details&&!s.skippedSegments&&Object(c.adjustSliding)(t.details,s))}function h(o,t,s){if(S(o,s,t)){var g=L(s.details,t);g&&Object(a.isFiniteNumber)(g.start)&&(e.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),n(g.start,t))}}function m(o,t){if(!(!t.fragments.length||!o.hasProgramDateTime||!t.hasProgramDateTime)){var s=t.fragments[0].programDateTime,g=o.fragments[0].programDateTime,E=(g-s)/1e3+t.fragments[0].start;E&&Object(a.isFiniteNumber)(E)&&(e.logger.log("Adjusting PTS using programDateTime delta "+(g-s)+"ms, sliding:"+E.toFixed(3)+" "+o.url+" "),n(E,o))}}function v(o,t){var s=o.programDateTime;if(!!s){var g=(s-t)/1e3;o.start=o.startPTS=g,o.endPTS=g+o.duration}}function T(o,t){if(!(!t.fragments.length||!o.hasProgramDateTime||!t.hasProgramDateTime)){var s=t.fragments[0].programDateTime,g=t.fragments[0].start,E=s-g*1e3;o.fragments.forEach(function(d){v(d,E)}),o.fragmentHint&&v(o.fragmentHint,E),o.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(R,M,i){i.r(M);var a=i("./src/utils/ewma.ts"),e=function(){function c(S,L,u){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=u,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new a.default(S),this.fast_=new a.default(L)}var O=c.prototype;return O.update=function(L,u){var n=this.slow_,f=this.fast_;this.slow_.halfLife!==L&&(this.slow_=new a.default(L,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==u&&(this.fast_=new a.default(u,f.getEstimate(),f.getTotalWeight()))},O.sample=function(L,u){L=Math.max(L,this.minDelayMs_);var n=8*u,f=L/1e3,h=n/f;this.fast_.sample(f,h),this.slow_.sample(f,h)},O.canEstimate=function(){var L=this.fast_;return L&&L.getTotalWeight()>=this.minWeight_},O.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},O.destroy=function(){},c}();M.default=e},"./src/utils/ewma.ts":function(R,M,i){i.r(M);var a=function(){function e(O,S,L){S===void 0&&(S=0),L===void 0&&(L=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=O,this.alpha_=O?Math.exp(Math.log(.5)/O):0,this.estimate_=S,this.totalWeight_=L}var c=e.prototype;return c.sample=function(S,L){var u=Math.pow(this.alpha_,S);this.estimate_=L*(1-u)+u*this.estimate_,this.totalWeight_+=S},c.getTotalWeight=function(){return this.totalWeight_},c.getEstimate=function(){if(this.alpha_){var S=1-Math.pow(this.alpha_,this.totalWeight_);if(S)return this.estimate_/S}return this.estimate_},e}();M.default=a},"./src/utils/fetch-loader.ts":function(R,M,i){i.r(M),i.d(M,"fetchSupported",function(){return v});var a=i("./src/polyfills/number.ts"),e=i("./src/loader/load-stats.ts"),c=i("./src/demux/chunk-cache.ts");function O(g,E){g.prototype=Object.create(E.prototype),g.prototype.constructor=g,f(g,E)}function S(g){var E=typeof Map=="function"?new Map:void 0;return S=function(r){if(r===null||!n(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof E<"u"){if(E.has(r))return E.get(r);E.set(r,l)}function l(){return L(r,arguments,h(this).constructor)}return l.prototype=Object.create(r.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),f(l,r)},S(g)}function L(g,E,d){return u()?L=Reflect.construct.bind():L=function(l,A,x){var b=[null];b.push.apply(b,A);var D=Function.bind.apply(l,b),p=new D;return x&&f(p,x.prototype),p},L.apply(null,arguments)}function u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function n(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function f(g,E){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},f(g,E)}function h(g){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(d){return d.__proto__||Object.getPrototypeOf(d)},h(g)}function m(){return m=Object.assign?Object.assign.bind():function(g){for(var E=1;E<arguments.length;E++){var d=arguments[E];for(var r in d)Object.prototype.hasOwnProperty.call(d,r)&&(g[r]=d[r])}return g},m.apply(this,arguments)}function v(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var T=function(){function g(d){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=d.fetchSetup||t,this.controller=new self.AbortController,this.stats=new e.LoadStats}var E=g.prototype;return E.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},E.abortInternal=function(){var r=this.response;(!r||!r.ok)&&(this.stats.aborted=!0,this.controller.abort())},E.abort=function(){var r;this.abortInternal(),(r=this.callbacks)!==null&&r!==void 0&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},E.load=function(r,l,A){var x=this,b=this.stats;if(b.loading.start)throw new Error("Loader can only be used once.");b.loading.start=self.performance.now();var D=o(r,this.controller.signal),p=A.onProgress,y=r.responseType==="arraybuffer",I=y?"byteLength":"length";this.context=r,this.config=l,this.callbacks=A,this.request=this.fetchSetup(r,D),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){x.abortInternal(),A.onTimeout(b,r,x.response)},l.timeout),self.fetch(this.request).then(function(C){if(x.response=x.loader=C,!C.ok){var P=C.status,w=C.statusText;throw new s(w||"fetch, bad network response",P,C)}return b.loading.first=Math.max(self.performance.now(),b.loading.start),b.total=parseInt(C.headers.get("Content-Length")||"0"),p&&Object(a.isFiniteNumber)(l.highWaterMark)?x.loadProgressively(C,b,r,l.highWaterMark,p):y?C.arrayBuffer():C.text()}).then(function(C){var P=x.response;self.clearTimeout(x.requestTimeout),b.loading.end=Math.max(self.performance.now(),b.loading.first),b.loaded=b.total=C[I];var w={url:P.url,data:C};p&&!Object(a.isFiniteNumber)(l.highWaterMark)&&p(b,r,C,P),A.onSuccess(w,b,r,P)}).catch(function(C){if(self.clearTimeout(x.requestTimeout),!b.aborted){var P=C&&C.code||0,w=C?C.message:null;A.onError({code:P,text:w},r,C?C.details:null)}})},E.getCacheAge=function(){var r=null;if(this.response){var l=this.response.headers.get("age");r=l?parseFloat(l):null}return r},E.loadProgressively=function(r,l,A,x,b){x===void 0&&(x=0);var D=new c.default,p=r.body.getReader(),y=function I(){return p.read().then(function(C){if(C.done)return D.dataLength&&b(l,A,D.flush(),r),Promise.resolve(new ArrayBuffer(0));var P=C.value,w=P.length;return l.loaded+=w,w<x||D.dataLength?(D.push(P),D.dataLength>=x&&b(l,A,D.flush(),r)):b(l,A,P,r),I()}).catch(function(){return Promise.reject()})};return y()},g}();function o(g,E){var d={method:"GET",mode:"cors",credentials:"same-origin",signal:E,headers:new self.Headers(m({},g.headers))};return g.rangeEnd&&d.headers.set("Range","bytes="+g.rangeStart+"-"+String(g.rangeEnd-1)),d}function t(g,E){return new self.Request(g.url,E)}var s=function(g){O(E,g);function E(d,r,l){var A;return A=g.call(this,d)||this,A.code=void 0,A.details=void 0,A.code=r,A.details=l,A}return E}(S(Error));M.default=T},"./src/utils/imsc1-ttml-parser.ts":function(R,M,i){i.r(M),i.d(M,"IMSC1_CODEC",function(){return n}),i.d(M,"parseIMSC1",function(){return v});var a=i("./src/utils/mp4-tools.ts"),e=i("./src/utils/vttparser.ts"),c=i("./src/utils/vttcue.ts"),O=i("./src/demux/id3.ts"),S=i("./src/utils/timescale-conversion.ts"),L=i("./src/utils/webvtt-parser.ts");function u(){return u=Object.assign?Object.assign.bind():function(x){for(var b=1;b<arguments.length;b++){var D=arguments[b];for(var p in D)Object.prototype.hasOwnProperty.call(D,p)&&(x[p]=D[p])}return x},u.apply(this,arguments)}var n="stpp.ttml.im1t",f=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,m={left:"start",center:"center",right:"end",start:"start",end:"end"};function v(x,b,D,p,y){var I=Object(a.findBox)(new Uint8Array(x),["mdat"]);if(I.length===0){y(new Error("Could not parse IMSC1 mdat"));return}var C=I.map(function(w){return Object(O.utf8ArrayToStr)(w)}),P=Object(S.toTimescaleFromScale)(b,1,D);try{C.forEach(function(w){return p(T(w,P))})}catch(w){y(w)}}function T(x,b){var D=new DOMParser,p=D.parseFromString(x,"text/xml"),y=p.getElementsByTagName("tt")[0];if(!y)throw new Error("Invalid ttml");var I={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},C=Object.keys(I).reduce(function(_,B){return _[B]=y.getAttribute("ttp:"+B)||I[B],_},{}),P=y.getAttribute("xml:space")!=="preserve",w=t(o(y,"styling","style")),k=t(o(y,"layout","region")),F=o(y,"body","[begin]");return[].map.call(F,function(_){var B=s(_,P);if(!B||!_.hasAttribute("begin"))return null;var N=r(_.getAttribute("begin"),C),U=r(_.getAttribute("dur"),C),j=r(_.getAttribute("end"),C);if(N===null)throw d(_);if(j===null){if(U===null)throw d(_);j=N+U}var K=new c.default(N-b,j-b,B);K.id=Object(L.generateCueId)(K.startTime,K.endTime,K.text);var H=k[_.getAttribute("region")],G=w[_.getAttribute("style")];K.position=10,K.size=80;var W=g(H,G,w),X=W.textAlign;if(X){var z=m[X];z&&(K.lineAlign=z),K.align=X}return u(K,W),K}).filter(function(_){return _!==null})}function o(x,b,D){var p=x.getElementsByTagName(b)[0];return p?[].slice.call(p.querySelectorAll(D)):[]}function t(x){return x.reduce(function(b,D){var p=D.getAttribute("xml:id");return p&&(b[p]=D),b},{})}function s(x,b){return[].slice.call(x.childNodes).reduce(function(D,p,y){var I;return p.nodeName==="br"&&y?D+`
`:(I=p.childNodes)!==null&&I!==void 0&&I.length?s(p,b):b?D+p.textContent.trim().replace(/\s+/g," "):D+p.textContent},"")}function g(x,b,D){var p="http://www.w3.org/ns/ttml#styling",y=null,I=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],C=x!=null&&x.hasAttribute("style")?x.getAttribute("style"):null;return C&&D.hasOwnProperty(C)&&(y=D[C]),I.reduce(function(P,w){var k=E(b,p,w)||E(x,p,w)||E(y,p,w);return k&&(P[w]=k),P},{})}function E(x,b,D){return x&&x.hasAttributeNS(b,D)?x.getAttributeNS(b,D):null}function d(x){return new Error("Could not parse ttml timestamp "+x)}function r(x,b){if(!x)return null;var D=Object(e.parseTimeStamp)(x);return D===null&&(f.test(x)?D=l(x,b):h.test(x)&&(D=A(x,b))),D}function l(x,b){var D=f.exec(x),p=(D[4]|0)+(D[5]|0)/b.subFrameRate;return(D[1]|0)*3600+(D[2]|0)*60+(D[3]|0)+p/b.frameRate}function A(x,b){var D=h.exec(x),p=Number(D[1]),y=D[2];switch(y){case"h":return p*3600;case"m":return p*60;case"ms":return p*1e3;case"f":return p/b.frameRate;case"t":return p/b.tickRate}return p}},"./src/utils/logger.ts":function(R,M,i){i.r(M),i.d(M,"enableLogs",function(){return L}),i.d(M,"logger",function(){return u});var a=function(){},e={trace:a,debug:a,log:a,warn:a,info:a,error:a},c=e;function O(n){var f=self.console[n];return f?f.bind(self.console,"["+n+"] >"):a}function S(n){for(var f=arguments.length,h=new Array(f>1?f-1:0),m=1;m<f;m++)h[m-1]=arguments[m];h.forEach(function(v){c[v]=n[v]?n[v].bind(n):O(v)})}function L(n){if(self.console&&n===!0||typeof n=="object"){S(n,"debug","log","info","warn","error");try{c.log()}catch{c=e}}else c=e}var u=c},"./src/utils/mediakeys-helper.ts":function(R,M,i){i.r(M),i.d(M,"KeySystems",function(){return a}),i.d(M,"requestMediaKeySystemAccess",function(){return e});var a;(function(c){c.WIDEVINE="com.widevine.alpha",c.PLAYREADY="com.microsoft.playready"})(a||(a={}));var e=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(R,M,i){i.r(M),i.d(M,"getMediaSource",function(){return a});function a(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(R,M,i){i.r(M),i.d(M,"RemuxerTrackIdConfig",function(){return L}),i.d(M,"bin2str",function(){return u}),i.d(M,"readUint16",function(){return n}),i.d(M,"readUint32",function(){return f}),i.d(M,"readSint32",function(){return h}),i.d(M,"writeUint32",function(){return m}),i.d(M,"findBox",function(){return v}),i.d(M,"parseSegmentIndex",function(){return T}),i.d(M,"parseInitSegment",function(){return o}),i.d(M,"getStartDTS",function(){return t}),i.d(M,"getDuration",function(){return s}),i.d(M,"computeRawDurationFromSamples",function(){return g}),i.d(M,"offsetStartDTS",function(){return E}),i.d(M,"segmentValidRange",function(){return d}),i.d(M,"appendUint8Array",function(){return r}),i.d(M,"parseSamples",function(){return l}),i.d(M,"parseSEIMessageFromNALu",function(){return b}),i.d(M,"parseEmsg",function(){return p});var a=i("./src/utils/typed-array.ts"),e=i("./src/loader/fragment.ts"),c=i("./src/demux/id3.ts"),O=Math.pow(2,32)-1,S=[].push,L={video:1,audio:2,id3:3,text:4};function u(y){return String.fromCharCode.apply(null,y)}function n(y,I){var C=y[I]<<8|y[I+1];return C<0?65536+C:C}function f(y,I){var C=h(y,I);return C<0?4294967296+C:C}function h(y,I){return y[I]<<24|y[I+1]<<16|y[I+2]<<8|y[I+3]}function m(y,I,C){y[I]=C>>24,y[I+1]=C>>16&255,y[I+2]=C>>8&255,y[I+3]=C&255}function v(y,I){var C=[];if(!I.length)return C;for(var P=y.byteLength,w=0;w<P;){var k=f(y,w),F=u(y.subarray(w+4,w+8)),_=k>1?w+k:P;if(F===I[0])if(I.length===1)C.push(y.subarray(w+8,_));else{var B=v(y.subarray(w+8,_),I.slice(1));B.length&&S.apply(C,B)}w=_}return C}function T(y){var I=[],C=y[0],P=8,w=f(y,P);P+=4;var k=0,F=0;C===0?P+=8:P+=16,P+=2;var _=y.length+F,B=n(y,P);P+=2;for(var N=0;N<B;N++){var U=P,j=f(y,U);U+=4;var K=j&2147483647,H=(j&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var G=f(y,U);U+=4,I.push({referenceSize:K,subsegmentDuration:G,info:{duration:G/w,start:_,end:_+K-1}}),_+=K,U+=4,P=U}return{earliestPresentationTime:k,timescale:w,version:C,referencesCount:B,references:I}}function o(y){for(var I=[],C=v(y,["moov","trak"]),P=0;P<C.length;P++){var w=C[P],k=v(w,["tkhd"])[0];if(k){var F=k[0],_=F===0?12:20,B=f(k,_),N=v(w,["mdia","mdhd"])[0];if(N){F=N[0],_=F===0?12:20;var U=f(N,_),j=v(w,["mdia","hdlr"])[0];if(j){var K=u(j.subarray(8,12)),H={soun:e.ElementaryStreamTypes.AUDIO,vide:e.ElementaryStreamTypes.VIDEO}[K];if(H){var G=v(w,["mdia","minf","stbl","stsd"])[0],W=void 0;G&&(W=u(G.subarray(12,16))),I[B]={timescale:U,type:H},I[H]={timescale:U,id:B,codec:W}}}}}}var X=v(y,["moov","mvex","trex"]);return X.forEach(function(z){var Q=f(z,4),$=I[Q];$&&($.default={duration:f(z,12),flags:f(z,20)})}),I}function t(y,I){return v(I,["moof","traf"]).reduce(function(C,P){var w=v(P,["tfdt"])[0],k=w[0],F=v(P,["tfhd"]).reduce(function(_,B){var N=f(B,4),U=y[N];if(U){var j=f(w,4);k===1&&(j*=Math.pow(2,32),j+=f(w,8));var K=U.timescale||9e4,H=j/K;if(isFinite(H)&&(_===null||H<_))return H}return _},null);return F!==null&&isFinite(F)&&(C===null||F<C)?F:C},null)||0}function s(y,I){for(var C=0,P=0,w=0,k=v(y,["moof","traf"]),F=0;F<k.length;F++){var _=k[F],B=v(_,["tfhd"])[0],N=f(B,4),U=I[N];if(!!U){var j=U.default,K=f(B,0)|(j==null?void 0:j.flags),H=j==null?void 0:j.duration;K&8&&(K&2?H=f(B,12):H=f(B,8));for(var G=U.timescale||9e4,W=v(_,["trun"]),X=0;X<W.length;X++){if(C=g(W[X]),!C&&H){var z=f(W[X],4);C=H*z}U.type===e.ElementaryStreamTypes.VIDEO?P+=C/G:U.type===e.ElementaryStreamTypes.AUDIO&&(w+=C/G)}}}if(P===0&&w===0){for(var Q=0,$=v(y,["sidx"]),Y=0;Y<$.length;Y++){var J=T($[Y]);J!=null&&J.references&&(Q+=J.references.reduce(function(q,tt){return q+tt.info.duration||0},0))}return Q}return P||w}function g(y){var I=f(y,0),C=8;I&1&&(C+=4),I&4&&(C+=4);for(var P=0,w=f(y,4),k=0;k<w;k++){if(I&256){var F=f(y,C);P+=F,C+=4}I&512&&(C+=4),I&1024&&(C+=4),I&2048&&(C+=4)}return P}function E(y,I,C){v(I,["moof","traf"]).forEach(function(P){v(P,["tfhd"]).forEach(function(w){var k=f(w,4),F=y[k];if(!!F){var _=F.timescale||9e4;v(P,["tfdt"]).forEach(function(B){var N=B[0],U=f(B,4);if(N===0)U-=C*_,U=Math.max(U,0),m(B,4,U);else{U*=Math.pow(2,32),U+=f(B,8),U-=C*_,U=Math.max(U,0);var j=Math.floor(U/(O+1)),K=Math.floor(U%(O+1));m(B,4,j),m(B,8,K)}})}})})}function d(y){var I={valid:null,remainder:null},C=v(y,["moof"]);if(C){if(C.length<2)return I.remainder=y,I}else return I;var P=C[C.length-1];return I.valid=Object(a.sliceUint8)(y,0,P.byteOffset-8),I.remainder=Object(a.sliceUint8)(y,P.byteOffset-8),I}function r(y,I){var C=new Uint8Array(y.length+I.length);return C.set(y),C.set(I,y.length),C}function l(y,I){var C=[],P=I.samples,w=I.timescale,k=I.id,F=!1,_=v(P,["moof"]);return _.map(function(B){var N=B.byteOffset-8,U=v(B,["traf"]);U.map(function(j){var K=v(j,["tfdt"]).map(function(H){var G=H[0],W=f(H,4);return G===1&&(W*=Math.pow(2,32),W+=f(H,8)),W/w})[0];return K!==void 0&&(y=K),v(j,["tfhd"]).map(function(H){var G=f(H,4),W=f(H,0)&16777215,X=(W&1)!==0,z=(W&2)!==0,Q=(W&8)!==0,$=0,Y=(W&16)!==0,J=0,q=(W&32)!==0,tt=8;G===k&&(X&&(tt+=8),z&&(tt+=4),Q&&($=f(H,tt),tt+=4),Y&&(J=f(H,tt),tt+=4),q&&(tt+=4),I.type==="video"&&(F=A(I.codec)),v(j,["trun"]).map(function(et){var rt=et[0],V=f(et,0)&16777215,it=(V&1)!==0,at=0,ot=(V&4)!==0,ut=(V&256)!==0,nt=0,ft=(V&512)!==0,st=0,dt=(V&1024)!==0,pt=(V&2048)!==0,yt=0,gt=f(et,4),lt=8;it&&(at=f(et,lt),lt+=4),ot&&(lt+=4);for(var ct=at+N,ht=0;ht<gt;ht++){if(ut?(nt=f(et,lt),lt+=4):nt=$,ft?(st=f(et,lt),lt+=4):st=J,dt&&(lt+=4),pt&&(rt===0?yt=f(et,lt):yt=h(et,lt),lt+=4),I.type===e.ElementaryStreamTypes.VIDEO)for(var vt=0;vt<st;){var Et=f(P,ct);ct+=4;var Z=P[ct]&31;if(x(F,Z)){var mt=P.subarray(ct,ct+Et);b(mt,y+yt/w,C)}ct+=Et,vt+=Et+4}y+=nt/w}}))})})}),C}function A(y){if(!y)return!1;var I=y.indexOf("."),C=I<0?y:y.substring(0,I);return C==="hvc1"||C==="hev1"||C==="dvh1"||C==="dvhe"}function x(y,I){return y?I===39||I===40:I===6}function b(y,I,C){var P=D(y),w=0;w++;for(var k=0,F=0,_=!1,B=0;w<P.length;){k=0;do{if(w>=P.length)break;B=P[w++],k+=B}while(B===255);F=0;do{if(w>=P.length)break;B=P[w++],F+=B}while(B===255);var N=P.length-w;if(!_&&k===4&&w<P.length){_=!0;var U=P[w++];if(U===181){var j=n(P,w);if(w+=2,j===49){var K=f(P,w);if(w+=4,K===1195456820){var H=P[w++];if(H===3){var G=P[w++],W=31&G,X=64&G,z=X?2+W*3:0,Q=new Uint8Array(z);if(X){Q[0]=G;for(var $=1;$<z;$++)Q[$]=P[w++]}C.push({type:H,payloadType:k,pts:I,bytes:Q})}}}}}else if(k===5&&F<N){if(_=!0,F>16){for(var Y=[],J=0;J<16;J++){var q=P[w++].toString(16);Y.push(q.length==1?"0"+q:q),(J===3||J===5||J===7||J===9)&&Y.push("-")}for(var tt=F-16,et=new Uint8Array(tt),rt=0;rt<tt;rt++)et[rt]=P[w++];C.push({payloadType:k,pts:I,uuid:Y.join(""),userData:Object(c.utf8ArrayToStr)(et),userDataBytes:et})}}else if(F<N)w+=F;else if(F>N)break}}function D(y){for(var I=y.byteLength,C=[],P=1;P<I-2;)y[P]===0&&y[P+1]===0&&y[P+2]===3?(C.push(P+2),P+=2):P++;if(C.length===0)return y;var w=I-C.length,k=new Uint8Array(w),F=0;for(P=0;P<w;F++,P++)F===C[0]&&(F++,C.shift()),k[P]=y[F];return k}function p(y){var I=y[0],C="",P="",w=0,k=0,F=0,_=0,B=0,N=0;if(I===0){for(;u(y.subarray(N,N+1))!=="\0";)C+=u(y.subarray(N,N+1)),N+=1;for(C+=u(y.subarray(N,N+1)),N+=1;u(y.subarray(N,N+1))!=="\0";)P+=u(y.subarray(N,N+1)),N+=1;P+=u(y.subarray(N,N+1)),N+=1,w=f(y,12),k=f(y,16),_=f(y,20),B=f(y,24),N=28}else if(I===1){N+=4,w=f(y,N),N+=4;var U=f(y,N);N+=4;var j=f(y,N);for(N+=4,F=Math.pow(2,32)*U+j,Number.isSafeInteger(F)||(F=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),_=f(y,N),N+=4,B=f(y,N),N+=4;u(y.subarray(N,N+1))!=="\0";)C+=u(y.subarray(N,N+1)),N+=1;for(C+=u(y.subarray(N,N+1)),N+=1;u(y.subarray(N,N+1))!=="\0";)P+=u(y.subarray(N,N+1)),N+=1;P+=u(y.subarray(N,N+1)),N+=1}var K=y.subarray(N,y.byteLength);return{schemeIdUri:C,value:P,timeScale:w,presentationTime:F,presentationTimeDelta:k,eventDuration:_,id:B,payload:K}}},"./src/utils/output-filter.ts":function(R,M,i){i.r(M),i.d(M,"default",function(){return a});var a=function(){function e(O,S){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=O,this.trackName=S}var c=e.prototype;return c.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},c.newCue=function(S,L,u){(this.startTime===null||this.startTime>S)&&(this.startTime=S),this.endTime=L,this.screen=u,this.timelineController.createCaptionsTrack(this.trackName)},c.reset=function(){this.cueRanges=[],this.startTime=null},e}()},"./src/utils/texttrack-utils.ts":function(R,M,i){i.r(M),i.d(M,"sendAddTrackEvent",function(){return e}),i.d(M,"addCueToTrack",function(){return c}),i.d(M,"clearCurrentCues",function(){return O}),i.d(M,"removeCuesInRange",function(){return S}),i.d(M,"getCuesInRange",function(){return u});var a=i("./src/utils/logger.ts");function e(n,f){var h;try{h=new Event("addtrack")}catch{h=document.createEvent("Event"),h.initEvent("addtrack",!1,!1)}h.track=n,f.dispatchEvent(h)}function c(n,f){var h=n.mode;if(h==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(f.id))try{if(n.addCue(f),!n.cues.getCueById(f.id))throw new Error("addCue is failed for: "+f)}catch(v){a.logger.debug("[texttrack-utils]: "+v);var m=new self.TextTrackCue(f.startTime,f.endTime,f.text);m.id=f.id,n.addCue(m)}h==="disabled"&&(n.mode=h)}function O(n){var f=n.mode;if(f==="disabled"&&(n.mode="hidden"),n.cues)for(var h=n.cues.length;h--;)n.removeCue(n.cues[h]);f==="disabled"&&(n.mode=f)}function S(n,f,h,m){var v=n.mode;if(v==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0)for(var T=u(n.cues,f,h),o=0;o<T.length;o++)(!m||m(T[o]))&&n.removeCue(T[o]);v==="disabled"&&(n.mode=v)}function L(n,f){if(f<n[0].startTime)return 0;var h=n.length-1;if(f>n[h].endTime)return-1;for(var m=0,v=h;m<=v;){var T=Math.floor((v+m)/2);if(f<n[T].startTime)v=T-1;else if(f>n[T].startTime&&m<h)m=T+1;else return T}return n[m].startTime-f<f-n[v].startTime?m:v}function u(n,f,h){var m=[],v=L(n,f);if(v>-1)for(var T=v,o=n.length;T<o;T++){var t=n[T];if(t.startTime>=f&&t.endTime<=h)m.push(t);else if(t.startTime>h)return m}return m}},"./src/utils/time-ranges.ts":function(R,M,i){i.r(M);var a={toString:function(c){for(var O="",S=c.length,L=0;L<S;L++)O+="["+c.start(L).toFixed(3)+","+c.end(L).toFixed(3)+"]";return O}};M.default=a},"./src/utils/timescale-conversion.ts":function(R,M,i){i.r(M),i.d(M,"toTimescaleFromBase",function(){return e}),i.d(M,"toTimescaleFromScale",function(){return c}),i.d(M,"toMsFromMpegTsClock",function(){return O}),i.d(M,"toMpegTsClockFromTimescale",function(){return S});var a=9e4;function e(L,u,n,f){n===void 0&&(n=1),f===void 0&&(f=!1);var h=L*u*n;return f?Math.round(h):h}function c(L,u,n,f){return n===void 0&&(n=1),f===void 0&&(f=!1),e(L,u,1/n,f)}function O(L,u){return u===void 0&&(u=!1),e(L,1e3,1/a,u)}function S(L,u){return u===void 0&&(u=1),e(L,a,1/u)}},"./src/utils/typed-array.ts":function(R,M,i){i.r(M),i.d(M,"sliceUint8",function(){return a});function a(e,c,O){return Uint8Array.prototype.slice?e.slice(c,O):new Uint8Array(Array.prototype.slice.call(e,c,O))}},"./src/utils/vttcue.ts":function(R,M,i){i.r(M),M.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var a=["","lr","rl"],e=["start","middle","end","left","right"];function c(n,f){if(typeof f!="string"||!Array.isArray(n))return!1;var h=f.toLowerCase();return~n.indexOf(h)?h:!1}function O(n){return c(a,n)}function S(n){return c(e,n)}function L(n){for(var f=arguments.length,h=new Array(f>1?f-1:0),m=1;m<f;m++)h[m-1]=arguments[m];for(var v=1;v<arguments.length;v++){var T=arguments[v];for(var o in T)n[o]=T[o]}return n}function u(n,f,h){var m=this,v={enumerable:!0};m.hasBeenReset=!1;var T="",o=!1,t=n,s=f,g=h,E=null,d="",r=!0,l="auto",A="start",x=50,b="middle",D=50,p="middle";Object.defineProperty(m,"id",L({},v,{get:function(){return T},set:function(I){T=""+I}})),Object.defineProperty(m,"pauseOnExit",L({},v,{get:function(){return o},set:function(I){o=!!I}})),Object.defineProperty(m,"startTime",L({},v,{get:function(){return t},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");t=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",L({},v,{get:function(){return s},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");s=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",L({},v,{get:function(){return g},set:function(I){g=""+I,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",L({},v,{get:function(){return E},set:function(I){E=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",L({},v,{get:function(){return d},set:function(I){var C=O(I);if(C===!1)throw new SyntaxError("An invalid or illegal string was specified.");d=C,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",L({},v,{get:function(){return r},set:function(I){r=!!I,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",L({},v,{get:function(){return l},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");l=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",L({},v,{get:function(){return A},set:function(I){var C=S(I);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");A=C,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",L({},v,{get:function(){return x},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");x=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",L({},v,{get:function(){return b},set:function(I){var C=S(I);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");b=C,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",L({},v,{get:function(){return D},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");D=I,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",L({},v,{get:function(){return p},set:function(I){var C=S(I);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");p=C,this.hasBeenReset=!0}})),m.displayState=void 0}return u.prototype.getCueAsHTML=function(){var n=self.WebVTT;return n.convertCueToDOMTree(self,this.text)},u}()},"./src/utils/vttparser.ts":function(R,M,i){i.r(M),i.d(M,"parseTimeStamp",function(){return c}),i.d(M,"fixLineBreaks",function(){return f}),i.d(M,"VTTParser",function(){return h});var a=i("./src/utils/vttcue.ts"),e=function(){function m(){}var v=m.prototype;return v.decode=function(o,t){if(!o)return"";if(typeof o!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(o))},m}();function c(m){function v(o,t,s,g){return(o|0)*3600+(t|0)*60+(s|0)+parseFloat(g||0)}var T=m.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return T?parseFloat(T[2])>59?v(T[2],T[3],0,T[4]):v(T[1],T[2],T[3],T[4]):null}var O=function(){function m(){this.values=Object.create(null)}var v=m.prototype;return v.set=function(o,t){!this.get(o)&&t!==""&&(this.values[o]=t)},v.get=function(o,t,s){return s?this.has(o)?this.values[o]:t[s]:this.has(o)?this.values[o]:t},v.has=function(o){return o in this.values},v.alt=function(o,t,s){for(var g=0;g<s.length;++g)if(t===s[g]){this.set(o,t);break}},v.integer=function(o,t){/^-?\d+$/.test(t)&&this.set(o,parseInt(t,10))},v.percent=function(o,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var s=parseFloat(t);if(s>=0&&s<=100)return this.set(o,s),!0}return!1},m}();function S(m,v,T,o){var t=o?m.split(o):[m];for(var s in t)if(typeof t[s]=="string"){var g=t[s].split(T);if(g.length===2){var E=g[0],d=g[1];v(E,d)}}}var L=new a.default(0,0,""),u=L.align==="middle"?"middle":"center";function n(m,v,T){var o=m;function t(){var E=c(m);if(E===null)throw new Error("Malformed timestamp: "+o);return m=m.replace(/^[^\sa-zA-Z-]+/,""),E}function s(E,d){var r=new O;S(E,function(x,b){var D;switch(x){case"region":for(var p=T.length-1;p>=0;p--)if(T[p].id===b){r.set(x,T[p].region);break}break;case"vertical":r.alt(x,b,["rl","lr"]);break;case"line":D=b.split(","),r.integer(x,D[0]),r.percent(x,D[0])&&r.set("snapToLines",!1),r.alt(x,D[0],["auto"]),D.length===2&&r.alt("lineAlign",D[1],["start",u,"end"]);break;case"position":D=b.split(","),r.percent(x,D[0]),D.length===2&&r.alt("positionAlign",D[1],["start",u,"end","line-left","line-right","auto"]);break;case"size":r.percent(x,b);break;case"align":r.alt(x,b,["start",u,"end","left","right"]);break}},/:/,/\s/),d.region=r.get("region",null),d.vertical=r.get("vertical","");var l=r.get("line","auto");l==="auto"&&L.line===-1&&(l=-1),d.line=l,d.lineAlign=r.get("lineAlign","start"),d.snapToLines=r.get("snapToLines",!0),d.size=r.get("size",100),d.align=r.get("align",u);var A=r.get("position","auto");A==="auto"&&L.position===50&&(A=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=A}function g(){m=m.replace(/^\s+/,"")}if(g(),v.startTime=t(),g(),m.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+o);m=m.slice(3),g(),v.endTime=t(),g(),s(m,v)}function f(m){return m.replace(/<br(?: \/)?>/gi,`
`)}var h=function(){function m(){this.state="INITIAL",this.buffer="",this.decoder=new e,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var v=m.prototype;return v.parse=function(o){var t=this;o&&(t.buffer+=t.decoder.decode(o,{stream:!0}));function s(){var A=t.buffer,x=0;for(A=f(A);x<A.length&&A[x]!=="\r"&&A[x]!==`
`;)++x;var b=A.slice(0,x);return A[x]==="\r"&&++x,A[x]===`
`&&++x,t.buffer=A.slice(x),b}function g(A){S(A,function(x,b){},/:/)}try{var E="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;E=s();var d=E.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!d||!d[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var r=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(r?r=!1:E=s(),t.state){case"HEADER":/:/.test(E)?g(E):E||(t.state="ID");continue;case"NOTE":E||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(E)){t.state="NOTE";break}if(!E)continue;if(t.cue=new a.default(0,0,""),t.state="CUE",E.indexOf("-->")===-1){t.cue.id=E;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{n(E,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{var l=E.indexOf("-->")!==-1;if(!E||l&&(r=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=E}continue;case"BADCUE":E||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},v.flush=function(){var o=this;try{if((o.cue||o.state==="HEADER")&&(o.buffer+=`

`,o.parse()),o.state==="INITIAL"||o.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){o.onparsingerror&&o.onparsingerror(t)}return o.onflush&&o.onflush(),this},m}()},"./src/utils/webvtt-parser.ts":function(R,M,i){i.r(M),i.d(M,"generateCueId",function(){return h}),i.d(M,"parseWebVTT",function(){return v});var a=i("./src/polyfills/number.ts"),e=i("./src/utils/vttparser.ts"),c=i("./src/demux/id3.ts"),O=i("./src/utils/timescale-conversion.ts"),S=i("./src/remux/mp4-remuxer.ts"),L=/\r\n|\n\r|\n|\r/g,u=function(o,t,s){return s===void 0&&(s=0),o.slice(s,s+t.length)===t},n=function(o){var t=parseInt(o.slice(-3)),s=parseInt(o.slice(-6,-4)),g=parseInt(o.slice(-9,-7)),E=o.length>9?parseInt(o.substring(0,o.indexOf(":"))):0;if(!Object(a.isFiniteNumber)(t)||!Object(a.isFiniteNumber)(s)||!Object(a.isFiniteNumber)(g)||!Object(a.isFiniteNumber)(E))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+o);return t+=1e3*s,t+=60*1e3*g,t+=60*60*1e3*E,t},f=function(o){for(var t=5381,s=o.length;s;)t=t*33^o.charCodeAt(--s);return(t>>>0).toString()};function h(T,o,t){return f(T.toString())+f(o.toString())+f(t)}var m=function(o,t,s){var g=o[t],E=o[g.prevCC];if(!E||!E.new&&g.new){o.ccOffset=o.presentationOffset=g.start,g.new=!1;return}for(;(d=E)!==null&&d!==void 0&&d.new;){var d;o.ccOffset+=g.start-E.start,g.new=!1,g=E,E=o[g.prevCC]}o.presentationOffset=s};function v(T,o,t,s,g,E,d,r){var l=new e.VTTParser,A=Object(c.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(L,`
`).split(`
`),x=[],b=Object(O.toMpegTsClockFromTimescale)(o,t),D="00:00.000",p=0,y=0,I,C=!0;l.oncue=function(P){var w=s[g],k=s.ccOffset,F=(p-b)/9e4;w!=null&&w.new&&(y!==void 0?k=s.ccOffset=w.start:m(s,g,F)),F&&(k=F-s.presentationOffset);var _=P.endTime-P.startTime,B=Object(S.normalizePts)((P.startTime+k-y)*9e4,E*9e4)/9e4;P.startTime=Math.max(B,0),P.endTime=Math.max(B+_,0);var N=P.text.trim();P.text=decodeURIComponent(encodeURIComponent(N)),P.id||(P.id=h(P.startTime,P.endTime,N)),P.endTime>0&&x.push(P)},l.onparsingerror=function(P){I=P},l.onflush=function(){if(I){r(I);return}d(x)},A.forEach(function(P){if(C)if(u(P,"X-TIMESTAMP-MAP=")){C=!1,P.slice(16).split(",").forEach(function(w){u(w,"LOCAL:")?D=w.slice(6):u(w,"MPEGTS:")&&(p=parseInt(w.slice(7)))});try{y=n(D)/1e3}catch(w){I=w}return}else P===""&&(C=!1);l.parse(P+`
`)}),l.flush()}},"./src/utils/xhr-loader.ts":function(R,M,i){i.r(M);var a=i("./src/utils/logger.ts"),e=i("./src/loader/load-stats.ts"),c=/^age:\s*[\d.]+\s*$/m,O=function(){function S(u){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=u?u.xhrSetup:null,this.stats=new e.LoadStats,this.retryDelay=0}var L=S.prototype;return L.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},L.abortInternal=function(){var n=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),n&&(n.onreadystatechange=null,n.onprogress=null,n.readyState!==4&&(this.stats.aborted=!0,n.abort()))},L.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},L.load=function(n,f,h){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=n,this.config=f,this.callbacks=h,this.retryDelay=f.retryDelay,this.loadInternal()},L.loadInternal=function(){var n=this.config,f=this.context;if(!!n){var h=this.loader=new self.XMLHttpRequest,m=this.stats;m.loading.first=0,m.loaded=0;var v=this.xhrSetup;try{if(v)try{v(h,f.url)}catch{h.open("GET",f.url,!0),v(h,f.url)}h.readyState||h.open("GET",f.url,!0);var T=this.context.headers;if(T)for(var o in T)h.setRequestHeader(o,T[o])}catch(t){this.callbacks.onError({code:h.status,text:t.message},f,h);return}f.rangeEnd&&h.setRequestHeader("Range","bytes="+f.rangeStart+"-"+(f.rangeEnd-1)),h.onreadystatechange=this.readystatechange.bind(this),h.onprogress=this.loadprogress.bind(this),h.responseType=f.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),h.send()}},L.readystatechange=function(){var n=this.context,f=this.loader,h=this.stats;if(!(!n||!f)){var m=f.readyState,v=this.config;if(!h.aborted&&m>=2)if(self.clearTimeout(this.requestTimeout),h.loading.first===0&&(h.loading.first=Math.max(self.performance.now(),h.loading.start)),m===4){f.onreadystatechange=null,f.onprogress=null;var T=f.status;if(T>=200&&T<300){h.loading.end=Math.max(self.performance.now(),h.loading.first);var o,t;if(n.responseType==="arraybuffer"?(o=f.response,t=o.byteLength):(o=f.responseText,t=o.length),h.loaded=h.total=t,!this.callbacks)return;var s=this.callbacks.onProgress;if(s&&s(h,n,o,f),!this.callbacks)return;var g={url:f.responseURL,data:o};this.callbacks.onSuccess(g,h,n,f)}else h.retry>=v.maxRetry||T>=400&&T<499?(a.logger.error(T+" while loading "+n.url),this.callbacks.onError({code:T,text:f.statusText},n,f)):(a.logger.warn(T+" while loading "+n.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,v.maxRetryDelay),h.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),v.timeout)}},L.loadtimeout=function(){a.logger.warn("timeout while loading "+this.context.url);var n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))},L.loadprogress=function(n){var f=this.stats;f.loaded=n.loaded,n.lengthComputable&&(f.total=n.total)},L.getCacheAge=function(){var n=null;if(this.loader&&c.test(this.loader.getAllResponseHeaders())){var f=this.loader.getResponseHeader("age");n=f?parseFloat(f):null}return n},S}();M.default=O}}).default})})(jt);const Zt=Ft(jt.exports);export{Xt as A,Zt as H,Qt as a};
